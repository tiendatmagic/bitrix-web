
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.min.js?17264564252044";s:6:"source";s:75:"/bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.js";s:3:"min";s:79:"/bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.min.js";s:3:"map";s:79:"/bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.map.js";}"*/
function __logGetNextPageLinkEntities(e,i){if(!!window.__logGetNextPageFormName&&!!e&&!!i&&!!window["UC"]&&!!window["UC"][window.__logGetNextPageFormName]&&!!window["UC"][window.__logGetNextPageFormName].linkEntity){window["UC"][window.__logGetNextPageFormName].linkEntity(e);for(var t in i){if(!!t&&i.hasOwnProperty(t)&&!!i[t]){window["UC"][window.__logGetNextPageFormName].entitiesCorrespondence[t]=i[t]}}}}function __logChangeFavorites(e,i,t,n,o){BX.Livefeed.FeedInstance.changeFavorites({logId:e,node:i,newState:t,fromMenu:!!n,event:o})}BitrixLF=function(){this.cmdPressed=null;this.tagEntryIdList=[];this.inlineTagNodeList=[];if(window.top!==window&&window.top.BX.Tasks&&window.BX.Tasks&&window.BX.Tasks.CommentActionController){window.top.BX.Tasks.CommentActionController=window.BX.Tasks.CommentActionController}if(BX.Tasks&&BX.Tasks.CommentActionController){void BX.Tasks.CommentActionController.init()}};BitrixLF.prototype.init=function(e){this.cmdPressed=false;if(BX.Livefeed&&BX.Livefeed.InformerInstance){BX.Livefeed.InformerInstance.lockCounterAnimation=false}BX.addCustomEvent("onFrameDataProcessed",(function(){if(BX.Livefeed&&BX.Livefeed.InformerInstance){BX.Livefeed.InformerInstance.lockCounterAnimation=false}}));if(BX.Livefeed&&BX.Livefeed.PageInstance){BX.Livefeed.PageInstance.init();if(BX.type.isPlainObject(e)){BX.Livefeed.PageInstance.firstPageLastTS=!BX.type.isUndefined(e.firstPageLastTS)?e.firstPageLastTS:0;BX.Livefeed.PageInstance.firstPageLastId=!BX.type.isUndefined(e.firstPageLastId)?e.firstPageLastId:0;BX.Livefeed.PageInstance.useBXMainFilter=!BX.type.isUndefined(e.useBXMainFilter)?e.useBXMainFilter:"N";if(BX.type.isNotEmptyString(e.blogCommentFormUID)){BX.Livefeed.PageInstance.blogCommentFormUID=e.blogCommentFormUID}}}};BitrixLF.prototype.LazyLoadCheckVisibility=function(e){return BX.Livefeed.MoreButton.lazyLoadCheckVisibility(e)};BitrixLF.prototype.createTask=function(e){BX.Livefeed.TaskCreator.create(e)};if(typeof oLF=="undefined"){oLF=new BitrixLF;window.oLF=oLF}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/socialnetwork.log.entry/templates/.default/scripts.min.js?17264564259164";s:6:"source";s:79:"/bitrix/components/bitrix/socialnetwork.log.entry/templates/.default/scripts.js";s:3:"min";s:83:"/bitrix/components/bitrix/socialnetwork.log.entry/templates/.default/scripts.min.js";s:3:"map";s:83:"/bitrix/components/bitrix/socialnetwork.log.entry/templates/.default/scripts.map.js";}"*/
window["__logCommentsListRedefine"]=function(e,t,n,a){if(window["UC"]&&!!window["UC"][e]){BX.addCustomEvent(window["UC"][e],"OnUCListWasBuilt",function(t,n,s){if(BX(s)&&s.hasChildNodes){var i=s.firstChild,o;do{if(BX(i)&&i["getAttribute"]){o=i.getAttribute("id").replace("record-"+e+"-","").replace("-cover","");BX.onCustomEvent(window,"OnUCAddEntitiesCorrespondence",[e+"-"+o,[a,top["arLogCom"+a+o]]])}}while(i=i.nextSibling)}})}if(!!window.mplCheckForQuote)BX.bind(BX(t),"mouseup",function(t){mplCheckForQuote(t,this,e,n)})};window["__logBuildRating"]=function(e,t,n){var a="";n=!!n?n:Math.floor(Math.random()*1e5)+1;if(BX.message("sonetLShowRating")=="Y"&&!!e["RATING_TYPE_ID"]>0&&e["RATING_ENTITY_ID"]>0&&(BX.message("sonetLRatingType")=="like"&&!!window["RatingLike"]||BX.message("sonetLRatingType")=="standart_text"&&!!window["Rating"])){if(BX.message("sonetLRatingType")=="like"){var s=e["RATING_USER_VOTE_VALUE"]>0?" bx-you-like":"",i=e["RATING_USER_VOTE_VALUE"]>0?BX.message("sonetLTextLikeN"):BX.message("sonetLTextLikeY"),o=null;if(!!t["ALLOW_VOTE"]&&!!t["ALLOW_VOTE"]["RESULT"])o=BX.create("span",{props:{className:"bx-ilike-text"},html:i});a=BX.create("span",{attrs:{id:"sonet-rating-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n},props:{className:"sonet-log-comment-like rating_vote_text"},children:[BX.create("span",{props:{className:"ilike-light"},children:[BX.create("span",{props:{id:"bx-ilike-button-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n,className:"bx-ilike-button"},children:[BX.create("span",{props:{className:"bx-ilike-right-wrap"+s},children:[BX.create("span",{props:{className:"bx-ilike-right"},html:e["RATING_TOTAL_POSITIVE_VOTES"]})]}),BX.create("span",{props:{className:"bx-ilike-left-wrap"},children:[o]})]}),BX.create("span",{props:{id:"bx-ilike-popup-cont-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n,className:"bx-ilike-wrap-block"},style:{display:"none"},children:[BX.create("span",{props:{className:"bx-ilike-popup"},children:[BX.create("span",{props:{className:"bx-ilike-wait"}})]})]})]})]})}else if(BX.message("sonetLRatingType")=="standart_text"){a=BX.create("span",{attrs:{id:"sonet-rating-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n},props:{className:"sonet-log-comment-like rating_vote_text"},children:[BX.create("span",{props:{className:"bx-rating"+(!t["ALLOW_VOTE"]["RESULT"]?" bx-rating-disabled":"")+(e["RATING_USER_VOTE_VALUE"]!=0?" bx-rating-active":""),id:"bx-rating-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n,title:!t["ALLOW_VOTE"]["RESULT"]?t["ERROR_MSG"]:""},children:[BX.create("span",{props:{className:"bx-rating-absolute"},children:[BX.create("span",{props:{className:"bx-rating-question"},html:!t["ALLOW_VOTE"]["RESULT"]?BX.message("sonetLTextDenied"):BX.message("sonetLTextAvailable")}),BX.create("span",{props:{className:"bx-rating-yes "+(e["RATING_USER_VOTE_VALUE"]>0?"  bx-rating-yes-active":""),title:e["RATING_USER_VOTE_VALUE"]>0?BX.message("sonetLTextCancel"):BX.message("sonetLTextPlus")},children:[BX.create("a",{props:{className:"bx-rating-yes-count",href:"#like"},html:""+parseInt(e["RATING_TOTAL_POSITIVE_VOTES"])}),BX.create("a",{props:{className:"bx-rating-yes-text",href:"#like"},html:BX.message("sonetLTextRatingY")})]}),BX.create("span",{props:{className:"bx-rating-separator"},html:"/"}),BX.create("span",{props:{className:"bx-rating-no "+(e["RATING_USER_VOTE_VALUE"]<0?"  bx-rating-no-active":""),title:e["RATING_USER_VOTE_VALUE"]<0?BX.message("sonetLTextCancel"):BX.message("sonetLTextMinus")},children:[BX.create("a",{props:{className:"bx-rating-no-count",href:"#dislike"},html:""+parseInt(e["RATING_TOTAL_NEGATIVE_VOTES"])}),BX.create("a",{props:{className:"bx-rating-no-text",href:"#dislike"},html:BX.message("sonetLTextRatingN")})]})]})]}),BX.create("span",{props:{id:"bx-rating-popup-cont-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n+"-plus"},style:{display:"none"},children:[BX.create("span",{props:{className:"bx-ilike-popup  bx-rating-popup"},children:[BX.create("span",{props:{className:"bx-ilike-wait"}})]})]}),BX.create("span",{props:{id:"bx-rating-popup-cont-"+e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n+"-minus"},style:{display:"none"},children:[BX.create("span",{props:{className:"bx-ilike-popup  bx-rating-popup"},children:[BX.create("span",{props:{className:"bx-ilike-wait"}})]})]})]})}}if(!!a){a=BX.create("span",{children:[a]});a=a.innerHTML+'<script>window["#OBJ#"].Set("#ID#", "#RATING_TYPE_ID#", #RATING_ENTITY_ID#, "#ALLOW_VOTE#", BX.message("sonetLCurrentUserID"), #TEMPLATE#, "light", BX.message("sonetLPathToUser"));<\/script>'.replace("#OBJ#",BX.message("sonetLRatingType")=="like"?"RatingLike":"Rating").replace("#ID#",e["RATING_TYPE_ID"]+"-"+e["RATING_ENTITY_ID"]+"-"+n).replace("#RATING_TYPE_ID#",e["RATING_TYPE_ID"]).replace("#RATING_ENTITY_ID#",e["RATING_ENTITY_ID"]).replace("#ALLOW_VOTE#",!!t["ALLOW_VOTE"]&&!!t["ALLOW_VOTE"]["RESULT"]?"Y":"N").replace("#TEMPLATE#",BX.message("sonetLRatingType")=="like"?'{LIKE_Y:BX.message("sonetLTextLikeN"),LIKE_N:BX.message("sonetLTextLikeY"),LIKE_D:BX.message("sonetLTextLikeD")}':'{PLUS:BX.message("sonetLTextPlus"),MINUS:BX.message("sonetLTextMinus"),CANCEL:BX.message("sonetLTextCancel")}')}return a};window["__logShowCommentForm"]=function(e){if(!!window["UC"][e])window["UC"][e].reply()};function __logShowHiddenDestination(e,t,n){BX.ajax.runAction("socialnetwork.api.livefeed.logentry.getHiddenDestinations",{data:{params:{logId:e,createdById:t,pathToUser:BX.message("sonetLPathToUser"),pathToWorkgroup:BX.message("sonetLPathToGroup"),pathToDepartment:BX.message("sonetLPathToDepartment"),nameTemplate:BX.message("sonetLNameTemplate"),showLogin:BX.message("sonetLShowLogin"),destinationLimit:BX.message("sonetLDestinationLimit")}}}).then(function(e){var t=e.data.destinationList;if(!BX.type.isNotEmptyObject(t)){return}if(BX(n)){var a=n.parentNode;a.removeChild(n);var s="";for(var i in t){if(!t.hasOwnProperty(i)){continue}if(BX.type.isNotEmptyString(t[i]["TITLE"])){a.appendChild(BX.create("SPAN",{html:", "}));if(BX.type.isNotEmptyString(t[i]["CRM_PREFIX"])){a.appendChild(BX.create("SPAN",{props:{className:"feed-add-post-destination-prefix"},html:t[i]["CRM_PREFIX"]+":&nbsp;"}))}if(BX.type.isNotEmptyString(t[i]["URL"])){a.appendChild(BX.create("A",{props:{className:"feed-add-post-destination-new"+(BX.type.isNotEmptyString(t[i]["IS_EXTRANET"])&&t[i]["IS_EXTRANET"]=="Y"?" feed-post-user-name-extranet":""),href:t[i]["URL"]},html:t[i]["TITLE"]}))}else{a.appendChild(BX.create("SPAN",{props:{className:"feed-add-post-destination-new"+(BX.type.isNotEmptyString(t[i]["IS_EXTRANET"])&&t[i]["IS_EXTRANET"]=="Y"?" feed-post-user-name-extranet":"")},html:t[i]["TITLE"]}))}}}if(typeof e.data["hiddenDestinationsCount"]!="undefined"&&parseInt(e.data["hiddenDestinationsCount"])>0){e.data["hiddenDestinationsCount"]=parseInt(e.data["hiddenDestinationsCount"]);var o=e.data["hiddenDestinationsCount"]%100>10&&e.data["hiddenDestinationsCount"]%100<20?5:e.data["hiddenDestinationsCount"]%10;a.appendChild(BX.create("SPAN",{html:"&nbsp;"+BX.message("sonetLDestinationHidden"+o).replace("#COUNT#",e.data["hiddenDestinationsCount"])}))}}},function(e){})}function __logSetFollow(e){return BX.Livefeed.FeedInstance.changeFollow({logId:e})}function __logRefreshEntry(e){var t=e.node!==undefined?BX(e.node):false;var n=e.logId!==undefined?parseInt(e.logId):0;if(!t||n<=0||BX.message("sonetLEPath")===undefined){return}BX.ajax({url:BX.message("sonetLEPath").replace("#log_id#",n),method:"POST",dataType:"json",data:{log_id:n,action:"get_entry"},onsuccess:function(e){if(e["ENTRY_HTML"]!==undefined){BX.cleanNode(t);t.innerHTML=e["ENTRY_HTML"];var n=BX.processHTML(t.innerHTML,true);var a=n.SCRIPT;BX.ajax.processScripts(a,true)}},onfailure:function(e){}});return false}window.__logEditComment=function(e,t,n){BX.ajax.runAction("socialnetwork.api.livefeed.comment.getsource",{data:{params:{postId:n,commentId:t}}}).then(function(t){var a=t.data;var s={messageBBCode:a.message,messageFields:{arFiles:BX.type.isNotEmptyObject(a.UF.UF_SONET_COM_FILE)?a.UF.UF_SONET_COM_FILE.VALUE:[]}};if(BX.type.isNotEmptyObject(a.UF.UF_SONET_COM_DOC)&&BX.type.isNotEmptyString(a.UF.UF_SONET_COM_DOC.USER_TYPE_ID)){if(a.UF.UF_SONET_COM_DOC.USER_TYPE_ID=="webdav_element"){s.messageFields.arDocs=a.UF.UF_SONET_COM_DOC.VALUE}else if(a.UF.UF_SONET_COM_DOC.USER_TYPE_ID=="disk_file"){s.messageFields.arDFiles=a.UF.UF_SONET_COM_DOC.VALUE}}window.UC[window.SLEC.formKey].entitiesCorrespondence[e+"-"+a.sourceId]=[n,a.id];BX.onCustomEvent(window,"OnUCAfterRecordEdit",[e,a.sourceId,s,"EDIT"])},function(){})};(function(){BX.SocialnetworkLogEntry={};BX.SocialnetworkLogEntry.registerViewAreaList=function(e){if(typeof e=="undefined"||typeof e.containerId=="undefined"||typeof e.className=="undefined"){return}if(BX(e.containerId)){var t=BX.findChildren(BX(e.containerId),{tag:"div",className:e.className},true),n=null;for(var a=0,s=t.length;a<s;a++){if(t[a].id.length>0){n=null;if(BX.type.isNotEmptyString(e.fullContentClassName)){n=BX.findChild(t[a],{className:e.fullContentClassName})}BX.UserContentView.registerViewArea(t[a].id,n?n:null)}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:103:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/templates/.default/script.min.js?172645642550105";s:6:"source";s:83:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/templates/.default/script.js";s:3:"min";s:87:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/templates/.default/script.min.js";s:3:"map";s:87:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};this.BX.Socialnetwork=this.BX.Socialnetwork||{};(function(e,t,i,s,o,n){"use strict";var a=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"htmlWasInserted",false);babelHelpers.defineProperty(this,"scriptsLoaded",false)}babelHelpers.createClass(e,[{key:"processCSS",value:function e(t,i){if(o.Type.isArray(t.CSS)&&t.CSS.length>0){BX.load(t.CSS,i)}else{i()}}},{key:"processExternalJS",value:function e(t,i){if(o.Type.isArray(t.JS)&&t.JS.length>0){BX.load(t.JS,i)}else{i()}}},{key:"processAjaxBlockInsertHTML",value:function e(t,i,s){i.appendChild(BX.create("DIV",{html:t.CONTENT}));this.htmlWasInserted=true;if(this.scriptsLoaded){this.processInlineJS(t,s)}}},{key:"processInlineJS",value:function e(t,i){this.scriptsLoaded=true;if(this.htmlWasInserted){BX.ajax.processRequestData(t.CONTENT,{scriptsRunFirst:false,dataType:"HTML"});i()}}}]);return e}();var r=function(){babelHelpers.createClass(e,null,[{key:"setInstance",value:function t(i){e.instance=i}},{key:"getInstance",value:function t(){return e.instance}}]);function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"lazyLoad",null);babelHelpers.defineProperty(this,"ajaxUrl","");babelHelpers.defineProperty(this,"inited",false);babelHelpers.defineProperty(this,"loaded",false);babelHelpers.defineProperty(this,"container",null);babelHelpers.defineProperty(this,"containerMicro",null);babelHelpers.defineProperty(this,"containerMicroInner",null);babelHelpers.defineProperty(this,"clickDisabled",false);babelHelpers.defineProperty(this,"lastWait",[]);babelHelpers.defineProperty(this,"animationStartHeight",0);babelHelpers.defineProperty(this,"initedEditorsList",[]);babelHelpers.defineProperty(this,"options",{});this.init(t);e.setInstance(this)}babelHelpers.createClass(e,[{key:"setOption",value:function e(t,i){if(!o.Type.isStringFilled(t)){return}this.options[t]=i}},{key:"onShow",value:function e(){if(!o.Type.isStringFilled(this.options.startVideoRecorder)||this.options.startVideoRecorder!=="Y"){return}setTimeout((function(){var e=document.getElementById("divoPostFormLHE_blogPostForm");if(!e){return}n.EventEmitter.emit(e,"OnShowLHE",new n.BaseEvent({compatData:["justShow"]}));BX.VideoRecorder.start("blogPostForm","post")}),500)}},{key:"onSliderClose",value:function e(){var t=BX.SidePanel.Instance.getTopSlider();if(!t){return}BX.SidePanel.Instance.postMessageAll(window,"SidePanel.Wrapper:onClose",{sliderData:t.getData()})}},{key:"init",value:function e(t){var i=this;if(this.inited!==true){this.inited=true;this.lazyLoad=!o.Type.isUndefined(t.lazyLoad)?!!t.lazyLoad:false;this.ajaxUrl=o.Type.isStringFilled(t.ajaxUrl)?t.ajaxUrl:"";this.container=o.Type.isDomNode(t.container)?t.container:null;this.containerMicro=o.Type.isDomNode(t.containerMicro)?t.containerMicro:null;this.containerMicroInner=o.Type.isDomNode(t.containerMicroInner)?t.containerMicroInner:null;this.successPostId=!o.Type.isUndefined(t.successPostId)&&parseInt(t.successPostId)>0?parseInt(t.successPostId):0;if(this.containerMicro){this.containerMicro.setAttribute("dropzone","copy f:*/*");var s=0;var a=function e(t){if(s>0){clearTimeout(s);s=0}t.stopPropagation();t.preventDefault()};var r=function e(t){a(t);i.containerMicro.click()};var l=function e(t){if(s<=0){s=setTimeout((function(){r(t)}),3e3)}t.stopPropagation();t.preventDefault()};this.containerMicro.addEventListener("dragover",l);this.containerMicro.addEventListener("dragenter",l);this.containerMicro.addEventListener("dragleave",a);this.containerMicro.addEventListener("dragexit",a);this.containerMicro.addEventListener("drop",a)}}var d=BX.SidePanel.Instance.getTopSlider();if(d){if(this.successPostId>0){BX.SidePanel.Instance.postMessage(window,"Socialnetwork.PostForm:onAdd",{originatorSliderId:d.getData().get("sliderId"),successPostId:this.successPostId});BX.SidePanel.Instance.close()}else if(!d.getData().get("initialized")){n.EventEmitter.subscribe(d,"BX.Socialnetwork.SidePanel.Slider:onClose",this.onSliderClose);d.getData().set("initialized",true)}}}},{key:"get",value:function e(t){var i=this;if(this.clickDisabled){return}if(this.lazyLoad&&!this.loaded){this.clickDisabled=true;this.animationStartHeight=this.containerMicro.offsetHeight;if(o.Type.isStringFilled(t.loaderType)&&t.loaderType==="tab"){this.showWaitTab()}else{this.containerMicroInner.style.display="none";this.showWait(this.containerMicro)}o.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{action:"SBPE_get_full_form",sessid:o.Loc.getMessage("bitrix_sessid")},onsuccess:function e(s){i.loaded=true;i.clickDisabled=false;i.closeWait();if(s.success){i.processAjaxBlock(s.PROPS,t.callback)}},onfailure:function e(){i.clickDisabled=false;i.closeWait();i.containerMicroInner.style.display="block"}})}else if(o.Type.isFunction(t.callback)){t.callback()}}},{key:"processAjaxBlock",value:function e(t,i){var s=this;if(!t){return}var o=new a;o.processCSS(t,(function(){o.processAjaxBlockInsertHTML(t,s.container,i)}));o.processExternalJS(t,(function(){o.processInlineJS(t,i)}))}},{key:"showWait",value:function e(t){var i=this;var s=t.bxmsg=document.body.appendChild(o.Dom.create("DIV",{props:{id:"wait_".concat(t.id),className:"feed-add-post-loader-cont"},html:'<svg class="feed-add-post-loader" viewBox="25 25 50 50"><circle class="feed-add-post-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"></circle><circle class="feed-add-post-loader-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"></circle></svg>'}));setTimeout((function(){i.adjustWait(t)}),10);this.lastWait.push(s);return s}},{key:"showWaitTab",value:function e(){if(!BX("feed-add-post-more-icon")||!BX("feed-add-post-more-icon-waiter")){return}BX("feed-add-post-more-icon").style.display="none";BX("feed-add-post-more-icon-waiter").style.display="block"}},{key:"closeWait",value:function e(){var t=this.containerMicro.bxmsg;if(t&&t.parentNode){for(var i=0,s=this.lastWait.length;i<s;i++){if(t===this.lastWait[i]){this.lastWait=BX.util.deleteFromArray(this.lastWait,i);break}}t.parentNode.removeChild(t);if(this.containerMicro){this.containerMicro.bxmsg=null}o.Dom.clean(t);o.Dom.remove(t)}if(BX("feed-add-post-more-icon")&&BX("feed-add-post-more-icon-waiter")&&BX("feed-add-post-more-icon").style.display==="none"){BX("feed-add-post-more-icon").style.display="block";BX("feed-add-post-more-icon-waiter").style.display="none"}}},{key:"adjustWait",value:function e(t){if(!t.bxmsg){return}var i=BX.pos(t);var s=i.top+15;if(s<BX.GetDocElement().scrollTop){s=BX.GetDocElement().scrollTop+5}t.bxmsg.style.top="".concat(s+5,"px");if(t===BX.GetDocElement()){t.bxmsg.style.right="5px"}else{t.bxmsg.style.left="".concat(i.left+parseInt((i.width-t.bxmsg.offsetWidth)/2),"px")}}},{key:"tasksTaskEvent",value:function e(t){if(!o.Reflection.getClass("BX.UI.Notification.Center")){return}var i=o.Loc.getMessage("PATH_TO_USER_TASKS_TASK").replace("#user_id#",o.Loc.getMessage("USER_ID")).replace("#task_id#",t).replace("#action#","view");window.top.BX.UI.Notification.Center.notify({content:o.Loc.getMessage("BLOG_POST_EDIT_T_CREATE_TASK_SUCCESS_TITLE"),actions:[{title:o.Loc.getMessage("BLOG_POST_EDIT_T_CREATE_TASK_BUTTON_TITLE"),events:{click:function e(t,s,o){s.close();window.top.BX.SidePanel.Instance.open(i)}}}]})}}]);return e}();babelHelpers.defineProperty(r,"instance",null);var l=function(e){babelHelpers.inherits(i,e);babelHelpers.createClass(i,null,[{key:"setInstance",value:function e(t){i.instance=t}},{key:"getInstance",value:function e(){if(i.instance===null){new i}return i.instance}}]);function i(){var e;babelHelpers.classCallCheck(this,i);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"inited",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"tabs",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"bodies",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"active",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"animation",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"animationStartHeight",0);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"previousTab",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"menu",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"listsMenu",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"menuItems",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"lastWait",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"clickDisabled",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"tabContainer",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"arrow",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"config",{id:{message:"message",task:"tasks",calendar:"calendar",file:"file",gratitude:"grat",important:"important",vote:"vote",more:"more",listItem:"lists"}});e.setEventNamespace("BX.Socialnetwork.Livefeed.Post.Form.Tabs");e.init();e.emit("onInitialized",{tabsInstance:babelHelpers.assertThisInitialized(e)});i.setInstance(babelHelpers.assertThisInitialized(e));window.SBPETabs=babelHelpers.assertThisInitialized(e);return e}babelHelpers.createClass(i,[{key:"init",value:function e(){var t=this;this.tabContainer=document.getElementById("feed-add-post-form-tab");this.arrow=document.getElementById("feed-add-post-form-tab-arrow");this.tabs={};this.bodies={};var i=this.tabContainer&&this.tabContainer.querySelectorAll("span.feed-add-post-form-link");if(i){for(var s=0;s<i.length;s++){var n=i[s].getAttribute("id").replace("feed-add-post-form-tab-","");var a=i[s].getAttribute("limited");this.tabs[n]=i[s];if(this.tabs[n].style.display==="none"){this.menuItems.push({tabId:n,text:i[s].getAttribute("data-name"),className:"menu-popup-no-icon feed-add-post-form-".concat(n," feed-add-post-form-").concat(n,"-more"),onclick:this.createOnClick(n,i[s].getAttribute("data-name"),i[s].getAttribute("data-onclick"),i[s].getAttribute("data-limited")==="Y")});this.tabs[n]=this.tabs[n].parentNode}this.bodies[n]=document.getElementById("feed-add-post-content-".concat(n))}}if(!!this.tabs[this.config.id.file]){this.bodies[this.config.id.file]=[this.bodies[this.config.id.message]]}if(!!this.tabs[this.config.id.calendar]){this.bodies[this.config.id.calendar]=[this.bodies[this.config.id.calendar]]}if(!!this.tabs[this.config.id.vote]){this.bodies[this.config.id.vote]=[this.bodies[this.config.id.message],this.bodies[this.config.id.vote]]}if(!!this.tabs[this.config.id.more]){this.bodies[this.config.id.more]=null}if(!!this.tabs[this.config.id.important]){this.bodies[this.config.id.important]=[this.bodies[this.config.id.message],this.bodies[this.config.id.important]]}if(!!this.tabs[this.config.id.gratitude]){this.bodies[this.config.id.gratitude]=[this.bodies[this.config.id.message],this.bodies[this.config.id.gratitude]]}if(!!this.tabs[this.config.id.listItem]){this.bodies[this.config.id.listItem]=[this.bodies[this.config.id.listItem]]}if(!!this.tabs[this.config.id.task]){this.bodies[this.config.id.task]=[this.bodies[this.config.id.task]]}for(var r in this.bodies){if(this.bodies.hasOwnProperty(r)&&o.Type.isDomNode(this.bodies[r])){this.bodies[r]=[this.bodies[r]]}}this.inited=true;this.previousTab=false;var l=document.getElementById("bx-b-uploadfile-blogPostForm");if(l){l.setAttribute("bx-press","pressOut");o.Event.bind(l,"mousedown",(function(){l.setAttribute("bx-press",l.getAttribute("bx-press")=="pressOut"?"pressOn":"pressOut")}))}var d=document.getElementById("blogPostForm");if(!d){return}if(!d.changePostFormTab){d.appendChild(o.Dom.create("INPUT",{props:{type:"hidden",name:"changePostFormTab",value:""}}))}this.subscribe("changePostFormTab",(function(e){var i=e.getData(),s=i.type;if(s===t.config.id.more){return}d.changePostFormTab.value=s;if(d["UF_BLOG_POST_IMPRTNT"]){d["UF_BLOG_POST_IMPRTNT"].value=s===t.config.id.important?"1":"0"}}))}},{key:"createOnClick",value:function e(t,i,s,n){var a=this;return function(){var e=document.getElementById("feed-add-post-form-link-more");var r=document.getElementById("feed-add-post-form-link-text");if(!n){r.innerHTML=i;if(t!==a.config.id.listItem){e.className="feed-add-post-form-link feed-add-post-form-link-more feed-add-post-form-link-active feed-add-post-form-".concat(t,"-link");a.changePostFormTab(t,false)}else{e.className="feed-add-post-form-link feed-add-post-form-link-more feed-add-post-form-".concat(t,"-link")}}if(o.Type.isStringFilled(s)){BX.evalGlobal(s)}a.menu.popupWindow.close()}}},{key:"changePostFormTab",value:function e(t,i){if(this.clickDisabled){return false}return this.setActive(t,i)}},{key:"setActive",value:function e(t,i){var s=this;if(o.Type.isNull(t)||this.active===t&&t!==this.config.id.listItem){return this.active}else if(!this.tabs[t]){return false}var a=t!==this.config.id.task||this.isTaskTabLoaded();if(a){this.startAnimation()}for(var r in this.tabs){if(this.tabs.hasOwnProperty(r)&&r!==t){this.tabs[r].classList.remove("feed-add-post-form-link-active");if(this.bodies[r]==null||this.bodies[t]==null){continue}for(var l=0;l<this.bodies[r].length;l++){if(this.bodies[t][l]!=this.bodies[r][l]){o.Dom.adjust(this.bodies[r][l],{style:{display:"none"}})}}}}if(!!this.tabs[t]){this.active=t;var d=BX.pos(this.tabs[t],true);this.arrow.style.display="block";this.arrow.style.top="".concat(d.bottom,"px");var c=parseInt(this.arrow.style.left)||0;var u=parseInt(this.arrow.style.width)||0;new BX.easing({duration:200,start:{left:c,width:u},finish:{left:d.left,width:d.width},transition:BX.easing.makeEaseInOut(BX.easing.transitions.quart),step:function e(t){s.arrow.style.left="".concat(t.left,"px");s.arrow.style.width="".concat(t.width,"px")},complete:function e(){s.arrow.style.display="none";s.tabs[t].classList.add("feed-add-post-form-link-active")}}).animate();if(this.previousTab===this.config.id.file||t===this.config.id.file){var m=false;var f=false;var p=document.getElementById("divoPostFormLHE_blogPostForm");if(!!p&&!!p.childNodes&&p.childNodes.length>0){for(var h in p.childNodes){if(!p.childNodes.hasOwnProperty(h)){continue}if(p.childNodes[h].className==="file-selectdialog"){var b=p.childNodes[h];var g=b.querySelector(".file-placeholder-tbody");var v=b.querySelector(".feed-add-photo-block");if(g.rows>0||!!v&&v.length>1){m=true}}else if(o.Type.isStringFilled(p.childNodes[h].className)&&(p.childNodes[h].className.indexOf("wduf-selectdialog")>=0||p.childNodes[h].className.indexOf("diskuf-selectdialog")>=0)){var y=p.childNodes[h];var T=y.querySelectorAll(".wd-inline-file");f=!!T&&T.length>0}else if(o.Type.isDomNode(p.childNodes[h])&&p.childNodes[h].classList&&!p.childNodes[h].classList.contains("urlpreview")&&!p.childNodes[h].classList.contains("feed-add-post-strings-blocks")){o.Dom.adjust(p.childNodes[h],{style:{display:t===this.config.id.file?"none":""}})}}if(t===this.config.id.file){if(!!window["PlEditorblogPostForm"]&&!window["PlEditorblogPostForm"].SBPEBinded){window["PlEditorblogPostForm"].SBPEBinded=true;n.EventEmitter.subscribe(window["PlEditorblogPostForm"].eventNode,"onUploadsHasBeenChanged",(function(e){var t=e.getData()[1];if(t.dialogName==="AttachFileDialog"&&t.urlUpload.indexOf("&dropped=Y")<0){t.urlUpload=t.agent.uploadFileUrl=t.urlUpload.replace("&random_folder=Y","&dropped=Y")}document.getElementById("bx-b-uploadfile-blogPostForm").setAttribute("bx-press","pressOn");if(s.active!==s.config.id.file){s.changePostFormTab(s.config.id.message)}}))}window["PlEditorblogPostForm"].controllerInit("show");p.classList.add("feed-add-post-form","feed-add-post-edit-form","feed-add-post-edit-form-file")}else{p.classList.remove("feed-add-post-form","feed-add-post-edit-form","feed-add-post-edit-form-file");if(!m&&!f&&document.getElementById("bx-b-uploadfile-blogPostForm").getAttribute("bx-press")==="pressOut"&&!!window["PlEditorblogPostForm"]){window["PlEditorblogPostForm"].controllerInit("hide")}}}}var E=document.getElementById("divoPostFormLHE_blogPostForm");if(E&&E.style.display==="none"){n.EventEmitter.emit(E,"OnShowLHE",new n.BaseEvent({compatData:["justShow"]}))}if(t===this.config.id.listItem){n.EventEmitter.emit("onDisplayClaimLiveFeed",new n.BaseEvent({compatData:[i]}))}this.previousTab=t;if(!!this.bodies[t]){for(var I=0;I<this.bodies[t].length;I++){if(!!this.bodies[t][I]){o.Dom.adjust(this.bodies[t][I],{style:{display:"block"}})}}}}if(a){this.endAnimation()}if(t!==this.config.id.listItem){this.restoreMoreMenu()}this.emit("changePostFormTab",{type:t});return this.active}},{key:"isTaskTabLoaded",value:function e(){var t=document.getElementById("feed-add-post-content-tasks-container");return t&&t.children.length}},{key:"collapse",value:function e(){this.active=null;var t=false;var i=window!==top.window?BX.SidePanel.Instance.getSliderByWindow(window):null;if(window!==top.window){if(i&&i.url.match(/\/user\/(\d+)\/blog\/edit\//)){t=true}}if(!t){this.changePostFormTab("message");var s=r.getInstance();if(s&&o.Type.isDomNode(s.containerMicroInner)){s.containerMicroInner.style.display="block"}this.startAnimation()}var a=document.getElementById("divoPostFormLHE_blogPostForm");if(a){n.EventEmitter.emit(a,"OnShowLHE",new n.BaseEvent({compatData:[false]}))}n.EventEmitter.emit("onExtAutoSaveReset_blogPostForm",new n.BaseEvent({compatData:[]}));if(!t){this.endAnimation()}else{if(i){n.EventEmitter.emit(window.top,"SidePanel.Slider:onClose",new n.BaseEvent({compatData:[i.getEvent("onClose")]}))}BX.SidePanel.Instance.close()}}},{key:"startAnimation",value:function e(){if(this.animation){this.animation.stop()}var t=document.getElementById("microblog-form");if(!t){return}if(r.getInstance().animationStartHeight>0){this.animationStartHeight=r.getInstance().animationStartHeight;r.getInstance().animationStartHeight=0}else{this.animationStartHeight=t.parentNode.offsetHeight}t.parentNode.style.height="".concat(this.animationStartHeight,"px");t.parentNode.style.overflowY="hidden";t.parentNode.style.position="relative";t.style.opacity=0}},{key:"endAnimation",value:function e(){var t=this;var i=document.getElementById("microblog-form");if(!i){return}this.animation=new BX.easing({duration:500,start:{height:this.animationStartHeight,opacity:0},finish:{height:i.offsetHeight+i.offsetTop,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function e(t){i.parentNode.style.height="".concat(t.height,"px");i.style.opacity=t.opacity/100},complete:function e(){i.style.cssText="";i.parentNode.style.cssText="";t.animation=null}});this.animation.animate()}},{key:"showMoreMenu",value:function e(){if(!this.menu){this.menu=t.MenuManager.create("feed-add-post-form-popup",document.getElementById("feed-add-post-form-link-text"),this.menuItems,{className:"feed-add-post-form-popup",closeByEsc:true,offsetTop:5,offsetLeft:3,angle:true})}this.menu.popupWindow.show()}},{key:"restoreMoreMenu",value:function e(){var t=this.menuItems.length;if(t<1){return}for(var i=0;i<t;i++){if(this.active===this.menuItems[i]["tabId"]){return}}var s=document.getElementById("feed-add-post-form-link-more");var n=document.getElementById("feed-add-post-form-link-text");s.className="feed-add-post-form-link feed-add-post-form-link-more";n.innerHTML=o.Loc.getMessage("SBPE_MORE")}},{key:"getTaskForm",value:function e(){var t=this;var i=document.getElementById("feed-add-post-form-tab-tasks")&&document.getElementById("feed-add-post-form-tab-tasks").style.display!=="none"?document.getElementById("feed-add-post-form-tab-tasks"):document.getElementById("feed-add-post-form-link-more");var s=document.getElementById("feed-add-post-content-tasks");var a=document.getElementById("feed-add-post-content-tasks-container");if(a&&a.innerHTML.length<=0&&!this.clickDisabled){this.clickDisabled=true;r.getInstance().showWait(a);this.startAnimation();var l={GROUP_ID:o.Loc.getMessage("TASK_SOCNET_GROUP_ID"),PATH_TO_USER_TASKS:o.Loc.getMessage("PATH_TO_USER_TASKS"),PATH_TO_USER_TASKS_TASK:o.Loc.getMessage("PATH_TO_USER_TASKS_TASK"),PATH_TO_GROUP_TASKS:o.Loc.getMessage("PATH_TO_GROUP_TASKS"),PATH_TO_GROUP_TASKS_TASK:o.Loc.getMessage("PATH_TO_GROUP_TASKS_TASK"),PATH_TO_USER_PROFILE:o.Loc.getMessage("PATH_TO_USER_PROFILE"),PATH_TO_GROUP:o.Loc.getMessage("PATH_TO_GROUP"),PATH_TO_USER_TASKS_PROJECTS_OVERVIEW:o.Loc.getMessage("PATH_TO_USER_TASKS_PROJECTS_OVERVIEW"),PATH_TO_USER_TASKS_TEMPLATES:o.Loc.getMessage("PATH_TO_USER_TASKS_TEMPLATES"),PATH_TO_USER_TEMPLATES_TEMPLATE:o.Loc.getMessage("PATH_TO_USER_TEMPLATES_TEMPLATE"),ENABLE_FOOTER:"N",TEMPLATE_CONTROLLER_ID:"livefeed_task_form",ENABLE_FORM:"N",BACKURL:o.Loc.getMessage("TASK_SUBMIT_BACKURL")};o.ajax.runComponentAction("bitrix:tasks.task","uiEdit",{mode:"class",data:{parameters:{COMPONENT_PARAMETERS:l}}}).then((function(e){o.Runtime.html(a,e.data.html).then((function(){t.clickDisabled=false;t.closeWait(a);t.endAnimation();n.EventEmitter.emit(document.getElementById("divlivefeed_task_form"),"OnShowLHE",new n.BaseEvent({compatData:["justShow"]}))}));o.Dom.adjust(s,{style:{display:"block"}})}),(function(e){t.clickDisabled=false;t.closeWait(a);t.endAnimation();if(e.errors&&e.errors.length){var i=[];e.errors.forEach((function(e){i.push(e.message)}));throw new Error(i.join(" "))}}))}else{this.startAnimation();this.endAnimation()}}},{key:"closeWait",value:function e(t){var i=t.bxmsg;if(i&&i.parentNode){for(var s=0,n=this.lastWait.length;s<n;s++){if(i===this.lastWait[s]){this.lastWait=BX.util.deleteFromArray(this.lastWait,s);break}}i.parentNode.removeChild(i);if(t){t.bxmsg=null}o.Dom.clean(i);o.Dom.remove(i)}}},{key:"getLists",value:function e(){var t=this;var i=document.getElementById("feed-add-post-form-tab-lists")&&document.getElementById("feed-add-post-form-tab-lists").style.display!=="none"?document.getElementById("feed-add-post-form-tab-lists"):document.getElementById("feed-add-post-form-link-more");var s=i.querySelectorAll("span.feed-add-post-form-link-lists");var n=i.querySelectorAll("span.feed-add-post-form-link-lists-default");var a=[];var r=[];if(s.length){r=this.getMenuItems(s,this.createOnclickLists);a=this.getMenuItemsDefault(n);r=r.concat(a);this.showMoreMenuLists(r)}else{var l=null;if(document.getElementById("bx-lists-select-site-id")){l=document.getElementById("bx-lists-select-site-id").value}o.ajax({method:"POST",dataType:"json",url:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/post.ajax.php",data:{bitrix_processes:1,siteId:l,sessid:o.Loc.getMessage("bitrix_sessid")},onsuccess:function e(l){if(l.success){for(var d in l.lists){if(!l.lists.hasOwnProperty(d)){continue}i.appendChild(o.Dom.create("span",{attrs:{"data-name":l.lists[d].NAME,"data-picture":l.lists[d].PICTURE,"data-description":l.lists[d].DESCRIPTION,"data-picture-small":l.lists[d].PICTURE_SMALL,"data-code":l.lists[d].CODE,iblockId:l.lists[d].ID},props:{className:"feed-add-post-form-link-lists",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}))}s=i.querySelectorAll("span.feed-add-post-form-link-lists");r=t.getMenuItems(s,t.createOnclickLists);if(!n.length){for(var c in l.permissions){if(!l.permissions.hasOwnProperty(c)){continue}var u=void 0;if(c==="new"){u='document.location.href = "'.concat(document.getElementById("bx-lists-lists-page").value,'0/edit/"')}else if(c==="market"){if(l.admin&&document.getElementById("bx-lists-lists-page")){u='document.location.href = "'.concat(document.getElementById("bx-lists-lists-page").value,'?bp_catalog=y"')}else{if(document.getElementById("bx-lists-random-string")){u='BX.Lists["LiveFeedClass_'.concat(BX("bx-lists-random-string").value,'"].errorPopup("').concat(o.Loc.getMessage("LISTS_CATALOG_PROCESSES_ACCESS_DENIED"),'");')}}}else if(c==="settings"){u='document.location.href = "'.concat(BX("bx-lists-lists-page").value,'"')}i.appendChild(o.Dom.create("span",{attrs:{"data-name":l.permissions[c],"data-picture-small":"","data-key":c,"data-onclick":u},props:{className:"feed-add-post-form-link-lists-default",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}))}n=i.querySelectorAll("span.feed-add-post-form-link-lists-default")}a=t.getMenuItemsDefault(n);r=r.concat(a);t.showMoreMenuLists(r)}else{i.appendChild(o.Dom.create("span",{attrs:{"data-name":l.error,"data-picture-small":""},props:{className:"feed-add-post-form-link-lists-default",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}));s=i.querySelectorAll("span.feed-add-post-form-link-lists-default");r=t.getMenuItems(s,false);t.showMoreMenuLists(r)}}})}}},{key:"getMenuItems",value:function e(t,i){var s=[];for(var o=0;o<t.length;o++){var n=t[o].getAttribute("id").replace("feed-add-post-form-tab-","");if(i){s.push({tabId:n,text:BX.util.htmlspecialchars(t[o].getAttribute("data-name")),className:"feed-add-post-form-".concat(n," feed-add-post-form-").concat(n,"-item"),onclick:i(n,[t[o].getAttribute("iblockId"),t[o].getAttribute("data-name"),t[o].getAttribute("data-description"),t[o].getAttribute("data-picture"),t[o].getAttribute("data-code")])})}else{s.push({tabId:n,text:t[o].getAttribute("data-name"),className:"feed-add-post-form-".concat(n),onclick:""})}}return s}},{key:"getMenuItemsDefault",value:function e(t){var i=[];for(var s=0;s<t.length;s++){i.push({text:BX.util.htmlspecialchars(t[s].getAttribute("data-name")),className:"feed-add-post-form-lists-default-".concat(t[s].getAttribute("data-key")),onclick:t[s].getAttribute("data-onclick")})}return i}},{key:"showMoreMenuLists",value:function e(i){var s=document.getElementById("feed-add-post-form-tab-lists").style.display!=="none"?document.getElementById("feed-add-post-form-tab-lists"):document.getElementById("feed-add-post-form-link-more");this.listsMenu=t.MenuManager.create("lists",s,i,{closeByEsc:true,offsetTop:5,offsetLeft:12,angle:true});var o=document.getElementById("popup-window-content-menu-popup-lists").querySelectorAll("span.menu-popup-item-icon");var n=s.querySelectorAll("span.feed-add-post-form-link-lists");var a=s.querySelectorAll("span.feed-add-post-form-link-lists-default");n=Array.from(n).concat(Array.from(a));for(var r=0;r<o.length;r++){if(!n[r].getAttribute("data-picture-small")){continue}o[r].innerHTML=n[r].getAttribute("data-picture-small")}this.listsMenu.popupWindow.show()}},{key:"createOnclickLists",value:function e(t,s){return function(){i.getInstance().changePostFormTab(t,s);i.getInstance().listsMenu.popupWindow.close();i.getInstance().menu.popupWindow.close()}}}]);return i}(n.EventEmitter);babelHelpers.defineProperty(l,"instance",null);var d=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"isInitialized",false);babelHelpers.defineProperty(this,"popupShowingPeriods",null);babelHelpers.defineProperty(this,"menuItems",[]);babelHelpers.defineProperty(this,"customDateStyleModifier","feed-add-post-expire-date-customize");babelHelpers.defineProperty(this,"customDatePopupOptionClass","js-custom-date-end");babelHelpers.defineProperty(this,"postExpireDateBlock",null);babelHelpers.defineProperty(this,"formUfInputDateCustom",null);babelHelpers.defineProperty(this,"formDateDuration",null);babelHelpers.defineProperty(this,"formDateTimeEditing",null);babelHelpers.defineProperty(this,"popupTrigger",null);babelHelpers.defineProperty(this,"customDateSelectedTitle",null);babelHelpers.defineProperty(this,"selectors",{postExpireDateBlock:".js-post-expire-date-block",postEndTime:".js-form-post-end-time",postEditingEndTime:".js-form-editing-post-end-time",postEndPeriod:".js-form-post-end-period",popupTrigger:".js-important-till-popup-trigger",customDateFinal:".js-date-post-showing-custom",durationOptionsContainer:".js-post-showing-duration-options-container",durationOption:".js-post-showing-duration-option"});this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){if(this.isInitialized){return}this.addEventHandlers();if(!this.formDateTimeEditing.value){this.customDateSelectedTitle.innerText=this.getCurrentDate()}this.isInitialized=true}},{key:"addEventHandlers",value:function e(){var t=this;this.postExpireDateBlock=document.querySelector(this.selectors.postExpireDateBlock);this.formUfInputDateCustom=document.querySelector(this.selectors.postEndTime);this.formDateDuration=document.querySelector(this.selectors.postEndPeriod);this.formDateTimeEditing=document.querySelector(this.selectors.postEditingEndTime);this.popupTrigger=document.querySelector(this.selectors.popupTrigger);if(this.popupTrigger){this.popupTrigger.addEventListener("click",(function(){t.showPostEndPeriodsPopup()}))}this.customDateSelectedTitle=document.querySelector(this.selectors.customDateFinal);if(this.customDateSelectedTitle){this.customDateSelectedTitle.addEventListener("click",(function(){var e=new Date;var i=Math.round(e/1e3)-e.getTimezoneOffset()*60;if(t.formDateTimeEditing.value){e=BX.parseDate(t.formDateTimeEditing.value);i=BX.date.convertToUTC(e)}BX.calendar({node:t.customDateSelectedTitle,form:"blogPostForm",value:i,bTime:false,callback:function e(){return true},callback_after:t.onEndDateSet.bind(t)})}))}}},{key:"showPostEndPeriodsPopup",value:function e(){if(!this.popupShowingPeriods){this.createPopupShowingPeriods()}this.popupShowingPeriods.popupWindow.show()}},{key:"createPopupShowingPeriods",value:function e(){if(this.menuItems.length<=0){this.menuItems=this.createPopupItems()}this.popupShowingPeriods=t.MenuManager.create("feed-add-post-form-popup42",document.getElementById("js-post-expire-date-wrapper"),this.menuItems,{className:"feed-add-post-expire-date-options",closeByEsc:true,angle:true})}},{key:"createPopupItems",value:function e(){var t=this;var i=[];var s=document.querySelector(this.selectors.durationOptionsContainer).querySelectorAll(this.selectors.durationOption);if(!s){return i}s.forEach((function(e){i.push({onclick:t.onPopupItemClick.bind(t),dataset:{value:e.getAttribute("data-value"),class:e.getAttribute("data-class")},text:e.getAttribute("data-text"),className:"menu-popup-item menu-popup-no-icon ".concat(e.getAttribute("data-class"))})}));return i}},{key:"onPopupItemClick",value:function e(t){var i=t.currentTarget;if(i.getAttribute("data-class")===this.customDatePopupOptionClass){this.postExpireDateBlock.classList.add(this.customDateStyleModifier);if(this.formDateTimeEditing.value){this.formUfInputDateCustom.value=this.formDateTimeEditing.value;this.customDateSelectedTitle.innerText=this.formDateTimeEditing.value}else{this.formUfInputDateCustom.value=this.getCurrentDate()}}else{this.postExpireDateBlock.classList.remove(this.customDateStyleModifier);this.formUfInputDateCustom.value=null}this.popupTrigger.innerText=i.innerText.toLowerCase();this.formDateDuration.value=i.getAttribute("data-value").toUpperCase();this.popupShowingPeriods.popupWindow.close()}},{key:"onEndDateSet",value:function e(t){if(!t){return}this.formDateTimeEditing.value=this.getFormattedDate(t);this.formUfInputDateCustom.value=this.getFormattedDate(t);this.customDateSelectedTitle.innerText=this.getFormattedDate(t)}},{key:"getFormattedDate",value:function e(t){return BX.date.format(BX.date.convertBitrixFormat(o.Loc.getMessage("FORMAT_DATE")),t)}},{key:"getCurrentDate",value:function e(){return this.getFormattedDate(new Date)}}]);return e}();var c=function(e){babelHelpers.inherits(s,e);babelHelpers.createClass(s,null,[{key:"setInstance",value:function e(t){s.instance=t}},{key:"getInstance",value:function e(){return s.instance}}]);function s(e){var t;babelHelpers.classCallCheck(this,s);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"popupWindow",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"sendEvent",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"gratsContentElement",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"itemSelectedImageItem",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"itemSelectedInput",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"gratsList",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"selector",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"config",{fields:{employeesValue:{name:"GRAT_DEST_DATA"}}});t.init(e);s.setInstance(babelHelpers.assertThisInitialized(t));return t}babelHelpers.createClass(s,[{key:"init",value:function e(t){var i=this;if(!t.name){t.name="lm"}this.itemSelectedImageItem[t.name]=t.itemSelectedImageItem;this.itemSelectedInput[t.name]=t.itemSelectedInput;this.gratsList[t.name]=t.gratsList;this.itemSelectedImageItem[t.name].addEventListener("click",(function(e){i.openDialog(t.name);e.preventDefault()}));this.createEntitySelector(t.entitySelectorParams)}},{key:"openDialog",value:function e(i){var s=this;if(!i){i="lm"}if(this.popupWindow!=null){this.popupWindow.close();return false}var n=[];for(var a=0;a<this.gratsList[i].length;a++){n[n.length]=o.Dom.create("span",{props:{className:"feed-add-grat-box ".concat(this.gratsList[i][a].style)},attrs:{"data-title":this.gratsList[i][a].title,"data-code":this.gratsList[i][a].code,"data-style":this.gratsList[i][a].style},events:{click:function e(t){var o=t.currentTarget;s.selectItem(i,o.getAttribute("data-code"),o.getAttribute("data-style"),o.getAttribute("data-title"));t.preventDefault()}}})}var r=[];var l=1;for(var d=0;d<n.length;d++){if(d>=n.length/2){l=2}if(o.Type.isNil(r[l])){r[l]=o.Dom.create("div",{props:{className:"feed-add-grat-list-row"}})}r[l].appendChild(n[d])}this.gratsContentElement=o.Dom.create("div",{children:[o.Dom.create("div",{props:{className:"feed-add-grat-list-title"},html:o.Loc.getMessage("BLOG_GRAT_POPUP_TITLE")}),o.Dom.create("div",{props:{className:"feed-add-grat-list"},children:r})]});this.popupWindow=new t.Popup("BXSocNetGratSelector",document.getElementById("feed-add-post-grat-type-selected"),{autoHide:true,offsetLeft:25,bindOptions:{forceBindPosition:true},closeByEsc:true,closeIcon:{top:"5px",right:"10px"},events:{onPopupClose:function e(){s.popupWindow.destroy()},onPopupDestroy:function e(){s.popupWindow=null}},content:this.gratsContentElement,angle:{position:"bottom",offset:20},lightShadow:true});this.popupWindow.setAngle({});this.popupWindow.show();return true}},{key:"selectItem",value:function e(t,i,s,o){var n=this.itemSelectedImageItem[t].querySelector("span");if(n){n.className="feed-add-grat-box ".concat(s)}this.itemSelectedImageItem[t].title=o;this.itemSelectedInput[t].value=i;this.popupWindow.close()}},{key:"createEntitySelector",value:function e(t){var s=this;this.selector=new i.TagSelector({id:t.id,dialogOptions:{id:t.id,context:"GRATITUDE",preselectedItems:o.Type.isArray(t.preselectedItems)?t.preselectedItems:[],events:{"Item:onSelect":function e(i){s.recalcValue(i.getTarget().getSelectedItems(),t.inputNodeId)},"Item:onDeselect":function e(i){s.recalcValue(i.getTarget().getSelectedItems(),t.inputNodeId)}},entities:[{id:"user",options:{emailUsers:false,inviteEmployeeLink:false,intranetUsersOnly:true}},{id:"department",options:{selectMode:"usersOnly"}}]},addButtonCaption:o.Loc.getMessage("BLOG_GRATMEDAL_1"),addButtonCaptionMore:o.Loc.getMessage("BLOG_GRATMEDAL_1")});this.selector.renderTo(document.getElementById(t.tagNodeId));this.selector.subscribe("onContainerClick",(function(){s.emit("Selector::onContainerClick")}))}},{key:"recalcValue",value:function e(t,i){if(!o.Type.isArray(t)||!document.getElementById(i)){return}var s=[];t.forEach((function(e){s.push([e.entityId,e.id])}));document.getElementById(i).value=JSON.stringify(s)}}]);return s}(n.EventEmitter);babelHelpers.defineProperty(c,"instance",null);var u=function(e){babelHelpers.inherits(t,e);babelHelpers.createClass(t,null,[{key:"setInstance",value:function e(i,s){t.instance[i]=s}},{key:"getInstance",value:function e(i){return t.instance[i]}}]);function t(e,i){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"disabled",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"formId","");s.init(e,i);t.setInstance(e,babelHelpers.assertThisInitialized(s));window["setBlogPostFormSubmitted"]=s.setBlogPostFormSubmitted.bind(babelHelpers.assertThisInitialized(s));window["submitBlogPostForm"]=s.submitBlogPostForm.bind(babelHelpers.assertThisInitialized(s));return s}babelHelpers.createClass(t,[{key:"init",value:function e(t,i){var s=this;this.disabled=false;this.formId=t;this.formParams={editorID:i.editorID,showTitle:!!i.showTitle,submitted:false,text:i.text,autoSave:i.autoSave,handler:LHEPostForm&&LHEPostForm.getHandler(i.editorID),editor:LHEPostForm&&LHEPostForm.getEditor(i.editorID),restoreAutosave:!!i.restoreAutosave,createdFromEmail:!!i.createdFromEmail};n.EventEmitter.subscribe("onInitialized",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),o=i[0],n=i[1];s.onHandlerInited(o,n)}));if(this.formParams.handler){this.onHandlerInited(this.formParams.handler,t)}n.EventEmitter.subscribe("OnEditorInitedAfter",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,1),o=i[0];s.onEditorInited(o)}));if(this.formParams.editor){this.onEditorInited(this.formParams.editor)}n.EventEmitter.subscribe("onSocNetLogMoveBody",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,1),o=i[0];if(o==="sonet_log_microblog_container"){s.reinit()}}));o.Event.ready((function(){if(o.Browser.isIE()&&document.getElementById("POST_TITLE")){var e=function e(){var t=document.getElementById("POST_TITLE");if(!t||t.value===t.getAttribute("placeholder")){t.value=t.getAttribute("placeholder");t.classList.remove("feed-add-post-inp-active")}};o.Event.bind(document.getElementById("POST_TITLE"),"blur",e);e();document.getElementById("POST_TITLE").__onchange=function(e){var t=document.getElementById("POST_TITLE");if(t.value===t.getAttribute("placeholder")){t.value=""}if(t.className.indexOf("feed-add-post-inp-active")<0){t.classList.add("feed-add-post-inp-active")}};o.Event.bind(document.getElementById("POST_TITLE"),"click",document.getElementById("POST_TITLE").__onchange);o.Event.bind(document.getElementById("POST_TITLE"),"keydown",document.getElementById("POST_TITLE").__onchange);o.Event.bind(document.getElementById("POST_TITLE").form,"submit",(function(){var e=document.getElementById("POST_TITLE");if(e.value===e.getAttribute("placeholder")){e.value=""}}))}if(i.activeTab!==""){l.getInstance().changePostFormTab(i.activeTab)}l.getInstance().subscribe("changePostFormTab",s.checkHideAlert.bind(s));if(c.getInstance()){c.getInstance().subscribe("Selector::onContainerClick",s.hideAlert.bind(s))}}))}},{key:"showPanelTitle",value:function e(t,i){t=t===true||t===false?t:document.getElementById("blog-title").style.display&&document.getElementById("blog-title").style.display==="none";i=i!==false;var s=this.formParams.showTitle;var o=document.getElementById("lhe_button_title_".concat(this.formId));var n=document.getElementById("feed-add-post-block".concat(this.formId));var a=document.getElementById("show_title")||{};if(t){BX.show(document.getElementById("blog-title"));if(document.getElementById("POST_TITLE")){document.getElementById("POST_TITLE").focus()}this.formParams.showTitle=true;a.value="Y";if(o){o.classList.add("feed-add-post-form-btn-active")}if(n){n.classList.add("blog-post-edit-open")}}else{BX.hide(document.getElementById("blog-title"));this.formParams.showTitle=false;a.value="N";if(o){o.classList.remove("feed-add-post-form-btn-active")}}if(i){BX.userOptions.save("socialnetwork","postEdit","showTitle",this.formParams.showTitle?"Y":"N")}else{this.formParams.showTitle=s}}},{key:"setBlogPostFormSubmitted",value:function e(t){if(document.getElementById("blog-submit-button-save")){if(t){document.getElementById("blog-submit-button-save").classList.add("ui-btn-clock")}else{document.getElementById("blog-submit-button-save").classList.remove("ui-btn-clock")}}this.formParams.submitted=t;this.disabled=t}},{key:"submitBlogPostForm",value:function e(t,i){var s=this;if(this.disabled){return}if(!o.Type.isObject(t)){i=t;t=LHEPostForm.getEditor(this.formParams.editorID)}if(t&&t.id===this.formParams.editorID){if(this.formParams.submitted){return false}t.SaveContent();if(!i){i="save"}if(document.getElementById("blog-title").style.display==="none"){document.getElementById("POST_TITLE").value=""}var n=this.getSubmitButton({buttonType:i});if(n){n.classList.add("ui-btn-clock");this.disabled=true;window.addEventListener("beforeunload",(function(e){setTimeout((function(){BX.removeClass(n,"ui-btn-clock");s.disabled=false;s.formParams.submitted=false}),3e3)}))}var a="";var r=l.getInstance().active;if(o.Type.isStringFilled(r)){a=document.getElementById(this.formId).action;o.Uri.removeParam(a,["b24statTab"]);o.Uri.addParam(a,{b24statTab:r});document.getElementById(this.formId).action=a}if([l.getInstance().config.id.message,l.getInstance().config.id.file,l.getInstance().config.id.gratitude,l.getInstance().config.id.important,l.getInstance().config.id.vote].includes(r)){if(!this.checkDestinationValue({buttonType:i})){return}}if(r===l.getInstance().config.id.gratitude&&c.getInstance()){if(!this.checkEmployeesValue({buttonType:i})){return}}setTimeout((function(){BX.submit(document.getElementById(s.formId),i);s.formParams.submitted=true}),100)}}},{key:"checkDestinationValue",value:function e(t){var i=t.buttonType;if(o.Type.isUndefined(MPFEntitySelector)){return true}var s=new MPFEntitySelector({id:"oPostFormLHE_".concat(this.formId)});if(!s||!o.Type.isArray(s.tags)||s.tags.length>0){return true}this.enableSubmitButton({buttonType:i});this.showBottomAlert({text:o.Loc.getMessage("BLOG_POST_EDIT_T_GRAT_ERROR_NO_DESTINATION")});s.subscribeOnce("onContainerClick",this.hideAlert);return false}},{key:"checkEmployeesValue",value:function e(t){var i=t.buttonType;var s=document.getElementById(this.formId).elements[c.getInstance().config.fields.employeesValue.name];if(s&&o.Type.isStringFilled(s.value)&&s.value!=="[]"){return true}this.enableSubmitButton({buttonType:i});this.showBottomAlert({text:o.Loc.getMessage("BLOG_POST_EDIT_T_GRAT_ERROR_NO_EMPLOYEES")});return false}},{key:"checkHideAlert",value:function e(t){var i=t.getData(),s=i.type;if(s===l.getInstance().config.id.gratitude){return}this.hideAlert()}},{key:"hideAlert",value:function e(){var t=document.getElementById("feed-add-post-bottom-alertblogPostForm");if(!t){return}o.Dom.clean(t)}},{key:"enableSubmitButton",value:function e(t){var i=t.buttonType;var s=this.getSubmitButton({buttonType:i});if(s){s.classList.remove("ui-btn-clock");this.disabled=false}}},{key:"getSubmitButton",value:function e(t){var i=t.buttonType;var s=null;if(i==="save"&&document.getElementById("blog-submit-button-save")){s=document.getElementById("blog-submit-button-save")}else if(i==="draft"&&document.getElementById("blog-submit-button-draft")){s=document.getElementById("blog-submit-button-draft")}return s}},{key:"showBottomAlert",value:function e(t){if(!o.Type.isPlainObject(t)||!o.Type.isStringFilled(t.text)){return}var i=document.getElementById("feed-add-post-bottom-alertblogPostForm");if(i){o.Dom.clean(i);i.appendChild(o.Dom.create("div",{props:{className:"ui-alert ui-alert-danger"},children:[o.Dom.create("span",{props:{className:"ui-alert-message"},text:t.text})]}))}}},{key:"onHandlerInited",value:function e(t,i){if(i!==this.formId){return}this.formParams.handler=t;n.EventEmitter.subscribe(t.eventNode,"OnControlClick",(function(){l.getInstance().changePostFormTab(l.getInstance().config.id.message)}));n.EventEmitter.subscribe(t.eventNode,"OnAfterShowLHE",this.OnAfterShowLHE.bind(this));n.EventEmitter.subscribe(t.eventNode,"OnAfterHideLHE",this.OnAfterHideLHE.bind(this));if(t.eventNode.style.display=="none"){this.OnAfterHideLHE()}else{this.OnAfterShowLHE()}}},{key:"OnAfterShowLHE",value:function e(){var t=[document.getElementById("feed-add-post-form-notice-blockblogPostForm"),document.getElementById("feed-add-buttons-blockblogPostForm"),document.getElementById("feed-add-post-bottom-alertblogPostForm"),document.getElementById("feed-add-post-content-message-add-ins")];for(var i=0;i<t.length;i++){if(!t[i]){continue}t[i].classList.remove("feed-post-form-block-hidden")}if(this.formParams.showTitle){this.showPanelTitle(true,false)}}},{key:"OnAfterHideLHE",value:function e(){var t=[document.getElementById("feed-add-post-form-notice-blockblogPostForm"),document.getElementById("feed-add-buttons-blockblogPostForm"),document.getElementById("feed-add-post-bottom-alertblogPostForm"),document.getElementById("feed-add-post-content-message-add-ins")];for(var i=0;i<t.length;i++){if(!t[i]){continue}t[i].classList.add("feed-post-form-block-hidden")}if(this.formParams.showTitle){this.showPanelTitle(false,false)}}},{key:"onEditorInited",value:function e(t){var i=this;if(r.getInstance().initedEditorsList.includes(t.id)){return}if(t.id!==this.formParams.editorID){return}this.formParams.editor=t;if(this.formParams.autoSave!=="N"){new m(this.formParams.autoSave,this.formParams.restoreAutosave)}var s=window[t.id+"Files"];var a=LHEPostForm.getHandler(t.id);var l=[];var d=null;var c=null;for(var u in a.controllers){if(!a.controllers.hasOwnProperty(u)){continue}if(a.controllers[u].parser&&a.controllers[u].parser.bxTag==="postimage"){c=a.controllers[u];break}}var f=function e(t,i){return function(){t.insertFile(i)}};var p=function e(t,i,s){return function(){if(c){c.deleteFile(i,{});o.Dom.remove(document.getElementById("wd-doc'".concat(i)));o.ajax({method:"GET",url:s})}else{t.deleteFile(i,s,t,{controlID:"common"})}}};for(var h in s){if(!s.hasOwnProperty(h)){continue}if(c){c.addFile(s[h])}else{var b=a.checkFile(h,"common",s[h]);l.push(h);if(!!b&&document.getElementById("wd-doc".concat(h))&&!document.getElementById("wd-doc".concat(h)).hasOwnProperty("bx-bound")){BX("wd-doc".concat(h)).setAttribute("bx-bound","Y");if((d=document.getElementById("wd-doc".concat(h)).querySelector(".feed-add-img-wrap"))&&d){o.Event.bind(d,"click",f(a,b));d.style.cursor="pointer"}if((d=document.getElementById("wd-doc".concat(h)).querySelector(".feed-add-img-title"))&&d){o.Event.bind(d,"click",f(a,b));d.style.cursor="pointer"}}}if((d=document.getElementById("wd-doc".concat(h)).querySelector(".feed-add-post-del-but"))&&d){o.Event.bind(d,"click",p(a,h,s[h].del_url));d.style.cursor="pointer"}}if(l.length>0){t.SaveContent();var g=t.GetContent();g=g.replace(new RegExp("\\&\\#91\\;IMG ID=("+l.join("|")+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"[IMG ID=$1$2]");t.SetContent(g);t.Focus()}r.getInstance().initedEditorsList.push(t.id);n.EventEmitter.subscribe(t,"OnSetViewAfter",(function(){if(i.formParams.createdFromEmail){if(t.GetContent()===""){t.SetContent("".concat(o.Loc.getMessage("CREATED_ON_THE_BASIC_OF_THE_MESSAGE")))}t.Focus(true)}}))}},{key:"reinit",value:function e(){if(!this.formParams.editorID){return}if(o.Type.isFunction(this.formParams.editor)){this.formParams.editor(this.formParams.text)}else{setTimeout(this.reinit,50)}}}]);return t}(n.EventEmitter);babelHelpers.defineProperty(u,"instance",{});var m=function(){function e(t,i){babelHelpers.classCallCheck(this,e);this.init(t,i)}babelHelpers.createClass(e,[{key:"init",value:function e(t,i){var s=this;var a="blogPostForm";var r=document.getElementById(a);var l="POST_TITLE";var d=document.getElementById(l);var c=r.TAGS;if(!r){return}i=!o.Type.isUndefined(i)?!!i:true;n.EventEmitter.subscribe(r,"onAutoSavePrepare",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),o=i[0],n=i[1];o.DISABLE_STANDARD_NOTIFY=true;var a=o;setTimeout((function(){s.bindLHEEvents(a)}),100)}));n.EventEmitter.subscribe(r,"onAutoSave",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),s=i[0],o=i[1];o.TAGS=c.value;delete o.POST_MESSAGE}));if(t=="Y"){n.EventEmitter.subscribe(r,"onAutoSaveRestoreFound",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),s=i[0],n=i[1];var r=n["text".concat(a)];r=o.Type.isStringFilled(r)?r.trim():"";var d=n[l];d=o.Type.isStringFilled(d)?d.trim():"";if(!o.Type.isStringFilled(r)&&!o.Type.isStringFilled(d)){return}s.Restore()}))}else{n.EventEmitter.subscribe(r,"onAutoSaveRestoreFound",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),s=i[0],n=i[1];var r=n["text".concat(a)];r=o.Type.isStringFilled(r)?r.trim():"";var d=n[l];d=o.Type.isStringFilled(d)?d.trim():"";if(!o.Type.isStringFilled(r)&&!o.Type.isStringFilled(d)){return}var c=document.getElementById("microoPostFormLHE_blogPostForm");var u=o.Dom.create("DIV",{attrs:{className:"feed-add-successfully"},children:[o.Dom.create("SPAN",{attrs:{className:"feed-add-info-icon"}}),o.Dom.create("A",{attrs:{className:"feed-add-info-text",href:"#"},events:{click:function e(){s.Restore();u.parentNode.removeChild(u);return false}},text:o.Loc.getMessage("BLOG_POST_AUTOSAVE2")})]});if(c){c.parentNode.insertBefore(u,c)}}))}if(i){n.EventEmitter.subscribe(r,"onAutoSaveRestore",(function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),r=i[0],c=i[1];d.value=c[l];if(o.Type.isStringFilled(c[l])&&c[l]!==d.getAttribute("placeholder")){if(document.getElementById("divoPostFormLHE_blogPostForm").style.display!=="none"){u.getInstance(a).showPanelTitle(true)}else{window.bShowTitle=true}if(o.Type.isFunction(d.__onchange)){d.__onchange()}}var m=window["BXPostFormTags_".concat(a)];if(c.TAGS.length>0&&m){var f=m.addTag(c.TAGS);if(f.length>0){BX.show(m.tagsArea)}}n.EventEmitter.emit("onAutoSaveRestoreDestination",new n.BaseEvent({compatData:[{formId:a,data:c}]}));s.bindLHEEvents(r)}))}}},{key:"bindLHEEvents",value:function e(t){var i=document.getElementById("blogPostForm");var s=document.getElementById("POST_TITLE");var n=i.TAGS;o.Event.bind(s,"keydown",t.Init.bind(t));o.Event.bind(n,"keydown",t.Init.bind(t))}}]);return e}();e.PostForm=r;e.PostFormTabs=l;e.PostFormDateEnd=d;e.PostFormGratSelector=c;e.PostFormAutoSave=m;e.PostFormEditor=u})(this.BX.Socialnetwork.Livefeed=this.BX.Socialnetwork.Livefeed||{},BX.Main,BX.UI.EntitySelector,BX.Main,BX,BX.Event);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?172645624470830";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.form/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.map.js";}"*/
(function(){if(window["LHEPostForm"]){return}this.BX=this.BX||{};(function(e,t,i,n,r){"use strict";var a=function(){function e(t,i){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id","SomeParser");babelHelpers.defineProperty(this,"buttonParams",{name:"Some parser name",iconClassName:"some-parser-class",disabledForTextarea:false,src:"/icon.png",toolbarSort:205});this.editor=t;this.htmlEditor=i;this.handler=this.handler.bind(this)}babelHelpers.createClass(e,[{key:"handler",value:function e(){}},{key:"parse",value:function e(t){return t}},{key:"unparse",value:function e(t,i){return""}},{key:"hasButton",value:function e(){return this.buttonParams!==null}},{key:"getButton",value:function e(){if(this.buttonParams===null){return null}return{id:this.id,name:this.buttonParams.name,iconClassName:this.buttonParams.iconClassName,disabledForTextarea:this.buttonParams.disabledForTextarea,src:this.buttonParams.src,toolbarSort:this.buttonParams.toolbarSort,handler:this.handler}}},{key:"getParser",value:function e(){var t=this;return{name:this.id,obj:{Parse:function e(i,n){return t.parse(n)},UnParse:this.unparse.bind(this)}}}}]);return e}();var o=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++){a[o]=arguments[o]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"id","spoiler");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"buttonParams",{name:r.Loc.getMessage("MPF_SPOILER"),iconClassName:"spoiler",disabledForTextarea:false,src:r.Loc.getMessage("MPF_TEMPLATE_FOLDER")+"/images/lhespoiler.svg",toolbarSort:205});return i}babelHelpers.createClass(t,[{key:"handler",value:function e(){var t;if(!this.htmlEditor.bbCode||!this.htmlEditor.synchro.IsFocusedOnTextarea()){t=this.htmlEditor.action.actions.formatBlock.exec("formatBlock","blockquote","bx-spoiler",false,{bxTagParams:{tag:"spoiler"}})}else{t=this.htmlEditor.action.actions.formatBbCode.exec("quote",{tag:"SPOILER"})}return t}},{key:"parse",value:function e(t,i){if(/\[spoiler(([^\]])*)\]/gi.test(t)){t=t.replace(/[\x01-\x02]/gi,"").replace(/\[spoiler([^\]]*)\]/gi,"\x01$1\x01").replace(/\[\/spoiler]/gi,"\x02");var n=/(?:\x01([^\x01]*)\x01)([^\x01-\x02]+)\x02/gi;while(t.match(n)){t=t.replace(n,function(e,t,i){t=t.replace(/^(="|='|=)/gi,"").replace(/("|')?$/gi,"");return'<blockquote class="bx-spoiler" id="'.concat(this.htmlEditor.SetBxTag(false,{tag:"spoiler"}),'" title="').concat(t,'">').concat(i,"</blockquote>")}.bind(this))}}t=t.replace(/\001([^\001]*)\001/gi,"[spoiler$1]").replace(/\002/gi,"[/spoiler]");return t}},{key:"unparse",value:function e(t,i){var n="";for(var r=0;r<i.node.childNodes.length;r++){n+=this.htmlEditor.bbParser.GetNodeHtml(i.node.childNodes[r])}n=n.trim();if(n!==""){return"[SPOILER"+(i.node.hasAttribute("title")?"="+i.node.getAttribute("title"):"")+"]"+n+"[/SPOILER]"}return""}}]);return t}(a);var s=function(e){babelHelpers.inherits(i,e);function i(e,n){var r;babelHelpers.classCallCheck(this,i);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"id","postuser");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"buttonParams",null);t.EventEmitter.subscribe(n,"OnIframeKeydown",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(window.onKeyDownHandler){window.onKeyDownHandler(i,n,n.formID)}}));t.EventEmitter.subscribe(n,"OnIframeKeyup",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(window.onKeyUpHandler){window.onKeyUpHandler(i,n,n.formID)}}));t.EventEmitter.subscribe(n,"OnIframeClick",(function(){if(window["BXfpdStopMent"+n.formID]){window["BXfpdStopMent"+n.formID]()}}));t.EventEmitter.subscribe(n,"OnTextareaKeyup",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(n.textareaView&&n.textareaView.GetCursorPosition&&window.onTextareaKeyUpHandler){window.onTextareaKeyUpHandler(i,n,n.formID)}}));t.EventEmitter.subscribe(n,"OnTextareaKeydown",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];if(n.textareaView&&n.textareaView.GetCursorPosition&&window.onTextareaKeyDownHandler){window.onTextareaKeyDownHandler(i,n,n.formID)}}));return r}babelHelpers.createClass(i,[{key:"parse",value:function e(t,i){var n=this;t=t.replace(/\[USER\s*=\s*(\d+)\](.*?)\[\/USER\]/gi,(function(e,t,i){i=i.trim();if(i===""){return""}var r=n.htmlEditor.SetBxTag(false,{tag:n.id,userId:t,userName:i});return'<span id="'.concat(r,'" class="bxhtmled-metion">').concat(i,"</span>")})).replace(/\[PROJECT\s*=\s*(\d+)\](.*?)\[\/PROJECT\]/gi,(function(e,t,i){i=i.trim();if(i===""){return""}var r=n.htmlEditor.SetBxTag(false,{tag:n.id,projectId:t,projectName:i});return'<span id="'.concat(r,'" class="bxhtmled-metion">').concat(i,"</span>")})).replace(/\[DEPARTMENT\s*=\s*(\d+)\](.*?)\[\/DEPARTMENT\]/gi,(function(e,t,i){i=i.trim();if(i===""){return""}var r=n.htmlEditor.SetBxTag(false,{tag:n.id,departmentId:t,departmentName:i});return'<span id="'.concat(r,'" class="bxhtmled-metion">').concat(i,"</span>")}));return t}},{key:"unparse",value:function e(t,i){var n=this;var a="";i.node.childNodes.forEach((function(e){a+=n.htmlEditor.bbParser.GetNodeHtml(e)}));a=String(a).trim();var o="";if(r.Type.isStringFilled(a)){if(!r.Type.isUndefined(t.userId)){o="[USER=".concat(t.userId,"]").concat(a,"[/USER]")}else if(!r.Type.isUndefined(t.projectId)){o="[PROJECT=".concat(t.projectId,"]").concat(a,"[/PROJECT]")}else if(!r.Type.isUndefined(t.departmentId)){o="[DEPARTMENT=".concat(t.departmentId,"]").concat(a,"[/DEPARTMENT]")}}return o}}]);return i}(a);var l=function(){function e(i,n,r){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"actionPool",[]);this.cid=i;this.container=n;this.editor=r;t.EventEmitter.subscribe(r.getEventObject(),"onShowControllers",(function(e){var i=e.data;t.EventEmitter.emit(n.parentNode,"BFileDLoadFormController",new t.BaseEvent({compatData:[i]}))}));t.EventEmitter.subscribe(r.getEventObject(),"onCollectControllers",(function(e){e.data[i]={values:[]}}))}babelHelpers.createClass(e,[{key:"exec",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(t){this.actionPool.push(t)}if(this.isReady){try{var i;while((i=this.actionPool.shift())&&i){i.apply(this)}}catch(e){console.log("error in attachments controllers: ",e)}}}},{key:"getId",value:function e(){return this.cid}},{key:"getFieldName",value:function e(){return null}},{key:"reinitFrom",value:function e(t){var i=this;this.exec((function(){if(!i.getFieldName()){return}i.container.querySelector('inptut[name="'.concat(i.getFieldName(),'"]')).forEach((function(e){e.parentNode.removeChild(e)}))}))}},{key:"isReady",get:function e(){return true}}]);return e}();var d=function(e){babelHelpers.inherits(i,e);function i(e,n,r){var a;babelHelpers.classCallCheck(this,i);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n,r));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"diskUfUploader",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"diskUfHandler",null);var o=function e(i){a.diskUfUploader=i;a.exec();var n=function e(i){t.EventEmitter.emit(r.getEventObject(),"onUploadsHasBeenChanged",i)};t.EventEmitter.subscribe(a.diskUfUploader,"onFileIsInited",n);t.EventEmitter.subscribe(a.diskUfUploader,"ChangeFileInput",n)};if(BX.UploaderManager.getById(e)){o(BX.UploaderManager.getById(e))}t.EventEmitter.subscribeOnce(n.parentNode,"DiskDLoadFormControllerInit",(function(t){var i=babelHelpers.slicedToArray(t.compatData,1),n=i[0];a.diskUfHandler=n;if(e===n.CID&&!a.diskUfUploader){o(n.agent)}}));t.EventEmitter.subscribe(r.getEventObject(),"onShowControllers",(function(e){var i=e.data;t.EventEmitter.emit(n.parentNode,"DiskLoadFormController",new t.BaseEvent({compatData:[i]}))}));return a}babelHelpers.createClass(i,[{key:"getFieldName",value:function e(){if(this.diskUfHandler){return this.diskUfHandler.params.controlName}return null}},{key:"reinitFrom",value:function e(t){var i=this;this.exec((function(){if(!i.getFieldName()){return}Array.from(i.container.querySelectorAll('inptut[name="'.concat(i.getFieldName(),'"]'))).forEach((function(e){e.parentNode.removeChild(e)}));var e=null;for(var n in t){if(t.hasOwnProperty(n)&&t[n]&&t[n]["USER_TYPE_ID"]==="disk_file"&&t[n]["FIELD_NAME"]===i.getFieldName()){e=t[n]["VALUE"]}}if(e){var r={};e.forEach((function(e){var t=document.querySelector("#disk-attach-"+e);if(t.tagName!=="A"){t=t.querySelector("img")}if(t){r["E"+e]={type:"file",id:e,name:t.getAttribute("data-bx-title")||t.getAttribute("data-title"),size:t.getAttribute("data-bx-size")||"",sizeInt:t.getAttribute("data-bx-size")||"",width:t.getAttribute("data-bx-width"),height:t.getAttribute("data-bx-height"),storage:"disk",previewUrl:t.tagName==="A"?"":t.getAttribute("data-bx-src")||t.getAttribute("data-src"),fileId:t.getAttribute("bx-attach-file-id")};if(t.hasAttribute("bx-attach-xml-id"))r["E"+e]["xmlId"]=t.getAttribute("bx-attach-xml-id");if(t.hasAttribute("bx-attach-file-type"))r["E"+e]["fileType"]=t.getAttribute("bx-attach-file-type")}}));i.diskUfHandler.selectFile({},{},r)}}))}},{key:"isReady",get:function e(){return!!this.diskUfUploader}}]);return i}(l);var c;var u=function(e){babelHelpers.inherits(i,e);function i(e,n){var a;babelHelpers.classCallCheck(this,i);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"id","uploadfile");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"buttonParams",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"regexp",/\[FILE ID=((?:\s|\S)*?)?\]/gi);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"values",new Map);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"controllers",new Map);a.checkButtonsDebounced=r.Runtime.debounce(a.checkButtons,500,babelHelpers.assertThisInitialized(a));a.init();t.EventEmitter.subscribe(e.getEditor(),"OnContentChanged",a.checkButtons.bind(babelHelpers.assertThisInitialized(a)));t.EventEmitter.subscribe(e.getEventObject(),"onReinitializeBefore",(function(e){var t=babelHelpers.slicedToArray(e.data,2),i=t[0],n=t[1];a.reinit(i,n)}));return a}babelHelpers.createClass(i,[{key:"init",value:function e(){var i=this;Array.from(this.editor.getContainer().querySelectorAll(".file-selectdialog")).forEach((function(e,n){var r=e.id.replace("file-selectdialog-","");var a=i.controllers.get(r);if(!a){a=new l(r,e,i.editor);t.EventEmitter.subscribe(e.parentNode,"OnFileUploadSuccess",(function(t){var n=babelHelpers.slicedToArray(t.data,2),a=n[0].element_id,o=n[1],s=o.id,l=o.doc_prefix,d=o.CID;if(r===s){var c=document.querySelector("#"+i.editor.getFormId())?document.querySelector("#"+i.editor.getFormId()).querySelector("#upload-cid"):null;if(c){c.value=d}var u=i.parseFile(e.querySelector("#"+l+a)),f=babelHelpers.slicedToArray(u,2),p=f[0],h=f[1];i.values.set(p,h)}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadRemove",(function(e){var t=babelHelpers.slicedToArray(e.compatData,2),n=t[0],a=t[1].id;if(r===a&&i.values.has(n)){i.values["delete"](n);i.deleteFile([n])}}));if(n===0){t.EventEmitter.subscribe(i.editor.getEventObject(),"onFilesHaveCaught",(function(e){e.stopImmediatePropagation();if(window["BfileFD"+r]){window["BfileFD"+r].agent.UploadDroppedFiles(babelHelpers.toConsumableArray(e.getData()))}}))}}if(e.querySelector("table.files-list")){Array.from(e.querySelector("table.files-list").querySelectorAll("tr")).forEach((function(e){var t=i.parseFile(e),n=babelHelpers.slicedToArray(t,2),r=n[0],a=n[1];i.values.set(r,a)}))}}))}},{key:"parseFile",value:function e(t){var i=this;var n=t.id.replace("wd-doc","");var a={id:n,name:t.querySelector('[data-role="name"]')?t.querySelector('[data-role="name"]').innerHTML:t.querySelector("span.f-wrap").innerHTML,node:t,buttonNode:t.querySelector('[data-role="button-insert"]'),image:{src:null,lowsrc:null,width:null,height:null}};var o=function e(){i.insertFile(n,t)};var s=t.querySelector(".f-wrap");if(s){s.addEventListener("click",o);s.style.cursor="pointer";s.title=r.Loc.getMessage("MPF_FILE")}var l=t.querySelector("img");if(l){l.addEventListener("click",o);l.title=r.Loc.getMessage("MPF_FILE");l.style.cursor="pointer";a.image.lowsrc=l.lowsrc||l.src;a.image.src=l.rel||l.src;a.image.width=l.getAttribute("data-bx-full-width");a.image.height=l.getAttribute("data-bx-full-height")}if(t instanceof HTMLTableRowElement&&t.querySelector(".files-info")){if(!a.buttonNode){a.buttonNode=r.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n<span type="button" onclick="','" data-role="button-insert" class="insert-btn">\n\t<span data-role="insert-btn" class="insert-btn-text">','</span>\n\t<span data-role="in-text-btn" class="insert-btn-text">',"</span>\n</span>"])),o,r.Loc.getMessage("MPF_FILE_INSERT_IN_TEXT"),r.Loc.getMessage("MPF_FILE_IN_TEXT"));t.querySelector(".files-info").appendChild(a.buttonNode);this.checkButtonsDebounced()}}return[n,a]}},{key:"buildHTML",value:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var r=this.htmlEditor.SetBxTag(false,{tag:this.id,fileId:t});var a='<span data-bx-file-id="'.concat(t,'" id="').concat(r,'" style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;">').concat(i.name,"</span>");if(i.image.src){var o=[];if(n){o.push('style="width:'.concat(n.width,"px;height:").concat(n.height,'px;"'))}else if(i.image.width&&i.image.height){o.push('style="width:'.concat(i.image.width,"px;height:").concat(i.image.height,'px;" '));o.push("onload=\"this.style.width='auto';this.style.height='auto';\"")}a='<img style="max-width: 90%;"  data-bx-file-id="'.concat(t,'" id="').concat(r,'" src="').concat(i.image.src,'" lowsrc="').concat(i.image.lowsrc,'" ').concat(o.join(" "),"/>")}return a}},{key:"buildText",value:function e(t,i){return"[FILE ID=".concat(t).concat(i||"","]")}},{key:"insertFile",value:function e(i,n){var r=this.values.get(String(i));if(r){t.EventEmitter.emit(this.editor.getEventObject(),"OnInsertContent",[this.buildText(i),this.buildHTML(i,r)])}}},{key:"deleteFile",value:function e(t){var i=this.htmlEditor.GetContent();if(this.htmlEditor.GetViewMode()==="wysiwyg"){var n=this.htmlEditor.GetIframeDoc();for(var r in this.htmlEditor.bxTags){if(this.htmlEditor.bxTags.hasOwnProperty(r)&&babelHelpers["typeof"](this.htmlEditor.bxTags[r])==="object"&&this.htmlEditor.bxTags[r]["tag"]===this.id&&t.indexOf(String(this.htmlEditor.bxTags[r]["fileId"]))>=0&&n.getElementById(r)){var a=n.getElementById(r);a.parentNode.removeChild(a)}}this.htmlEditor.SaveContent()}else{var o=i.replace(this.regexp,(function(e,i){return t.indexOf(i)>=0?"":e}));this.htmlEditor.SetContent(o);this.htmlEditor.Focus()}}},{key:"checkButtons",value:function e(t){var i=t?t.compatData[0]:this.htmlEditor.GetContent();var n=babelHelpers.toConsumableArray(i.matchAll(this.regexp)).map((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],n=t[1];return n}));this.values.forEach((function(e,t){if(!e.buttonNode){return}var i=n.indexOf(t)>=0;if(i===true&&e.buttonNode.className!=="insert-text"){e.buttonNode.className="insert-text";e.buttonNode.querySelector('[data-role="insert-btn"]').style.display="none";e.buttonNode.querySelector('[data-role="in-text-btn"]').style.display=""}else if(i!==true&&e.buttonNode.className!=="insert-btn"){e.buttonNode.className="insert-btn";e.buttonNode.querySelector('[data-role="insert-btn"]').style.display="";e.buttonNode.querySelector('[data-role="in-text-btn"]').style.display="none"}}))}},{key:"reinit",value:function e(t,i){this.values.forEach((function(e,t){if(e.node&&e.node.parentNode){e.node.parentNode.removeChild(e.node)}}));this.values.clear();this.controllers.forEach((function(e){e.reinitFrom(i)}))}},{key:"parse",value:function e(t){if(!this.regexp.test(t)){return t}t=t.replace(this.regexp,function(e,t,i,n){if(this.values.has(t)){return this.buildHTML(t,this.values.get(t),i>0&&n>0?{width:i,height:n}:null)}return e}.bind(this));return t}},{key:"unparse",value:function e(t,i){var n=i.node;var r=parseInt(n.hasAttribute("width")?n.getAttribute("width"):0);var a=parseInt(n.hasAttribute("height")?n.getAttribute("height"):0);var o="";if(r>0&&a>0){o=" WIDTH="+r+" HEIGHT="+a}var s=n.getAttribute("data-bx-file-id");return this.buildText(s,o)}}]);return i}(a);var f=function(e){babelHelpers.inherits(i,e);function i(e,n){var r;babelHelpers.classCallCheck(this,i);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this,e,n));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"id","uploadimage");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"buttonParams",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"regexp",/\[IMAGE ID=((?:\s|\S)*?)?\]/gi);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"values",new Map);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(r),"controllers",new Map);r.init();console.log("PostImage: ");t.EventEmitter.subscribe(e.getEventObject(),"onReinitializeBefore",(function(e){var t=babelHelpers.slicedToArray(e.data,2),i=t[0],n=t[1];r.reinit(i,n)}));return r}babelHelpers.createClass(i,[{key:"init",value:function e(){var i=this;Array.from(this.editor.getContainer().querySelectorAll(".file-selectdialog")).forEach((function(e){var n=e.id.replace("file-selectdialog-","");var r=i.controllers.get(n);if(!r){r=new l(n,e,i.editor);t.EventEmitter.subscribe(e.parentNode,"OnFileUploadSuccess",(function(t){var r=babelHelpers.slicedToArray(t.data,2),a=r[0].element_id,o=r[1],s=o.id,l=o.doc_prefix,d=o.CID;if(n===s){var c=document.querySelector("#"+i.editor.getFormId())?document.querySelector("#"+i.editor.getFormId()).querySelector("#upload-cid"):null;if(c){c.value=d}var u=i.parseFile(e.querySelector("#"+l+a)),f=babelHelpers.slicedToArray(u,2),p=f[0],h=f[1];i.values.set(p,h)}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadRemove",(function(e){var t=babelHelpers.slicedToArray(e.compatData,2),r=t[0],a=t[1].id;if(n===a&&i.values.has(r)){i.values["delete"](r)}}))}if(e.querySelector("table.files-list")){Array.from(e.querySelector("table.files-list").querySelectorAll("tr")).forEach((function(e){var t=i.parseFile(e),n=babelHelpers.slicedToArray(t,2),r=n[0],a=n[1];i.values.set(r,a)}))}}))}},{key:"parseFile",value:function e(t){var i=t.id.replace("wd-doc","");var n={id:i,name:t.querySelector('[data-role="name"]')?t.querySelector('[data-role="name"]').innerHTML:t.querySelector("span.f-wrap").innerHTML,node:t,image:{src:null,lowsrc:null,width:null,height:null}};return[i,n]}},{key:"reinit",value:function e(t,i){this.values.forEach((function(e,t){if(e.node&&e.node.parentNode){e.node.parentNode.removeChild(e.node)}}));this.values.clear();this.controllers.forEach((function(e){e.reinitFrom(i)}))}},{key:"parse",value:function e(t){return t}},{key:"unparse",value:function e(t,i){var n=i.node;return""}}]);return i}(a);var p;var h=function(e){babelHelpers.inherits(i,e);function i(){var e;var t;babelHelpers.classCallCheck(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++){r[a]=arguments[a]}t=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(i)).call.apply(e,[this].concat(r)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"id","diskfile");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"regexp",/\[(?:DOCUMENT ID|DISK FILE ID)=([n0-9]+)\]/gi);return t}babelHelpers.createClass(i,[{key:"init",value:function e(){var i=this;Array.from(this.editor.getContainer().querySelectorAll(".diskuf-selectdialog")).forEach((function(e,n){var r=e.id.replace("diskuf-selectdialog-","");var a=i.controllers.get(r);if(!a){a=new d(r,e,i.editor);i.controllers.set(r,a);t.EventEmitter.subscribe(e.parentNode,"OnFileUploadSuccess",(function(t){var n=babelHelpers.slicedToArray(t.data,3),r=n[0].element_id,o=n[1].CID,s=n[2];if(a.getId()!==o||i.values.has(r)){return}var l=i.parseFile(e.querySelector("#disk-edit-attach"+r)),d=babelHelpers.slicedToArray(l,3),c=d[0],u=d[1],f=d[2];i.values.set(c,f);if(c!==u){i.values.set(u,f)}if(s&&s["insertImageAfterUpload"]&&f.image.src){i.insertFile(c,f.node)}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadRemove",(function(e){var t=babelHelpers.slicedToArray(e.compatData,2),n=t[0],r=t[1].CID;if(a.getId()===r&&i.values.has(n)){var o=i.values.get(n);i.values["delete"](o.id);i.values["delete"](o.fileId);i.deleteFile([o.id,o.fileId])}}));t.EventEmitter.subscribe(e.parentNode,"OnFileUploadFailed",(function(e){var t=babelHelpers.slicedToArray(e.compatData,3),n=t[0],r=t[1].CID,o=t[2];if(a.getId()===r&&o&&o["referrerToEditor"]){BX.onCustomEvent(o["referrerToEditor"],"OnImageDataUriCaughtFailed",[]);BX.onCustomEvent(i.editor,"OnImageDataUriCaughtFailed",[o["referrerToEditor"]])}}));if(n===0){b(i,a,e,i.editor);m(i,a,e,i.editor);t.EventEmitter.subscribe(i.editor.getEventObject(),"onFilesHaveCaught",(function(e){e.stopImmediatePropagation();a.diskUfUploader.onChange(babelHelpers.toConsumableArray(e.getData()))}))}}if(e.querySelector("table.files-list")){Array.from(e.querySelector("table.files-list").querySelectorAll("tr")).forEach((function(e){var t=i.parseFile(e),n=babelHelpers.slicedToArray(t,3),r=n[0],a=n[1],o=n[2];i.values.set(r,o);if(r!==a){i.values.set(a,o)}}))}}))}},{key:"parseFile",value:function e(t){var i=this;var n=String(t.id.replace("disk-edit-attach",""));var a={id:n,name:t.querySelector('[data-role="name"]')?t.querySelector('[data-role="name"]').innerHTML:t.querySelector("span.f-wrap").innerHTML,fileId:t.getAttribute("bx-attach-file-id"),node:t,buttonNode:t.querySelector('[data-role="button-insert"]'),image:{src:null,lowsrc:null,width:null,height:null}};var o=t.querySelector(".f-wrap");var s=function e(){i.insertFile(n,t)};if(o){o.addEventListener("click",s);o.style.cursor="pointer";o.title=r.Loc.getMessage("MPF_FILE")}var l=t.querySelector("img.files-preview");if(l&&(l.src.indexOf("bitrix/tools/disk/uf.php")>=0||l.src.indexOf("/disk/showFile/")>=0)){l.addEventListener("click",s);l.title=r.Loc.getMessage("MPF_FILE");l.style.cursor="pointer";a.image.lowsrc=l.lowsrc||l.src;a.image.src=(l.rel||l.getAttribute("data-bx-src")||l.src).replace(/&(width|height)=\d+/gi,"");var d=function e(){a.image.width=l.getAttribute("data-bx-full-width");a.image.height=l.getAttribute("data-bx-full-height")};l.addEventListener("load",d);if(l.complete){d()}}if(t instanceof HTMLTableRowElement&&!a.buttonNode){a.buttonNode=r.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n<span class="insert-btn" data-role="button-insert" onclick="','">\n\t<span data-role="insert-btn" class="insert-btn-text">','</span>\n\t<span data-role="in-text-btn" class="insert-btn-text" style="display: none;">',"</span>\n</span>"])),s,r.Loc.getMessage("MPF_FILE_INSERT_IN_TEXT"),r.Loc.getMessage("MPF_FILE_IN_TEXT"));setTimeout((function(){if(t.querySelector(".files-info")){t.querySelector(".files-info").appendChild(a.buttonNode);i.checkButtonsDebounced()}}))}return[n,a.fileId,a]}},{key:"buildText",value:function e(t,i){return"[DISK FILE ID=".concat(t).concat(i||"","]")}}]);return i}(u);function b(e,i,n,r){t.EventEmitter.subscribe(r.getEventObject(),"OnVideoHasCaught",(function(r){var a=r.getData();var o=function i(r){var o=babelHelpers.slicedToArray(r.data,3),s=o[0].element_id;babelHelpers.objectDestructuringEmpty(o[1]);var l=o[2];if(a===l&&e.values.has(s)){t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadSuccess",i);e.insertFile(s,e.values.get(s).node)}};t.EventEmitter.subscribe(n.parentNode,"OnFileUploadSuccess",o);i.exec((function(){i.diskUfUploader.onChange([a])}));r.stopImmediatePropagation()}))}function m(e,i,n,r){t.EventEmitter.subscribe(r.getEventObject(),"OnImageHasCaught",(function(r){r.stopImmediatePropagation();var a=r.getData();return new Promise((function(o,s){var l=function i(r){var s=babelHelpers.slicedToArray(r.data,3),l=s[0].element_id;babelHelpers.objectDestructuringEmpty(s[1]);var c=s[2];if(a===c&&e.values.has(l)){t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadSuccess",i);t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadFailed",d);var u=e.values.get(l);var f=e.buildHTML(l,u);o({image:u.image,html:f})}};var d=function e(i){var r=babelHelpers.slicedToArray(i.data,3),o=r[0];babelHelpers.objectDestructuringEmpty(r[1]);var d=r[2];if(a===d){t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadSuccess",l);t.EventEmitter.unsubscribe(n.parentNode,"OnFileUploadFailed",e);s()}};t.EventEmitter.subscribe(n.parentNode,"OnFileUploadSuccess",l);t.EventEmitter.subscribe(n.parentNode,"OnFileUploadFailed",d);i.exec((function(){i.diskUfUploader.onChange([r.getData()])}))}))}))}function v(e,t,i){if(e==="Spoiler"){return new o(t,i)}else if(e==="MentionUser"){return new s(t,i)}else if(e==="UploadImage"){return new f(t,i)}else if(e==="UploadFile"){return new u(t,i)}else if(babelHelpers["typeof"](e)==="object"&&e["disk_file"]){return new h(t,i)}return null}function E(e,t){if(!t){return}BX.addCustomEvent(t,"onAutoSavePrepare",(function(t){t.FORM.setAttribute("bx-lhe-autosave-prepared","Y");setTimeout((function(){BX.addCustomEvent(e,"OnContentChanged",(function(e){t["mpfTextContent"]=e;t.Init()}))}),1500)}));BX.addCustomEvent(t,"onAutoSave",(function(e,t){if(BX.type.isNotEmptyString(e["mpfTextContent"]))t["text"]=e["mpfTextContent"]}));BX.addCustomEvent(t,"onAutoSaveRestore",(function(t,i){if(i["text"]&&/[^\s]+/gi.test(i["text"])){e.CheckAndReInit(i["text"])}}));if(t.hasAttribute("bx-lhe-autosave-prepared")&&t.BXAUTOSAVE){t.removeAttribute("bx-lhe-autosave-prepared");setTimeout(t.BXAUTOSAVE.Prepare,100)}}function g(e,t,i){var n=false;if(i.showPanelEditor!==true&&i.showPanelEditor!==false){i.showPanelEditor=!t.toolbar.IsShown();n=true}e.exec((function(){var n=e.getContainer().querySelector('[data-bx-role="button-show-panel-editor"]');if(i.showPanelEditor){t.dom.toolbarCont.style.opacity="inherit";t.toolbar.Show();if(n){n.classList.add("feed-add-post-form-btn-active")}}else{t.toolbar.Hide();if(n){n.classList.remove("feed-add-post-form-btn-active")}}}));if(n!==false){BX.userOptions.save("main.post.form","postEdit","showBBCode",i.showPanelEditor?"Y":"N")}}function y(e,t){if(!(t.urlPreviewId&&window["BXUrlPreview"]&&BX(t.urlPreviewId))){return}var i=new BXUrlPreview(BX(t.urlPreviewId));var n=function e(t){i.attachUrlPreview({url:t})};var r=function e(t,n,r,a){if(n==="createLink"&&BX.type.isPlainObject(a)&&a.hasOwnProperty("href")){i.attachUrlPreview({url:a.href})}};BX.addCustomEvent(e,"OnAfterUrlConvert",n);BX.addCustomEvent(e,"OnAfterLinkInserted",n);BX.addCustomEvent(e,"OnBeforeCommandExec",r);BX.addCustomEvent(e,"OnReinitialize",(function(e,t){i.detachUrlPreview();var n;for(var r in t){if(t.hasOwnProperty(r)&&t[r].hasOwnProperty("USER_TYPE_ID")&&t[r]["USER_TYPE_ID"]==="url_preview"){n=t[r]["VALUE"];break}}if(n){i.attachUrlPreview({id:n})}}))}function w(e,t){e.exec((function(){t.contextMenu.items["postimage"]=t.contextMenu.items["postdocument"]=t.contextMenu.items["postfile"]=[{TEXT:r.Loc.getMessage("BXEdDelFromText"),bbMode:true,ACTION:function e(){var i=t.contextMenu.GetTargetItem("postimage");if(!i)i=t.contextMenu.GetTargetItem("postdocument");if(!i)i=t.contextMenu.GetTargetItem("postfile");if(i&&i.element){t.selection.RemoveNode(i.element)}t.contextMenu.Hide()}}];if(t.toolbar.controls&&t.toolbar.controls.FontSelector){t.toolbar.controls.FontSelector.SetWidth(45)}}))}function B(e){var i=document.querySelector("#lhe_button_submit_"+e.getFormId());if(i){i.addEventListener("click",(function(i){t.EventEmitter.emit(e.getEventObject(),"OnButtonClick",["submit"]);i.preventDefault();i.stopPropagation()}))}var n=document.querySelector("#lhe_button_cancel_"+e.getFormId());if(n){n.addEventListener("click",(function(i){t.EventEmitter.emit(e.getEventObject(),"OnButtonClick",["cancel"]);i.preventDefault();i.stopPropagation()}))}}function I(e,i){var n=e.getContainer().querySelector('[data-bx-role="toolbar"]');if(n.querySelector('[data-id="file"]')){var r=n.querySelector('[data-id="file"]');if(r){r.addEventListener("click",(function(){t.EventEmitter.emit(e.getEventObject(),"onShowControllers",r.hasAttribute("data-bx-button-status")?"hide":"show")}));t.EventEmitter.subscribe(e.getEventObject(),"onShowControllers",(function(e){var t=e.data;if(t.toString()==="show"){r.setAttribute("data-bx-button-status","active")}else{r.removeAttribute("data-bx-button-status")}}));r.setAttribute("data-bx-files-count",0);t.EventEmitter.subscribe(e.getEventObject(),"onShowControllers:File:Increment",(function(e){var t=e.data;var i=t>0?t:1;var n=Math.max(parseInt(r.getAttribute("data-bx-files-count")||0)+i,0);if(n>0){if(!r["counterObject"]){r["counterObject"]=new BX.UI.Counter({value:n,color:BX.UI.Counter.Color.GRAY,animate:true});var a=r.querySelector("span");a.appendChild(r["counterObject"].getContainer())}else{r["counterObject"].update(n)}}r.setAttribute("data-bx-files-count",n)}));t.EventEmitter.subscribe(e.getEventObject(),"onShowControllers:File:Decrement",(function(e){var t=e.data;var i=t>0?t:1;var n=Math.max(parseInt(r.getAttribute("data-bx-files-count")||0)-i,0);r.setAttribute("data-bx-files-count",n);if(r["counterObject"]){r["counterObject"].update(n)}}))}}if(n.querySelector('[data-id="search-tag"]')){window["BXPostFormTags_"+e.getFormId()]=new BXPostFormTags(e.getFormId(),n.querySelector('[data-id="search-tag"]'))}if(n.querySelector('[data-id="create-link"]')){n.querySelector('[data-id="create-link"]').addEventListener("click",(function(e){i.toolbar.controls.InsertLink.OnClick(e)}))}if(n.querySelector('[data-id="video"]')){n.querySelector('[data-id="video"]').addEventListener("click",(function(e){i.toolbar.controls.InsertVideo.OnClick(e)}))}if(n.querySelector('[data-id="quote"]')){var a=n.querySelector('[data-id="quote"]');a.setAttribute("data-bx-type","action");a.setAttribute("data-bx-action","quote");a.addEventListener("mousedown",(function(e){i.toolbar.controls.Quote.OnMouseDown.apply(i.toolbar.controls.Quote,[e]);i.CheckCommand(a)}))}if(e.getContainer().querySelector('[data-bx-role="button-show-panel-editor"]')){e.getContainer().querySelector('[data-bx-role="button-show-panel-editor"]').addEventListener("click",(function(){e.showPanelEditor()}))}}var S;var C;function T(e,t){if(!C){C=new IntersectionObserver((function(e){e.forEach((function(e){if(e.isIntersecting){C.unobserve(e.target);var t=e.target.observedCallback;delete e.target.observedCallback;setTimeout(t)}}))}),{threshold:0})}e.observedCallback=t;C.observe(e)}var P=0;var O=function(){function e(t,i){babelHelpers.classCallCheck(this,e);this.container=i.querySelector('[data-bx-role="toolbar"]');this.adjustMorePosition=this.adjustMorePosition.bind(this);this.moreItem=i.querySelector('[data-bx-role="toolbar-item-more"]');this.moreItem.addEventListener("click",this.showSubmenu.bind(this));T(this.container,this.adjustMorePosition);window.addEventListener("resize",this.adjustMorePosition)}babelHelpers.createClass(e,[{key:"insertAfter",value:function e(t,i){if(!r.Type.isElementNode(t["BODY"])&&!r.Type.isStringFilled(t["BODY"])){return}var n=r.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['<div class="main-post-form-toolbar-button" data-bx-role="toolbar-item"></div>'])));if(r.Type.isElementNode(t["BODY"])){n.appendChild(t["BODY"])}else{n.innerHTML=t["BODY"]}if(t["ID"]){n.setAttribute("data-id",t["ID"])}if(i!==null){var a=false;var o=null;Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){if(a===true&&o===null){o=e}else if(a===false&&e&&e.dataset&&e.dataset.id===i){a=true}}));if(o){o.parentNode.insertBefore(n,o)}}if(!n.parentNode){this.container.appendChild(n)}this.adjustMorePosition()}},{key:"getItems",value:function e(){return Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]'))}},{key:"getVisibleItems",value:function e(){var t=this;var i=[];Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){if(e.offsetTop>t.container.clientHeight/2){i.push(e)}}));return i}},{key:"getHiddenItems",value:function e(){var t=[];Array.from(this.container.querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){if(e.offsetTop>0){t.push(e)}}));return t}},{key:"adjustMorePosition",value:function e(){var t=this.getVisibleItems().length;if(t<=0||t>=this.getItems().length){this.moreItem.style.display="none"}else{this.moreItem.style.display=""}}},{key:"getPopup",value:function e(){var t=this;if(!this.popup){this.popup=n.PopupManager.create({id:"main_post_form_toolbar_"+P++,className:"main-post-form-toolbar-popup",cacheable:false,content:this.getPopupContainer(),closeByEsc:true,autoHide:true,angle:true,bindElement:this.moreItem,offsetTop:-5,offsetLeft:5,events:{onClose:function e(){Array.from(t.getPopupContainer().querySelectorAll('[data-bx-role="toolbar-item"]')).forEach((function(e){t.container.appendChild(e)}));delete t.popup}}})}return this.popup}},{key:"getPopupContainer",value:function e(){if(!this.popupContainer){this.popupContainer=document.createElement("DIV")}return this.popupContainer}},{key:"showSubmenu",value:function e(){var t=this;var i=this.getHiddenItems();if(i.length<=0){return}i.forEach((function(e){t.getPopupContainer().appendChild(e)}));this.getPopup().show()}}]);return e}();var x=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"showPopup",value:function e(t){var i=n.PopupManager.getPopupById(this.getPopupId());if(!i){i=new n.Popup(this.getPopupId(),null,{content:this.getTasksLimitPopupContent(),lightShadow:false,offsetLeft:20,autoHide:false,angle:{position:"bottom"},closeByEsc:false,closeIcon:true})}i.setBindElement(t.bindPosition);i.show()}},{key:"getPopupId",value:function e(){return"bx-post-mention-tasks-limit-popup"}},{key:"getTasksLimitPopupContent",value:function e(){return r.Dom.create("DIV",{style:{width:"400px",padding:"10px"},children:[r.Dom.create("SPAN",{html:r.Loc.getMessage("MPF_MENTION_TASKS_LIMIT").replace("#A_BEGIN#",'<a href="javascript:void(0);" onclick="BX.Main.PostFormTasksLimit.onClickTasksLimitPopupSlider();">').replace("#A_END#","</a>")})]})}},{key:"onClickTasksLimitPopupSlider",value:function e(){this.hidePopup();BX.UI.InfoHelper.show("limit_tasks_observers_participants",{isLimit:true,limitAnalyticsLabels:{module:"tasks",source:"postForm",subject:"auditor"}})}},{key:"hidePopup",value:function e(){var t=n.PopupManager.getPopupById(this.getPopupId());if(t){t.close()}}}]);return e}();function X(e,t,i){H(e,t);k(i,"get");return F(e,i)}function k(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function H(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function F(e,t){if(t.get){return t.get.call(e)}return t.value}var A=function(){function e(i,n){var a=this;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"jobs",new Map);babelHelpers.defineProperty(this,"editorParams",{height:100,ctrlEnterHandler:null,parsers:null,showPanelEditor:false,lazyLoad:true,urlPreviewId:null,tasksLimitExceeded:false});babelHelpers.defineProperty(this,"actionQueue",[]);this.id=i["id"];this.name=i["name"];this.formId=i["formId"];this.eventNode=i.eventNode||document.querySelector("#div"+(this.name||this.id));this.eventNode.dataset.bxHtmlEditable="Y";this.formEntityType=null;e.repo.set(this.getId(),this);if(!r.Type.isArray(n.parsers)&&r.Type.isPlainObject(n.parsers)){n.parsers=Object.values(n.parsers)}this.setEditorParams(n);this.bindEvents(window["BXHtmlEditor"]?window["BXHtmlEditor"].Get(this.getId()):null);this.toolbar=new O(this.getEventObject(),this.getContainer());this.inited=true;if(this.name!==null){window[this.name]=this}BX.onCustomEvent(this,"onInitialized",[this,this.getFormId()]);t.EventEmitter.subscribe(this.getEventObject(),"OnFileUploadSuccess",(function(e){var t=e.compatData;BX.onCustomEvent(a.getEventObject(),"onFileIsAdded",t)}));t.EventEmitter.subscribe(this.getEventObject(),"onBusy",(function(e){var i=e.data;if(a.jobs.size<=0){t.EventEmitter.emit(a.getEventObject(),"onLHEIsBusy")}a.jobs.set(i,(a.jobs.get(i)||0)+1)}));t.EventEmitter.subscribe(this.getEventObject(),"onReady",(function(e){var i=e.data;if(a.jobs.size<=0||!a.jobs.has(i)){return}var n=a.jobs.get(i);if(n<=1){a.jobs["delete"](i);if(a.jobs.size<=0){t.EventEmitter.emit(a.getEventObject(),"onLHEIsReady")}}else{a.jobs.set(i,--n)}}))}babelHelpers.createClass(e,[{key:"setEditorParams",value:function e(t){this.editorParams=Object.assign(this.editorParams,t)}},{key:"bindEvents",value:function e(){var i=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.events={};[["OnEditorInitedBefore",this.OnEditorInitedBefore.bind(this)],["OnCreateIframeAfter",this.OnCreateIframeAfter.bind(this)],["OnEditorInitedAfter",this.OnEditorInitedAfter.bind(this)]].forEach((function(e){var t=babelHelpers.slicedToArray(e,2),r=t[0],a=t[1];if(!n){i.events[r]=function(e){if(e.id===i.getId()){
//!it important to use deprecated eventEmitter
BX.removeCustomEvent(r,i.events[r]);delete i.events[r];a(e)}};//!it important to use deprecated eventEmitter
BX.addCustomEvent(r,i.events[r])}else{a(n)}}));t.EventEmitter.subscribe(this.getEventObject(),"OnShowLHE",this.OnShowLHE.bind(this));t.EventEmitter.subscribe(this.getEventObject(),"OnButtonClick",this.OnButtonClick.bind(this));t.EventEmitter.subscribe(this.getEventObject(),"OnParserRegister",(function(e){var t=e.data;i.addParser(t)}));t.EventEmitter.subscribe(this.getEventObject(),"OnGetHTMLEditor",(function(e){var t=e.data;t.htmlEditor=i.getEditor()}));t.EventEmitter.subscribe(this.getEventObject(),"OnInsertContent",(function(e){var t=babelHelpers.slicedToArray(e.data,2),n=t[0],r=t[1];i.insertContent(n,r)}));t.EventEmitter.subscribe(this.getEventObject(),"OnAddButton",(function(e){var t=babelHelpers.slicedToArray(e.data,2),n=t[0],r=t[1];i.getToolbar().insertAfter(n,r)}));B(this)}},{key:"getId",value:function e(){return this.id}},{key:"setEditor",value:function i(n){var a=this;if(this.htmlEditor===n){return}this.htmlEditor=n;n.formID=this.getFormId();t.EventEmitter.subscribe(n,"OnCtrlEnter",(function(){n.SaveContent();if(r.Type.isFunction(a.editorParams.ctrlEnterHandler)){a.editorParams.ctrlEnterHandler()}else if(r.Type.isStringFilled(a.editorParams.ctrlEnterHandler)&&window[a.editorParams.ctrlEnterHandler]){window[a.editorParams.ctrlEnterHandler]()}else if(document.forms[a.getFormId()]){BX.submit(document.forms[a.getFormId()])}}));this.editorParams["height"]=n.config["height"];console.groupCollapsed("main.post.form: parsers: ",this.getId());this.editorParams.parsers.forEach((function(e){var t=v(e,a,n);if(t){console.groupCollapsed(e);console.log(t);if(t.hasButton()){n.AddButton(t.getButton())}n.AddParser(t.getParser());console.groupEnd(e)}}));console.groupEnd("main.post.form: parsers: ",this.getId());t.EventEmitter.subscribe(n,"OnImageDataUriHandle",(function(e){var i=babelHelpers.slicedToArray(e.compatData,2),r=i[0],o=i[1];var s=BX.UploaderUtils.dataURLToBlob(o.src);if(s&&s.size>0&&s.type.indexOf("image/")===0){t.EventEmitter.emit(a.getEventObject(),"onShowControllers","show");s.name=s.name||o.title||"image."+s.type.substr(6);s.referrerToEditor=o;t.EventEmitter.emit(a.getEventObject(),"OnImageHasCaught",new t.BaseEvent({data:s})).forEach((function(e){e.then((function(e){var i=e.image,r=e.html;t.EventEmitter.emit(n,"OnImageDataUriCaughtUploaded",new t.BaseEvent({compatData:[o,i,{replacement:r}]}))}))["catch"]((function(){t.EventEmitter.emit(n,"OnImageDataUriCaughtFailed",new t.BaseEvent({compatData:[o]}))}))}))}}));t.EventEmitter.subscribe(t.EventEmitter.GLOBAL_TARGET,"onAddVideoMessage",(function(e){var i=babelHelpers.slicedToArray(e.compatData,2),n=i[0],r=i[1];if(!r||a.getFormId()!==r){return}t.EventEmitter.emit(a.getEventObject(),"onShowControllers","show");t.EventEmitter.emit(a.getEventObject(),"OnVideoHasCaught",new t.BaseEvent({data:n}))}));(function(){var i=BX("micro"+(a.name||a.id));var n=false;var r=0;var o=function e(t){t.preventDefault();t.stopPropagation();if(r>0){clearTimeout(r);r=0}if(n===true){return}var o=t&&t["dataTransfer"]&&t["dataTransfer"]["types"]&&t["dataTransfer"]["types"].indexOf("Files")>=0;if(o){n=true;a.getContainer().classList.add("feed-add-post-dnd-over");if(i){i.classList.add("feed-add-post-micro-dnd-ready")}}return true};var s=function e(t){t.preventDefault();t.stopPropagation();if(r>0){clearTimeout(r)}r=setTimeout((function(){n=false;a.getContainer().classList.remove("feed-add-post-dnd-over");if(i){i.classList.remove("feed-add-post-micro-dnd-ready")}}),100);return false};var l=function e(i){s(i);if(i&&i["dataTransfer"]&&i["dataTransfer"]["types"]&&i["dataTransfer"]["types"].indexOf("Files")>=0&&i["dataTransfer"]["files"]&&i["dataTransfer"]["files"].length>0){t.EventEmitter.emit(a.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",{onShowControllers:"show"}]}));t.EventEmitter.emit(a.getEventObject(),"onFilesHaveCaught",new t.BaseEvent({data:i["dataTransfer"]["files"]}))}return false};a.getContainer().addEventListener("dragover",o);a.getContainer().addEventListener("dragenter",o);a.getContainer().addEventListener("dragleave",s);a.getContainer().addEventListener("dragexit",s);a.getContainer().addEventListener("drop",l);a.getContainer().setAttribute("dropzone","copy f:*/*");if(!document.body.hasAttribute("dropzone")){document.body.setAttribute("dropzone","copy f:*/*");document.body.addEventListener("dragover",(function(e){e.preventDefault();e.stopPropagation();return true}));document.body.addEventListener("drop",function(i){i.preventDefault();i.stopPropagation();if(i&&i["dataTransfer"]&&i["dataTransfer"]["types"]&&i["dataTransfer"]["types"].indexOf("Files")>=0&&i["dataTransfer"]["files"]&&i["dataTransfer"]["files"].length>0){var n;var r;var a=X(this.constructor,e,D).keys();while((r=a.next())&&r.done!==true&&r.value){n=r.value}if(n){t.EventEmitter.emit(n.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",{onShowControllers:"show"}]}));t.EventEmitter.emit(n.getEventObject(),"onFilesHaveCaught",new t.BaseEvent({data:i["dataTransfer"]["files"]}))}}return false}.bind(a))}if(i){i.addEventListener("dragenter",(function(e){o(e);t.EventEmitter.emit(a.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",{onShowControllers:"show"}]}))}))}t.EventEmitter.subscribe(a.getEditor(),"OnIframeDrop",(function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];return l(i)}));t.EventEmitter.subscribe(a.getEditor(),"OnIframeDragOver",(function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];return o(i)}));t.EventEmitter.subscribe(a.getEditor(),"OnIframeDragLeave",(function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];return s(i)}))})();t.EventEmitter.subscribe(n,"OnInsertContent",(function(e){var t=babelHelpers.slicedToArray(e.data,2),i=t[0],n=t[1];a.insertContent(i,n)}));g(this,n,this.editorParams);y(n,this.editorParams);w(this,n);E(n,BX(this.getFormId()));I(this,n);t.EventEmitter.subscribe(this.getEventObject(),"OnAfterShowLHE",(function(){a.getEditor().AllowBeforeUnloadHandler()}));t.EventEmitter.subscribe(this.getEventObject(),"OnAfterHideLHE",(function(){x.hidePopup();a.getEditor().DenyBeforeUnloadHandler()}));t.EventEmitter.subscribe(n,"OnIframeClick",(function(){var e=new MouseEvent("click",{bubbles:true,cancelable:true,view:window});n.iframeView.container.dispatchEvent(e)}))}},{key:"getEditor",value:function e(){return this.htmlEditor}},{key:"getFormId",value:function e(){return this.formId}},{key:"getEventObject",value:function e(){return this.eventNode}},{key:"getContainer",value:function e(){return this.eventNode}},{key:"getToolbar",value:function e(){return this.toolbar}},{key:"OnEditorInitedBefore",value:function e(t){this.setEditor(t)}},{key:"OnCreateIframeAfter",value:function e(){if(this.editorIsLoaded!==true){this.editorIsLoaded=true;this.exec();t.EventEmitter.emit(this,"OnEditorIsLoaded",[])}}},{key:"OnEditorInitedAfter",value:function e(i){if(!this.editorParams.lazyLoad){t.EventEmitter.emit(this.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["justShow",i,false]}))}if(i.sandbox&&i.sandbox.inited){this.OnCreateIframeAfter()}}},{key:"addParser",value:function e(t){var i=this;this.exec((function(){t.init(i.getEditor());i.getEditor().AddParser({name:t.id,obj:{Parse:function e(i,n){return t.parse(n)},UnParse:t.unparse}});if(!i["addParserAfterDebounced"]){i.addParserAfterDebounced=r.Runtime.debounce((function(){i.getEditor().SetContent(i.getEditor().GetContent().replace(/&#91;/gi,"[").replace(/&#93;/gi,"]"),true)}),100)}i.addParserAfterDebounced()}))}},{key:"insertContent",value:function e(t){var i=this;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;this.exec((function(){var e=i.getEditor().GetViewMode();if(e==="wysiwyg"){i.getEditor().InsertHtml(n||t);setTimeout(i.getEditor().AutoResizeSceleton.bind(i.getEditor()),500);setTimeout(i.getEditor().AutoResizeSceleton.bind(i.getEditor()),1e3)}else{i.getEditor().textareaView.Focus();if(!i.getEditor().bbCode){var r=i.getEditor().GetIframeDoc();var a=r.createElement("DIV");a.style.display="none";a.innerHTML=t;r.body.appendChild(a);t=i.getEditor().Parse(t,true,false);a.parentNode.removeChild(a)}i.getEditor().textareaView.WrapWith("","",t)}}))}},{key:"reinit",value:function e(i,n){var a="hide";if(r.Type.isPlainObject(n)&&Object.values(n).length){Object.values(n).forEach((function(e){if(e&&e["VALUE"]){a="show"}}))}t.EventEmitter.emit(this.getEventObject(),"onShowControllers",a);t.EventEmitter.emit(this.getEventObject(),"onReinitializeBefore",[i,n]);this.getEditor().CheckAndReInit(r.Type.isString(i)?i:"");BX.onCustomEvent(this.getEditor(),"onReinitialize",[this,i,n]);if(this.editorParams["height"]){this.oEditor.SetConfigHeight(this.editorParams["height"]);this.oEditor.ResizeSceleton()}}},{key:"OnShowLHE",value:function i(n){var a=this;var o=n.data,s=n.compatData;var l=o||s,d=babelHelpers.slicedToArray(l,3),c=d[0],u=d[1],f=d[2];if(!this.getEditor()&&window["BXHtmlEditor"]){window["BXHtmlEditor"].Get(this.getId()).Init()}c=c===false||c==="hide"||c==="justShow"?c:true;var p=BX("micro"+(this.name||this.id));if(p){p.style.display=c===true||c==="justShow"?"none":"block"}if(c==="hide"){X(this.constructor,e,D)["delete"](this);t.EventEmitter.emit(this.getEventObject(),"OnBeforeHideLHE");if(this.getContainer().style.display==="none"){t.EventEmitter.emit(this.getEventObject(),"OnAfterHideLHE");t.EventEmitter.emit(this.getEventObject(),"onShowControllers","hide")}else{new BX["easing"]({duration:200,start:{opacity:100,height:this.getContainer().scrollHeight},finish:{opacity:0,height:20},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function e(t){a.getContainer().style.height=t.height+"px";a.getContainer().style.opacity=t.opacity/100},complete:function e(){a.getContainer().style.cssText="";a.getContainer().style.display="none";t.EventEmitter.emit(a.getEventObject(),"OnAfterHideLHE");t.EventEmitter.emit(a.getEventObject(),"onShowControllers","hide")}}).animate()}}else if(c){X(this.constructor,e,D).set(this);this.formEntityType=r.Type.isArray(f)&&r.Type.isStringFilled(f[0])&&f[0].match(/^TASK_(\d+)$/i)?"task":null;if(u&&r.Type.isPlainObject(u)){if(u["onShowControllers"]){t.EventEmitter.emit(this.getEventObject(),"onShowControllers",u["onShowControllers"])}}t.EventEmitter.emit(this.getEventObject(),"OnBeforeShowLHE");if(c==="justShow"||this.getContainer().style.display==="block"){this.getContainer().style.display="block";t.EventEmitter.emit(this.getEventObject(),"OnAfterShowLHE");if(u!==false){this.getEditor().Focus()}}else{r.Dom.adjust(this.getContainer(),{style:{display:"block",overflow:"hidden",height:"20px",opacity:.1}});new BX["easing"]({duration:200,start:{opacity:10,height:20},finish:{opacity:100,height:this.getContainer().scrollHeight},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function e(t){a.getContainer().style.height=t.height+"px";a.getContainer().style.opacity=t.opacity/100},complete:function e(){t.EventEmitter.emit(a.getEventObject(),"OnAfterShowLHE");a.getEditor().Focus();a.getContainer().style.cssText=""}}).animate()}}else{X(this.constructor,e,D)["delete"](this);t.EventEmitter.emit(this.getEventObject(),"OnBeforeHideLHE");t.EventEmitter.emit(this.getEventObject(),"onShowControllers","hide");this.getContainer().style.display="none";t.EventEmitter.emit(this.getEventObject(),"OnAfterHideLHE")}}},{key:"OnButtonClick",value:function e(i){var n=babelHelpers.slicedToArray(i.data,1),r=n[0];if(r!=="cancel"){var a={result:true};t.EventEmitter.emit(this.getEventObject(),"OnClickBeforeSubmit",new t.BaseEvent({compatData:[this,a]}));if(a["result"]!==false){t.EventEmitter.emit(this.getEventObject(),"OnClickSubmit",new t.BaseEvent({compatData:[this]}))}}else{t.EventEmitter.emit(this.getEventObject(),"OnClickCancel",new t.BaseEvent({compatData:[this]}));t.EventEmitter.emit(this.getEventObject(),"OnShowLHE",new t.BaseEvent({compatData:["hide"]}))}}},{key:"exec",value:function e(t,i){if(typeof t=="function"){this.actionQueue.push([t,i])}if(this.editorIsLoaded===true){var n;while((n=this.actionQueue.shift())&&n){n[0].apply(this,n[1])}}}},{key:"showPanelEditor",value:function e(){g(this,this.getEditor(),{})}},{key:"getContent",value:function e(){return this.oEditor?this.oEditor.GetContent():""}},{key:"setContent",value:function e(t){if(this.getEditor()){this.getEditor().SetContent(t)}}},{key:"controllerInit",value:function e(i){t.EventEmitter.emit(this.getEventObject(),"onShowControllers",i==="hide"?"hide":"show")}},{key:"isReady",get:function e(){return this.editorIsLoaded}},{key:"oEditor",get:function e(){return this.getEditor()}},{key:"oEditorId",get:function e(){return this.getId()}},{key:"formID",get:function e(){return this.getFormId()}},{key:"params",get:function e(){return{formID:this.getFormId()}}},{key:"controllers",get:function e(){var i=new t.BaseEvent;var n={};i.setData(n);t.EventEmitter.emit(this.getEventObject(),"onCollectControllers",i);var a={};Object.keys(n).forEach((function(e){a[e]=Object.assign({},n[e]);a[e]["values"]={};if(r.Type.isArray(n[e]["values"])){n[e]["values"].forEach((function(t){a[e]["values"][t]={id:t}}))}else if(r.Type.isPlainObject(n[e]["values"])){a[e]["values"]=Object.assign({},n[e]["values"])}}));return a}},{key:"arFiles",get:function e(){var i=new t.BaseEvent;var n={};i.setData(n);t.EventEmitter.emit(this.getEventObject(),"onCollectControllers",i);var r={};Object.keys(n).forEach((function(e){if(n[e]["values"]){n[e]["values"].forEach((function(t){r[t]=[e]}))}}));return r}}]);return e}();babelHelpers.defineProperty(A,"repo",new Map);var D={writable:true,value:new Map};window["LHEPostForm"]={getEditor:function e(t){return window["BXHtmlEditor"]?window["BXHtmlEditor"].Get(babelHelpers["typeof"](t)=="object"?t.id:t):null},getHandler:function e(t){var i=r.Type.isStringFilled(t)?t:t.id;return A.repo.get(i)},getHandlerByFormId:function e(t){var i=null;A.repo.forEach((function(e){if(e.getFormId()===t){i=e}}));return i},reinitData:function e(t,i,n){var a={};if(!r.Type.isPlainObject(n)){n={}}Object.entries(n).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],n=t[1];if(r.Type.isPlainObject(n)&&n["USER_TYPE_ID"]&&n["VALUE"]&&Object.values(n["VALUE"]).length>0){a[i]=n}}));var o=this.getHandler(t);if(o&&(o.isReady||r.Type.isStringFilled(i)||Object.values(a).length>0)){o.exec(o.reinit,[i,a])}return false},reinitDataBefore:function e(i){var n=A.repo.get(i);if(n&&n.getEventObject()){t.EventEmitter.emit(n.getEventObject(),"onReinitializeBefore",[n])}}};e.PostForm=A;e.PostFormTasksLimit=x})(this.BX.Main=this.BX.Main||{},BX.Event,BX,BX.Main,BX);(function(){if(window["BXPostFormTags"])return;var e={selector:{},mentionParams:{}};window.BXPostFormTags=function(e,t){this.popup=null;this.formID=e;this.buttonID=t;this.sharpButton=null;this.addNewLink=null;this.tagsArea=null;this.hiddenField=null;this.popupContent=null;BX.ready(BX.proxy(this.init,this))};window.BXPostFormTags.prototype.init=function(){this.sharpButton=BX(this.buttonID);this.addNewLink=BX("post-tags-add-new-"+this.formID);this.tagsArea=BX("post-tags-block-"+this.formID);this.tagsContainer=BX("post-tags-container-"+this.formID);this.hiddenField=BX("post-tags-hidden-"+this.formID);this.popupContent=BX("post-tags-popup-content-"+this.formID);this.popupInput=BX.findChild(this.popupContent,{tag:"input"});var e=BX.findChildren(this.tagsContainer,{className:"feed-add-post-del-but"},true);for(var t=0,i=e.length;t<i;t++){BX.bind(e[t],"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:e[t].parentNode,tagValue:e[t].parentNode.getAttribute("data-tag")}))}BX.bind(this.sharpButton,"click",BX.proxy(this.onButtonClick,this));BX.bind(this.addNewLink,"click",BX.proxy(this.onAddNewClick,this))};window.BXPostFormTags.prototype.onTagDelete=function(){BX.remove(this.tagBox);this.obj.hiddenField.value=this.obj.hiddenField.value.replace(this.tagValue+",","").replace("  "," ")};window.BXPostFormTags.prototype.show=function(){if(this.popup===null){this.popup=new BX.PopupWindow("bx-post-tag-popup",this.addNewLink,{content:this.popupContent,lightShadow:false,offsetTop:8,offsetLeft:10,autoHide:true,angle:true,closeByEsc:true,zIndex:-840,buttons:[new BX.PopupWindowButton({text:BX.message("TAG_ADD"),events:{click:BX.proxy(this.onTagAdd,this)}})]});BX.bind(this.popupInput,"keydown",BX.proxy(this.onKeyPress,this));BX.bind(this.popupInput,"keyup",BX.proxy(this.onKeyPress,this))}this.popup.show();BX.focus(this.popupInput)};window.BXPostFormTags.prototype.addTag=function(e){var t=BX.type.isNotEmptyString(e)?e.split(","):this.popupInput.value.split(",");var i=[];for(var n=0;n<t.length;n++){var r=BX.util.trim(t[n]);if(r.length>0){var a=this.hiddenField.value.split(",");if(!BX.util.in_array(r,a)){var o;var s=BX.create("span",{children:[o=BX.create("span",{attrs:{class:"feed-add-post-del-but"}})],attrs:{class:"feed-add-post-tags"}});s.insertBefore(document.createTextNode(r),o);this.tagsContainer.insertBefore(s,this.addNewLink);BX.bind(o,"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:s,tagValue:r}));this.hiddenField.value+=r+",";i.push(r)}}}return i};window.BXPostFormTags.prototype.onTagAdd=function(){this.addTag();this.popupInput.value="";this.popup.close()};window.BXPostFormTags.prototype.onAddNewClick=function(e){e=e||window.event;this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onButtonClick=function(e){e=e||window.event;BX.show(this.tagsArea);this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onKeyPress=function(e){e=e||window.event;var t=e.keyCode?e.keyCode:e.which?e.which:null;if(t==13){setTimeout(BX.proxy(this.onTagAdd,this),0)}};window.BXPostFormImportant=function(e,t,i){if(i){this.formID=e;this.buttonID=t;this.inputName=i;this.fireButton=null;this.activeBlock=null;this.hiddenField=null;BX.ready(BX.proxy(this.init,this))}return false};window.BXPostFormImportant.prototype.init=function(){this.fireButton=BX(this.buttonID);this.activeBlock=BX(this.buttonID+"-active");var e=BX(this.formID);if(e){this.hiddenField=e[this.inputName];if(this.hiddenField&&this.hiddenField.value==1){this.showActive()}}BX.bind(this.fireButton,"click",BX.proxy((function(e){e=e||window.event;this.showActive();BX.PreventDefault(e)}),this));BX.bind(this.activeBlock,"click",BX.proxy((function(e){e=e||window.event;this.hideActive();BX.PreventDefault(e)}),this))};window.BXPostFormImportant.prototype.showActive=function(e){BX.hide(this.fireButton);BX.show(this.activeBlock,"inline-block");if(this.hiddenField){this.hiddenField.value=1}return false};window.BXPostFormImportant.prototype.hideActive=function(e){BX.hide(this.activeBlock);BX.show(this.fireButton,"inline-block");if(this.hiddenField){this.hiddenField.value=0}return false};var t=null;window.MPFbuttonShowWait=function(e){if(e&&!BX.type.isElementNode(e)){e=null}e=e||this;e=e?e.tagName=="A"?e:e.parentNode:e;if(e){BX.addClass(e,"ui-btn-clock");t=e;BX.defer((function(){e.disabled=true}))()}};var i={listen:false,plus:false,text:"",bSearch:false,node:null,mode:null};BX.addCustomEvent(window,"onInitialized",(function(e){if(e&&e.eventNode){BX.onCustomEvent(e.eventNode,"OnClickCancel",(function(){i.node=null}))}}));BX.addCustomEvent(window,"BX.MPF.MentionSelector:open",(function(t){var i=BX.Type.isStringFilled(t.formId)?t.formId:"";if(!BX.Type.isStringFilled(i)||BX.Type.isUndefined(e.mentionParams[i])){return}var n=BX.Type.isDomNode(t.bindNode)?t.bindNode:null;var r=BX.type.isNotEmptyObject(t.bindPosition)?t.bindPosition:null;var a=window.MPFgetSelectorId("bx-mention-"+i+"-id")+(n?"-withsearch":"");var o=BX.UI.EntitySelector.Dialog.getById(a);if(!o){window.MPFcreateSelectorDialog({formId:i,selectorId:a,enableSearch:!!n,params:e.mentionParams[i]});o=BX.UI.EntitySelector.Dialog.getById(a)}if(!o){return}o.deselectAll();o.search("");o.show();var s={};if(BX.Type.isDomNode(n)){o.focusSearch();o.popup.setBindElement(n);s.position="top"}else if(BX.type.isNotEmptyObject(r)){r.top-=5;o.popup.setBindElement(r)}o.popup.adjustPosition(s)}));window.onKeyDownHandler=function(e,t,r){var a=e.keyCode;if(!window["BXfpdStopMent"+r]){return true}var o=window.MPFgetSelectorId("bx-mention-"+r+"-id");if(a===t.KEY_CODES["backspace"]&&i.node){var s=BX.util.trim(t.util.GetTextContent(i.node));if(s==="+"||s==="@"||i.mode=="button"&&s.length==1){window["BXfpdStopMent"+r]()}else if(i.mode=="button"&&s.length==1){window["BXfpdStopMent"+r]()}}if(BX.util.in_array(a,[107,187])||(e.shiftKey||e.modifiers>3)&&BX.util.in_array(a,[50,43,61])||e.altKey&&BX.util.in_array(a,[76])||e.altKey&&e.ctrlKey&&BX.util.in_array(a,[81])&&e.key==="@"||e.altKey&&BX.util.in_array(a,[71,81])&&e.key==="@"||e.altKey&&BX.util.in_array(a,[50])&&e.key==="@"||BX.Type.isFunction(e.getModifierState)&&!!e.getModifierState("AltGraph")&&BX.util.in_array(a,[81,50,48])&&!BX.Type.isUndefined(e.key)&&e.key==="@"||BX.util.in_array(a,[192])&&e.key==="@"){setTimeout((function(){var e=t.selection.GetRange();var a=t.GetIframeDoc();var s=e?e.endContainer.textContent:"";var l=s?s.slice(e.endOffset-1,e.endOffset):"";var d=s?s.slice(e.endOffset-2,e.endOffset-1):"";if((l=="@"||l=="+")&&(!d||BX.util.in_array(d,["+","@",",","("])||d.length==1&&BX.util.trim(d)==="")){i.listen=true;i.listenFlag=true;i.text="";i.leaveContent=true;i.mode="plus";e.setStart(e.endContainer,e.endOffset-1);e.setEnd(e.endContainer,e.endOffset);t.selection.SetSelection(e);i.node=BX.create("SPAN",{props:{id:"bx-mention-node"}},a);t.selection.Surround(i.node,e);e.setStart(i.node,1);e.setEnd(i.node,1);t.selection.SetSelection(e);if(BX.Type.isStringFilled(o)){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:r,bindPosition:n(i.node,t)}])}}}),10)}if(i.listen){var l=null;var d=BX.Type.isStringFilled(o)?BX.UI.EntitySelector.Dialog.getById(o):null;if(d&&d.getActiveTab()){l=d.getActiveTab().getId()}var c=null;switch(a){case t.KEY_CODES.enter:c="Enter";break;case 9:c="Tab";break;case t.KEY_CODES.up:c="ArrowUp";break;case t.KEY_CODES.down:c="ArrowDown";break;case t.KEY_CODES.left:if(l==="departments"){c="ArrowLeft"}break;case t.KEY_CODES.right:if(l==="departments"){c="ArrowRight"}break}if(c){var u=new KeyboardEvent("keydown",{key:c,keyCode:a,bubbles:true,cancelable:true,view:window});if(!document.dispatchEvent(u)){t.iframeKeyDownPreventDefault=true;e.stopPropagation();e.preventDefault()}}}if(!i.listen&&i.listenFlag&&a===t.KEY_CODES["enter"]){var f=t.selection.GetRange();if(f.collapsed){var p=f.endContainer;var h=t.GetIframeDoc();if(p){if(p.className!=="bxhtmled-metion"){p=BX.findParent(p,(function(e){return e.className=="bxhtmled-metion"}),h.body)}if(p&&p.className=="bxhtmled-metion"){t.selection.SetAfter(p)}}}}};window.onKeyUpHandler=function(e,t,n){var r=e.keyCode;var a;var o;if(!window["BXfpdStopMent"+n]){return true}if(i.listen===true){if(r==t.KEY_CODES.escape){var s=new KeyboardEvent("keyup",{key:"Escape",keyCode:r,bubbles:true,cancelable:true,view:window});if(!document.dispatchEvent(s)){e.stopPropagation();e.preventDefault()}window["BXfpdStopMent"+n]()}else if(r!==t.KEY_CODES.enter&&r!==t.KEY_CODES.left&&r!==t.KEY_CODES.right&&r!==t.KEY_CODES.up&&r!==t.KEY_CODES.down){if(BX(i.node)){o=BX.util.trim(t.util.GetTextContent(i.node));var l=o;o=o.replace(/^[\+@]*/,"");i.bSearch=BX.Type.isStringFilled(o);var d=window.MPFgetSelectorId("bx-mention-"+n+"-id");var c=BX.UI.EntitySelector.Dialog.getById(d);if(BX.Type.isStringFilled(o)&&c){c.search(o)}if(i.leaveContent&&i._lastText){if(l===""){window["BXfpdStopMent"+n]()}else if(l!==""&&o===""){i.bSearch=false;if(c){c.search("")}}}i.lastText=o;i._lastText=l}else{window["BXfpdStopMent"+n]()}}}else{if(!e.shiftKey&&(r===t.KEY_CODES["space"]||r===t.KEY_CODES["escape"]||r===188||r===190)){a=t.selection.GetRange();if(a.collapsed){var u=a.endContainer;var f=t.GetIframeDoc();if(u){if(u.className!=="bxhtmled-metion"){u=BX.findParent(u,(function(e){return e.className=="bxhtmled-metion"}),f.body)}if(u&&u.className=="bxhtmled-metion"){o=t.util.GetTextContent(u);var p=o.match(/[\s\.\,]$/);if(p||r===t.KEY_CODES["escape"]){u.innerHTML=o.replace(/[\s\.\,]$/,"");var h=BX.create("SPAN",{html:p||t.INVISIBLE_SPACE},f);t.util.InsertAfter(h,u);t.selection.SetAfter(h)}}}}}}};window.onTextareaKeyDownHandler=function(e,t,n){var r=e.keyCode;if(i.listen&&r==t.KEY_CODES.enter){t.textareaKeyDownPreventDefault=true;e.stopPropagation();e.preventDefault()}};window.onTextareaKeyUpHandler=function(e,t,n){var r=null;var a="";var o=e.keyCode;var s=window.MPFgetSelectorId("bx-mention-"+n+"-id");if(i.listen===true){if(o==27){window["BXfpdStopMent"+n]()}else if(o!==13){a=t.textareaView.GetValue(false);r=t.textareaView.GetCursorPosition();var l="";var d="";if(a.indexOf("+")!==-1||a.indexOf("@")!==-1){var c=a.substr(0,r);var u=Math.max(c.lastIndexOf("+"),c.lastIndexOf("@"));if(u>=0){l=c.substr(u);d=l;l=l.replace(/^[\+@]*/,"");i.bSearch=BX.Type.isStringFilled(l);var f=BX.UI.EntitySelector.Dialog.getById(s);if(BX.Type.isStringFilled(l)&&f){f.search(l)}}}if(i._lastText){if(d===""){window["BXfpdStopMent"+n]()}else if(d!==""&&l===""){i.bSearch=false;if(f){f.search("")}}}i.lastText=l;i._lastText=d}}else{if(o==16){var p=this;this.shiftPressed=true;if(this.shiftTimeout){this.shiftTimeout=clearTimeout(this.shiftTimeout)}this.shiftTimeout=setTimeout((function(){p.shiftPressed=false}),100)}if(o==107||(e.shiftKey||e.modifiers>3||this.shiftPressed)&&BX.util.in_array(o,[187,50,107,43,61])){r=t.textareaView.element.selectionStart;if(r>0){a=t.textareaView.element.value;var h=a.substr(r-1,1);if(h&&(h==="+"||h==="@")){i.listen=true;i.listenFlag=true;i.text="";i.textarea=true;i.bSearch=false;i.mode="plus";BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:n,bindPosition:BX.pos(document.getElementById("bx-b-mention-"+n))}])}}}}};var n=function(e,t){var i=BX.pos(e);var n=BX.pos(t.dom.areaCont);var r=BX.GetWindowScrollPos(t.GetIframeDoc());var a=n.top+i.bottom-r.scrollTop+2;var o=n.left+i.right-r.scrollLeft;return{top:a,left:o}};window.BxInsertMention=function(e){var t=e.item;var r=e.type;var a=e.formID;var o=e.editorId;var s=e.bNeedComa;var l=LHEPostForm.getEditor(o);var d;if((r==="user"||r==="project"||r==="department")&&t&&t.entityId>0&&l){if(l.GetViewMode()=="wysiwyg"){var c=l.GetIframeDoc();var u=l.selection.GetRange();var f=BX.create("SPAN",{props:{className:"bxhtmled-metion"},text:BX.util.htmlspecialcharsback(t.name)},c);d=BX.create("SPAN",{html:s?",&nbsp;":"&nbsp;"},c);var p={tag:"postuser",params:{value:t.entityId}};switch(r){case"project":p.projectId=t.entityId;p.projectName=t.name;break;case"department":p.departmentId=t.entityId;p.departmentName=t.name;break;default:p.userId=t.entityId;p.userName=t.name}l.SetBxTag(f,p);if(BX(i.node)&&i.node.parentNode){l.util.ReplaceNode(i.node,f)}else{l.selection.InsertNode(f,u)}if(f&&f.parentNode){var h=BX.findParent(f,{className:"bxhtmled-metion"},c.body);if(h){l.util.InsertAfter(f,h)}}if(f&&f.parentNode){l.util.InsertAfter(d,f);l.selection.SetAfter(d)}}else if(l.GetViewMode()=="code"&&l.bbCode){l.textareaView.Focus();var b=l.textareaView.GetValue(false);var m=l.textareaView.GetCursorPosition();var v=b.substr(0,m);var E=Math.max(v.lastIndexOf("+"),v.lastIndexOf("@"));if(E>=0&&m>E){l.textareaView.SetValue(b.substr(0,E)+b.substr(m));l.textareaView.element.setSelectionRange(E,E)}var g="";switch(r){case"user":g="USER";break;case"project":g="PROJECT";break;case"department":g="DEPARTMENT";break;default:}l.textareaView.WrapWith(false,false,"["+g+"="+t.entityId+"]"+t.name+"[/"+g+"]"+(s?", ":" "))}if(e.fireAddEvent===true){BX.onCustomEvent(window,"onMentionAdd",[t,r])}if(window["BXfpdStopMent"+a]){window["BXfpdStopMent"+a]()}i["text"]="";if(l.GetViewMode()=="wysiwyg"){l.Focus();l.selection.SetAfter(d)}var y=LHEPostForm.getHandler(o);if(y&&y.formEntityType==="task"&&y.editorParams.tasksLimitExceeded){BX.Main.PostFormTasksLimit.showPopup({bindPosition:n(i.node,l)})}}};window.MPFgetSelectorId=function(e){var t=false;var i=BX(e);if(!i){return t}t=i.getAttribute("data-bx-selector-id");return t};window.MPFcreateSelectorDialog=function(e){new BX.UI.EntitySelector.Dialog({targetNode:"mpf-mention-"+e.formId,id:e.selectorId,context:"MENTION",multiple:false,enableSearch:e.enableSearch,clearSearchOnSelect:true,hideOnSelect:true,hideByEsc:true,entities:e.params.entities,height:300,width:400,compactView:true,events:{onShow:function(){window.BXfpdOnDialogOpen()},onHide:function(){window.BXfpdOnDialogClose({editorId:e.params.editorId})},"Item:onSelect":function(t){var i=t.getData().item;if(i){window["BXfpdSelectCallbackMent"+e.formId]({item:{name:i.getTitle(),entityId:i.getId()},entityType:i.getEntityId()})}}}})};window.MPFMentionInit=function(t,n){e.mentionParams[t]=n;if(n.initDestination===true){BX.addCustomEvent("onAutoSaveRestoreDestination",(function(e){if(BX.type.isNotEmptyObject(e)&&BX.type.isNotEmptyObject(e.data)&&BX.type.isNotEmptyString(e.data.DEST_DATA)&&BX.type.isNotEmptyString(e.formId)&&e.formId==t&&BX.UI.EntitySelector){var i=JSON.parse(e.data.DEST_DATA);if(!Array.isArray(i)){return}var n=BX.UI.EntitySelector.Dialog.getById("oPostFormLHE_blogPostForm");if(!BX.type.isNotEmptyObject(n)){return}n.preselectedItems=i;n.setPreselectedItems(i)}}));BX.addCustomEvent(window,"onMentionAdd",(function(e,t){var i=BX.UI.EntitySelector.Dialog.getById("oPostFormLHE_blogPostForm");if(!BX.type.isNotEmptyObject(i)){return}var n="";if(t==="user"){if(e.isExtranet==="Y"){n="extranet"}else if(e.isEmail==="Y"){n="email"}else{n="employee"}}else if(t==="project"){if(e.isExtranet==="Y"){n="extranet"}}i.addItem({avatar:e.avatar,customData:{email:BX.Type.isStringFilled(e.email)?e.email:""},entityId:t,entityType:n,id:e.entityId,title:e.name}).select()}))}window["BXfpdSelectCallbackMent"+t]=function(e){window.BxInsertMention({item:e.item,type:e.entityType.toLowerCase(),formID:t,editorId:n.editorId,fireAddEvent:n.initDestination})};window["BXfpdStopMent"+t]=function(){var e=window.MPFgetSelectorId("bx-mention-"+t+"-id");var i=BX.UI.EntitySelector.Dialog.getById(e);if(i){i.hide()}};if(BX(t)){BX.addCustomEvent(BX(t),"OnUCFormAfterShow",(function(e){if(!BX.type.isNotEmptyObject(e)||!BX.type.isArray(e.id)||!BX.Type.isStringFilled(e.id[0])){return}var t=new RegExp("EVENT_(\\d+)","i");if(!t.test(e.id[0])){return}}))}var r=LHEPostForm.getHandlerByFormId(t);if(r){r.exec()}BX.ready((function(){var e=BX("bx-b-mention-"+t);BX.bind(e,"click",(function(r){if(i.listen!==true){var a=LHEPostForm.getEditor(n.editorId);var o=a.GetIframeDoc();if(a.GetViewMode()=="wysiwyg"&&o){i.listen=true;i.listenFlag=true;i.text="";i.leaveContent=false;i.mode="button";var s=a.selection.GetRange();if(BX(i.node)){BX.remove(BX(i.node))}a.InsertHtml('<span id="bx-mention-node">'+a.INVISIBLE_SPACE+"</span>",s);setTimeout((function(){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:t,bindNode:e}]);i.node=o.getElementById("bx-mention-node");if(i.node){s.setStart(i.node,0);if(i.node.firstChild&&i.node.firstChild.nodeType==3&&i.node.firstChild.nodeValue.length>0){s.setEnd(i.node,1)}else{s.setEnd(i.node,0)}a.selection.SetSelection(s)}a.Focus()}),100)}else if(a.GetViewMode()=="code"){i.listen=true;i.listenFlag=true;i.text="";i.leaveContent=false;i.mode="button";setTimeout((function(){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{formId:t,bindNode:e}])}),100)}BX.onCustomEvent(e,"mentionClick")}}))}))};window.BXfpdOnDialogOpen=function(){i.listen=true;i.listenFlag=true};window.BXfpdOnDialogClose=function(e){i.listen=false;setTimeout((function(){i.listenFlag=false;if(!i.listen){var t=LHEPostForm.getEditor(e.editorId);if(t){t.Focus()}}}),100)};MPFEntitySelector=function(t){this.selector=null;this.inputNode=null;this.messages={};if(!BX.Type.isStringFilled(t.id)){return null}if(e.selector[t.id]){return e.selector[t.id]}e.selector[t.id]=this.init(t)};MPFEntitySelector.prototype.init=function(e){if(!BX.type.isPlainObject(e)){e={}}if(!BX.Type.isStringFilled(e.id)||!BX.Type.isStringFilled(e.tagNodeId)||!BX(e.tagNodeId)){return null}if(BX.Type.isStringFilled(e.inputNodeId)&&BX(e.inputNodeId)){this.inputNode=BX(e.inputNodeId)}if(BX.type.isNotEmptyObject(e.messages)){this.messages=e.messages}this.selector=new BX.UI.EntitySelector.TagSelector({id:e.id,dialogOptions:{id:e.id,context:BX.Type.isStringFilled(e.context)?e.context:null,preselectedItems:BX.type.isArray(e.preselectedItems)?e.preselectedItems:[],events:{"Item:onSelect":function(){this.recalcValue(this.selector.getDialog().getSelectedItems())}.bind(this),"Item:onDeselect":function(){this.recalcValue(this.selector.getDialog().getSelectedItems())}.bind(this)},entities:[{id:"meta-user",options:{"all-users":{title:this.messages.allUsersTitle,allowView:BX.type.isBoolean(e.allowToAll)&&e.allowToAll}}},{id:"user",options:{emailUsers:BX.type.isBoolean(e.allowSearchEmailUsers)?e.allowSearchEmailUsers:false,inviteGuestLink:BX.type.isBoolean(e.allowSearchEmailUsers)?e.allowSearchEmailUsers:false,myEmailUsers:true}},{id:"project",options:{features:{blog:["premoderate_post","moderate_post","write_post","full_post"]}}},{id:"department",options:{selectMode:"usersAndDepartments",allowFlatDepartments:false}}]},addButtonCaption:BX.message("BX_FPD_LINK_1"),addButtonCaptionMore:BX.message("BX_FPD_LINK_2")});this.selector.renderTo(document.getElementById(e.tagNodeId));return this.selector};MPFEntitySelector.prototype.recalcValue=function(e){if(!BX.type.isArray(e)||!this.inputNode){return}var t=[];e.forEach((function(e){t.push([e.entityId,e.id])}));this.inputNode.value=JSON.stringify(t)};window.MPFEntitySelector=MPFEntitySelector})()})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:71:"/bitrix/components/bitrix/system.field.edit/script.min.js?1726456244814";s:6:"source";s:53:"/bitrix/components/bitrix/system.field.edit/script.js";s:3:"min";s:57:"/bitrix/components/bitrix/system.field.edit/script.min.js";s:3:"map";s:57:"/bitrix/components/bitrix/system.field.edit/script.map.js";}"*/
function addElement(e,n){if(document.getElementById("main_"+e)){var d=document.getElementById("main_"+e).getElementsByTagName("div");if(d&&d.length>0&&d[0]){var t=d[0].parentNode;t.appendChild(d[d.length-1].cloneNode(true))}}}function addElementFile(e,n){var d=document.getElementById("main_"+e);var t=document.getElementById("main_add_"+e);if(d&&t){t=t.cloneNode(true);t.id="";t.style.display="";d.appendChild(t)}}function addElementDate(e,n){var d=document.getElementById("date_container_"+n);var t=document.getElementById("hidden_"+n).innerHTML;if(d&&t){var a=e[n].fieldName;var i=e[n].index;t=t.replace(/[#]FIELD_NAME[#]/g,a+"["+i+"]");t=t.replace(/[\%]23FIELD_NAME[\%]23/g,escape(a+"["+i+"]"));var l=d.appendChild(document.createElement("DIV"));l.innerHTML+=t;e[n].index++}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:87:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?172645630266406";s:6:"source";s:67:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.js";s:3:"min";s:71:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js";s:3:"map";s:71:"/bitrix/components/bitrix/disk.uf.file/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};this.BX.Disk=this.BX.Disk||{};(function(e,t,i,n,a,r,s){"use strict";var o=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"set",value:function t(i){for(var n in i){if(e.hasOwnProperty(n)){e[n]=i[n]}}}},{key:"getDocumentHandlers",value:function t(){if(!e.documentHandlers){return[]}return e.documentHandlers}},{key:"getDocumentHandler",value:function t(i){if(!e.documentHandlers){return{}}var n=e.documentHandlers.find((function(e){return e.code===i}));return n||{}}}]);return e}();babelHelpers.defineProperty(o,"urlUpload",null);babelHelpers.defineProperty(o,"documentHandlers",null);babelHelpers.defineProperty(o,"previewSize",{width:115,height:115});var l;var c=function(){function e(t,i){babelHelpers.classCallCheck(this,e);this.id=t;this.object=i;this.data={NAME:i.name};s.EventEmitter.subscribe(this.object,"onUploadProgress",this.onUploadProgress.bind(this));s.EventEmitter.subscribe(this.object,"onUploadDone",this.onUploadDone.bind(this));s.EventEmitter.subscribe(this.object,"onUploadError",this.onUploadError.bind(this));this.progress=new BX.UI.ProgressRound({width:18,colorTrack:"rgba(255,255,255,.3)",colorBar:"#fff",lineSize:3,statusType:BX.UI.ProgressRound.Status.INCIRCLE,textBefore:"<i></i>",textAfter:this.object.size})}babelHelpers.createClass(e,[{key:"getContainer",value:function e(){if(!this.container){var t=this.object.name.split(".").pop().toLowerCase();t=r.Text.encode(t===this.object.name?"":t);this.container=r.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-file-thumb disk-file-thumb-file disk-file-thumb--',' disk-file-thumb--active">\n\t\t\t<div class="ui-icon ui-icon-file-',' disk-file-thumb-icon"><i></i></div>\n\t\t\t<div class="disk-file-thumb-text">','</div>\n\t\t\t<div class="disk-file-thumb-loader">\n\t\t\t\t','\n\t\t\t\t<div class="disk-file-thumb-loader-btn" onclick="','"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t'])),t,t,r.Text.encode(this.object.name),this.progress.getContainer(),this.onClickDelete.bind(this))}return this.container}},{key:"onClickDelete",value:function e(t){var i=this;t.preventDefault();t.stopPropagation();s.EventEmitter.emit(this,"onDelete",[this]);setTimeout((function(){i.object.deleteFile()}),400);delete this.container}},{key:"onUploadProgress",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,2),n=i[0],a=i[1];a=Math.min(Math.max(this.progress.getValue(),a),98);this.progress.update(a)}},{key:"onUploadDone",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,2),n=i[0],a=i[1].file;s.EventEmitter.emit(this,"onUploadDone",[a,n.file]);delete this.object.hash;this.object.deleteFile()}},{key:"onUploadError",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,1),n=i[0];s.EventEmitter.emit(this,"onUploadError",[n.file]);this.progress.setTextBefore(r.Loc.getMessage("WDUF_ITEM_ERROR"));this.container.classList.add("disk-file-upload-error");this.object.deleteFile()}}]);return e}();function u(e,t,i){d(e,t);t.set(e,i)}function d(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function h(e,t,i){b(e,t);p(i,"get");return f(e,i)}function p(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function b(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function f(e,t){if(t.get){return t.get.call(e)}return t.value}var m=new WeakMap;var v=function(){function e(t){var i=t.id,n=t.container,a=t.dropZone,r=t.input;babelHelpers.classCallCheck(this,e);u(this,m,{writable:true,value:0});this.container=n;this.agent=BX.Uploader.getInstance({id:i,allowUpload:"A",uploadFormData:"N",uploadMethod:"immediate",uploadFileUrl:o.urlUpload,showImage:false,sortItems:false,dropZone:a,input:r,pasteFileHashInForm:false});s.EventEmitter.subscribe(this.agent,"onFileIsCreated",this.catchFile.bind(this));s.EventEmitter.subscribe(this.agent,"onPackageIsInitialized",(function(e){var t=babelHelpers.slicedToArray(e.compatData,1),i=t[0];var n={width:o.previewSize.width,height:o.previewSize.height,exact:"N"};if(i.data){i.data["previewParams"]=n}else{i.post.data["previewParams"]=n}}))}babelHelpers.createClass(e,[{key:"catchFile",value:function t(i){var n=this;var a=babelHelpers.slicedToArray(i.compatData,2),r=a[0],o=a[1];this.incrementItemsCount();var l=new c(r,o);s.EventEmitter.subscribe(l,"onUploadDone",(function(t){var i=babelHelpers.slicedToArray(t.data,2),a=i[0],r=i[1];if(!l[h(n.constructor,e,g)]){n.decrementItemsCount();s.EventEmitter.emit(n,"onUploadDone",{itemData:n.convertToItemSavedType(a),itemContainer:l.getContainer(),blob:r})}}));s.EventEmitter.subscribe(l,"onUploadError",(function(t){var i=babelHelpers.slicedToArray(t.data,1),a=i[0];n.decrementItemsCount();l[h(n.constructor,e,g)]=true;s.EventEmitter.emit(n,"onUploadError",{itemContainer:l.getContainer(),blob:a})}));s.EventEmitter.subscribe(l,"onDelete",(function(){n.decrementItemsCount();l[h(n.constructor,e,g)]=true;n.container.removeChild(l.getContainer())}));this.container.appendChild(l.getContainer())}},{key:"addTestThumb",value:function e(t){var i=this;var n=new c(Math.ceil(Math.random()*1e3),{name:"test.file.js",size:"348 Kb",deleteFile:function e(){}});this.container.appendChild(n.getContainer());if(t>0){n.onUploadProgress({compatData:[null,t]})}s.EventEmitter.subscribe(n,"onDelete",(function(){i.container.removeChild(n.getContainer())}))}},{key:"addTestErrorThumb",value:function e(){var t=this;var i=new c(Math.ceil(Math.random()*1e3),{name:"test.file.js",size:"348 Kb",deleteFile:function e(){}});this.container.appendChild(i.getContainer());i.onUploadError({compatData:[{file:null}]});s.EventEmitter.subscribe(i,"onDelete",(function(){t.container.removeChild(i.getContainer())}))}},{key:"upload",value:function e(t){var i=babelHelpers.toArray(t),n=i.slice(0);this.agent.onAttach(n)}},{key:"convertToItemSavedType",value:function e(t){return{ID:t.attachId,IS_LOCKED:false,IS_MARK_DELETED:false,EDITABLE:false,FROM_EXTERNAL_SYSTEM:false,CAN_RESTORE:false,CAN_UPDATE:t.canChangeName,CAN_RENAME:t.canChangeName,CAN_MOVE:t.canChangeName,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:null,PREVIEW_URL:t.previewUrl?t.previewUrl:"",BIG_PREVIEW_URL:t.previewUrl?t.previewUrl.replace(/\&(width|height)=\d+/gi,""):null,EXTENSION:t.ext,NAME:t.name,SIZE:t.size,SIZE_BYTES:t.sizeInt,STORAGE:t.storage,TYPE_FILE:t.fileType}}},{key:"incrementItemsCount",value:function e(){var t;if(babelHelpers.classPrivateFieldGet(this,m)<=0){s.EventEmitter.emit(this,"onUploadIsStart")}babelHelpers.classPrivateFieldSet(this,m,(t=+babelHelpers.classPrivateFieldGet(this,m))+1),t}},{key:"decrementItemsCount",value:function e(){var t;if(babelHelpers.classPrivateFieldGet(this,m)===1){s.EventEmitter.emit(this,"onUploadIsDone")}babelHelpers.classPrivateFieldSet(this,m,Math.max((babelHelpers.classPrivateFieldSet(this,m,(t=+babelHelpers.classPrivateFieldGet(this,m))-1),t),0))}}]);return e}();var g={writable:true,value:Symbol("deleted")};var E=function(){function e(t){var i=t.container,n=t.eventObject;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"hasContainer",false);babelHelpers.defineProperty(this,"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(this,"properties",{pluggedIn:false});this.container=i;this.eventObject=n;this.properties.pluggedIn=this.eventObject&&this.eventObject.dataset.bxHtmlEditable==="Y";if(!this.container){return}this.hasContainer=true}babelHelpers.createClass(e,[{key:"isRelevant",value:function e(){return this.hasContainer}},{key:"getEventObject",value:function e(){return this.eventObject}},{key:"getContainer",value:function e(){return this.container}},{key:"isPluggedIn",value:function e(){return this.properties.pluggedIn}},{key:"show",value:function e(){this.container.style.display="";delete this.container.style.display}},{key:"hide",value:function e(){this.container.style.display="none"}}]);return e}();var D;var I=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"hiddenFilesCount",0);babelHelpers.defineProperty(this,"stepNumber",0);babelHelpers.defineProperty(this,"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(this,"stepValue",5)}babelHelpers.createClass(e,[{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",(function(){return r.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-file-thumb disk-file-thumb-file" onclick="','">\n\t\t\t<div class="ui-icon ui-icon-more disk-file-thumb-icon">\n\t\t\t\t<i></i>\n\t\t\t</div>\n\t\t\t<div class="disk-file-thumb-text">',"</div>\n\t\t</div>"])),t.onClick.bind(t),t.getValueContainer())}))}},{key:"getValueContainer",value:function e(){return this.cache.remember("valueContainer",(function(){return document.createElement("DIV")}))}},{key:"reset",value:function e(){this.hiddenFilesCount=1;this.stepNumber=0;this.getValueContainer().innerHTML=this.hiddenFilesCount;this.show();return this}},{key:"increment",value:function e(){this.hiddenFilesCount++;this.getValueContainer().innerHTML=this.hiddenFilesCount;this.show()}},{key:"decrement",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;this.hiddenFilesCount-=t;this.getValueContainer().innerHTML=this.hiddenFilesCount;if(this.hiddenFilesCount<=0){this.hide()}}},{key:"onClick",value:function e(){this.stepNumber++;var t=Math.min(30,this.stepValue*this.stepNumber);this.decrement(t);s.EventEmitter.emit(this,"onGetMore",{itemsCount:t})}},{key:"show",value:function e(){delete this.getContainer().style.display}},{key:"hide",value:function e(){this.getContainer().style.display="none"}}]);return e}();var k=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getSelectedFile",value:function e(t,i,n){var a=this;return new Promise((function(e){r.ajax.get(r.Uri.addParam(a.urlSelect,{ACTION:"none",MULTI:"Y",ID:["E",t].join(""),NAME:i,wish:"fakemove",dialogName:n}),e)}))}},{key:"loadFolder",value:function e(t,i,n){var a=t;var s=r.Uri.addParam([BX.DiskFileDialog.obCurrentTab[n].link.replace("/index.php","").replace("/files/lib/","/files/"),"element/upload",a].join("/"),{use_light_view:"Y",AJAX_CALL:"Y",SIMPLE_UPLOAD:"Y",IFRAME:"Y",sessid:BX.bitrix_sessid(),SECTION_ID:a,CHECK_NAME:i});return new Promise((function(e){r.ajax.loadJSON(s,{},e)}))}},{key:"getSelectedData",value:function e(t){var i=this;return new Promise((function(e){r.ajax.get(r.Uri.addParam(i.urlSelect,{dialogName:t}),e)}))}},{key:"getSelectedCloudData",value:function e(t,i){var n=this;return new Promise((function(e){r.ajax.get(r.Uri.addParam(n.urlSelect,{cloudImport:1,service:i,dialogName:t}),e)}))}},{key:"moveFile",value:function e(t,i){return new Promise((function(e){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","moveUploadedFile"),data:{attachedId:t,targetFolderId:i},onsuccess:e})}))}},{key:"getMetaDataForCreatedFileInUf",value:function e(t){return r.ajax.runAction("disk.api.file.getMetaDataForCreatedFileInUf",{data:{id:t}})}},{key:"renameAction",value:function e(t,i){return new Promise((function(e){r.ajax.post("/bitrix/tools/disk/uf.php?action=renameFile",{newName:i,attachedId:t,sessid:r.Loc.getMessage("bitrix_sessid")},e)}))}},{key:"deleteAction",value:function e(t){return new Promise((function(e){r.ajax.post("/bitrix/tools/disk/uf.php?action=deleteFile",{attachedId:t,sessid:r.Loc.getMessage("bitrix_sessid")},e)}))}}]);return e}();babelHelpers.defineProperty(k,"urlSelect","/bitrix/tools/disk/uf.php?action=selectFile&SITE_ID="+r.Loc.getMessage("SITE_ID")+"&dialog2=Y&ACTION=SELECT&MULTI=Y");var C,y,T,S,_,w,F;function A(e,t){U(e,t);t.add(e)}function L(e,t,i){U(e,t);t.set(e,i)}function U(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function N(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var H=new WeakMap;var x=new WeakSet;var O=new WeakSet;var P=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));A(babelHelpers.assertThisInitialized(i),O);A(babelHelpers.assertThisInitialized(i),x);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"cache",new r.Cache.MemoryCache);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"properties",{pluggedIn:false,insertedInText:false});L(babelHelpers.assertThisInitialized(i),H,{writable:true,value:void 0});i.setEventNamespace("Disk:UF:");i.id=String(e["ID"]);i.setData(e);i.subscribe("onMoved",i.onMoved.bind(babelHelpers.assertThisInitialized(i)));return i}babelHelpers.createClass(t,[{key:"getId",value:function e(){return this.id}},{key:"getFileId",value:function e(){return this.data.FILE_ID}},{key:"getData",value:function e(t){if(t){return this.data[t]}return this.data}},{key:"getAllIds",value:function e(){return[this.getId(),["n",this.data.FILE_ID].join("")]}},{key:"setData",value:function e(t){this.data=t}},{key:"setPluggedIn",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.properties.pluggedIn=t===true}},{key:"isPluggedIn",value:function e(){return this.properties.pluggedIn}},{key:"setInsertedInText",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.properties.insertedInText=t===true;r.Dom.addClass(this.getContainer(),"--edit-text-preview")}},{key:"isInsertedInText",value:function e(){return this.properties.insertedInText}},{key:"getNameWithoutExtension",value:function e(){var t=this.data["NAME"].split(".");if(t.length>1){t.pop()}var i=t.join(".");if(i.length>50){return i.substr(0,39)+"..."+i.substr(-5)}return i}},{key:"getButtonBox",value:function e(){var t="";if(this.isPluggedIn()){t=r.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div\n\t\t\t\t\tclass="disk-file-thumb-btn-text-copy"\n\t\t\t\t\tonclick="','"\n\t\t\t\t\tonmouseenter="','"\n\t\t\t\t\tonmouseleave="','"\n\t\t\t\t>\n\t\t\t\t</div>'])),this.onClickInsertInText.bind(this),N(this,x,M).bind(this),N(this,O,R).bind(this))}return r.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="disk-file-thumb-btn-box">\n\t\t\t\t','\n\t\t\t\t<div class="disk-file-thumb-btn-more" data-bx-role="more" onclick="','"></div>\n\t\t\t</div>\n\t\t'])),t,this.onClickMore.bind(this))}},{key:"getDeleteButton",value:function e(){return r.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="disk-file-thumb-btn-close-box">\n\t\t\t\t<div class="disk-file-thumb-btn-close" onclick="','"></div>\n\t\t\t</div>\n\t\t'])),this.onClickDelete.bind(this))}},{key:"getNameBox",value:function e(t,i){var n="";if(i){n=r.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['<span class="disk-file-thumb-file-extension">.',"</span>"])),i)}return r.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="disk-file-thumb-text-box">\n\t\t\t\t<div data-bx-role="name" class="disk-file-thumb-text">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),t,n)}},{key:"getIcon",value:function e(t){return r.Tag.render(w||(w=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div data-bx-role="icon" class="ui-icon ui-icon-file-',' disk-file-thumb-icon"><i></i></div>\n\t\t'])),t)}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",(function(){var e=r.Text.encode(t.getNameWithoutExtension());var i=r.Text.encode(t.data["EXTENSION"]).toLowerCase();switch(i){case"pptx":i="ppt";break}return r.Tag.render(F||(F=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-file-thumb disk-file-thumb-file disk-file-thumb--','">\n\t\t\t',"\n\t\t\t","\n\t\t\t","\n\t\t\t","\n\t\t</div>"])),i,t.getIcon(i),t.getNameBox(e,i),t.getDeleteButton(),t.getButtonBox())}))}},{key:"rename",value:function e(t){this.data["NAME"]=t;if(this.hasContainer()){this.getContainer().querySelector('[data-bx-role="name"]').innerHTML=r.Text.encode(this.data["NAME"])}}},{key:"destroy",value:function e(){var t=this;var i=this.cache.keys();i.forEach((function(e){var i=t.cache.get(e);if(r.Type.isDomNode(i)&&i.parentNode){i.parentNode.removeChild(i)}t.cache["delete"](e)}));this.emit("onDestroy")}},{key:"hasContainer",value:function e(){return this.cache.has("container")}},{key:"getMenu",value:function e(){var t=this;var n=this.getData("NAME").split(".").pop();n=n===this.getData("NAME")?"":[".",n].join("");var a=String(this.getData("NAME"));var s=a.substring(0,a.length-n.length);return this.cache.remember("menu",(function(){var e=t.getContainer().querySelector("div[data-bx-role='more']");var a=new i.Menu({id:"crm-tunnels-menu-".concat(r.Text.getRandom().toLowerCase()),bindElement:e,items:[t.isPluggedIn()?{dataset:{bxRole:"insertIntoTheText"},text:r.Loc.getMessage("WDUF_ITEM_MENU_INSERT_INTO_THE_TEXT"),onclick:function e(i,n){a.close();t.onClickInsertInText(i)}}:null,{dataset:{bxRole:"deleteFile"},text:r.Loc.getMessage("WDUF_ITEM_MENU_DELETE"),onclick:function e(i){a.close();t.onClickDelete(i)}},t.data["CAN_RENAME"]===true?{dataset:{bxRole:"renameFile"},text:r.Loc.getMessage("WDUF_ITEM_MENU_RENAME"),items:[{html:['<textarea class="disk-file-popup-rename-file-textarea"\n\t\t\t\t\t\t\t\t\t\t\tname="rename" onkeydown="if(event.keyCode===13){ BX.fireEvent(event.target.parentNode.querySelector(\'input[name=save]\'), \'click\'); }"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder="'.concat(r.Text.encode(s),'">').concat(r.Text.encode(s),"</textarea>"),'<div class="ui-btn-container ui-btn-container-center">\n\t\t\t\t\t\t\t\t\t\t\t<input type="button" class="ui-btn ui-btn-sm ui-btn-primary" name="save" value="'.concat(r.Loc.getMessage("WDUF_ITEM_MENU_RENAME_SAVE"),'">\n\t\t\t\t\t\t\t\t\t\t\t<input type="button" class="ui-btn ui-btn-sm ui-btn-link" value="').concat(r.Loc.getMessage("WDUF_ITEM_MENU_RENAME_CANCEL"),'">\n\t\t\t\t\t\t\t\t\t\t</div>')].join(""),className:"menu-popup-item-rename-form",onclick:function e(i,s){if(r.Type.isDomNode(i.target)&&i.target.type==="button"){if(i.target.name==="save"){t.onRenamed([s.getContainer().querySelector("textarea").value,n].join(""));t.clearMenu()}a.close()}}}]}:null,{delimiter:true,text:[r.Loc.getMessage("WDUF_ITEM_MENU_FILE"),r.Text.encode(t.data["SIZE"])].join(" ")},t.data["CAN_MOVE"]===true?{dataset:{bxRole:"moveFile"},text:r.Text.encode(t.data["STORAGE"]),className:"menu-popup-item-storage",onclick:function e(i,n){var r;i["counter"]=((r=i["counter"])!==null&&r!==void 0?r:1)+1;a.close();t.onClickMoveTo(i,n)}}:{text:r.Text.encode(t.data["STORAGE"]),className:"menu-popup-item-storage"}].filter((function(e){return e!==null})),angle:true,offsetLeft:9});return a}))}},{key:"clearMenu",value:function e(){if(this.cache.has("menu")){this.cache.get("menu").destroy();this.cache["delete"]("menu")}}},{key:"onClick",value:function e(t){this.emit("onClick")}},{key:"onClickDelete",value:function e(t){t.preventDefault();t.stopPropagation();this.emit("onDelete");this.destroy();k.deleteAction(this.getId())}},{key:"onClickInsertInText",value:function e(t){this.emit("onClickInsertInText")}},{key:"onClickMore",value:function e(t){t.preventDefault();t.stopPropagation();this.getMenu().show()}},{key:"onClickEdit",value:function e(){}},{key:"onClickMoveTo",value:function e(t,i,n){var a=s.EventEmitter.emit(BX.DiskFileDialog,"onFileNeedsToMove",[this]);return a.length>0}},{key:"onMoved",value:function e(t){var i=t.data;this.data["STORAGE"]=i;this.clearMenu()}},{key:"onRenamed",value:function e(t){if(this.getData("NAME")===t){return}this.rename(t);k.renameAction(this.getId(),t)}},{key:"getHTMLForHTMLEditor",value:function e(t){if(this.getData("TYPE_FILE")==="player"){return'<img contenteditable="false" class="bxhtmled-player-surrogate" data-bx-file-id="'.concat(r.Text.encode(this.data.ID),'" id="').concat(t,'" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" />')}return'<span contenteditable="false" data-bx-file-id="'.concat(r.Text.encode(this.data.ID),'" id="').concat(t,'" style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;">').concat(r.Text.encode(this.data.NAME),"</span>")}}],[{key:"detect",value:function e(){return true}}]);return t}(s.EventEmitter);function M(e){var t=this;if(babelHelpers.classPrivateFieldGet(this,H)){return}var i=e.currentTarget;var n=i.offsetWidth;babelHelpers.classPrivateFieldSet(this,H,new BX.PopupWindow({content:r.Loc.getMessage("WDUF_ITEM_MENU_INSERT_INTO_THE_TEXT"),cacheable:false,animation:"fading-slide",bindElement:i,offsetTop:0,bindOptions:{position:"top"},darkMode:true,events:{onClose:function e(){babelHelpers.classPrivateFieldGet(t,H).destroy();babelHelpers.classPrivateFieldSet(t,H,null)},onShow:function e(t){var i=t.getTarget();i.getPopupContainer().style.display="block";var a=n/2-i.getPopupContainer().offsetWidth/2;i.setOffset({offsetLeft:a+40});i.setAngle({offset:i.getPopupContainer().offsetWidth/2-17})}}}));babelHelpers.classPrivateFieldGet(this,H).show()}function R(e){if(!babelHelpers.classPrivateFieldGet(this,H)){return}babelHelpers.classPrivateFieldGet(this,H).close();babelHelpers.classPrivateFieldSet(this,H,null)}var B;var j=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++){a[s]=arguments[s]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"cache",new r.Cache.MemoryCache);return i}babelHelpers.createClass(t,[{key:"setData",value:function e(t){this.data=t;this.data.BIG_REVIEW_URL=this.data.PREVIEW_URL.replace(/\&(width|height)\=\d+/gi,"")}},{key:"getContainer",value:function e(){var t=this;return this.cache.remember("container",(function(){var e=r.Text.encode(t.getNameWithoutExtension());var i=r.Text.encode(t.data["EXTENSION"]).toLowerCase();return r.Tag.render(B||(B=babelHelpers.taggedTemplateLiteral(['\n\t\t<div class="disk-file-thumb disk-file-thumb-preview">\n\t\t\t<div style="background-image: url(\'','\'); background-size: cover;" class="disk-file-thumb-image"></div>\n\t\t\t',"\n\t\t\t","\n\t\t\t","\n\t\t\t","\n\t\t</div>"])),encodeURI(t.data["PREVIEW_URL"]),t.getIcon(i),t.getNameBox(e,i),t.getDeleteButton(),t.getButtonBox())}))}},{key:"getHTMLForHTMLEditor",value:function e(t){return'<img style="max-width: 90%;" data-bx-file-id="'.concat(r.Text.encode(this.data.ID),'" id="').concat(t,'" src="').concat(this.data.BIG_REVIEW_URL,'" />')}}],[{key:"detect",value:function e(t){return!!t["PREVIEW_URL"]}}]);return t}(P);function X(e,t){W(e,t);t.add(e)}function W(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function V(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var G=0;var z=new WeakSet;var Y=function(){function e(t){babelHelpers.classCallCheck(this,e);X(this,z);babelHelpers.defineProperty(this,"tag","[DISK FILE ID=#id#]");babelHelpers.defineProperty(this,"regexp",/\[(?:DOCUMENT ID|DISK FILE ID)=([n0-9]+)\]/gi);this.id=["diskfile"+G++].join("_");this.items=t.items}babelHelpers.createClass(e,[{key:"getInterface",value:function e(){var t=this;return{id:this.id,init:function e(i){t.htmlEditor=i},parse:this.parse.bind(this),unparse:this.unparse.bind(this)}}},{key:"hasInterface",value:function e(){return this.regexp!==null&&this.tag!==null}},{key:"setParams",value:function e(t){var i=t.tag,n=t.regexp;if(r.Type.isStringFilled(i)&&i!=="null"){this.tag=i}else{this.tag=null}if(r.Type.isStringFilled(n)&&n!=="null"){this.regexp=new RegExp(n)}else if(n instanceof RegExp){this.regexp=n}else{this.regexp=null}}},{key:"insertFile",value:function e(t){var i=this.items.get(String(t));if(i){var n=i instanceof j?"\n":" ";var a=i instanceof j?"<br>":"&nbsp;";s.EventEmitter.emit(this.htmlEditor,"OnInsertContent",[n+this.getItemBBCode(t)+n,a+this.getItemHTML(t)+a])}}},{key:"getItemBBCode",value:function e(t){var i=this.items.get(String(t));if(i&&i.isPluggedIn()){i.setInsertedInText()}return this.tag.replace("#id#",t)}},{key:"getItemHTML",value:function e(t){var i=this.items.get(String(t));if(i){return V(this,z,K).call(this,i,t)}return null}},{key:"deleteFile",value:function e(t){if(!this.items.has(t)){return}var i=this.items.get(t).getAllIds();if(this.htmlEditor.GetViewMode()==="wysiwyg"){var n=this.htmlEditor.GetIframeDoc();for(var a in this.htmlEditor.bxTags){if(this.htmlEditor.bxTags.hasOwnProperty(a)&&babelHelpers["typeof"](this.htmlEditor.bxTags[a])==="object"&&this.htmlEditor.bxTags[a]["tag"]===this.id&&i.indexOf(String(this.htmlEditor.bxTags[a]["itemId"]))>=0&&n.getElementById(a)){var r=n.getElementById(a);r.parentNode.removeChild(r)}}this.htmlEditor.SaveContent()}else{var s=this.htmlEditor.GetContent().replace(this.regexp,(function(e,t){return i.indexOf(t)>=0?"":e}));this.htmlEditor.SetContent(s);this.htmlEditor.Focus()}}},{key:"parse",value:function e(t){if(!this.regexp.test(t)){return t}t=t.replace(this.regexp,function(e,t){var i=this.items.has(t)?this.items.get(t):babelHelpers.toConsumableArray(this.items.values()).find((function(e){return e.getAllIds().indexOf(t)>=0}));if(i){return V(this,z,K).call(this,i,t)}return e}.bind(this));return t}},{key:"unparse",value:function e(t,i){var n=i.node;var a=t.itemId;if(this.items.has(a)){return this.getItemBBCode(a)}return""}}]);return e}();function K(e,t){if(e.isPluggedIn()){e.setInsertedInText()}return e.getHTMLForHTMLEditor(this.htmlEditor.SetBxTag(false,{tag:this.id,fileId:t,itemId:e.getId()}))}var q=[P,j];function Z(e){var t=P;q.forEach((function(i){if(i.detect(e)){t=i}}));return new t(e)}var J=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.id,a=e.container,r=e.fieldName,s=e.multiple,o=e.eventObject;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:a.querySelector('[data-bx-role="placeholder"]'),eventObject:o}));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"maxVisibleCount",10);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"prefixHTMLNode","disk-attach-");i.items=new Map;i.multiple=s!==false;i.fieldName=r;if(!a.querySelector('[data-bx-role="placeholder"]')){return babelHelpers.possibleConstructorReturn(i)}if(i.isPluggedIn()){i.buildInHTMLEditor()}return i}babelHelpers.createClass(t,[{key:"buildInHTMLEditor",value:function e(){var t=this;if(this.getParser().hasInterface()){s.EventEmitter.emit(this.eventObject,"OnParserRegister",this.getParser().getInterface())}s.EventEmitter.subscribe(this.eventObject,"onReinitializeBefore",(function(e){var i=babelHelpers.slicedToArray(e.data,2),n=i[0],a=i[1];var s=true;if(a){Object.values(a).forEach((function(e){if(e&&e["USER_TYPE_ID"]==="disk_file"&&e["FIELD_NAME"].replace("[]","")===t.fieldName.replace("[]","")){try{var i=[];var n={};if(r.Type.isArray(e["VALUE"])){e["VALUE"].forEach((function(e){var a=document.querySelector(["#",t.prefixHTMLNode,e].join(""));var s=String(e);if(!a||n[s]){return}n[s]=true;var o=a.querySelector("img")||a.querySelector("div[data-bx-preview]");var l=o||a;var c=l.hasAttribute("data-title")?l.getAttribute("data-title"):l.hasAttribute("data-bx-title")?l.getAttribute("data-bx-title"):"";var u={ID:e,FILE_ID:l.getAttribute("bx-attach-file-id"),CAN_RESTORE:false,CAN_UPDATE:false,CAN_RENAME:false,CAN_MOVE:false,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:null,PREVIEW_URL:null,BIG_PREVIEW_URL:null,EXTENSION:c.split(".").pop(),NAME:c,SIZE:l.getAttribute("data-bx-size"),SIZE_BYTES:l.getAttribute("data-bx-size"),STORAGE:"disk",TYPE_FILE:l.getAttribute("bx-attach-file-type")};if(o){u["PREVIEW_URL"]=o.hasAttribute("data-bx-preview")&&r.Type.isStringFilled(o.getAttribute("data-bx-preview"))?o.getAttribute("data-bx-preview"):o.hasAttribute("data-thumb-src")&&r.Type.isStringFilled(o.getAttribute("data-thumb-src"))?o.getAttribute("data-thumb-src"):o.src;u["BIG_PREVIEW_URL"]=o.hasAttribute("data-bx-src")?o.getAttribute("data-bx-src"):o.getAttribute("data-src")}i.push(u)}))}t.set(i);s=false}catch(e){console.log("e: ",e)}}}))}if(s!==false){t.clear()}}))}},{key:"set",value:function e(t){var i=this;this.clear();var n=this.maxVisibleCount;return new Promise((function(e){t.forEach((function(e){var t=i.addItem(e);n--;if(n>0){i.appendNode(t)}else if(n===0){i.container.appendChild(i.getItemMore().reset().getContainer())}else{i.getItemMore().increment()}}));e()}))}},{key:"clear",value:function e(){this.items.forEach((function(e){e.destroy()}));this.container.innerHTML=""}},{key:"add",value:function e(t,i){this.multiple||this.clear();var n=this.addItem(t);this.appendNode(n,i);return n}},{key:"addItem",value:function e(t){var i=this;var n=Z(t);var a=this.getContainer().querySelector('[data-bx-role="reserve-item"][value="'.concat(r.Text.encode(n.getId()),'"]'));if(!a){a=document.createElement("INPUT");a.name=this.fieldName;a.type="hidden";a.value=n.getId();this.container.appendChild(a)}n.subscribe("onDelete",(function(){if(a&&a.parentNode){a.parentNode.removeChild(a)}s.EventEmitter.emit(i,"OnItemDelete",n)}));n.subscribe("onDestroy",(function(){i.items["delete"](n.getId())}));if(this.isPluggedIn()){s.EventEmitter.emit(this.eventObject,"onShowControllers:File:Increment");if(this.getParser().hasInterface()){n.setPluggedIn();n.subscribe("onClickInsertInText",(function(){i.getParser().insertFile(n.getId())}));n.subscribe("onDelete",(function(){i.getParser().deleteFile(n.getId())}));n.subscribe("onDestroy",(function(){s.EventEmitter.emit(i.eventObject,"onShowControllers:File:Decrement")}))}}this.items.set(n.getId(),n);return n}},{key:"getItem",value:function e(t){return this.items.get(t)}},{key:"appendNode",value:function e(t,i){if(i){if(i.parentNode){i.parentNode.replaceChild(t.getContainer(),i)}}else{this.container.appendChild(t.getContainer())}return t}},{key:"getItemMore",value:function e(){var t=this;return this.cache.remember("moreButton",(function(){var e=new I;s.EventEmitter.subscribe(e,"onGetMore",t.showMoreItems.bind(t));return e}))}},{key:"showMoreItems",value:function e(t){var i=t.data.itemsCount;var n=i;var a=this.getItemMore().getContainer();a.style.opacity="0";a.style.visibility="hidden";this.items.forEach((function(e){if(i>0){if(!e.hasContainer()){i--;var t=document.createElement("DIV");a.parentNode.insertBefore(t,a);setTimeout((function(){r.Dom.style(e.getContainer(),"opacity","0");r.Dom.addClass(e.getContainer(),"disk-file-thumb--animate");r.Dom.style(e.getContainer(),"opacity","");t.parentNode.replaceChild(e.getContainer(),t);e.getContainer().addEventListener("transitionend",(function(){r.Dom.removeClass(e.getContainer(),"disk-file-thumb--animate")}))}),(n-i)*100)}}}));if(i<=0){setTimeout((function(){a.style.opacity="";a.style.visibility=""}),n*100+100)}}},{key:"getParser",value:function e(){this.parser=this.parser||new Y(this);return this.parser}}]);return t}(E);var $=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.container,a=e.eventObject;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:n.querySelector('[data-bx-role="setting"]'),eventObject:a}));if(i.getContainer()){i.getContainer().addEventListener("click",i.show.bind(babelHelpers.assertThisInitialized(i)));i.allowEditNode=n.querySelector('input[data-bx-role="settings-allow-edit"]');i.allowGridNode=n.querySelector('input[data-bx-role="settings-allow-grid"]')}return i}babelHelpers.createClass(t,[{key:"show",value:function e(){var t=this;if(!this.popup){this.popup=new i.Menu({bindElement:this.getContainer(),className:"disk-uf-file-popup-settings",items:[this.allowEditNode?{dataset:{bxRole:"allowEdit"},className:this.allowEditNode.checked?"menu-popup-item-take":"",text:r.Loc.getMessage("WDUF_ALLOW_EDIT"),onclick:function(e,t){this.allowEditNode.checked=!this.allowEditNode.checked;if(this.allowEditNode.checked){t.getContainer().classList.add("menu-popup-item-take");t.getContainer().classList.remove("menu-popup-no-icon")}else{t.getContainer().classList.remove("menu-popup-item-take");t.getContainer().classList.add("menu-popup-no-icon")}}.bind(this)}:null,{dataset:{bxRole:"allowGrid"},className:this.allowGridNode.checked?"menu-popup-item-take":"",text:r.Loc.getMessage("WDUF_ALLOW_COLLAGE"),onclick:function(e,t){this.allowGridNode.checked=!this.allowGridNode.checked;if(this.allowGridNode.dataset.bxSave==="Y"){BX.userOptions.save("disk","disk.uf.file",this.allowGridNode.dataset.bxName,this.allowGridNode.checked?"grid":".default")}if(this.allowGridNode.checked){t.getContainer().classList.add("menu-popup-item-take");t.getContainer().classList.remove("menu-popup-no-icon")}else{t.getContainer().classList.remove("menu-popup-item-take");t.getContainer().classList.add("menu-popup-no-icon")}}.bind(this)},{text:this.buildDocumentServiceTextLabel(),items:this.buildSubMenuWithDocumentServices()}],angle:true,offsetTop:-16,offsetLeft:16,events:{onClose:function e(){delete t.popup}}})}this.popup.show()}},{key:"buildDocumentServiceTextLabel",value:function e(){var t=BX.Disk.getDocumentService();if(!t&&BX.Disk.isAvailableOnlyOffice()){t="onlyoffice"}else if(!t){t="l"}var i=o.getDocumentHandler(t).name;return r.Loc.getMessage("DISK_UF_FILE_EDIT_SERVICE_LABEL",{"#NAME#":i})}},{key:"buildSubMenuWithDocumentServices",value:function e(){var t=this;var i=[];o.getDocumentHandlers().forEach((function(e){i.push({text:e.name,dataset:{code:e.code},onclick:function e(i,n){BX.Disk.saveDocumentService(n.dataset.code);n.getMenuWindow().getParentMenuItem().setText(t.buildDocumentServiceTextLabel());n.getMenuWindow().getPopupWindow().close()}})}));return i}},{key:"hide",value:function e(){if(this.popup){this.popup.close()}}}]);return t}(E);var Q=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.container,a=e.eventObject;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:n.querySelector('[data-bx-role="document-area"]'),eventObject:a}));if(i.getContainer()){Array.from(i.getContainer().querySelectorAll("[data-bx-handler]")).forEach((function(e){e.addEventListener("click",(function(){i.createDocument(e.getAttribute("data-bx-handler"))}))}))}return i}babelHelpers.createClass(t,[{key:"createDocument",value:function e(t){if(!BX.Disk.getDocumentService()&&BX.Disk.isAvailableOnlyOffice()){BX.Disk.saveDocumentService("onlyoffice")}else if(!BX.Disk.getDocumentService()){BX.Disk.saveDocumentService("l")}var i=function(e){var t=this;var i=e.object.name.split(".");i.pop();setTimeout((function(){s.EventEmitter.emit(t,"onFileIsCreated",{itemData:t.convertToItemSavedType(e)})}),200)}.bind(this);if(BX.Disk.Document.Local.Instance.isSetWorkWithLocalBDisk()){BX.Disk.Document.Local.Instance.createFile({type:t}).then(function(e){i(e)}.bind(this));return}var n=new BX.Disk.Document.CreateProcess({typeFile:t,serviceCode:BX.Disk.getDocumentService(),onAfterSave:function e(t,n){if(t.status!=="success"){return}if(!n){k.getMetaDataForCreatedFileInUf(t.object.id).then((function(e){var t=e.data;i(t)}))}else{i(n)}}});n.start()}},{key:"convertToItemSavedType",value:function e(t){return{ID:"n"+t.object.id,IS_LOCKED:false,IS_MARK_DELETED:false,EDITABLE:false,FROM_EXTERNAL_SYSTEM:false,CAN_RESTORE:false,CAN_UPDATE:true,CAN_RENAME:true,CAN_MOVE:true,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:t.link,PREVIEW_URL:null,BIG_PREVIEW_URL:null,EXTENSION:t.object.extension,NAME:t.object.name,SIZE:t.object.size,SIZE_BYTES:t.object.sizeInt,STORAGE:t.folderName}}}]);return t}(E);var ee=function(e){babelHelpers.inherits(t,e);function t(e){var i=e.container,n=e.eventObject;babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:i.querySelector('[data-bx-role="control-panel"]'),eventObject:n}))}return t}(E);var te=0;var ie=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.container,a=e.eventObject;babelHelpers.classCallCheck(this,t);var r=n.querySelector('[data-bx-role="file-local-controller"]')||n.querySelector(".diskuf-selector-link");i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:r,eventObject:a}));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"opened",false);i.dialogName=["selectFile",te++].join("-");if(!i.getContainer()){return babelHelpers.possibleConstructorReturn(i)}i.getContainer().addEventListener("click",i.onClick.bind(babelHelpers.assertThisInitialized(i)));i.openSection=i.openSection.bind(babelHelpers.assertThisInitialized(i));i.selectFile=i.selectFile.bind(babelHelpers.assertThisInitialized(i));s.EventEmitter.subscribe(BX.DiskFileDialog,"loadItems",i.openSection);return i}babelHelpers.createClass(t,[{key:"onClick",value:function e(){var t=this;k.getSelectedData(this.dialogName).then((function(){setTimeout((function(){BX.DiskFileDialog.obCallback[t.dialogName]={saveButton:t.selectFile};BX.DiskFileDialog.openDialog(t.dialogName)}),10)}))}},{key:"openSection",value:function e(t){var i=babelHelpers.slicedToArray(t.data,2),n=i[0],a=i[1];if(a===this.dialogName){BX.DiskFileDialog.target[a]=r.Uri.addParam(n,{dialog2:"Y"})}}},{key:"selectFile",value:function e(t,i,n){s.EventEmitter.unsubscribe(BX.DiskFileDialog,"loadItems",this.openSection);for(var a in n){if(n.hasOwnProperty(a)){s.EventEmitter.emit(this,"onUploadDone",{itemData:this.convertToItemSavedType(n[a])})}}}},{key:"convertToItemSavedType",value:function e(t){var i;return{ID:t.id,IS_LOCKED:false,IS_MARK_DELETED:false,EDITABLE:false,FROM_EXTERNAL_SYSTEM:false,CAN_RESTORE:false,CAN_RENAME:false,CAN_UPDATE:false,CAN_MOVE:false,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:null,PREVIEW_URL:t.previewUrl?t.previewUrl:"",BIG_PREVIEW_URL:t.previewUrl?t.previewUrl.replace(/\&(width|height)=\d+/gi,""):null,EXTENSION:t.ext,NAME:t.name,SIZE:t.size,SIZE_BYTES:t.sizeInt,STORAGE:(i=t["storage"])!==null&&i!==void 0?i:r.Loc.getMessage("WDUF_MY_DISK")}}}]);return t}(E);var ne=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e,i));BX.Disk.ExternalLoader.startLoad({file:{id:n.id,name:n.object.name,service:n.object.service},onFinish:function e(t){s.EventEmitter.emit(babelHelpers.assertThisInitialized(n),"onUploadDone",[t])},onProgress:function e(t){n.onUploadProgress({compatData:[{},t]})}});return n}babelHelpers.createClass(t,[{key:"onClickDelete",value:function e(t){t.preventDefault();t.stopPropagation();s.EventEmitter.emit(this,"onDelete",[this]);delete this.container}},{key:"onUploadDone",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,2),n=i[0],a=i[1].file}},{key:"onUploadError",value:function e(t){var i=babelHelpers.slicedToArray(t.compatData,1),n=i[0];s.EventEmitter.emit(this,"onUploadError",[n.file]);this.progress.getContainer().parentNode.removeChild(this.progress.getContainer());this.container.classList.add("disk-file-upload-error")}}]);return t}(c);var ae=0;var re=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.container,a=e.eventObject;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:n.querySelector('[data-bx-role="placeholder"]'),eventObject:a}));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"services",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"items",new Map);if(!i.getContainer()){return babelHelpers.possibleConstructorReturn(i)}Array.from(n.querySelectorAll('[data-bx-role="file-external-controller"]')).forEach((function(e){i.services.push(e)}));Array.from(n.querySelectorAll(".diskuf-selector-link-cloud")).forEach((function(e){i.services.push(e)}));i.eventObject=a;i.dialogName=["selectFileCloud",ae++].join("-");i.services.forEach((function(e){e.addEventListener("click",i.onClick.bind(babelHelpers.assertThisInitialized(i)))}));i.openSection=i.openSection.bind(babelHelpers.assertThisInitialized(i));i.selectFile=i.selectFile.bind(babelHelpers.assertThisInitialized(i));return i}babelHelpers.createClass(t,[{key:"onClick",value:function e(t){var i=this;s.EventEmitter.subscribe(BX.DiskFileDialog,"loadItems",this.openSection);this.currentService=t.currentTarget.getAttribute("data-bx-doc-handler");k.getSelectedCloudData(this.dialogName,this.currentService).then((function(){setTimeout((function(){BX.DiskFileDialog.obCallback[i.dialogName]={saveButton:i.selectFile};BX.DiskFileDialog.openDialog(i.dialogName)}),10)}))}},{key:"openSection",value:function e(t){var i=babelHelpers.slicedToArray(t.data,2),n=i[0],a=i[1];if(a===this.dialogName){BX.DiskFileDialog.target[a]=r.Uri.addParam(n,{dialog2:"Y"})}}},{key:"selectFile",value:function e(t,i,n){s.EventEmitter.unsubscribe(BX.DiskFileDialog,"loadItems",this.openSection);for(var a in n){if(n.hasOwnProperty(a)&&n[a].type==="file"){this.catchFile(n[a],this.currentService)}}this.currentService=null}},{key:"catchFile",value:function e(t,i){var n=this;if(this.items.has(t.id)){return}t["service"]=t["provider"]||i;var a=new ne(t.id,t);this.items.set(a.id,a);s.EventEmitter.subscribe(a,"onUploadDone",(function(e){var t=babelHelpers.slicedToArray(e.data,1),i=t[0];if(n.items.has(a.id)){n.items["delete"](a.id);s.EventEmitter.emit(n,"onUploadDone",{itemData:n.convertToItemSavedType(i),itemContainer:a.getContainer()})}}));s.EventEmitter.subscribe(a,"onUploadError",(function(){n.items["delete"](a.id);s.EventEmitter.emit(n,"onUploadError",{itemContainer:a.getContainer()})}));s.EventEmitter.subscribe(a,"onDelete",(function(){n.items["delete"](a.id);n.container.removeChild(a.getContainer())}));this.container.appendChild(a.getContainer())}},{key:"convertToItemSavedType",value:function e(t){var i=t.name.split(".").pop().toLowerCase();var n={ID:t.ufId,IS_LOCKED:false,IS_MARK_DELETED:false,EDITABLE:false,FROM_EXTERNAL_SYSTEM:true,CAN_RESTORE:false,CAN_RENAME:false,CAN_UPDATE:false,CAN_MOVE:false,COPY_TO_ME_URL:null,DELETE_URL:null,DOWNLOAD_URL:null,EDIT_URL:null,VIEW_URL:null,PREVIEW_URL:t.previewUrl?t.previewUrl:"",BIG_PREVIEW_URL:t.previewUrl?t.previewUrl.replace(/\&(width|height)=\d+/gi,""):null,EXTENSION:i===t.name?"":i,NAME:t.name,SIZE:t.sizeFormatted,SIZE_BYTES:t.size,STORAGE:t.storage};return n}}]);return t}(E);var se=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"dialogName","moveFile");this.openSection=this.openSection.bind(this);this.loadFolder=this.loadFolder.bind(this);this.stopLoadingFolder=this.stopLoadingFolder.bind(this);this.checkFileName=this.checkFileName.bind(this);this.onApply=this.onApply.bind(this);this.onCancel=this.onCancel.bind(this)}babelHelpers.createClass(e,[{key:"fire",value:function e(t){var i=this;if(this.item!==null&&this.item!==t){this.onCancel()}this.item=t;k.getSelectedFile(t.getFileId(),t.getData("NAME"),this.dialogName).then((function(){setTimeout((function(){BX.DiskFileDialog.obCallback[i.dialogName]={saveButton:i.onApply,cancelButton:i.onCancel};BX.DiskFileDialog.openDialog(i.dialogName)}),10)}));s.EventEmitter.subscribe(BX.DiskFileDialog,"loadItems",this.openSection);s.EventEmitter.subscribe(BX.DiskFileDialog,"selectItem",this.loadFolder);s.EventEmitter.subscribe(BX.DiskFileDialog,"unSelectItem",this.stopLoadingFolder)}},{key:"openSection",value:function e(t){var i=babelHelpers.slicedToArray(t.data,2),n=i[0],a=i[1];if(a===this.dialogName){BX.DiskFileDialog.target[a]=r.Uri.addParam(n,{dialog2:"Y"})}}},{key:"loadFolder",value:function e(t){var i=this;var n=babelHelpers.slicedToArray(t.data,3),a=n[0],s=n[1],o=n[2];if(o!==this.dialogName){return}k.loadFolder(s.substr(1),this.item.getData("NAME"),this.dialogName).then((function(e){var t=e.permission===true&&e["okmsg"]!=="";if(i.timeout>0){clearTimeout(i.timeout)}i.timeout=setTimeout((function(){if(t){BX.DiskFileDialog.showNotice(r.Loc.getMessage("WDUF_FILE_IS_EXISTS"),i.dialogName)}else{BX.DiskFileDialog.closeNotice(i.dialogName)}}),200)}))}},{key:"stopLoadingFolder",value:function e(t){var i=t.data;if(this.timeout>0){clearTimeout(this.timeout)}this.timeout=setTimeout(this.checkFileName,200)}},{key:"onApply",value:function e(t,i,n,a){var r=this;s.EventEmitter.unsubscribe(BX.DiskFileDialog,"loadItems",this.openSection);s.EventEmitter.unsubscribe(BX.DiskFileDialog,"selectItem",this.loadFolder);s.EventEmitter.unsubscribe(BX.DiskFileDialog,"unSelectItem",this.stopLoadingFolder);if(!this.item){return}var o=this.item.getId();var l=false;var c=function e(t,i,n,a){k.moveFile(t,i).then((function(e){if(!e||e.status!=="success"){BX.Disk.showModalWithStatusAction(e);return}r.showMovedFile(t,n,a)}))};var u,d;for(var h in n){if(n.hasOwnProperty(h)&&n[h].type==="folder"){u=t.name+n[h].path;d={sectionID:h,iblockID:t.iblock_id};c(o,n[h].id,d,u);l=true}}if(!l){u=t.name;d={sectionID:t.section_id,iblockID:t.iblock_id};if(!!a&&!!a.path&&a.path!=="/"){u+=a.path;d.sectionID=a.id;if(!!a){c(o,a.id,d,u)}}}}},{key:"checkFileName",value:function e(t){if(this.timeout>0){clearTimeout(this.timeout)}if(t!==this.dialogName||!this.item){return}var i=this.item.getData("NAME");var n=false;for(var a in BX.DiskFileDialog.obItems[this.dialogName]){if(BX.DiskFileDialog.obItems[this.dialogName].hasOwnProperty(a)&&BX.DiskFileDialog.obItems[this.dialogName][a]["name"]===i){n=true;break}}if(n){BX.DiskFileDialog.showNotice(r.Loc.getMessage("WDUF_FILE_IS_EXISTS"),this.dialogName)}else{BX.DiskFileDialog.closeNotice(this.dialogName)}}},{key:"showMovedFile",value:function e(t,i,n){if(this.item){this.item.emit("onMoved",n)}this.item=null}},{key:"onCancel",value:function e(){s.EventEmitter.unsubscribe(BX.DiskFileDialog,"loadItems",this.openSection);s.EventEmitter.unsubscribe(BX.DiskFileDialog,"selectItem",this.loadFolder);s.EventEmitter.unsubscribe(BX.DiskFileDialog,"unSelectItem",this.stopLoadingFolder);this.item=null;if(this.timeout>0){clearTimeout(this.timeout)}this.timeout=null}}],[{key:"subscribe",value:function t(){if(BX.DiskFileDialog.subscribed!==true){BX.DiskFileDialog.subscribed=true;s.EventEmitter.subscribe(BX.DiskFileDialog,"onFileNeedsToMove",(function(t){t.stopImmediatePropagation();e.getInstance().fire(babelHelpers.toConsumableArray(t.getData()).shift())}))}}},{key:"getInstance",value:function t(){if(this.instance===null){this.instance=new e}return this.instance}}]);return e}();babelHelpers.defineProperty(se,"subscribed",false);babelHelpers.defineProperty(se,"instance",null);var oe,le;var ce=0;function ue(e){var t={},i,n;for(i in e){n=i.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase();t[n]=e[i];t[i]=e[i]}return t}var de=function(e){babelHelpers.inherits(t,e);function t(e){var i;var n=e.id,a=e.fieldName,r=e.container,l=e.eventObject,c=e.input;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:r,eventObject:l}));i.id=n;i.fieldName=a;i.input=c;if(!i.input){return babelHelpers.possibleConstructorReturn(i)}i.agent=BX.Uploader.getInstance({id:n,streams:1,allowUpload:"A",uploadFormData:"N",uploadMethod:"immediate",uploadFileUrl:o.urlUpload,showImage:false,sortItems:false,dropZone:null,input:i.input,pasteFileHashInForm:false});i.onUploadDone=i.onUploadDone.bind(babelHelpers.assertThisInitialized(i));i.onUploadError=i.onUploadError.bind(babelHelpers.assertThisInitialized(i));s.EventEmitter.subscribe(i.agent,"onFileIsUploaded",(function(e){var t=babelHelpers.slicedToArray(e.compatData,3),n=t[0],a=t[1],r=t[2];i.onUploadDone(a,r)}));s.EventEmitter.subscribe(i.agent,"onFileIsUploadedWithError",(function(e){var t=babelHelpers.slicedToArray(e.compatData,3),n=t[0],a=t[1],r=t[2];i.onUploadError(a,r)}));i.fileSelector=new ie(babelHelpers.assertThisInitialized(i));s.EventEmitter.subscribe(i.fileSelector,"onUploadDone",(function(e){var t=e.data.itemData;i.onSelectionIsDone(t)}));i.fileSelectorCloud=new re(babelHelpers.assertThisInitialized(i));s.EventEmitter.subscribe(i.fileSelectorCloud,"onUploadDone",(function(e){var t=e.data.itemData;i.onSelectionIsDone(t)}));return i}babelHelpers.createClass(t,[{key:"onSelectionIsDone",value:function e(t){var i={id:"disk-edit-attach"+t["ID"],"bx-agentFileId":t["ID"]};if(t["FILE_ID"])i["bx-attach-file-id"]="n"+t["FILE_ID"];var n=r.Tag.render(oe||(oe=babelHelpers.taggedTemplateLiteral(['<input type="hidden" name="','" value="','">'])),this.fieldName,t["ID"]);for(var a in i){if(i.hasOwnProperty(a)){n.setAttribute(a,i[a])}}this.getContainer().appendChild(n);var o={element_id:t["ID"],element_name:t["NAME"],element_url:t["PREVIEW_URL"],storage:t["STORAGE"]};s.EventEmitter.emit(this.getEventObject(),"OnFileUploadSuccess",new s.BaseEvent({compatData:[o,{},null,{id:ce++,name:t["NAME"],size:t["SIZE"],sizeInt:t["SIZE_INT"]}]}))}},{key:"onUploadDone",value:function e(t,i){if(i["file"]&&i["file"]["attachId"]!==i["file"]["id"]){i["file"]["id"]=i["file"]["attachId"];delete i["file"]["attachId"]}var n=ue(i["file"]);var a={id:"disk-edit-attach"+n.id,"bx-agentFileId":t.id};if(n["XML_ID"])a["bx-attach-xml-id"]=n["XML_ID"];if(n["FILE_ID"])a["bx-attach-file-id"]="n"+n["FILE_ID"];if(n["FILE_TYPE"])a["bx-attach-file-type"]=n["FILE_TYPE"];n.element_id=n.id;var s=r.Tag.render(le||(le=babelHelpers.taggedTemplateLiteral(['<input type="hidden" name="','" value="','">'])),this.fieldName,n.id);for(var o in a){if(a.hasOwnProperty(o)){s.setAttribute(o,a[o])}}this.getContainer().appendChild(s);this.onFileIs(t,n)}},{key:"onFileIs",value:function e(t,i){var n={element_id:i.element_id,element_name:i.element_name||t.name,element_url:i.element_name||i.previewUrl||i.preview_url,storage:"disk"};s.EventEmitter.emit(this.getEventObject(),"OnFileUploadSuccess",new s.BaseEvent({compatData:[n,this,t.file,t]}))}},{key:"onUploadError",value:function e(t,i){BX.onCustomEvent(this.getEventObject(),"OnFileUploadFailed",[this,t.file,t])}}]);return t}(E);var he=function(e){babelHelpers.inherits(t,e);function t(e,i){var n;var a=e.id,r=e.fieldName,o=e.container,l=e.eventObject,c=e.input,u=e.parserParams;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{container:o,eventObject:l}));n.id=a;n.fieldName=r;n.input=c;if(u){n.getFileController().getParser().setParams(u)}n.init();if(i.length>0){s.EventEmitter.emit(n.getEventObject(),"onShowControllers","show");n.show(i)}return n}babelHelpers.createClass(t,[{key:"init",value:function e(){var t=this;if(this.input){this.getFilesUploader()}this.initDocumentController();this.settingsController=new $(this,{});this.panelController=new ee(this);this.fileSelector=new ie(this);s.EventEmitter.subscribe(this.fileSelector,"onUploadDone",(function(e){var i=e.data.itemData;t.getFileController().add(i)}));this.fileSelectorCloud=new re(this);s.EventEmitter.subscribe(this.fileSelectorCloud,"onUploadDone",(function(e){var i=e.data,n=i.itemData,a=i.itemContainer;t.getFileController().add(n,a)}));var i=function e(i){var n=r.Type.isArray(i.getData())?i.getData().shift():i.getData();if(n==="show"){t.show()}else{t.hide()}};s.EventEmitter.subscribe(this.getEventObject(),"onCollectControllers",(function(e){e.data[t.fieldName]={storage:"disk",tag:t.getFileController().isPluggedIn()?t.getFileController().getParser().tag:null,values:[],handler:{selectFile:function e(i,n,a){t.fileSelector.selectFile(i,n,a)}}};Array.from(t.getContainer().querySelectorAll('input[type="hidden"][name="'.concat(t.fieldName,'"]'))).forEach((function(i){e.data[t.fieldName].values.push(i.value)}))}));s.EventEmitter.subscribe(this.getEventObject(),"onShowControllers",i);s.EventEmitter.subscribe(this.getEventObject(),"DiskLoadFormController",i);s.EventEmitter.subscribe(s.EventEmitter.GLOBAL_TARGET,"disk.uf.file:create:thumb:upload",(function(e){var i=e.data;t.show();t.getFilesUploader().addTestThumb(i)}));s.EventEmitter.subscribe(s.EventEmitter.GLOBAL_TARGET,"disk.uf.file:create:thumb:error",(function(){t.show();t.getFilesUploader().addTestErrorThumb()}))}},{key:"initDocumentController",value:function e(){var i=this;this.documentController=new Q({container:this.getContainer(),eventObject:this.getEventObject()});s.EventEmitter.subscribe(this.documentController,"onFileIsCreated",(function(e){var t=e.data.itemData;s.EventEmitter.emit(i.getEventObject(),"onShowControllers","show");i.getFileController().add(t)}));if(!this.documentController.isRelevant()){return}else if(!this.isPluggedIn()){this.documentController.show();return}if(this.eventObject.dataset.bxDiskDocumentButton!=="added"){this.eventObject.dataset.bxDiskDocumentButton="added";var n=document.createElement("DIV");n.addEventListener("click",(function(){var e=n.closest('[data-id="disk-document"]');if(e&&e.hasAttribute("data-bx-button-status")){s.EventEmitter.emit(i.getEventObject(),"onHideDocuments")}else{s.EventEmitter.emit(i.getEventObject(),"onShowControllers","hide");s.EventEmitter.emit(i.getEventObject(),"onShowDocuments","show")}}));n.innerHTML="<i></i>"+r.Loc.getMessage("WDUF_CREATE_DOCUMENT");s.EventEmitter.emit(this.eventObject,"OnAddButton",[{BODY:n,ID:"disk-document"},"file"]);s.EventEmitter.subscribe(this.getEventObject(),"onShowDocuments",(function(){var e=n.closest('[data-id="disk-document"]');if(e){e.setAttribute("data-bx-button-status","active")}}));s.EventEmitter.subscribe(this.getEventObject(),"onHideDocuments",(function(){var e=n.closest('[data-id="disk-document"]');if(e){e.removeAttribute("data-bx-button-status")}}))}s.EventEmitter.subscribe(this.getEventObject(),"onShowDocuments",(function(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"show",i).call(i);i.documentController.show()}));s.EventEmitter.subscribe(this.getEventObject(),"onHideDocuments",(function(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"hide",i).call(i);i.documentController.hide()}));var a=function e(t){var n=t.data;if(n==="show"){s.EventEmitter.emit(i.getEventObject(),"onHideDocuments")}};s.EventEmitter.subscribe(this.getEventObject(),"DiskLoadFormController",a);s.EventEmitter.subscribe(this.getEventObject(),"onShowControllers",a)}},{key:"getFileController",value:function e(){if(!this.filesController){this.filesController=new J({id:this.id,fieldName:this.fieldName,container:this.container,eventObject:this.eventObject})}return this.filesController}},{key:"getFilesUploader",value:function e(){var t=this;if(!this.filesUploader){this.filesUploader=new v({id:this.id,container:this.container.querySelector('[data-bx-role="placeholder"]'),dropZone:this.container,input:this.input});s.EventEmitter.subscribe(this.getEventObject(),"OnVideoHasCaught",(function(e){var i=e.getData();var n=function e(n){var a=n.data,r=a.itemData,o=a.itemContainer,l=a.blob;if(i===l){s.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",e);t.getFileController().getParser().insertFile(r.ID)}};s.EventEmitter.subscribe(t.filesUploader,"onUploadDone",n);t.filesUploader.upload([i]);e.stopImmediatePropagation()}));s.EventEmitter.subscribe(this.getEventObject(),"OnImageHasCaught",(function(e){var i=e.getData();e.stopImmediatePropagation();return new Promise((function(e,n){var a=function n(a){var o=a.data,l=o.itemData,c=o.itemContainer,u=o.blob;if(i===u){s.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",n);s.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",r);e({image:{src:l.PREVIEW_URL},html:t.getFileController().getParser().getItemHTML(l.ID)})}};s.EventEmitter.subscribe(t.filesUploader,"onUploadDone",a);var r=function e(r){var o=r.data.blob;if(i===o){s.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",a);s.EventEmitter.unsubscribe(t.filesUploader,"onUploadDone",e);n()}};s.EventEmitter.subscribe(t.filesUploader,"onUploadDone",r);t.filesUploader.upload([i])}))}));s.EventEmitter.subscribe(this.getEventObject(),"onFilesHaveCaught",(function(e){e.stopImmediatePropagation();t.filesUploader.upload(babelHelpers.toConsumableArray(e.getData()))}));s.EventEmitter.subscribe(this.filesUploader,"onUploadDone",(function(e){var i=e.data,n=i.itemData,a=i.itemContainer;t.getFileController().add(n,a)}));s.EventEmitter.subscribe(this.filesUploader,"onUploadIsStart",(function(){s.EventEmitter.emit(t.getEventObject(),"onBusy",t)}));s.EventEmitter.subscribe(this.filesUploader,"onUploadIsDone",(function(){s.EventEmitter.emit(t.getEventObject(),"onReady",t)}))}return this.filesUploader}},{key:"getPanelController",value:function e(){return this.panelController}},{key:"show",value:function e(i){var n=this;var a=this.getContainer().parentNode.querySelector("#"+this.getContainer().id+"-switcher");if(a){a.parentNode.removeChild(a)}if(this.getFileController().isPluggedIn()){this.getContainer().setAttribute("data-bx-plugged-in","Y")}babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"show",this).call(this);this.showInitialLoader();this.getFileController().show();this.getPanelController().show();if(i){this.getFileController().set(i).then((function(){n.hideInitialLoader()}))}else{this.hideInitialLoader()}}},{key:"hide",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"hide",this).call(this);this.getFileController().hide();this.getPanelController().hide()}},{key:"showInitialLoader",value:function e(){}},{key:"hideInitialLoader",value:function e(){}}],[{key:"getInstance",value:function e(i,n){if(!this.repo[i["id"]]){this.repo[i["id"]]=new t(i,n)}return this.repo[i["id"]]}},{key:"getBriefInstance",value:function e(t){if(!this.repo[t["id"]]){this.repo[t["id"]]=new de(t,[])}return this.repo[t["id"]]}}]);return t}(E);babelHelpers.defineProperty(he,"repo",{});setTimeout((function(){if(BX.DiskFileDialog){se.subscribe()}}),1e3);var pe=function e(t){var i=BX("diskuf-selectdialog-"+t["UID"]);if(i&&BX.isNodeInDom(i)){var n=i.parentNode;if(!i.hasAttribute("bx-disk-load-is-bound")){i.setAttribute("bx-disk-load-is-bound","Y");BX.addCustomEvent(n,"DiskLoadFormController",(function(e){try{BX.Disk.UF.Options.set({urlUpload:t.urlUpload});return BX.Disk.UF.Form.getBriefInstance({container:i,eventObject:i.parentNode,id:t.UID,fieldName:t.controlName,input:BX.findChild(i,{className:"diskuf-fileUploader"},true)})}catch(e){console.log("Error with compatibility",e)}}))}if(!!t["values"]&&t["values"].length>0&&!t["hideSelectDialog"])BX.onCustomEvent(i.parentNode,"DiskLoadFormController",["show"])}};e.Form=he;e.Options=o;e.add=pe})(this.BX.Disk.UF=this.BX.Disk.UF||{},BX,BX.Main,BX.UI,BX.UI,BX,BX.Event);(function(e){if(e.BX.Disk&&e.BX.Disk.UFShowController)return;var t=e.BX;var i=0;var n={};var a=function(e){return t.Disk.ajaxPromise({url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","getBreadcrumbs"),method:"POST",dataType:"json",data:{attachedId:e}})};var r=function(e){if(!t(e)||e.hasAttribute("bx-is-bound"))return;e.setAttribute("bx-is-bound","Y");this.img=e;this.node=e.parentNode.parentNode.parentNode;t.unbindAll(e);t.unbindAll(this.node);t.show(this.node);t.remove(this.node.nextSibling);this.id="wufdp_"+Math.random()};r.prototype={turnOn:function(){this.timeout=setTimeout(t.delegate((function(){this.show()}),this),500)},turnOff:function(){clearTimeout(this.timeout);this.timeout=null;this.hide()},show:function(){if(this.popup!=null)this.popup.close();if(this.popup==null){var e={width:this.img.naturalWidth,height:this.img.naturalHeight};if(t["UploaderUtils"]){var i=t.UploaderUtils.scaleImage(e,{width:parseInt(t.message("DISK_THUMB_WIDTH")),height:parseInt(t.message("DISK_THUMB_HEIGHT"))});e=i.destin}this.popup=new t.PopupWindow("bx-wufd-preview-img-"+this.id,this.img.parentNode,{lightShadow:true,offsetTop:-7,offsetLeft:(51-28)/2+14,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:t.proxy((function(){this.popup=null}),this)},content:t.create("DIV",{props:e,children:[t.create("IMG",{props:e,attrs:{src:this.img.src}})]})});this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false},hide:function(){if(this.popup!=null)this.popup.close()}};t.addCustomEvent("onDiskPreviewIsReady",(function(e){new r(e)}));t.Disk.UF.runImport=function(e){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_PROCESS_LOADING"),showLoaderIcon:true,autoHide:false});t.Disk.ExternalLoader.reloadLoadAttachedObject({attachedObject:{id:e.id,name:e.name,service:e.service},onFinish:t.delegate((function(e){if(e.hasOwnProperty("hasNewVersion")&&!e.hasNewVersion){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_HAS_LAST_VERSION"),showSuccessIcon:true,autoHide:true})}else if(e.status==="success"){t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_SUCCESS_LOADING"),showSuccessIcon:true,autoHide:true})}else{t.Disk.showActionModal({text:t.message("DISK_UF_FILE_STATUS_FAIL_LOADING"),autoHide:true})}}),this),onProgress:t.delegate((function(e){}),this)}).start()};t.Disk.UF.disableAutoCommentToAttachedObject=function(e){var i=e.attachedId;t.Disk.ajax({method:"POST",dataType:"json",url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","disableAutoCommentToAttachedObject"),data:{attachedId:i},onsuccess:t.delegate((function(e){}),this)})};t.Disk.UF.enableAutoCommentToAttachedObject=function(e){var i=e.attachedId;t.Disk.ajax({method:"POST",dataType:"json",url:t.Disk.addToLinkParam("/bitrix/tools/disk/uf.php","action","enableAutoCommentToAttachedObject"),data:{attachedId:i},onsuccess:t.delegate((function(e){}),this)})};t.Disk.UF.showTransformationUpgradePopup=function(e){B24.licenseInfoPopup.show("disk_transformation_video_limit",t.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_TITLE"),t.message("DISK_UF_CONTROLLER_TRANSFORMATION_UPGRADE_POPUP_CONTENT"),false)};t.Disk.UFShowController=function(e){if(!t.type.isPlainObject(e)){e={}}this.entityType=t.type.isNotEmptyString(e.entityType)?e.entityType:"";this.entityId=parseInt(e.entityId)>0?e.entityId:"";this.signedParameters=t.type.isNotEmptyString(e.signedParameters)?e.signedParameters:"";this.loader=null;this.container=t.type.isNotEmptyString(e.nodeId)?document.getElementById(e.nodeId):null;if(this.container){var i=this.container.querySelector(".disk-uf-file-switch-control");if(i){t.Event.bind(i,"click",t.Disk.UFShowController.onToggleView)}}if(t.type.isNotEmptyString(e.nodeId)){n[e.nodeId]=this}};t.Disk.UFShowController.getInstance=function(e){return t.type.isNotEmptyString(e)&&n[e]?n[e]:null};t.Disk.UFShowController.onToggleView=function(e){var i=e.currentTarget.closest(".diskuf-files-toggle-container"),n=e.currentTarget.getAttribute("data-bx-view-type");if(!t.type.isDomNode(i)||!t.type.isNotEmptyString(i.id)){return}var a=t.Disk.UFShowController.getInstance(i.id);if(a){a.toggleViewType({viewType:n})}e.preventDefault()};t.Disk.UFShowController.prototype.toggleViewType=function(e){this.showToggleViewLoader();t.ajax.runComponentAction("bitrix:disk.uf.file","toggleViewType",{mode:"class",signedParameters:this.signedParameters,data:{params:{viewType:e.viewType}}}).then(function(e){this.hideToggleViewLoader();t.clean(this.container);t.html(this.container,e.data.html)}.bind(this),(function(e){this.hideToggleViewLoader()}))};t.Disk.UFShowController.prototype.showToggleViewLoader=function(e){this.container.classList.add("diskuf-files-toggle-container-active");this.loader=new t.Loader({target:this.container});this.loader.show()};t.Disk.UFShowController.prototype.hideToggleViewLoader=function(e){this.container.classList.remove("diskuf-files-toggle-container-active");if(this.loader){this.loader.destroy()}};e.DiskOpenMenuCreateService=function(e){var i=[t.Disk.UF.getDocumentHandler("onlyoffice")?{text:t.Disk.UF.getDocumentHandler("onlyoffice").name,className:"bx-viewer-popup-item item-b24-docs",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("onlyoffice");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("onlyoffice").name})}}:null,t.Disk.Document.Local.Instance.isEnabled()?{text:t.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT"),className:"bx-viewer-popup-item item-b24",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("l");t.adjust(e,{text:t.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT")})}}:null,{text:t.Disk.UF.getDocumentHandler("gdrive").name,className:"bx-viewer-popup-item item-gdocs",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("gdrive");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("gdrive").name})}},{text:t.Disk.UF.getDocumentHandler("office365").name,className:"bx-viewer-popup-item item-office365",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("office365");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("office365").name})}},{text:t.Disk.UF.getDocumentHandler("onedrive").name,className:"bx-viewer-popup-item item-office",onclick:function(i,n){n.getMenuWindow().close();t.Disk.saveDocumentService("onedrive");t.adjust(e,{text:t.Disk.UF.getDocumentHandler("onedrive").name})}}];t.PopupMenu.show("disk_open_menu_with_services",t(e),i,{offsetTop:0,offsetLeft:25,angle:{position:"top",offset:45},autoHide:true,zIndex:1e4,overlay:{opacity:.01},events:{}})};e.DiskOpenMenuImportService=function(e,i){var n=[];for(var a in i){if(!i.hasOwnProperty(a))continue;n.push({text:i[a].name,code:i[a].id,href:"#",onclick:function(e,i){var n=i.layout.item;t.addClass(n,"diskuf-selector-link-cloud");n.setAttribute("data-bx-doc-handler",i.code);t.onCustomEvent("onManualChooseCloudImport",[{target:n}]);t.removeClass(n,"diskuf-selector-link-cloud");n.removeAttribute("data-bx-doc-handler");t.PopupMenu.destroy("disk_open_menu_with_import_services");return t.PreventDefault(e)}})}var r=new t.CViewer({});r.openMenu("disk_open_menu_with_import_services",t(e),n,{offsetTop:0,offsetLeft:25});return t.PreventDefault()};e.DiskActionFileMenu=function(e,n,a){i++;t.PopupMenu.show("bx-viewer-wd-popup"+i+"_"+e,t(n),a,{angle:{position:"top",offset:25},autoHide:true});return false};e.WDInlineElementClickDispatcher=function(e,i){var n=t(i);if(n){t.fireEvent(n,"click")}return false}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:88:"/bitrix/components/bitrix/search.tags.input/templates/.default/script.js?172645641313020";s:6:"source";s:72:"/bitrix/components/bitrix/search.tags.input/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
var Errors = {
	"result_unval" : "Error in result",
	"result_empty" : "Empty result"
};

function JsTc(oHandler, sParams, sParser) // TC = TagCloud
{
	var t = this;

	t.oObj = typeof oHandler == 'object' ? oHandler : document.getElementById("TAGS");
	t.sParams = sParams;
	// Arrays for data
	if (sParser)
	{
		t.sExp = new RegExp("["+sParser+"]+", "i");
	}
	else
	{
		t.sExp = new RegExp(",");
	}
	t.oLast = {"str":false, "arr":false};
	t.oThis = {"str":false, "arr":false};
	t.oEl = {"start":false, "end":false};
	t.oUnfinedWords = {};
	// Flags
	t.bReady = true;
	t.eFocus = true;
	// Array with results & it`s showing
	t.aDiv = null;
	t.oDiv = null;
	// Pointers
	t.oActive = null;
	t.oPointer = [];
	t.oPointer_default = [];
	t.oPointer_this = 'input_field';

	t.oObj.onblur = function()
	{
		t.eFocus = false;
	};

	t.oObj.onfocus = function()
	{
		if (!t.eFocus)
		{
			t.eFocus = true;
			setTimeout(function(){t.CheckModif('focus')}, 500);
		}
	};

	t.oLast["arr"] = t.oObj.value.split(t.sExp);
	t.oLast["str"] = t.oLast["arr"].join(":");

	setTimeout(function(){t.CheckModif('this')}, 500);

	this.CheckModif = function(__data)
	{
		var
			sThis = false, tmp = 0,
			bUnfined = false, word = "",
			cursor = {};

		if (!t.eFocus)
			return;

		if (t.bReady && t.oObj.value.length > 0)
		{
			// Preparing input data
			t.oThis["arr"] = t.oObj.value.split(t.sExp);
			t.oThis["str"] = t.oThis["arr"].join(":");

			// Getting modificated element
			if (t.oThis["str"] && (t.oThis["str"] != t.oLast["str"]))
			{
				cursor['position'] = TCJsUtils.getCursorPosition(t.oObj);
				if (cursor['position']['end'] > 0 && !t.sExp.test(t.oObj.value.substr(cursor['position']['end']-1, 1)))
				{
					cursor['arr'] = t.oObj.value.substr(0, cursor['position']['end']).split(t.sExp);
					sThis = t.oThis["arr"][cursor['arr'].length - 1];

					t.oEl['start'] = cursor['position']['end'] - cursor['arr'][cursor['arr'].length - 1].length;
					t.oEl['end'] = t.oEl['start'] + sThis.length;
					t.oEl['content'] = sThis;

					t.oLast["arr"] = t.oThis["arr"];
					t.oLast["str"] = t.oThis["str"];
				}
			}
			if (sThis)
			{
				// Checking for UnfinedWords
				for (tmp = 2; tmp <= sThis.length; tmp++)
				{
					word = sThis.substr(0, tmp);
					if (t.oUnfinedWords[word] == '!fined')
					{
						bUnfined = true;
						break;
					}
				}
				if (!bUnfined)
					t.Send(sThis);
			}
		}
		setTimeout(function(){t.CheckModif('this')}, 500);
	};

	t.Send = function(sSearch)
	{
		if (!sSearch)
			return false;

		var oError = [];
		t.bReady = false;
		if (BX('wait_container'))
		{
			BX('wait_container').innerHTML = BX.message('JS_CORE_LOADING');
			BX.show(BX('wait_container'));
		}
		BX.ajax.post(
			'/bitrix/components/bitrix/search.tags.input/search.php',
			{"search":sSearch, "params":t.sParams},
			function(data)
			{
				var result = {};
				t.bReady = true;

				try
				{
					eval("result = " + data + ";");
				}
				catch(e)
				{
					oError['result_unval'] = e;
				}

				if (TCJsUtils.empty(result))
					oError['result_empty'] = Errors['result_empty'];

				try
				{
					if (TCJsUtils.empty(oError) && (typeof result == 'object'))
					{
						if (!(result.length == 1 && result[0]['NAME'] == t.oEl['content']))
						{
							t.Show(result);
							return;
						}
					}
					else
					{
						t.oUnfinedWords[t.oEl['content']] = '!fined';
					}
				}
				catch(e)
				{
					oError['unknown_error'] = e;
				}

				if(BX('wait_container'))
					BX.hide(BX('wait_container'));
			}
		);
	};

	t.Show = function(result)
	{
		t.Destroy();
		t.oDiv = document.body.appendChild(document.createElement("DIV"));
		t.oDiv.id = t.oObj.id+'_div';

		t.oDiv.className = "search-popup";
		t.oDiv.style.position = 'absolute';

		t.aDiv = t.Print(result);
		var pos = TCJsUtils.GetRealPos(t.oObj);
		t.oDiv.style.width = parseInt(pos["width"]) + "px";
		TCJsUtils.show(t.oDiv, pos["left"], pos["bottom"]);
		TCJsUtils.addEvent(document, "click", t.CheckMouse);
		TCJsUtils.addEvent(document, "keydown", t.CheckKeyword);
	};

	t.Print = function(aArr)
	{
		var aEl = null;
		var aResult = [];
		var aRes = [];
		var iCnt = 0;
		var oDiv = null;
		var oSpan = null;
		var sPrefix = t.oDiv.id;

		for (var tmp_ in aArr)
		{
			// Math
			if (aArr.hasOwnProperty(tmp_))
			{
				aEl = aArr[tmp_];
				aRes = [];
				aRes['ID'] = (aEl['ID'] && aEl['ID'].length > 0) ? aEl['ID'] : iCnt++;
				aRes['GID'] = sPrefix + '_' + aRes['ID'];
				aRes['NAME'] = TCJsUtils.htmlspecialcharsEx(aEl['NAME']);
				aRes['~NAME'] = aEl['NAME'];
				aRes['CNT'] = aEl['CNT'];
				aResult[aRes['GID']] = aRes;
				t.oPointer.push(aRes['GID']);
				// Graph
				oDiv = t.oDiv.appendChild(document.createElement("DIV"));
				oDiv.id = aRes['GID'];
				oDiv.name = sPrefix + '_div';

				oDiv.className = 'search-popup-row';

				oDiv.onmouseover = function(){t.Init(); this.className='search-popup-row-active';};
				oDiv.onmouseout = function(){t.Init(); this.className='search-popup-row';};
				oDiv.onclick = function(e){
						t.oActive = this.id;
						t.Replace();
						t.Destroy();
						BX.PreventDefault(e);
					};

				oSpan = oDiv.appendChild(document.createElement("DIV"));
				oSpan.id = oDiv.id + '_NAME';
				oSpan.className = "search-popup-el search-popup-el-cnt";
				oSpan.innerHTML = aRes['CNT'];

				oSpan = oDiv.appendChild(document.createElement("DIV"));
				oSpan.id = oDiv.id + '_NAME';
				oSpan.className = "search-popup-el search-popup-el-name";
				oSpan.innerHTML = aRes['NAME'];
			}
		}
		t.oPointer.push('input_field');
		t.oPointer_default = t.oPointer;
		return aResult;
	};

	t.Destroy = function()
	{
		try
		{
			TCJsUtils.hide(t.oDiv);
			t.oDiv.parentNode.removeChild(t.oDiv);
		}
		catch(e)
		{}
		t.aDiv = [];
		t.oPointer = [];
		t.oPointer_default = [];
		t.oPointer_this = 'input_field';
		t.bReady = true;
		t.eFocus = true;
		t.oActive = null;

		TCJsUtils.removeEvent(document, "click", t.CheckMouse);
		TCJsUtils.removeEvent(document, "keydown", t.CheckKeyword);
	};

	t.Replace = function()
	{
		if (typeof t.oActive == 'string')
		{
			var tmp = t.aDiv[t.oActive];
			var tmp1 = '';
			if (typeof tmp == 'object')
			{
				var elEntities = document.createElement("textarea");
				elEntities.innerHTML = tmp['~NAME'];
				tmp1 = elEntities.value;
			}
			//this preserves leading spaces
			var start = t.oEl['start'];
			while(start < t.oObj.value.length && t.oObj.value.substring(start, start+1) == " ")
				start++;

			t.oObj.value = t.oObj.value.substring(0, start) + tmp1 + t.oObj.value.substr(t.oEl['end']);
			TCJsUtils.setCursorPosition(t.oObj, start + tmp1.length);
		}
	};

	t.Init = function()
	{
		t.oActive = false;
		t.oPointer = t.oPointer_default;
		t.Clear();
		t.oPointer_this = 'input_pointer';
	};

	t.Clear = function()
	{
		var oEl = t.oDiv.getElementsByTagName("div");
		if (oEl.length > 0 && typeof oEl == 'object')
		{
			for (var ii in oEl)
			{
				if (oEl.hasOwnProperty(ii))
				{
					var oE = oEl[ii];
					if (oE && (typeof oE == 'object') && (oE.name == t.oDiv.id + '_div'))
					{
						oE.className = "search-popup-row";
					}
				}
			}
		}
	};

	t.CheckMouse = function()
	{
		t.Replace();
		t.Destroy();
	};

	t.CheckKeyword = function(e)
	{
		if (!e)
			e = window.event;
		var oP = null;
		var oEl = null;
		if ((37 < e.keyCode && e.keyCode <41) || (e.keyCode == 13))
		{
			t.Clear();

			switch (e.keyCode)
			{
				case 38:
					oP = t.oPointer.pop();
					if (t.oPointer_this == oP)
					{
						t.oPointer.unshift(oP);
						oP = t.oPointer.pop();
					}

					if (oP != 'input_field')
					{
						t.oActive = oP;
						oEl = document.getElementById(oP);
						if (typeof oEl == 'object')
						{
							oEl.className = "search-popup-row-active";
						}
					}
					t.oPointer.unshift(oP);
					break;
				case 40:
					oP = t.oPointer.shift();
					if (t.oPointer_this == oP)
					{
						t.oPointer.push(oP);
						oP = t.oPointer.shift();
					}
					if (oP != 'input_field')
					{
						t.oActive = oP;
						oEl = document.getElementById(oP);
						if (typeof oEl == 'object')
						{
							oEl.className = "search-popup-row-active";
						}
					}
					t.oPointer.push(oP);
					break;
				case 39:
					t.Replace();
					t.Destroy();
					break;
				case 13:
					t.Replace();
					t.Destroy();
					if (TCJsUtils.IsIE())
					{
						e.returnValue = false;
						e.cancelBubble = true;
					}
					else
					{
						e.preventDefault();
						e.stopPropagation();
					}
					break;
			}
			t.oPointer_this	= oP;
		}
		else
		{
			t.Destroy();
		}
	}
}

var TCJsUtils =
{
	arEvents:  [],

	addEvent: function(el, evname, func)
	{
		if(el.attachEvent) // IE
			el.attachEvent("on" + evname, func);
		else if(el.addEventListener) // Gecko / W3C
			el.addEventListener(evname, func, false);
		else
			el["on" + evname] = func;
		this.arEvents[this.arEvents.length] = {'element': el, 'event': evname, 'fn': func};
	},

	removeEvent: function(el, evname, func)
	{
		if(el.detachEvent) // IE
			el.detachEvent("on" + evname, func);
		else if(el.removeEventListener) // Gecko / W3C
			el.removeEventListener(evname, func, false);
		else
			el["on" + evname] = null;
	},

	getCursorPosition: function(oObj)
	{
		var result = {'start': 0, 'end': 0};
		if (!oObj || (typeof oObj != 'object'))
			return result;
		try
		{
			if (document.selection != null && oObj.selectionStart == null)
			{
				oObj.focus();
				var oRange = document.selection.createRange();
				var oParent = oRange.parentElement();
				var sBookmark = oRange.getBookmark();
				var sContents_ = oObj.value;
				var sContents = sContents_;
				var sMarker = '__' + Math.random() + '__';

				while(sContents.indexOf(sMarker) != -1)
				{
					sMarker = '__' + Math.random() + '__';
				}

				if (!oParent || oParent == null || (oParent.type != "textarea" && oParent.type != "text"))
				{
					return result;
				}

				oRange.text = sMarker + oRange.text + sMarker;
				sContents = oObj.value;
				result['start'] = sContents.indexOf(sMarker);
				sContents = sContents.replace(sMarker, "");
				result['end'] = sContents.indexOf(sMarker);
				oObj.value = sContents_;
				oRange.moveToBookmark(sBookmark);
				oRange.select();
				return result;
			}
			else
			{
				return {
					'start': oObj.selectionStart,
					'end': oObj.selectionEnd
				};
			}
		}
		catch(e){}
		return result;
	},

	setCursorPosition: function(oObj, iPosition)
	{
		if (typeof oObj != 'object')
			return false;

		oObj.focus();

		try
		{
			if (document.selection != null && oObj.selectionStart == null)
			{
				var oRange = document.selection.createRange();
				oRange.select();
			}
			else
			{
				oObj.selectionStart = iPosition;
				oObj.selectionEnd = iPosition;
			}
			return true;
		}
		catch(e)
		{
			return false;
		}
	},

	printArray: function (oObj, sParser, iLevel)
	{
		try
		{
			var result = '';
			var space = '';

			if (iLevel==undefined)
				iLevel = 0;
			if (!sParser)
				sParser = "\n";

			for (var j=0; j<=iLevel; j++)
				space += '  ';

			for (var i in oObj)
			{
				if (oObj.hasOwnProperty(i))
				{
					if (typeof oObj[i] == 'object')
						result += space+i + " = {"+ sParser + TCJsUtils.printArray(oObj[i], sParser, iLevel+1) + ", " + sParser + "}" + sParser;
					else
						result += space+i + " = " + oObj[i] + "; " + sParser;
				}
			}
			return result;
		}
		catch(e)
		{
		}
	},

	empty: function(oObj)
	{
		if (oObj)
		{
			for (var i in oObj)
			{
				if (oObj.hasOwnProperty(i))
				{
					return false;
				}
			}
		}
		return true;
	},

	show: function(oDiv, iLeft, iTop)
	{
		if (typeof oDiv != 'object')
			return;
		var zIndex = parseInt(oDiv.style.zIndex);
		if(zIndex <= 0 || isNaN(zIndex))
			zIndex = 2200;
		oDiv.style.zIndex = zIndex;
		oDiv.style.left = iLeft + "px";
		oDiv.style.top = iTop + "px";
		return oDiv;
	},

	hide: function(oDiv)
	{
		if (oDiv)
			oDiv.style.display = 'none';
	},

	GetRealPos: function(el)
	{
		if(!el || !el.offsetParent)
			return false;

		var res = {};
		var objParent = el.offsetParent;
		res["left"] = el.offsetLeft;
		res["top"] = el.offsetTop;
		while(objParent && objParent.tagName != "BODY")
		{
			res["left"] += objParent.offsetLeft;
			res["top"] += objParent.offsetTop;
			objParent = objParent.offsetParent;
		}
		res["right"]=res["left"] + el.offsetWidth;
		res["bottom"]=res["top"] + el.offsetHeight;
		res["width"]=el.offsetWidth;
		res["height"]=el.offsetHeight;

		return res;
	},

	IsIE: function()
	{
		return (document.attachEvent && !TCJsUtils.IsOpera());
	},

	IsOpera: function()
	{
		return (navigator.userAgent.toLowerCase().indexOf('opera') != -1);
	},

	htmlspecialcharsEx: function(str)
	{
		return str.replace(/&amp;/g, '&amp;amp;').replace(/&lt;/g, '&amp;lt;').replace(/&gt;/g, '&amp;gt;').replace(/&quot;/g, '&amp;quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
	},

	htmlspecialcharsback: function(str)
	{
		return str.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;;/g, '"').replace(/&amp;/g, '&');
	}
};

/* End */
;
; /* Start:"a:4:{s:4:"full";s:84:"/bitrix/components/bitrix/voting.uf/templates/.default/script.min.js?172645645111231";s:6:"source";s:64:"/bitrix/components/bitrix/voting.uf/templates/.default/script.js";s:3:"min";s:68:"/bitrix/components/bitrix/voting.uf/templates/.default/script.min.js";s:3:"map";s:68:"/bitrix/components/bitrix/voting.uf/templates/.default/script.map.js";}"*/
(function(t){var e=t.BX;if(e["Vote"])return;var i=t["app"]?e.message("SITE_DIR")+"mobile/?mobile_action=vote":"/bitrix/tools/vote/uf.php";e.Vote=function(){var a=function(i,s){this.node=i;this.form=e.findChild(this.node,{tagName:"FORM"},true);this.id=s["id"];this.voteId=s["voteId"];this.params=s;var a,o,r;this.errorNode=e.findChild(this.node,{attribute:{"data-bx-vote-role":"error"}},true);for(var n in this.buttons){if(this.buttons.hasOwnProperty(n)){a=e.findChild(this.node,{attribute:{"data-bx-vote-button":n}},true);if(a&&e.type.isFunction(this[n])){this[n]=e.delegate(this[n],this);this.buttons[n]=a;e.bind(a,"click",this[n])}}}a=e.findChildren(this.node,{tagName:"TR"},true);while(a&&(o=a.pop())&&o&&o.hasAttribute("data-bx-vote-answer")){r=e.findChild(o,{tagName:"A",attribute:{"data-bx-vote-result":"counter"}},true);if(r){if(t["app"]){e.bind(o,"click",e.proxy(this.checkMobileUsers,this))}else{e.bind(r,"click",e.proxy(this.checkUsers,this));e.adjust(r,{attrs:{"data-bx-vote-answer":o.getAttribute("data-bx-vote-answer")}})}}}this.onPullEvent=e.delegate((function(t,i){if(t=="voting"&&!!i&&i["VOTE_ID"]==this.voteId&&e(this.node)){this.adjustResults(i)}}),this);if(t["app"]){app.onCustomEvent("onPullExtendWatch",{id:"VOTE_"+this.voteId});e.addCustomEvent("onPull-vote",this.onPullEvent)}else if(e["PULL"]){e.PULL.extendWatch("VOTE_"+this.voteId);e.addCustomEvent("onPullEvent-vote",this.onPullEvent)}};a.prototype={buttons:{showVoteForm:null,showResults:null,actVoting:null,stopOrResume:null,exportXls:null},params:{},url:i,showVoteForm:function(t){if(this.node.getAttribute("data-bx-vote-lamp")=="green"){var i=e.proxy((function(t){if(t&&t.data&&t.data.event)this.adjustBallot(t.data.attach,t.data.event);this.node.setAttribute("data-bx-vote-form","shown")}),this),s=e.proxy((function(t){this.node.setAttribute("data-bx-vote-form","shown")}),this);this.send({action:"getBallot"},t.target,i,s)}e.eventCancelBubble(t);return e.PreventDefault(t)},showResults:function(t){this.node.setAttribute("data-bx-vote-result",this.node.getAttribute("data-bx-vote-result")=="shown"?"hidden":"shown");e.eventCancelBubble(t);return e.PreventDefault(t)},stopOrResume:function(t){this.send({action:this.node.getAttribute("data-bx-vote-lamp")=="red"?"resume":"stop"},t.target,e.proxy((function(t){if(t["action"]=="stop"){this.node.setAttribute("data-bx-vote-result","shown");this.node.setAttribute("data-bx-vote-form","hidden");this.node.setAttribute("data-bx-vote-lamp","red")}else{if(this.node.getAttribute("data-bx-vote-status")!=="voted")this.node.setAttribute("data-bx-vote-form","shown");this.node.setAttribute("data-bx-vote-lamp","green")}if(t["data"]&&t["data"]["attach"])this.adjustResults(t["data"]["attach"])}),this));e.eventCancelBubble(t);return e.PreventDefault(t)},exportXls:function(t){e.eventCancelBubble(t);top.location.href=e.util.add_url_param(this.url,{action:"exportXls",attachId:this.id,sessid:e.bitrix_sessid()});return e.PreventDefault(t)},actVoting:function(t){var i=e.ajax.prepareForm(this.form).data;i["action"]="vote";this.send(i,t.target,e.proxy((function(t){this.node.setAttribute("data-bx-vote-form","hidden");this.node.setAttribute("data-bx-vote-result","shown");this.adjustResults(t.data.attach)}),this),e.proxy((function(){this.node.setAttribute("data-bx-vote-form","shown")}),this));e.eventCancelBubble(t);return e.PreventDefault(t)},send:function(t,i,s,a){e.addClass(i,"ui-btn-clock");t["sessid"]=e.bitrix_sessid();t["attachId"]=this.id;e.ajax({method:"POST",url:e.util.add_url_param(this.url,{action:t["action"],attachId:this.id}),data:t,dataType:"json",onsuccess:e.proxy((function(t){e.removeClass(i,"ui-btn-clock");if(t.status=="success"){this.showError(null);if(e.type.isFunction(s))s.apply(this,arguments)}else{if(t.status=="error"&&t["errors"])this.showError(t["errors"]);if(e.type.isFunction(a))a.apply(this,arguments)}}),this),onfailure:e.proxy((function(){e.removeClass(i,"ui-btn-clock");if(e.type.isFunction(a))a.apply(this,arguments)}),this)})},adjustBallot:function(t,i){var s,a,o,r,n,u,l,h,p,d=t["QUESTIONS"],c=i["ballot"],f=i["extras"];for(s in d){if(d.hasOwnProperty(s)){l=d[s];o=[l["FIELD_NAME"],l["FIELD_NAME"]+"[]"];p=c[s]||{};while(r=o.shift()){if(this.form.elements[r]){u=e(this.form.elements[r])?[this.form.elements[r]]:this.form.elements[r];for(r=0;r<u.length;r++){if(p[u[r].value]){u[r].checked="checked"}else{delete u[r].checked}}}}for(a in d[s]["ANSWERS"]){if(d[s]["ANSWERS"].hasOwnProperty(a)){h=d[s]["ANSWERS"][a];if(h["FIELD_TYPE"]>=4){if(this.form.elements[h["MESSAGE_FIELD_NAME"]])this.form.elements[h["MESSAGE_FIELD_NAME"]].value=c[s]&&c[s][a]&&c[s][a]["MESSAGE"]?c[s][a]["MESSAGE"]:"";else this.form.elements[h["FIELD_NAME"]].value=c[s]&&c[s][a]&&c[s][a]["MESSAGE"]?c[s][a]["MESSAGE"]:""}}}}}for(r in f){if(f.hasOwnProperty(r)&&(s=e(this.form.elements[String(t["FIELD_NAME"]).replace("#ENTITY_ID#",r)]))){if(s.value==f[r])s.checked=true;else delete s.checked}}},adjustResults:function(t){var i=t["QUESTIONS"];e.onCustomEvent(this.node,"OnBeforeChangeData");var s,a,o,r,n,u;for(r in i){if(i.hasOwnProperty(r)){s=e.findChild(this.node,{attr:{id:"question"+r}},true);if(s){for(o in i[r]["ANSWERS"]){if(i[r]["ANSWERS"].hasOwnProperty(o)){a=e.findChild(s,{attr:{"data-bx-vote-answer":o}},true);if(!!a){n=parseInt(i[r]["ANSWERS"][o]["PERCENT"]);n=isNaN(n)?0:n;u=e.findChild(a,{attribute:{"data-bx-vote-result":"counter"}},true);e.adjust(u,{html:i[r]["ANSWERS"][o]["COUNTER"]+""});delete u["VOTED_USER_OBJ"];e.adjust(e.findChild(a,{tagName:"SPAN",attribute:{"data-bx-vote-result":"percent"}},true),{html:n+"%"});e.adjust(e.findChild(a,{tagName:"DIV",attribute:{"data-bx-vote-result":"bar"}},true),{style:{width:n+"%"}})}}}}}}u=e.findChild(this.node,{tagName:"DIV",attribute:{"data-bx-vote-result":"counter"}},true);e.adjust(u,{html:t["COUNTER"]+""});e.onCustomEvent(this.controller,"OnAfterChangeData")},checkUsers:function(t){var i=t?e(t.currentTarget):null;if(i.hasAttribute("data-bx-vote-answer")){if(!i["VOTED_USER_OBJ"]){i.VOTED_USER_OBJ=new s(i.getAttribute("data-bx-vote-answer"),i,{nameTemplate:this.params["nameTemplate"],urlTemplate:this.params["urlTemplate"],attachId:this.id})}i.VOTED_USER_OBJ.click()}},checkMobileUsers:function(t){if(this.node&&this.node.getAttribute("data-bx-vote-form")!=="shown"){var i=e.proxy_context,s=e.findChild(i,{tagName:"A",attribute:{"data-bx-vote-result":"counter"}},true);if(s&&parseInt(s.innerHTML)>0){e.PreventDefault(t);app.openBXTable({url:e.util.add_url_param(this.url,{action:"getMobileVoted",attachId:this.id,answerId:i.getAttribute("data-bx-vote-answer"),sessid:e.bitrix_sessid()}),TABLE_SETTINGS:{markmode:false,cache:false}});return false}}return true},showError:function(t){var i="";if(e.type.isArray(t)){var s=[];for(var a=0;a<t.length;a++){s.push(t[a]["message"])}s=s.join("<br />");i=s===""?"Unknown error":s;this.errorNode.innerHTML=i;this.node.setAttribute("data-bx-vote-error","shown")}else{this.errorNode.innerHTML="";this.node.setAttribute("data-bx-vote-error","hidden")}}};return a}();var s=function(){var t=function(t,e,i){this.id=["vote",t,(new Date).getTime()].join("-");this.answerId=t;this.node=e;this.status="ready";this.iNumPage=0;this.urlTemplate=i["urlTemplate"];this.nameTemplate=i["nameTemplate"];this.attachId=i["attachId"];this.data=[];this.queue=[];this.popup=null;this.popupScrollCheck=this.popupScrollCheck.bind(this)};t.prototype={url:i,click:function(){var t=parseInt(this.node.innerHTML);if(t>0){this.showPopup().then((()=>{if(this.data.length>0){this.buildVoters(this.data)}}))}},buildVoters:function(t){var i=this.popup?this.popup.getPopupContainer():null;if(i===null){return}var s=i.querySelector(".bx-ilike-popup");i.querySelector(".bx-ilike-wrap-block").removeAttribute("style");var a=false;t.forEach((t=>{var i=e.util.htmlspecialchars(t["ID"]);var o=e.util.htmlspecialchars(t["FULL_NAME"]);var r=e.type.isNotEmptyString(t["PHOTO_SRC"])?encodeURI(e.util.htmlspecialchars(t["PHOTO_SRC"])):null;var n=e.type.isNotEmptyString(t["TYPE"])?e.util.htmlspecialchars(t["TYPE"]):null;var u=["a",this.answerId,"u",i].join("");if(s.querySelector("a#"+u)===null){var l=['<span class="bx-ilike-popup-avatar-new">','<img src="',r??"/bitrix/images/main/blank.gif",'" class="bx-ilike-popup-avatar-img',r?"":" bx-ilike-popup-avatar-img-default",'" />','<span class="bx-ilike-popup-avatar-status-icon"></span>',"</span>",'<span class="bx-ilike-popup-name-new">',o,"</span>"].join("");s.appendChild(e.create(t["ID"]!=="HIDDEN"&&this.urlTemplate?"A":"SPAN",{attrs:{id:u},props:{href:this.urlTemplate.replace(/#(USER_ID|ID)#/i,i),target:"_blank",className:"bx-ilike-popup-img"+(n?" bx-ilike-popup-img-"+n:"")},html:l}))}a=true}));if(a){this.popup.adjustPosition({forceBindPosition:true});this.popupScrollCheck({currentTarget:s})}},makeError:function(t){var i=this.popup?this.popup.getPopupContainer():null;if(i===null){return}var s=(t||[{message:e.message("VOTE_ERROR_DEFAULT")}]).map((t=>t.message)).join("");i.innerHTML='<div class="bx-vote-popup-error-block">'+s+"</div>";this.popup.adjustPosition({forceBindPosition:true})},showPopup:function(){return new Promise((t=>{var e=this.getPopup();e.show();e.setAngle({position:"bottom"});e.adjustPosition({forceBindPosition:true});t(e)}))},getPopup:function(){if(this.popup){return this.popup}this.popup=new e.PopupWindow("bx-vote-popup-cont-"+this.id,this.node,{lightShadow:true,offsetTop:-2,offsetLeft:3,autoHide:true,closeByEsc:true,cacheable:false,bindOptions:{position:"top"},content:['<span class="bx-ilike-wrap-block" style="display: none;">'+'<span class="bx-ilike-popup"><span class="bx-ilike-bottom_scroll"></span></span>'+"</span>",'<span class="bx-ilike-wait"></span>'].join(""),events:{onFirstShow:()=>{this.send();e.bind(this.popup.contentContainer.querySelector(".bx-ilike-popup"),"scroll",this.popupScrollCheck)},onClose:()=>{this.popup=null}}});return this.popup},popupScrollCheck:function(){var t=this.popup?this.popup.contentContainer:null;if(t===null){return}var e=t.querySelector(".bx-ilike-popup");if(e.scrollTop>(e.scrollHeight-e.offsetHeight)/1.5||t.offsetHeight>e.offsetHeight){this.send()}},send:function(){if(this.status!=="ready"){if(this.status==="busy"){this.queue.push(this.send.bind(this))}else if(this.status==="done"){this.finalize()}return}this.status="busy";e.ajax({url:e.util.add_url_param(this.url,{action:"getVoted",attachId:this.attachId,answerId:this.answerId}),method:"POST",dataType:"json",data:{iNumPage:++this.iNumPage,nameTemplate:this.nameTemplate,sessid:e.bitrix_sessid()},onsuccess:function(t){if(t&&t.status==="success"){t=t.data;this.buildVoters(t.items);this.data=this.data.concat(t.items);if(t["statusPage"]==="done"||t.items.length<=0){this.status="done";this.finalize()}else{this.status="ready";var e=this.queue.shift();if(e){e.call(this)}}}else{this.status="error";this.makeError(t.errors);this.finalize()}}.bind(this),onfailure:function(){this.status="error";this.makeError();this.finalize()}.bind(this)})},finalize:function(){this.queue=[];var t=this.popup?this.popup.getPopupContainer():null;if(t===null){return}t.querySelector(".bx-ilike-wait").style.display="none";e.unbind(t.querySelector(".bx-ilike-popup"),"scroll",this.popupScrollCheck)}};return t}()})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/voting.vote.edit/templates/.default/script.min.js?172645645112569";s:6:"source";s:71:"/bitrix/components/bitrix/voting.vote.edit/templates/.default/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/voting.vote.edit/templates/.default/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/voting.vote.edit/templates/.default/script.map.js";}"*/
(function(){if(window.BVoteConstructor)return;BX.addCustomEvent("onClickMulti",(function(t){var e=BX.findChildren(t.parentNode.previousSibling,{attribute:{"data-bx-answer-field":"field-type"}},true);for(var i=0;i<e.length;i++){e[i].value=t.checked?"1":"0"}}));var t=function(t){this.map=new Map;this.maxSort=0;this.currentId=0;t=t||{};this.maxCount=parseInt(t["maxCount"]||0);this.onEntityHasBeenDeleted=this.onEntityHasBeenDeleted.bind(this)};t.prototype={set:function(t,e){this.map.set(t,e);BX.addCustomEvent(e,"onEntityHasBeenDeleted",this.onEntityHasBeenDeleted);this.maxSort=Math.max(this.maxSort,e.getSort());this.currentId++},get:function(t){return this.map.get(t)},keys:function(){return this.map.keys()},delete:function(t){return this.map.delete(t)},onEntityHasBeenDeleted:function(t,e,i){this.delete(t);if(this.maxSort===parseInt(e)){var s=0;this.map.forEach((function(t){s=Math.max(s,parseInt(t.getSort()))}));this.maxSort=s}},getNextId:function(){return this.currentId},getMaxSort:function(){return this.maxSort},canAdd:function(){return!(this.maxCount>0&&this.maxCount<=this.map.size)}};var e=function(t,i){this.id=[i["groupId"]||"vote",t.getAttribute("data-bx-number").toString()];this.eventObject=i["eventObject"];this.nodes={main:t,sort:null};this.delete=this.delete.bind(this);this.__sortDD=this.__sortDD.bind(this);this.onbxdragstart=this.onbxdragstart.bind(this);this.onbxdragstop=this.onbxdragstop.bind(this);this.onbxdrag=this.onbxdrag.bind(this);this.onbxdraghout=this.onbxdraghout.bind(this);this.onbxdestdraghover=this.onbxdestdraghover.bind(this);this.onbxdestdraghout=this.onbxdestdraghout.bind(this);this.onbxdestdragfinish=this.onbxdestdragfinish.bind(this);BX.addCustomEvent(this.eventObject,"onEntityHasBeenSorted",this.__sortDD);this.init(i);e.repo.set(this.id,this)};e.repo=new Map;e.getByFullId=function(t){return e.repo.get(t)};e.deleteByFullId=function(t){return e.repo.delete(t)};e.prototype={init:function(t){},bind:function(t){var e,i,s;if(BX(t)){e=BX.findChildren(t,{attribute:"data-bx-action"},true);if(t.hasAttribute("data-bx-action")){e.unshift(t)}}else{e=BX.findChildren(this.nodes.main,{attribute:"data-bx-action"},true)}for(i=0;i<e.length;i++){if(!e[i].hasAttribute("data-bx-bo und")){s="__"+e[i].getAttribute("data-bx-action");if(typeof this[s]==="function"){e[i].setAttribute("data-bx-bound","Y");BX.bind(e[i],"click",this[s].bind(this))}}}this.nodes.main["entityId"]=this.getFullId()},initDD:function(){if(window["jsDD"]&&!this.nodes.main.hasAttribute("data-bx-drag-sensitive")){var t=BX.findChildren(this.nodes.main,{attribute:"data-bx-action"},true),e;for(e=0;e<t.length;e++){if(t[e].getAttribute("data-bx-action")==="sortDD"&&!t[e].hasAttribute("data-bx-bound-dd")&&t[e].getAttribute("data-bx-bound")==="Y"){BX.unbindAll(t[e],"click");this.nodes.dd=t[e];this.nodes.dd.setAttribute("data-bx-bound-dd","Y");this.nodes.dd["entityId"]=this.getFullId();BX.addClass(this.nodes.dd,"bx-drag-draggable");this.nodes.main.hasAttribute("data-bx-drag-sensitive","Y");BX.addClass(this.nodes.main,"bx-drag-drag-sensitive");window.jsDD.registerObject(this.nodes.dd);this.nodes.dd.onbxdragstart=this.onbxdragstart;this.nodes.dd.onbxdragstop=this.onbxdragstop;this.nodes.dd.onbxdrag=this.onbxdrag;this.nodes.dd.onbxdraghout=this.onbxdraghout;window.jsDD.registerDest(this.nodes.main);this.nodes.main.onbxdestdraghover=this.onbxdestdraghover;this.nodes.main.onbxdestdraghout=this.onbxdestdraghout;this.nodes.main.onbxdestdragfinish=this.onbxdestdragfinish;var i=BX.findChild(this.nodes.main,{tagName:"INPUT",props:{type:"text"}},true,true);for(e=0;e<=i.length;e++){BX.bind(i[e],"mousedown",BX.eventCancelBubble)}}}}},getSort:function(){if(!this.__sort)this.__sort=parseInt(this.nodes["sort"].value);return this.__sort},setSort:function(t){this.__sort=this.nodes["sort"].value=parseInt(t)},__sortDD:function(t,e,i,s){if(BX.type.isInteger(t)&&i.getGroupId()===this.getGroupId()){if(this===i){this.setSort(e)}else if(t>e){if(e<=this.getSort()&&this.getSort()<=t){this.setSort(this.getSort()+10)}}else if(t<e){if(t<this.getSort()&&this.getSort()<=e){this.setSort(this.getSort()-10)}}}},__sortDown:function(){if(this.nodes.main.nextSibling&&this.nodes.main.nextSibling["entityId"]){var t=e.getByFullId(this.nodes.main.nextSibling["entityId"]);this.nodes.main.parentNode.insertBefore(this.nodes.main.nextSibling,this.nodes.main);BX.onCustomEvent(this.eventObject,"onEntityHasBeenSorted",[this.getSort(),t.getSort(),this,t])}},__sortUp:function(){if(this.nodes.main.previousSibling&&this.nodes.main.previousSibling["entityId"]){var t=e.getByFullId(this.nodes.main.previousSibling["entityId"]);this.nodes.main.parentNode.insertBefore(this.nodes.main,this.nodes.main.previousSibling);BX.onCustomEvent(this.eventObject,"onEntityHasBeenSorted",[this.getSort(),t.getSort(),this,t])}},getFullId:function(t){return t===true?this.id.join("_"):this.id},getId:function(){return this.id[1]},getGroupId:function(){return this.id[0]},delete:function(){var t=[],i,s=this.getSort();for(i in this.nodes){if(this.nodes.hasOwnProperty(i)){t.push(i)}}for(i=0;i<=t.length;i++){if(this.nodes.hasOwnProperty(t[i])){this.nodes[t[i]]=null;delete this.nodes[t[i]]}}e.deleteByFullId(this.getFullId());BX.onCustomEvent(this,"onEntityHasBeenDeleted",[this.getFullId(),s,this])},onbxdragstart:function(){var t=BX.create("DIV",{attrs:{className:"bx-drag-object"},style:{position:"absolute",zIndex:10,width:this.nodes.main.parentNode.clientWidth+"px"},html:this.nodes.main.outerHTML.replace(new RegExp(this.nodes.main.getAttribute("id"),"gi"),"DragCopy")});this.nodes.drag=t;this.nodes.dd["entitySort"]=this.getSort();this.dragPos={main:BX.pos(this.nodes.main),parent:BX.pos(this.nodes.main.parentNode)};document.body.appendChild(this.nodes.drag);BX.addClass(this.nodes.main,"bx-drag-source");t=null},onbxdragstop:function(){if(this.dragPos){BX.removeClass(this.nodes.main,"bx-drag-source");this.nodes.drag.parentNode.removeChild(this.nodes.drag);this.nodes.drag=null;delete this.nodes.drag;delete this.dragPos}return true},onbxdrag:function(t,e){if(this.nodes.drag){if(this.dragPos){if(!this.dragPos.main.deltaX)this.dragPos.main.deltaX=this.dragPos.main.left-t;if(!this.dragPos.main.deltaY)this.dragPos.main.deltaY=this.dragPos.main.top-e;t+=this.dragPos.main.deltaX;e+=this.dragPos.main.deltaY;e=Math.min(Math.max(e,this.dragPos.parent.top),this.dragPos.parent.bottom)}this.nodes.drag.style.left=t+"px";this.nodes.drag.style.top=e+"px"}},onbxdraghout:function(){},onbxdestdraghover:function(t){if(this.nodes.dd!==t){var e=parseInt(t["entitySort"]);if(this.getSort()<e)BX.addClass(this.nodes.main,"bx-drag-over-up");else BX.addClass(this.nodes.main,"bx-drag-over-down")}},onbxdestdraghout:function(){BX.removeClass(this.nodes.main,"bx-drag-over-up");BX.removeClass(this.nodes.main,"bx-drag-over-down")},onbxdestdragfinish:function(t){BX.removeClass(this.nodes.main,"bx-drag-over-up");BX.removeClass(this.nodes.main,"bx-drag-over-down");if(this.nodes.dd!==t){var i=e.getByFullId(t["entityId"]);if(i.getGroupId()===this.getGroupId()){var s=parseInt(t["entitySort"]);if(this.getSort()<s){this.nodes.main.parentNode.insertBefore(i.nodes.main,this.nodes.main);BX.onCustomEvent(this.eventObject,"onEntityHasBeenSorted",[i.getSort(),this.getSort(),i,this])}else{if(this.nodes.main.nextSibling)this.nodes.main.parentNode.insertBefore(i.nodes.main,this.nodes.main.nextSibling);else this.nodes.main.parentNode.appendChild(i.nodes.main);BX.onCustomEvent(this.eventObject,"onEntityHasBeenSorted",[i.getSort(),this.getSort(),i,this])}}}}};var i=function(e,s){this.answers=new t({maxCount:s["maxAnswersCount"]});this.visibleId=0;i.superclass.constructor.apply(this,arguments);this.nodes.sort=BX.findChild(this.nodes["main"],{attribute:{"data-bx-question-field":"C_SORT"}},true)};BX.extend(i,e);i.prototype.init=function(t){this.nodes.answerList=BX.findChild(this.nodes.main,{attribute:{"data-bx-role":"answer-list"}},true);var e=BX.findChild(this.nodes.answerList,{tagName:"LI",attribute:{"data-bx-role":"answer"}},false,true),i,n;for(i=0;i<e.length;i++){n=new s(e[i],{eventObject:t["eventObject"],groupId:this.getId()});this.answers.set(n.getId(),n);this.visibleId++}this.bind();this.initDD();this.addAnswer=this.addAnswer.bind(this);this.toggleAddNode=this.toggleAddNode.bind(this);this.toggleAddNode(null,null);BX.addCustomEvent(this.eventObject,"onAnswerHasBeenAdded",this.toggleAddNode);BX.addCustomEvent(this.eventObject,"onAnswerHasBeenDeleted",this.toggleAddNode)};i.prototype.toggleAddNode=function(t,e){if(e===null||e.getGroupId()===this.getId()){var i=BX.findChild(this.nodes["main"],{attribute:{"data-bx-action":"adda"}},true,true),s;for(s=0;s<i.length;s++){BX.unbind(i[s],"focus",this.addAnswer)}if(this.answers.canAdd()){BX.bind(i[i.length-1],"focus",this.addAnswer)}}};i.prototype.addAnswer=function(){var t=this.answers.getNextId(),e={"#Q#":this.getId(),"#A#":t,"#A_FIELD_TYPE#":BX("multi_"+this.getId())&&BX("multi_"+this.getId()).checked?"1":"0","#A_VALUE#":"","#A_C_SORT#":this.answers.getMaxSort()+10,"#A_PH#":++this.visibleId},i=BX.message("VOTE_TEMPLATE_ANSWER"),n;for(n in e){if(e.hasOwnProperty(n)){i=i.replace(new RegExp(n,"gi"),e[n])}}var d=BX.create("DIV",{html:i}).firstChild;this.nodes.answerList.appendChild(d);var o=new s(d,{eventObject:this.eventObject,groupId:this.getId()});this.bind(d);this.initDD(d);this.answers.set(o.getId(),o);BX.onCustomEvent(this.eventObject,"onAnswerHasBeenAdded",[o.getFullId(),o])};i.prototype.__delq=function(){var t=BX.findChild(this.nodes.main,{attribute:{"data-bx-question-field":"MESSAGE"}},true);if(!t||t.value===""||confirm(BX.message("VVE_QUESTION_DELETE"))){var e=this.answers.keys(),i=e.next();t=this.nodes.main;while(!i.done){this.answers.get(i.value).delete();i=e.next()}this.delete();t.parentNode.removeChild(t);BX.onCustomEvent(this.eventObject,"onQuestionHasBeenDeleted",[this.getFullId(),this])}};var s=function(t,e){s.superclass.constructor.apply(this,arguments);this.nodes.sort=BX.findChild(this.nodes["main"],{attribute:{"data-bx-answer-field":"C_SORT"}},true)};BX.extend(s,e);s.prototype.init=function(t){this.bind();this.initDD(this.nodes.main)};s.prototype.__dela=function(t){var e=BX.findChild(this.nodes.main,{attribute:{"data-bx-answer-field":"MESSAGE"}},true),i;if(!e||e.value===""||confirm(BX.message("VVE_ANS_DELETE"))){e=this.nodes.main;this.delete();e.parentNode.removeChild(e);BX.onCustomEvent(this.eventObject,"onAnswerHasBeenDeleted",[this.getFullId(),this])}};top.BVoteConstructor=window.BVoteConstructor=function(e){this.controller=e.controller;this.questions=new t({maxCount:e["maxQ"]});this.nodes={questionList:BX.findChild(this.controller,{attribute:{"data-bx-role":"question-list"}},true),action:BX.findChild(this.controller,{attribute:{"data-bx-action":"addq"}},true)};this.toggleAddNode=this.toggleAddNode.bind(this);this.visibleId=0;this.maxAnswersCount=e["maxA"];this.init(e)};window.BVoteConstructor.prototype.init=function(){var t=BX.findChild(this.controller,{tagName:"LI",attribute:{"data-bx-role":"question"}},true,true),e,s;for(e=0;e<t.length;e++){s=new i(t[e],{eventObject:this,maxAnswersCount:this.maxAnswersCount});this.questions.set(s.getId(),s)}this.toggleAddNode();BX.addCustomEvent(this,"onQuestionHasBeenAdded",this.toggleAddNode);BX.addCustomEvent(this,"onQuestionHasBeenDeleted",this.toggleAddNode);BX.bind(this.nodes.action,"click",this.addq.bind(this))};window.BVoteConstructor.prototype.toggleAddNode=function(){if(!this.questions.canAdd()){this.nodes.action.style.display="none"}else if(this.nodes.action.style.display==="none"){delete this.nodes.action.style.display}};window.BVoteConstructor.prototype.addq=function(t){BX.PreventDefault(t);if(this.questions.canAdd()){var e=BX.message("VOTE_TEMPLATE_ANSWER").replace(/#A#/gi,0).replace(/#A_PH#/gi,1).replace(/#A_FIELD_TYPE#/gi,"0").replace(/#A_C_SORT#/gi,"10").replace(/#A_VALUE#/gi,"")+BX.message("VOTE_TEMPLATE_ANSWER").replace(/#A#/gi,1).replace(/#A_PH#/gi,2).replace(/#A_FIELD_TYPE#/gi,"0").replace(/#A_C_SORT#/gi,"20").replace(/#A_VALUE#/gi,"");e=BX.create("DIV",{html:BX.message("VOTE_TEMPLATE_QUESTION").replace(/#ANSWERS#/gi,e).replace(/#Q#/gi,this.questions.getNextId()).replace(/#Q_C_SORT#/gi,this.questions.getMaxSort()+10).replace(/#Q_PH#/gi,++this.visibleId).replace(/#Q_VALUE#/gi,"").replace(/#Q_MULTY#/gi,"")});var s=new i(e.firstChild,{eventObject:this,maxAnswersCount:this.maxAnswersCount});s.visibleId=2;this.questions.set(s.getId(),s);this.nodes.questionList.appendChild(e.firstChild);BX.onCustomEvent(this,"onQuestionHasBeenAdded",[s.getFullId(),s])}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/lists.live.feed/templates/.default/script.min.js?172645636918900";s:6:"source";s:70:"/bitrix/components/bitrix/lists.live.feed/templates/.default/script.js";s:3:"min";s:74:"/bitrix/components/bitrix/lists.live.feed/templates/.default/script.min.js";s:3:"map";s:74:"/bitrix/components/bitrix/lists.live.feed/templates/.default/script.map.js";}"*/
BX.namespace("BX.Lists");BX.Lists.LiveFeedClass=function(){var t=function(t){this.ajaxUrl="/bitrix/components/bitrix/lists.live.feed/ajax.php";this.socnetGroupId=t.socnetGroupId;this.randomString=t.randomString;this.listData=t.listData;var s=this;BX.addCustomEvent("onDisplayClaimLiveFeed",function(t){s.init(t)});if(this.listData){var e=[this.listData.ID,this.listData.NAME,this.listData.DESCRIPTION,this.listData.PICTURE,this.listData.CODE];BX.addCustomEvent("BX.Socialnetwork.Livefeed.Post.Form.Tabs:onInitialized",function(t){var s=t.getData().tabsInstance;if(s){s.changePostFormTab("lists",e)}})}};t.prototype.init=function(t){this.manyTemplate=false;this.constantsPopup=null;this.templateId=null;if(t instanceof Array){var s=t[0],e=t[1],i=t[2],a=t[3],o=t[4];this.setPicture(a);this.setTitle(e);this.getList(s,i,o);this.isConstantsTuned(s)}};t.prototype.isConstantsTuned=function(t){BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","isConstantsTuned"),data:{iblockId:t},onsuccess:BX.delegate(function(t){if(t.status=="success"){var s="",e,i=0;for(e in t.templateData){s+=e+",";i++}if(i>1){this.manyTemplate=true}BX("bx-lists-template-id").value=s;if(t.admin===true){this.setResponsible()}else if(t.admin===false){this.notifyAdmin();BX("bx-lists-check-notify-admin").value=1}}else{t.errors=t.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}},this)})};t.prototype.setPicture=function(t){BX("bx-lists-table-td-title-img").innerHTML=t};t.prototype.setTitle=function(t){BX("bx-lists-table-td-title").innerHTML=BX.util.htmlspecialchars(t);BX("bx-lists-title-notify-admin-popup").value=BX.util.htmlspecialchars(t)};t.prototype.getList=function(t,s,e){var i=BX.findChildrenByClassName(BX("bx-lists-store-lists"),"bx-lists-input-list");for(var a=0;a<i.length;a++){if(i[a].value==t){BX.show(BX("bx-lists-div-list-"+i[a].value))}else{BX.hide(BX("bx-lists-div-list-"+i[a].value))}}BX("bx-lists-selected-list").value=t;if(BX("bx-lists-input-list-"+t)){return}BX.Lists.ajax({url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","getList"),method:"POST",dataType:"html",processData:false,data:{iblockId:t,iblockDescription:s,iblockCode:e,socnetGroupId:this.socnetGroupId,randomString:this.randomString},onsuccess:BX.delegate(function(s){BX("bx-lists-store-lists").appendChild(BX.create("input",{props:{id:"bx-lists-input-list-"+t,className:"bx-lists-input-list"},attrs:{type:"hidden",value:t}}));BX("bx-lists-total-div-id").appendChild(BX.create("div",{props:{id:"bx-lists-div-list-"+t,className:"bx-lists-div-list"},attrs:{style:"display: block;"},html:s}));var e=BX.processHTML(s);BX.ajax.processScripts(e.SCRIPT)},this)});BX.unbindAll(BX("blog-submit-button-save"));BX.bind(BX("blog-submit-button-save"),"click",BX.proxy(function(t){this.submitForm(t)},this))};t.prototype.addNewFileTableRow=function(t,s,e,i){var a=document.getElementById(t);var o=a.rows.length;var n=a.insertRow(o);for(var l=0;l<s;l++){var r=n.insertCell(l);var p=a.rows[o-1].cells[l].innerHTML;var d=document.createElement("div");d.innerHTML=p;d.firstChild.lastChild.innerHTML="";p=d.innerHTML;r.innerHTML=p.replace(e,function(t){return t.replace("[n"+arguments[i]+"]","[n"+(1+parseInt(arguments[i]))+"]")})}};t.prototype.getNameInputFile=function(){var t=document.getElementsByClassName("bx-lists-input-file");for(var s=0;s<t.length;s++){var e=t[s].getElementsByTagName("input");for(var i=0;i<e.length;i++){e[i].onchange=getName}}};t.prototype.createAdditionalHtmlEditor=function(t,s,e){var i=document.getElementById(t);var a=i.rows.length;var o=i.insertRow(a);var n=o.insertCell(0);var l=i.rows[a-1].cells[0].innerHTML;var r=0;while(true){var p=l.indexOf("[n",r);if(p<0)break;var d=l.indexOf("]",p);if(d<0)break;var u=parseInt(l.substr(p+2,d-p));l=l.substr(0,p)+"[n"+ ++u+"]"+l.substr(d+1);r=p+1}var r=0;while(true){var p=l.indexOf("__n",r);if(p<0)break;var d=l.indexOf("_",p+2);if(d<0)break;var u=parseInt(l.substr(p+3,d-p));l=l.substr(0,p)+"__n"+ ++u+"_"+l.substr(d+1);r=d+1}n.innerHTML=l;var c="id_"+s+"__n"+a+"_";var m=s+"[n"+a+"][VALUE]";window.BXHtmlEditor.Show({id:c,inputName:m,name:m,content:"",width:"100%",height:"200",allowPhp:false,limitPhpAccess:false,templates:[],templateId:"",templateParams:[],componentFilter:"",snippets:[],placeholder:"Text here...",actionUrl:"/bitrix/tools/html_editor_action.php",cssIframePath:"/bitrix/js/fileman/html_editor/iframe-style.css?1412693817",bodyClass:"",bodyId:"",spellcheck_path:"/bitrix/js/fileman/html_editor/html-spell.js?v=1412693817",usePspell:"N",useCustomSpell:"Y",bbCode:false,askBeforeUnloadPage:false,settingsKey:"user_settings_1",showComponents:true,showSnippets:true,view:"wysiwyg",splitVertical:false,splitRatio:"1",taskbarShown:false,taskbarWidth:"250",lastSpecialchars:false,cleanEmptySpans:true,lazyLoad:false,showTaskbars:false,showNodeNavi:false,controlsMap:[{id:"Bold",compact:true,sort:"80"},{id:"Italic",compact:true,sort:"90"},{id:"Underline",compact:true,sort:"100"},{id:"Strikeout",compact:true,sort:"110"},{id:"RemoveFormat",compact:true,sort:"120"},{id:"Color",compact:true,sort:"130"},{id:"FontSelector",compact:false,sort:"135"},{id:"FontSize",compact:false,sort:"140"},{separator:true,compact:false,sort:"145"},{id:"OrderedList",compact:true,sort:"150"},{id:"UnorderedList",compact:true,sort:"160"},{id:"AlignList",compact:false,sort:"190"},{separator:true,compact:false,sort:"200"},{id:"InsertLink",compact:true,sort:"210"},{id:"InsertImage",compact:false,sort:"220"},{id:"InsertVideo",compact:true,sort:"230"},{id:"InsertTable",compact:false,sort:"250"},{id:"Smile",compact:false,sort:"280"},{separator:true,compact:false,sort:"290"},{id:"Fullscreen",compact:false,sort:"310"},{id:"More",compact:true,sort:"400"}],autoResize:true,autoResizeOffset:"40",minBodyWidth:"350",normalBodyWidth:"555"});var B=BX.findChildrenByClassName(BX(t),"bx-html-editor");for(var b in B){var f=B[b].getAttribute("id");var X=BX.findChildrenByClassName(BX(f),"bx-editor-iframe");if(X.length>1){for(var h=0;h<X.length-1;h++){X[h].parentNode.removeChild(X[h])}}}};t.prototype.createSettingsDropdown=function(t){BX.PreventDefault(t);BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","createSettingsDropdown"),data:{iblockId:BX("bx-lists-selected-list").value,randomString:this.randomString},onsuccess:BX.delegate(function(t){if(t.status=="success"){var s=BX.PopupMenu.getMenuById("settings-lists");if(s&&s.popupWindow){if(s.popupWindow.isShown()){BX.PopupMenu.destroy("settings-lists");return}}BX.PopupMenu.show("settings-lists",BX("bx-lists-settings-btn"),t.settingsDropdown,{autoHide:true,offsetTop:0,offsetLeft:0,angle:{offset:15},events:{onPopupClose:function(){}}})}else{t.errors=t.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}},this)})};t.prototype.setDelegateResponsible=function(){if(BX.PopupWindowManager.getCurrentPopup()){BX.PopupWindowManager.getCurrentPopup().close()}var t=BX.Lists.hide,s=BX.Lists.addToLinkParam,e=BX.Lists.showModalWithStatusAction,i=this.ajaxUrl;BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","checkDelegateResponsible"),data:{iblockId:BX("bx-lists-selected-list").value},onsuccess:BX.delegate(function(t){if(t.status=="success"){BX.show(BX("feed-add-lists-right"));BX.Lists.modalWindow({modalId:"bx-lists-popup",title:BX.message("LISTS_SELECT_STAFF_SET_RIGHT"),draggable:true,overlay:false,autoHide:false,contentStyle:{width:"600px",paddingTop:"10px",paddingBottom:"10px"},content:[BX("feed-add-lists-right")],events:{onPopupClose:function(){BX.hide(BX("feed-add-lists-right"));BX("bx-lists-total-div-id").appendChild(BX("feed-add-lists-right"))},onAfterPopupShow:function(t){BX.PopupMenu.destroy("settings-lists")}},buttons:[BX.create("a",{text:BX.message("LISTS_SAVE_BUTTON_SET_RIGHT"),props:{className:"webform-small-button webform-small-button-accept"},events:{click:BX.delegate(function(t){var a=BX.findChildrenByClassName(BX("feed-add-post-lists-item"),"feed-add-post-lists"),o=[];for(var n=0;n<a.length;n++){o.push(a[n].getAttribute("data-id"))}BX.Lists.ajax({method:"POST",dataType:"json",url:s(i,"action","setDelegateResponsible"),data:{iblockId:BX("bx-lists-selected-list").value,selectUsers:o},onsuccess:function(t){if(t.status=="success"){BX.PopupWindowManager.getCurrentPopup().close();e({status:"success",message:t.message})}else{BX.PopupWindowManager.getCurrentPopup().close();t.errors=t.errors||[{}];e({status:"error",message:t.errors.pop().message})}}})},this)}}),BX.create("a",{text:BX.message("LISTS_CANCEL_BUTTON_SET_RIGHT"),props:{className:"webform-small-button webform-button-cancel"},events:{click:BX.delegate(function(t){BX.PopupWindowManager.getCurrentPopup().close()},this)}})]});for(var a in t.listUser){var o=BX.findChildrenByClassName(BX("feed-add-post-lists-item"),"feed-add-post-lists");for(var n in o){if(t.listUser[a].id==o[n].getAttribute("data-id")){delete t.listUser[a]}}BXfpListsSelectCallback(t.listUser[a])}}else{t.errors=t.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}},this)})};t.prototype.jumpSettingProcess=function(){BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","checkPermissions"),data:{iblockId:BX("bx-lists-selected-list").value},onsuccess:BX.delegate(function(t){if(t.status=="success"){document.location.href=BX("bx-lists-lists-page").value+BX("bx-lists-selected-list").value+"/edit/"}else{t.errors=t.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}},this)})};t.prototype.jumpProcessDesigner=function(){BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","getBizprocTemplateId"),data:{iblockId:BX("bx-lists-selected-list").value},onsuccess:BX.delegate(function(t){if(t.status=="success"){var s;if(t.manyTemplate){var e="<p>"+BX.message("LISTS_DESIGNER_POPUP_DESCRIPTION")+"</p>";for(s in t.templateData){var i=BX("bx-lists-lists-page").value+BX("bx-lists-selected-list").value+"/bp_edit/"+t.templateData[s].ID+"/";e+='<a href="'+i+'"><div class="bx-lists-designer-item">'+t.templateData[s].NAME+"</div></a>"}e+="";BX("bx-lists-designer-template-popup-content").innerHTML=e;BX.Lists.modalWindow({modalId:"bx-lists-popup",title:BX.message("LISTS_DESIGNER_POPUP_TITLE"),draggable:true,overlay:false,contentStyle:{width:"400px",paddingTop:"10px",paddingBottom:"10px"},content:[BX("bx-lists-designer-template-popup-content")],events:{onPopupClose:function(){BX("bx-lists-designer-template-popup-content").innerHTML="";BX("bx-lists-designer-template-popup").appendChild(BX("bx-lists-designer-template-popup-content"))},onAfterPopupShow:function(t){BX.PopupMenu.destroy("settings-lists")}},buttons:[BX.create("a",{text:BX.message("LISTS_CANCEL_BUTTON_CLOSE"),props:{className:"webform-small-button webform-button-cancel"},events:{click:BX.delegate(function(t){BX.PopupWindowManager.getCurrentPopup().close()},this)}})]})}else{for(s in t.templateData){document.location.href=BX("bx-lists-lists-page").value+BX("bx-lists-selected-list").value+"/bp_edit/"+t.templateData[s].ID+"/"}}}else{t.errors=t.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}},this)})};t.prototype.notify=function(t){BX("bx-lists-notify-button-"+t).setAttribute("onclick","");var s="/",e=null;if(BX("bx-lists-select-site-dir")){s=BX("bx-lists-select-site-dir").value}if(BX("bx-lists-select-site-id")){e=BX("bx-lists-select-site-id").value}BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","notifyAdmin"),data:{iblockId:BX("bx-lists-selected-list").value,iblockName:BX("bx-lists-title-notify-admin-popup").value,userId:t,siteDir:s,siteId:e},onsuccess:BX.delegate(function(s){if(s.status=="success"){BX.Lists.removeElement(BX("bx-lists-notify-button-"+t));BX("bx-lists-notify-success-"+t).innerHTML=s.message}else{BX("bx-lists-notify-button-"+t).setAttribute("onclick",'BX.Lists["LiveFeedClass_'+this.randomString+'"].notify('+t+")");s.errors=s.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:s.errors.pop().message})}},this)})};t.prototype.notifyAdmin=function(){BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","getListAdmin"),data:{iblockId:BX("bx-lists-selected-list").value},onsuccess:BX.delegate(function(t){if(t.status=="success"){var s='<span class="bp-question"><span>!</span>'+BX.message("LISTS_NOTIFY_ADMIN_TITLE_WHY").replace("#NAME_PROCESSES#",BX("bx-lists-title-notify-admin-popup").value)+"</span>";s+="<p>"+BX.message("LISTS_NOTIFY_ADMIN_TEXT_ONE").replace("#NAME_PROCESSES#",BX("bx-lists-title-notify-admin-popup").value)+"</p>";s+="<p>"+BX.message("LISTS_NOTIFY_ADMIN_TEXT_TWO").replace("#NAME_PROCESSES#",BX("bx-lists-title-notify-admin-popup").value)+"</p>";s+='<span class="bp-question-title">'+BX.message("LISTS_NOTIFY_ADMIN_MESSAGE")+"</span>";for(var e in t.listAdmin){var i="";if(t.listAdmin[e].img){i='<img src="'+t.listAdmin[e].img+'" alt="">'}s+='<div class="bp-question-item"><a href="#" class="bp-question-item-avatar"><span class="bp-question-item-avatar-inner">'+i+'</span></a><span class="bp-question-item-info"><span>'+t.listAdmin[e].name+"</span></span>"+'<span id="bx-lists-notify-success-'+t.listAdmin[e].id+'" class="bx-lists-notify-success"></span>'+'<a id="bx-lists-notify-button-'+t.listAdmin[e].id+'" href="#" onclick=\'BX.Lists["LiveFeedClass_'+this.randomString+'"].notify('+t.listAdmin[e].id+');\' class="webform-small-button bp-small-button webform-small-button-blue">'+""+BX.message("LISTS_NOTIFY_ADMIN_MESSAGE_BUTTON")+"</a></div>"}BX("bx-lists-notify-admin-popup-content").innerHTML=s;BX.Lists.modalWindow({modalId:"bx-lists-popup",title:BX("bx-lists-title-notify-admin-popup").value,draggable:true,overlay:false,contentStyle:{width:"600px",paddingTop:"10px",paddingBottom:"10px"},content:[BX("bx-lists-notify-admin-popup-content")],events:{onPopupClose:function(){BX("bx-lists-notify-admin-popup-content").innerHTML="";BX("bx-lists-notify-admin-popup").appendChild(BX("bx-lists-notify-admin-popup-content"))},onAfterPopupShow:function(t){BX.PopupMenu.destroy("settings-lists")}},buttons:[BX.create("a",{text:BX.message("LISTS_CANCEL_BUTTON_CLOSE"),props:{className:"webform-small-button webform-button-cancel"},events:{click:BX.delegate(function(t){BX.PopupWindowManager.getCurrentPopup().close()},this)}})]})}else{t.errors=t.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}},this)})};t.prototype.setResponsible=function(t){this.templateId=t;BX.Lists.ajax({method:"POST",dataType:"json",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","checkPermissions"),data:{iblockId:BX("bx-lists-selected-list").value},onsuccess:BX.delegate(function(t){if(t.status==="success"){BX.Lists.ajax({url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","setResponsible"),method:"POST",dataType:"html",data:{iblockId:BX("bx-lists-selected-list").value,randomString:this.randomString,templateId:this.templateId},onsuccess:BX.delegate(function(t){this.showConstantsPopup(t)},this)})}else{if(BX("bx-lists-check-notify-admin").value){this.notifyAdmin()}else{t.errors=t.errors||[{}];BX.Lists.showModalWithStatusAction({status:"error",message:t.errors.pop().message})}}},this)})};t.prototype.showConstantsPopup=function(t){if(BX.PopupWindowManager.getCurrentPopup())BX.PopupWindowManager.getCurrentPopup().close();if(this.manyTemplate&&!this.templateId){this.constantsPopup=BX.Lists.modalWindow({modalId:"bx-lists-popup",title:BX.message("LISTS_DESIGNER_POPUP_TITLE"),overlay:false,draggable:true,contentStyle:{width:"600px",paddingBottom:"10px"},content:[this.getConstantsForm(t)],events:{onPopupClose:function(){this.constantsPopup=null}.bind(this),onAfterPopupShow:function(t){BX.PopupMenu.destroy("settings-lists")}},buttons:[BX.create("a",{text:BX.message("LISTS_CANCEL_BUTTON_CLOSE"),props:{className:"webform-small-button webform-button-cancel"},events:{click:BX.delegate(function(t){if(!!this.constantsPopup)this.constantsPopup.close()},this)}})]})}else{this.constantsPopup=BX.Lists.modalWindow({modalId:"bx-lists-popup",title:BX.message("LISTS_SELECT_STAFF_SET_RESPONSIBLE"),overlay:false,draggable:true,withoutWindowManager:true,contentStyle:{width:"600px",paddingBottom:"10px"},content:[this.getConstantsForm(t)],events:{onPopupClose:function(){this.constantsPopup=null}.bind(this),onAfterPopupShow:function(t){BX.PopupMenu.destroy("settings-lists")}},buttons:[BX.create("a",{text:BX.message("LISTS_SAVE_BUTTON_SET_RIGHT"),props:{className:"webform-small-button webform-small-button-accept"},events:{click:BX.delegate(function(t){var s=BX.findChild(BX("bx-lists-set-responsible-content"),{tag:"FORM"},true);if(s){s.modalWindow=this.constantsPopup;s.onsubmit(s,t)}},this)}}),BX.create("a",{text:BX.message("LISTS_CANCEL_BUTTON_SET_RIGHT"),props:{className:"webform-small-button webform-button-cancel"},events:{click:BX.delegate(function(t){if(!!this.constantsPopup)this.constantsPopup.close()},this)}})]})}};t.prototype.getConstantsForm=function(t){return BX.create("div",{children:[BX.create("div",{props:{id:"bx-lists-set-responsible-content",className:"bx-lists-set-responsible-content"},html:t})]})};t.prototype.submitForm=function(t){BX.unbindAll(BX("blog-submit-button-save"));if(BX("feed-add-post-content-lists").style.display==="none"){BX.bind(BX("blog-submit-button-save"),"click",submitBlogPostForm())}BX.addClass(BX("blog-submit-button-save"),"ui-btn-clock");var s=BX.findChildrenByClassName(BX("bx-lists-store-lists"),"bx-lists-input-list");for(var e=0;e<s.length;e++){if(s[e].value!==BX("bx-lists-selected-list").value){BX.Lists.removeElement(BX("bx-lists-div-list-"+s[e].value));BX.Lists.removeElement(BX("bx-lists-input-list-"+s[e].value))}}BX.ajax.submitAjax(BX("blogPostForm"),{method:"POST",url:BX.Lists.addToLinkParam(this.ajaxUrl,"action","checkDataElementCreation"),processData:true,onsuccess:BX.delegate(function(t){var s=BX.parseJSON(t,{});if(s!==null&&s!==undefined){if(s.status==="success"){BX.bind(BX("blog-submit-button-save"),"click",submitBlogPostForm())}else{BX.removeClass(BX("blog-submit-button-save"),"ui-btn-clock");BX("bx-lists-block-errors").innerHTML=s.errors.pop().message;BX.show(BX("bx-lists-block-errors"));BX.bind(BX("blog-submit-button-save"),"click",BX.proxy(function(t){this.submitForm(t)},this))}}else{BX.removeClass(BX("blog-submit-button-save"),"ui-btn-clock");BX("bx-lists-block-errors").innerHTML=t;BX.show(BX("bx-lists-block-errors"));BX.bind(BX("blog-submit-button-save"),"click",BX.proxy(function(t){this.submitForm(t)},this))}},this)});t.preventDefault()};t.prototype.errorPopup=function(t){BX.Lists.showModalWithStatusAction({status:"error",message:t})};return t}();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/ui.tile.selector/templates/.default/script.min.js?172645644914347";s:6:"source";s:71:"/bitrix/components/bitrix/ui.tile.selector/templates/.default/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/ui.tile.selector/templates/.default/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/ui.tile.selector/templates/.default/script.map.js";}"*/
(function(t){BX.namespace("BX.UI");if(BX.UI.TileSelector){return}var e=[];function i(t){this.id=t.id;this.name=t.name||null;this.node=t.node;this.data=t.data;this.removeNode=null;this.nameNode=o.getNode("tile-item-name",this.node);if(!this.name){this.name=this.nameNode.textContent}}i.prototype.changeRemoving=function(t){if(!this.removeNode){return}this.removeNode.style.display=t?"":"none"};function n(t){this.init(t)}n.prototype.events={containerClick:"container-click",tileClick:"tile-click",tileRemove:"tile-remove",tileEdit:"tile-edit",tileAdd:"tile-add",buttonAdd:"add",buttonSelect:"select",buttonSelectFirst:"select-first",search:"search",input:"input",searcherCategoryClick:"popup-category-click",searcherItemClick:"popup-item-click",searcherInit:"popup-search-init"};n.getById=function(t){var i=e.filter(function(e){return e.id===t&&document.body.contains(e.context)});return i.length>0?i[0]:null};n.getList=function(){return e};n.prototype.init=function(t){this.list=[];this.id=t.id;this.context=BX(t.containerId);this.duplicates=t.duplicates;this.multiple=t.multiple;this.readonly=t.readonly;this.manualInputEnd=t.manualInputEnd;this.caption=t.caption;this.captionMore=t.captionMore;this.tilesLimit=!!t.tilesLimit?parseInt(t.tilesLimit):10;this.attributeId="data-bx-id";this.attributeData="data-bx-data";this.tileContainer=o.getNode("tile-container",this.context);this.tileTemplate=o.getNode("tile-template",this.context);this.input=o.getNode("tile-input",this.context);this.buttonAdd=o.getNode("tile-add",this.context);this.buttonSelect=o.getNode("tile-select",this.context);this.buttonMore=o.getNode("tile-more",this.context);if(!this.context||!this.input){return}o.getNodes("tile-item",this.context).forEach(this.initNode.bind(this));if(!this.readonly){this.initEventHandlers()}this.searcher=null;e.push(this)};n.prototype.initEventHandlers=function(){if(this.buttonAdd){BX.bind(this.buttonAdd,"click",this.onButtonAdd.bind(this))}if(this.context){BX.bind(this.context,"click",this.onContainerClick.bind(this))}if(this.buttonSelect){BX.bind(this.buttonSelect,"click",this.onButtonSelect.bind(this));BX.bind(this.tileContainer,"click",this.onButtonSelect.bind(this))}BX.bind(this.input,"input",this.onInput.bind(this));if(this.buttonMore){BX.bind(this.buttonMore,"click",this.onButtonMore.bind(this))}if(!this.manualInputEnd){BX.bind(this.input,"blur",this.onInputEnd.bind(this));o.handleKeyEnter(this.input,this.onInputEnd.bind(this))}BX.bind(this.input,"keydown",function(t){if(t.key==="Enter"){t.preventDefault();t.stopPropagation();return false}})};n.prototype.getSearchInput=function(){return this.input};n.prototype.isSearcherInit=function(){return!!this.searcher};n.prototype.clearSearcher=function(){this.isButtonSelectFired=false;if(this.searcher){this.searcher.hide();this.searcher=null}};n.prototype.hideSearcher=function(){this.searcher.hide()};n.prototype.showSearcher=function(t){if(!this.searcher){this.searcher=new s({id:this.id,caller:this,context:this.context,title:t||""});this.fire(this.events.searcherInit,[this.searcher])}this.searcher.filterByName();this.searcher.show()};n.prototype.setSearcherData=function(t){if(!this.searcher){this.showSearcher()}this.searcher.setCategories(t)};n.prototype.initNode=function(t){if(!t){return null}var e=t.getAttribute(this.attributeId);var n=t.getAttribute(this.attributeData);try{n=JSON.parse(n)}catch(t){try{n=JSON.parse(BX.util.htmlspecialcharsback(n))}catch(t){n={}}}var s=new i({id:e,node:t,data:n});if(s.id&&!this.duplicates&&this.findDuplicates(s.id)){s=null;return null}s.removeNode=o.getNode("remove",t);if(s.removeNode){BX.bind(s.removeNode,"click",this.onRemove.bind(this,s))}BX.bind(t,"click",this.onClick.bind(this,s));this.list.push(s);return s};n.prototype.onRemove=function(t,e){e.preventDefault();e.stopPropagation();this.removeTile(t);if(BX.UI.SelectorManager){var i=BX.UI.SelectorManager.instances[this.id];if(i&&i.callback.unSelect){if(BX.type.isNotEmptyObject(t.data)&&BX.type.isNotEmptyString(t.data.entityType)){i.callback.unSelect({item:i.entities[t.data.entityType.toUpperCase()].items[t.id.match(/^\d+$/)?"U"+t.id:t.id],entityType:t.data.entityType,selectorId:i.id})}}}return false};n.prototype.onClick=function(t,e){e.preventDefault();e.stopPropagation();this.fire(this.events.tileClick,[t])};n.prototype.removeTiles=function(){var t=this.list;t.forEach(this.removeTile.bind(this))};n.prototype.removeTile=function(t){this.list=BX.util.deleteFromArray(this.list,this.list.indexOf(t));BX.remove(t.node);this.fire(this.events.tileRemove,[t]);this.recalcButtonSelectText();if(this.buttonMore.style.display!="none"){this.recalcMore()}};n.prototype.recalcMore=function(){if(this.checkTilesLimit({action:"remove"})){this.buttonMore.style.display="none"}o.getNodes("tile-item",this.context).forEach(function(t,e){t.style.display=e>=this.tilesLimit?"none":""}.bind(this))};n.prototype.getTile=function(t){var e=this.list.filter(function(e){return e.id===t});return e.length>0?e[0]:null};n.prototype.getTilesData=function(){return this.list.map(function(t){return t.data})};n.prototype.getTilesId=function(){return this.list.map(function(t){return t.id}).filter(function(t){return!!t})};n.prototype.getTiles=function(){return this.list};n.prototype.findDuplicates=function(t){var e=this.getTile(t);if(!e){return false}this.removeTile(e)};n.prototype.addTile=function(t,e,i,n,s){if(!t||this.readonly){return null}i=i||"";if(!this.multiple){if(this.isSearcherInit()){this.hideSearcher()}if(this.list.length>0){var r=this.list[0];if(r&&r.id==i){return}}this.removeTiles()}e=e||{};s=s||"";n=n||"";var a=this.tileTemplate;if(!a){return null}a=a.innerHTML;var l="";if(s){l+="color: "+BX.util.htmlspecialchars(s)+"; "}if(n){l+="background-color: "+BX.util.htmlspecialchars(n)+"; "}if(BX.type.isNotEmptyString(e.state)&&e.state=="init"){l+=this.checkTilesLimit({action:"init"})?"":"display: none;"}var c=BX.type.isNotEmptyString(e.entityType)?e.entityType.toLowerCase():"none";if(!!e.extranet){c+="-extranet"}if(!!e.crmEmail){c+="-crm"}a=o.replace(a,{id:BX.util.htmlspecialchars(i+""),name:BX.util.htmlspecialchars(t),data:BX.util.htmlspecialchars(JSON.stringify(e)),style:l,type:c,readonly:!!e.readonly?"yes":"no"},true);var h=document.createElement("div");h.innerHTML=a;h=h.children[0];var u=this.initNode(h);if(!u){return null}this.buttonMore.parentNode.insertBefore(h,this.buttonMore);this.fire(this.events.tileAdd,[u]);this.recalcButtonSelectText();return u};n.prototype.updateTile=function(t,e,i,n,o){if(!t||this.readonly){return null}e=e||null;i=i||null;n=n||null;o=o||null;if(e){t.nameNode.textContent=e}if(i){t.data=i}if(n||n===null){t.node.style.backgroundColor=n}if(o){t.node.style.color=o}this.fire(this.events.tileEdit,[t]);return t};n.prototype.checkTilesLimit=function(t){var e=true,i=o.getNodes("tile-item",this.context).length,n=BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyString(t.action)?t.action:null;if(i>=this.tilesLimit){e=false;this.buttonMore.style.display="";this.buttonMore.title=BX.message("UI_TILE_SELECTOR_MORE").replace("#NUM#",i-this.tilesLimit+(n=="init"?1:0))}return e};n.prototype.fire=function(t,e){BX.onCustomEvent(this,t,e)};n.prototype.onInput=function(){var t=this.input.value;if(this.searcher&&t.length>0){this.searcher.filterByName(t)}this.fire(this.events.input,[this.input.value])};n.prototype.onInputEnd=function(){var t=this.input.value;this.input.value="";o.changeDisplay(this.input,false);o.changeDisplay(this.buttonSelect,true);this.recalcButtonSelectText();this.fire(this.events.search,[t])};n.prototype.onButtonAdd=function(t){t.preventDefault();t.stopPropagation();this.fire(this.events.buttonAdd,[])};n.prototype.onContainerClick=function(){this.fire(this.events.containerClick,[])};n.prototype.onButtonSelect=function(t){t.preventDefault();t.stopPropagation();o.changeDisplay(this.buttonSelect,false);o.changeDisplay(this.input,true);this.input.focus();this.fire(this.events.buttonSelect,[]);if(!this.isButtonSelectFired){this.fire(this.events.buttonSelectFirst,[]);this.isButtonSelectFired=true}};n.prototype.onButtonMore=function(t){t.preventDefault();t.stopPropagation();o.getNodes("tile-item",this.context).forEach(function(t){t.style.display=""});t.currentTarget.style.display="none"};n.prototype.recalcButtonSelectText=function(){if(!this.buttonSelect){return}var t=this.getTiles();this.buttonSelect.innerHTML=t.length>0?this.captionMore:this.caption};var o={getObjectByKey:function(t,e,i){var n=t.filter(function(t){return t.hasOwnProperty(e)&&t[e]===i});return n.length>0?n[0]:null},getNode:function(t,e){var i=this.getNodes(t,e);return i.length>0?i[0]:null},getNodes:function(t,e){if(!e){return[]}return BX.convert.nodeListToArray(e.querySelectorAll('[data-role="'+t+'"]'))},changeClass:function(t,e,i){if(!t){return}if(i){BX.addClass(t,e)}else{BX.removeClass(t,e)}},changeDisplay:function(t,e){if(!t){return}t.style.display=e?"":"none"},replace:function(t,e,i){e=e||{};i=i||false;if(!t){return""}for(var n in e){if(!e.hasOwnProperty(n)){continue}var o=e[n];o=o||"";if(!i&&o){o=BX.util.htmlspecialchars(o)}t=t.replace(new RegExp("%"+n+"%","g"),o)}return t},handleKeyEnter:function(e,i){if(!i){return}var n=function(e){e=e||t.event;if(e.keyCode===10||e.keyCode===13){e.preventDefault();e.stopPropagation();i();return false}};BX.bind(e,"keyup",n)},getTemplatedNode:function(t,e,i){if(!t){return null}var n=o.replace(t.innerHTML,e,i);var s=document.createElement("div");s.innerHTML=n;return s.children[0]}};function s(t){this.init(t)}s.prototype.classNameCategoryActive="ui-tile-selector-searcher-sidebar-item-selected";s.prototype.classNameItemActive="ui-tile-selector-searcher-content-item-selected";s.prototype.init=function(t){this.id=t.id;this.context=t.context;this.caller=t.caller;this.categories=[];this.items=[];this.currentCategory=null;this.categoryTemplate=o.getNode("popup-category-template",this.context);this.itemTemplate=o.getNode("popup-item-template",this.context);this.content=o.getTemplatedNode(o.getNode("popup-template",this.context));this.loader=o.getNode("popup-loader",this.content);this.categoryContainer=o.getNode("popup-category-list",this.content);this.itemContainer=o.getNode("popup-item-list",this.content);this.itemContainer.innerHTML="";this.categoryContainer.innerHTML="";this.title=o.getNode("popup-title",this.content);if(this.title){this.title.textContent=t.title}if(t.dataList){this.setCategories(t.dataList)}BX.addCustomEvent(this.caller,this.caller.events.tileAdd,this.onTileAdd.bind(this));BX.addCustomEvent(this.caller,this.caller.events.tileRemove,this.onTileRemove.bind(this))};s.prototype.onTileAdd=function(t){var e=o.getObjectByKey(this.items,"id",t.id);if(!e){return}o.changeClass(e.node,this.classNameItemActive,true)};s.prototype.onTileRemove=function(t){var e=o.getObjectByKey(this.items,"id",t.id);if(!e){return}o.changeClass(e.node,this.classNameItemActive,false)};s.prototype.filterByName=function(t){t=t||"";if(t.length<3){o.changeDisplay(this.categoryContainer,true);this.setCurrentCategory();return}var e=new RegExp(BX.util.escapeRegExp(t),"i");this.items.forEach(function(t){o.changeDisplay(t.node,e.test(t.name))});o.changeDisplay(this.categoryContainer,false)};s.prototype.onCategoryClick=function(t){this.setCurrentCategory(t);this.caller.fire(this.caller.events.searcherCategoryClick,[t])};s.prototype.setCurrentCategory=function(t){t=t||this.categories[0];if(this.currentCategory){BX.removeClass(this.currentCategory.node,this.classNameCategoryActive)}this.currentCategory=t;if(!t){return}BX.addClass(this.currentCategory.node,this.classNameCategoryActive);this.items.forEach(function(e){o.changeDisplay(e.node,e.category===t)})};s.prototype.onItemClick=function(t){this.caller.addTile(t.name,t.data,t.id,t.bgcolor,t.color);this.caller.fire(this.caller.events.searcherItemClick,[t])};s.prototype.getCategory=function(t){return o.getObjectByKey(this.categories,"id",t)};s.prototype.getItem=function(t){return o.getObjectByKey(this.items,"id",t)};s.prototype.updateItem=function(t,e,i){if(e){t.node.textContent=e;t.node.title=e}if(i){t.data=i}};s.prototype.addItem=function(t,e,i,n){var s=o.getTemplatedNode(this.itemTemplate,{name:i});var r={category:t,node:s,id:e,name:i,data:n||{}};this.items.push(r);this.itemContainer.appendChild(s);BX.bind(s,"click",this.onItemClick.bind(this,r));return r};s.prototype.setItems=function(t,e){this.items=[];e.forEach(function(e){this.addItem(t,e.id,e.name,e.data)},this)};s.prototype.addItems=function(t,e){e.forEach(function(e){this.addItem(t,e.id,e.name,e.data)},this)};s.prototype.addCategory=function(t,e,i,n){var s=o.getTemplatedNode(this.categoryTemplate,{name:e});var r={node:s,id:t,name:e,data:i||{}};this.categories.push(r);this.categoryContainer.appendChild(s);BX.bind(s,"click",this.onCategoryClick.bind(this,r));this.addItems(r,n);return r};s.prototype.setCategories=function(t){this.items=[];this.categories=[];this.itemContainer.innerHTML="";this.categoryContainer.innerHTML="";t.forEach(function(t){this.addCategory(t.id,t.name,t.data,t.items)},this);if(this.categories.length>0){this.setCurrentCategory(this.categories[0])}var e=this.caller.getTilesId();this.items.filter(function(t){var i=t.id&&BX.util.in_array(t.id,e);o.changeClass(t.node,this.classNameItemActive,i)},this);o.changeDisplay(this.loader,false);o.changeDisplay(this.itemContainer,true);o.changeDisplay(this.categoryContainer,true)};s.prototype.showLoader=function(){o.changeDisplay(this.loader,true)};s.prototype.hide=function(){if(!this.popup){return}this.popup.close()};s.prototype.show=function(){if(this.popup){this.popup.show();return}this.popup=BX.Main.PopupManager.create(this.id,this.context,{width:620,height:290,autoHide:true,lightShadow:true,closeByEsc:true,closeIcon:false,offsetLeft:40,angle:true,buttons:[new BX.UI.CloseButton({onclick:function(){this.popup.close()}.bind(this)})]});this.popup.setContent(this.content);o.changeDisplay(this.content,true);this.popup.show()};BX.UI.TileSelector=n;BX.addCustomEvent("BX.Main.SelectorV2:onGetDataStart",function(t){var e=BX("ui-tile-selector-"+t+"-mask");if(!e){return}e.classList.add("ui-tile-selector-selector-mask-active")});BX.addCustomEvent("BX.Main.SelectorV2:onGetDataFinish",function(t){var e=BX("ui-tile-selector-"+t+"-mask");if(!e){return}e.classList.remove("ui-tile-selector-selector-mask-active")})})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:100:"/bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.min.js?172645635714177";s:6:"source";s:80:"/bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.js";s:3:"min";s:84:"/bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.min.js";s:3:"map";s:84:"/bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.map.js";}"*/
(function(){if(window.IntranetUsers)return;window.IntranetUsers=function(e,t,a){this.name=e;this.multiple=t;this.arSelected=[];this.arFixed=[];this.bSubordinateOnly=a;this.ajaxUrl="";this.lastSearchTime=0};IntranetUsers.arStructure={};IntranetUsers.bSectionsOnly=false;IntranetUsers.arEmployees={group:{}};IntranetUsers.arEmployeesData={};IntranetUsers.ajaxUrl="";IntranetUsers.prototype.loadGroup=function(e){var t=BX(this.name+"_group_section_"+e);function a(t){IntranetUsers.arEmployees["group"][e]=t;this.show(e,t,"g")}e=parseInt(e);if(IntranetUsers.arEmployees["group"][e]!=null){this.show(e,IntranetUsers.arEmployees["group"][e],"g")}else{var s=this.getAjaxUrl()+"&MODE=EMPLOYEES&GROUP_ID="+e;BX.ajax.loadJSON(s,BX.proxy(a,this))}BX.toggleClass(t,"company-department-opened");BX.toggleClass(BX(this.name+"_gchildren_"+e),"company-department-children-opened")};IntranetUsers.prototype.load=function(e,t,a,s){this.bSectionsOnly=s;function n(t){IntranetUsers.arStructure[e]=t.STRUCTURE;IntranetUsers.arEmployees[e]=t.USERS;this.show(e,false,"",this.bSectionsOnly)}if(null==t)t=false;if(null==a)a=false;if(null==s)s=false;if(e!="extranet")e=parseInt(e);var r=BX(this.name+"_employee_section_"+e);if(!r.BX_LOADED){if(IntranetUsers.arEmployees[e]!=null){this.show(e,false,"",this.bSectionsOnly)}else{var i=this.getAjaxUrl()+"&MODE=EMPLOYEES&SECTION_ID="+e;BX.ajax.loadJSON(i,BX.proxy(n,this))}}if(a){BX(this.name+"_employee_search_layout").scrollTop=r.offsetTop-40}BX.toggleClass(r,"company-department-opened");BX.toggleClass(BX(this.name+"_children_"+e),"company-department-children-opened")};IntranetUsers.prototype.show=function(e,t,a,s){s=!!s;a=a||"";var n=BX(this.name+"_"+a+"employee_section_"+e);var r=t||IntranetUsers.arEmployees[e];if(n!==null){n.BX_LOADED=true}var i=BX(this.name+"_"+a+"employees_"+e);if(i){if(IntranetUsers.arStructure[e]!=null&&!a){var l=IntranetUsers.arStructure[e];var o=BX(this.name+"_"+a+"children_"+e);if(o){for(var c=0;c<l.length;c++){obSectionRow1=BX.create("div",{props:{className:"company-department"},children:[s?BX.create("span",{props:{className:"company-department-inner",id:this.name+"_employee_section_"+l[c].ID},children:[BX.create("div",{props:{className:"company-department-arrow"},attrs:{onclick:"O_"+this.name+".load("+l[c].ID+", false, false, true)"}}),BX.create("div",{props:{className:"company-department-text"},attrs:{"data-section-id":l[c].ID,onclick:"O_"+this.name+".selectSection("+this.name+"_employee_section_"+l[c].ID+")"},text:l[c].NAME})]}):BX.create("span",{props:{className:"company-department-inner",id:this.name+"_employee_section_"+l[c].ID},attrs:{onclick:"O_"+this.name+".load("+l[c].ID+")"},children:[BX.create("div",{props:{className:"company-department-arrow"}}),BX.create("div",{props:{className:"company-department-text"},text:l[c].NAME})]})]});obSectionRow2=BX.create("div",{props:{className:"company-department-children",id:this.name+"_children_"+l[c].ID},children:[BX.create("div",{props:{className:"company-department-employees",id:this.name+"_employees_"+l[c].ID},children:[BX.create("span",{props:{className:"company-department-employees-loading"},text:BX.message("INTRANET_EMP_WAIT")})]})]});o.appendChild(obSectionRow1);o.appendChild(obSectionRow2)}o.appendChild(i)}}i.innerHTML="";for(var c=0;c<r.length;c++){var p;var d=false;IntranetUsers.arEmployeesData[r[c].ID]={id:r[c].ID,name:r[c].NAME,sub:r[c].SUBORDINATE=="Y"?true:false,sup:r[c].SUPERORDINATE=="Y"?true:false,position:r[c].WORK_POSITION,photo:r[c].PHOTO,url:r[c].USER_PROFILE_URL};var m=BX.create("input",{props:{className:"intranet-hidden-input"}});if(this.multiple){m.name=this.name+"[]";m.type="checkbox"}else{m.name=this.name;m.type="radio"}var h=document.getElementsByName(m.name);var u=0;while(!d&&u<h.length){if(h[u].value==r[c].ID&&h[u].checked){d=true}u++}m.value=r[c].ID;p=BX.create("div",{props:{className:"company-department-employee"+(d?" company-department-employee-selected":"")},events:{click:BX.proxy(this.select,this)},children:[m,BX.create("div",{props:{className:"company-department-employee-avatar"},style:{background:r[c].PHOTO?"url('"+encodeURI(r[c].PHOTO)+"') no-repeat center center":"",backgroundSize:r[c].PHOTO?"cover":""}}),BX.create("div",{props:{className:"company-department-employee-icon"}}),BX.create("div",{props:{className:"company-department-employee-info"},children:[BX.create("div",{props:{className:"company-department-employee-name"},text:r[c].NAME}),BX.create("div",{props:{className:"company-department-employee-position"},html:!r[c].HEAD&&!r[c].WORK_POSITION?"&nbsp;":BX.util.htmlspecialchars(r[c].WORK_POSITION)+(r[c].HEAD&&r[c].WORK_POSITION?", ":"")+(r[c].HEAD?BX.message("INTRANET_EMP_HEAD"):"")})]})]});i.appendChild(p)}}};IntranetUsers.prototype.select=function(e){var t;var a=0;var s=e.target||e.srcElement;if(e.currentTarget){t=e.currentTarget}else{t=s;while(!BX.hasClass(t,"finder-box-item")&&!BX.hasClass(t,"company-department-employee")){t=t.parentNode}}var n=BX.findChild(t,{tag:"input"});if(!this.multiple){var r=document.getElementsByName(this.name);for(var a=0;a<r.length;a++){if(r[a].value!=n.value){BX.removeClass(r[a].parentNode,BX.hasClass(r[a].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}else{BX.addClass(r[a].parentNode,BX.hasClass(r[a].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}}n.checked=true;BX.addClass(t,BX.hasClass(t,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected");this.searchInput.value=IntranetUsers.arEmployeesData[n.value].name;this.arSelected=[];this.arSelected[n.value]={id:n.value,name:IntranetUsers.arEmployeesData[n.value].name,sub:IntranetUsers.arEmployeesData[n.value].sub,sup:IntranetUsers.arEmployeesData[n.value].sup,position:IntranetUsers.arEmployeesData[n.value].position,photo:IntranetUsers.arEmployeesData[n.value].photo,url:IntranetUsers.arEmployeesData[n.value].url}}else{var r=document.getElementsByName(this.name+"[]");if(!BX.util.in_array(n,r)&&!BX.util.in_array(n.value,this.arFixed)){n.checked=false;BX.toggleClass(n.parentNode,BX.hasClass(n.parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}for(var a=0;a<r.length;a++){if(r[a].value==n.value&&!BX.util.in_array(n.value,this.arFixed)){r[a].checked=false;BX.toggleClass(r[a].parentNode,BX.hasClass(r[a].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}}if(BX.hasClass(n.parentNode,"finder-box-item-selected")||BX.hasClass(n.parentNode,"company-department-employee-selected")){n.checked=true}if(n.checked){var i=BX.findChild(BX(this.name+"_selected_users"),{className:"finder-box-selected-items"});if(!BX(this.name+"_employee_selected_"+n.value)){var l=BX.create("DIV");l.id=this.name+"_employee_selected_"+n.value;l.className="finder-box-selected-item";var o=BX.findChild(t,{tag:"DIV",className:"finder-box-item-text"},true)||BX.findChild(t,{tag:"DIV",className:"company-department-employee-name"},true);l.innerHTML='<div class="finder-box-selected-item-icon" id="'+this.name+"-user-selector-unselect-"+n.value+'" onclick="O_'+this.name+".unselect("+n.value+', this);"></div><span class="finder-box-selected-item-text">'+o.innerHTML+"</span>";i.appendChild(l);var c=BX(this.name+"_current_count");c.innerHTML=parseInt(c.innerHTML)+1;this.arSelected[n.value]={id:n.value,name:IntranetUsers.arEmployeesData[n.value].name,sub:IntranetUsers.arEmployeesData[n.value].sub,sup:IntranetUsers.arEmployeesData[n.value].sup,position:IntranetUsers.arEmployeesData[n.value].position,photo:IntranetUsers.arEmployeesData[n.value].photo,url:IntranetUsers.arEmployeesData[n.value].url}}}else{BX.remove(BX(this.name+"_employee_selected_"+n.value));var c=BX(this.name+"_current_count");c.innerHTML=parseInt(c.innerHTML)-1;this.arSelected[n.value]=null}}var p=BX.util.array_search(n.value,IntranetUsers.lastUsers);if(p>=0)IntranetUsers.lastUsers.splice(p,1);IntranetUsers.lastUsers.unshift(n.value);BX.userOptions.save("intranet","user_search","last_selected",IntranetUsers.lastUsers.slice(0,10));if(this.onSelect){var d=this.arSelected.pop();this.arSelected.push(d);this.onSelect(d)}BX.onCustomEvent(this,"on-change",[this.toObject(this.arSelected)]);if(this.onChange){this.onChange(this.arSelected)}};IntranetUsers.prototype.toObject=function(e){var t={};for(var a in e){a=parseInt(a);if(typeof a=="number"&&e[a]!==null){t[a]=BX.clone(e[a])}}return t};IntranetUsers.prototype.selectSection=function(e){var t=BX(e);if(!t){return false}else{var a=BX.findChild(t,{tag:"div",className:"company-department-text"});if(a){if(this.onSectionSelect){this.onSectionSelect({id:a.getAttribute("data-section-id"),name:a.innerHTML})}}}};IntranetUsers.prototype.unselect=function(e){var t=BX(this.name+"-user-selector-unselect-"+e);var a=document.getElementsByName(this.name+(this.multiple?"[]":""));for(var s=0;s<a.length;s++){if(a[s].value==e){a[s].checked=false;BX.removeClass(a[s].parentNode,BX.hasClass(a[s].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}}if(this.multiple){if(t){BX.remove(t.parentNode)}var n=BX(this.name+"_current_count");n.innerHTML=parseInt(n.innerHTML)-1}this.arSelected[e]=null;BX.onCustomEvent(this,"on-change",[this.toObject(this.arSelected)]);if(this.onChange){this.onChange(this.arSelected)}};IntranetUsers.prototype.getSelected=function(){return this.arSelected};IntranetUsers.prototype.setSelected=function(e){for(var t=0,a=this.arSelected.length;t<a;t++){if(this.arSelected[t]&&this.arSelected[t].id)this.unselect(this.arSelected[t].id)}if(!this.multiple){e=[e[0]]}this.arSelected=[];for(var t=0,a=e.length;t<a;t++){this.arSelected[e[t].id]=e[t];var s=BX.create("input",{props:{className:"intranet-hidden-input",value:e[t].id,checked:"checked",name:this.name+(this.multiple?"[]":"")}});BX(this.name+"_last").appendChild(s);if(this.multiple){var n=BX.findChild(BX(this.name+"_selected_users"),{className:"finder-box-selected-items"});var r=BX.create("div",{props:{className:"finder-box-selected-item",id:this.name+"_employee_selected_"+e[t].id},html:'<div class="finder-box-selected-item-icon" id="'+this.name+"-user-selector-unselect-"+e[t].id+'" onclick="O_'+this.name+".unselect("+e[t].id+', this);"></div><span class="finder-box-selected-item-text">'+BX.util.htmlspecialchars(e[t].name)+"</span>"});n.appendChild(r)}var i=document.getElementsByName(this.name+(this.multiple?"[]":""));for(var l=0;l<i.length;l++){if(i[l].value==e[t].id){BX.toggleClass(i[l].parentNode,BX.hasClass(i[l].parentNode,"finder-box-item")?"finder-box-item-selected":"company-department-employee-selected")}}}if(this.multiple){BX.adjust(BX(this.name+"_current_count"),{text:e.length})}};IntranetUsers.prototype.setFixed=function(e){if(typeof e!="object")e=[];this.arFixed=e;var t=BX.findChildren(BX(this.name+"_selected_users"),{className:"finder-box-selected-item-icon"},true);for(i=0;i<t.length;i++){var a=t[i].id.replace(this.name+"-user-selector-unselect-","");BX.adjust(t[i],{style:{visibility:BX.util.in_array(a,this.arFixed)?"hidden":"visible"}})}};IntranetUsers.prototype.search=function(e){this.searchRqstTmt=clearTimeout(this.searchRqstTmt);if(typeof this.searchRqst=="object"){this.searchRqst.abort();this.searchRqst=false}if(!e)e=window.event;if(this.searchInput.value.length>0){this.displayTab("search");var t=this.getAjaxUrl()+"&MODE=SEARCH&SEARCH_STRING="+encodeURIComponent(this.searchInput.value);if(this.bSubordinateOnly)t+="&S_ONLY=Y";var a=this;this.searchRqstTmt=setTimeout((function(){var e=(new Date).getTime();a.lastSearchTime=e;a.searchRqst=BX.ajax.loadJSON(t,BX.proxy((function(t){if(a.lastSearchTime==e)a.showResults(t)}),a))}),400)}};IntranetUsers.prototype.showResults=function(e){var t=e;var a=BX(this.name+"_search");var s=a.getElementsByTagName("input");var n=null;for(n=0,count=s.length;n<count;n++){if(s[n].checked){BX(this.name+"_last").appendChild(s[n])}}if(a){a.innerHTML="";var r=BX.create("table",{props:{className:"finder-box-tab-columns",cellspacing:"0"},children:[BX.create("tbody")]});var i=BX.create("tr");r.firstChild.appendChild(i);var l=BX.create("td");i.appendChild(l);a.appendChild(r);for(n=0;n<t.length;n++){var o;var c=false;IntranetUsers.arEmployeesData[t[n].ID]={id:t[n].ID,name:t[n].NAME,sub:t[n].SUBORDINATE=="Y"?true:false,sup:t[n].SUPERORDINATE=="Y"?true:false,position:t[n].WORK_POSITION,photo:t[n].PHOTO,url:t[n].USER_PROFILE_URL};var p=BX.create("input",{props:{className:"intranet-hidden-input"}});if(this.multiple){p.name=this.name+"[]";p.type="checkbox"}else{p.name=this.name;p.type="radio"}s=document.getElementsByName(p.name);var d=0;while(!c&&d<s.length){if(s[d].value==t[n].ID&&s[d].checked){c=true}d++}p.value=t[n].ID;var m=t[n].NAME;o=BX.create("div",{props:{className:"finder-box-item"+(c?" finder-box-item-selected":"")},events:{click:BX.proxy(this.select,this)},children:[p,BX.create("div",{props:{className:"finder-box-item-text"},attrs:{"bx-tooltip-user-id":t[n].ID,"bx-tooltip-classname":"intrantet-user-selector-tooltip"},text:m}),BX.create("div",{props:{className:"finder-box-item-icon"}})]});l.appendChild(o);if(n==Math.ceil(t.length/2)-1){l=BX.create("td");r.firstChild.appendChild(l)}}}};IntranetUsers.prototype.displayTab=function(e){BX.removeClass(BX(this.name+"_last"),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_search"),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_structure"),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_groups"),"finder-box-tab-content-selected");BX.addClass(BX(this.name+"_"+e),"finder-box-tab-content-selected");BX.removeClass(BX(this.name+"_tab_last"),"finder-box-tab-selected");BX.removeClass(BX(this.name+"_tab_search"),"finder-box-tab-selected");BX.removeClass(BX(this.name+"_tab_structure"),"finder-box-tab-selected");BX.removeClass(BX(this.name+"_tab_groups"),"finder-box-tab-selected");BX.addClass(BX(this.name+"_tab_"+e),"finder-box-tab-selected")};IntranetUsers.prototype._onFocus=function(){this.searchInput.value=""};IntranetUsers.prototype.getAjaxUrl=function(){return this.ajaxUrl||IntranetUsers.ajaxUrl}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/crm.field.element/templates/main.edit/script.min.js?17264562874990";s:6:"source";s:73:"/bitrix/components/bitrix/crm.field.element/templates/main.edit/script.js";s:3:"min";s:77:"/bitrix/components/bitrix/crm.field.element/templates/main.edit/script.min.js";s:3:"map";s:77:"/bitrix/components/bitrix/crm.field.element/templates/main.edit/script.map.js";}"*/
BX.CrmElementEntitySelector=function(){var t=function(t){this.randomString=t.randomString;this.jsObject=t.jsObject;this.fieldUid=t.fieldUid;this.fieldName=t.fieldName;this.usePrefix=t.usePrefix;this.listPrefix=t.listPrefix;this.selectorEntityTypes=t.selectorEntityTypes;this.multiple=t.multiple;this.listElement=t.listElement;this.listEntityType=t.listEntityType;this.pluralCreation=Boolean(t.pluralCreation);this.listEntityCreateUrl=t.listEntityCreateUrl;this.currentEntityType=t.currentEntityType;this.context=t.context;this.dynamicTypeTitles=t.dynamicTypeTitles;this.initialize()};t.prototype.initialize=function(){this.popupObject=null;this.popupId="crm-"+this.randomString+"-popup";this.popupBindElement=null;this.popupContent="";this.externalRequestData=null;this.externalEventHandler=null;BX.addCustomEvent("onCrmSelectedItem",BX.proxy(this.setSelectedElement,this));BX.addCustomEvent("onCrmUnSelectedItem",BX.proxy(this.unsetSelectedElement,this))};t.prototype.createNewEntity=function(t){if(this.pluralCreation){t=t||window.event;this.popupBindElement=t.currentTarget;this.createPopup()}else{this.performExternalRequest()}};t.prototype.performExternalRequest=function(t){if(this.popupObject){this.popupObject.popupWindow.close()}if(t){this.setCurrentEntityType(t)}var e=BX.util.add_url_param(this.getCreateUrl(),{external_context:this.context});BX.SidePanel.Instance.open(e);if(!this.externalRequestData){this.externalRequestData={}}this.externalRequestData[this.context]={context:this.context,url:e};if(!this.externalEventHandler){this.externalEventHandler=BX.delegate(this.onExternalEvent,this);BX.addCustomEvent(window,"onLocalStorageSet",this.externalEventHandler)}};t.prototype.onExternalEvent=function(t){var e=BX.type.isNotEmptyString(t["key"])?t["key"]:"";var i=BX.type.isPlainObject(t["value"])?t["value"]:{};var s=BX.type.isNotEmptyString(i["entityTypeName"])?i["entityTypeName"]:"";var n=BX.type.isNotEmptyString(i["context"])?i["context"]:"";if(e==="onCrmEntityCreate"&&s===this.currentEntityType.toUpperCase()&&this.externalRequestData&&BX.type.isPlainObject(this.externalRequestData[n])){var r=BX.type.isBoolean(i["isCanceled"])?i["isCanceled"]:false;if(!r&&BX.type.isPlainObject(i["entityInfo"])){var l=BX.UI.SelectorManager.instances[this.fieldUid];var a=i.entityInfo.type.toUpperCase();if(BX.type.isNotEmptyObject(l)){var p={};if(this.multiple==="Y"){for(var o in l.itemsSelected){if(!l.itemsSelected.hasOwnProperty(o)){continue}p[o]=l.itemsSelected[o]}}p[this.listPrefix[a]+"_"+i.entityInfo.id]=this.selectorEntityTypes[a];BX.onCustomEvent("BX.Main.SelectorV2:reInitDialog",[{selectorId:this.fieldUid,selectedItems:p}])}}if(this.externalRequestData[n]["url"]){var E=BX.SidePanel.Instance.getSlider(this.externalRequestData[n]["url"]);if(E){E.destroy()}}delete this.externalRequestData[n]}};t.prototype.createPopup=function(){var t=[];var e="";for(var i in this.listEntityType){if(this.listEntityType[i].toUpperCase().indexOf("DYNAMIC_")===0){e=this.dynamicTypeTitles["DYNAMICS_"+i]}else{e=BX.message("CRM_ELEMENT_CREATE_"+this.listEntityType[i].toUpperCase());t.push({text:e,onclick:'BX["'+this.jsObject+'"].performExternalRequest("'+this.listEntityType[i]+'");'})}}if(!BX.PopupMenu.getMenuById(this.popupId)){var s=this.popupBindElement.getBoundingClientRect();this.popupObject=BX.PopupMenu.create(this.popupId,this.popupBindElement,t,{closeByEsc:true,angle:true,offsetLeft:s.width/2})}if(this.popupObject){this.popupObject.popupWindow.show()}};t.prototype.setCurrentEntityType=function(t){this.currentEntityType=t};t.prototype.getCreateUrl=function(){if(this.listEntityCreateUrl.hasOwnProperty(this.currentEntityType)){return this.listEntityCreateUrl[this.currentEntityType]}else{return""}};t.prototype.setSelectedElement=function(t){for(var e in this.listElement){if(t.id===this.listElement[e].id){this.listElement[e].selected="Y"}}};t.prototype.unsetSelectedElement=function(t){for(var e in this.listElement){if(t.id===this.listElement[e].id){this.listElement[e].selected="N"}}};t.prototype.initWidgetEntitySelection=function(){BX.loadCSS("/bitrix/js/crm/css/crm.css");if(typeof CRM=="undefined"){BX.loadScript("/bitrix/js/crm/crm.js",BX[""+this.jsObject+""].initWidgetEntitySelection());return}CRM.Set(BX("crm-"+this.fieldUid+"-open"),this.fieldName,"",this.listElement,this.usePrefix==="Y",this.multiple==="Y",this.listEntityType,{lead:BX.message("CRM_ELEMENT_LEAD"),contact:BX.message("CRM_ELEMENT_CONTACT"),company:BX.message("CRM_ELEMENT_COMPANY"),deal:BX.message("CRM_ELEMENT_DEAL"),quote:BX.message("CRM_ELEMENT_QUOTE"),order:BX.message("CRM_ELEMENT_ORDER"),ok:BX.message("CRM_ELEMENT_OK"),cancel:BX.message("CRM_ELEMENT_CANCEL"),close:BX.message("CRM_ELEMENT_CLOSE"),wait:BX.message("CRM_ELEMENT_SEARCH"),noresult:BX.message("CRM_ELEMENT_NO_RESULT"),add:BX.message("CRM_ELEMENT_CHOISE"),edit:BX.message("CRM_ELEMENT_CHANGE"),search:BX.message("CRM_ELEMENT_SEARCH"),last:BX.message("CRM_ELEMENT_LAST")})};return t}();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/main.user.selector/templates/.default/script.min.js?17264562448493";s:6:"source";s:73:"/bitrix/components/bitrix/main.user.selector/templates/.default/script.js";s:3:"min";s:77:"/bitrix/components/bitrix/main.user.selector/templates/.default/script.min.js";s:3:"map";s:77:"/bitrix/components/bitrix/main.user.selector/templates/.default/script.map.js";}"*/
(function(){BX.namespace("BX.Main.User");if(BX.Main.User.Selector){return}function e(e){this.caller=e.caller;this.container=BX(e.containerId);this.id=e.id;this.containerId=e.containerId;this.inputName=e.inputName;this.inputId=e.inputName;this.isInputMultiple=e.isInputMultiple;this.inputNode=this.container?this.container.querySelector('input[name="'+e.inputName+'"]'):null;this.useSymbolicId=e.useSymbolicId;this.openDialogWhenInit=!!e.openDialogWhenInit;this.selector=BX.UI.TileSelector.getById(this.id);if(!this.selector){throw new Error("Tile selector `"+this.id+"` not found.")}this.searchInputNode=this.selector.getSearchInput();if(!this.searchInputNode.id){this.searchInputNode.id=this.inputId+"-"+this.id+"-search-input"}this.lazyload=!!e.lazyload;BX.addCustomEvent(this.selector,this.selector.events.buttonSelect,this.openDialog.bind(this));BX.addCustomEvent(this.selector,this.selector.events.tileRemove,this.removeTile.bind(this));BX.addCustomEvent(this.selector,this.selector.events.tileClick,this.clickTile.bind(this));BX.Main.User.SelectorController.init(this)}e.prototype={openDialog:function(){if(this.lazyload){var e=false;if(BX.Main.selectorManagerV2){var t=BX.Main.selectorManagerV2.getById(this.id);if(t&&t.initialized){BX.Main.User.SelectorController.open(this);e=true}}if(!e){BX.onCustomEvent("BX.Main.SelectorV2:initDialog",[{selectorId:this.id,openDialogWhenInit:true}])}}else{BX.Main.User.SelectorController.open(this)}},removeTile:function(e){this.unsetValue(e.id)},clickTile:function(e){if(BX.type.isNotEmptyObject(e.data)&&BX.type.isNotEmptyString(e.data.url)){if(BX.type.isNotEmptyString(e.data.urlUseSlider)&&e.data.urlUseSlider=="Y"&&BX.type.isNotEmptyObject(BX.SidePanel)){BX.SidePanel.Instance.open(e.data.url)}else{window.open(e.data.url,"_blank")}}},setUsers:function(e){e=e||[];if(this.isInputMultiple){this.addInputs(e)}else{this.inputNode.value=e.join(",");BX.fireEvent(this.inputNode,"change")}},getUsers:function(){if(!this.isInputMultiple&&!this.inputNode){return[]}var e;if(this.isInputMultiple){e=this.getInputs().map((function(e){return e.value}))}else{e=this.inputNode.value.split(",")}if(!this.useSymbolicId){return e.filter((function(e){e=parseInt(e);return!!e})).map((function(e){return parseInt(e)}))}else{return e.filter((function(e){return e.length>0}))}},setValue:function(e){if(!this.useSymbolicId){if(/^\d+$/.test(e)!==true){return}e=parseInt(e)}if(this.selectOne){this.setUsers([e])}else{var t=this.getUsers();if(!BX.util.in_array(e,t)){t.push(e)}this.setUsers(t)}},unsetValue:function(e){if(!this.useSymbolicId){if(/^\d+$/.test(e)!==true){return}e=parseInt(e)}if(this.selectOne){this.setUsers()}else{var t=false;if(BX.type.isNotEmptyObject(BX.Main.selectorManagerV2)){var i=BX.Main.selectorManagerV2.getById(this.id);if(i.getOption("returnJsonValue")=="Y"){t=true}}var n=this.getUsers().filter((function(i){if(t){var n=JSON.parse(i);if(BX.type.isNotEmptyObject(n)){i=n.id}}return i!==e}));this.setUsers(n)}},addInput:function(e){var t=document.createElement("input");t.type="hidden";t.name=this.inputName;t.value=e;this.container.appendChild(t);BX.fireEvent(t,"change");BX.Event.EventEmitter.emit(window,"BX.Main.User.SelectorController:itemRendered",[{selectorId:this.id,value:e}])},addInputs:function(e){this.removeInputs();e.forEach((function(e){this.addInput(e)}),this);if(e.length<=0&&this.isInputMultiple){this.addInput("")}},getInputs:function(){return BX.convert.nodeListToArray(this.container.querySelectorAll('input[name="'+this.inputName+'"]'))},removeInputs:function(){this.getInputs().forEach((function(e){BX.fireEvent(e,"change");BX.remove(e)}))}};var t={list:[],init:function(e){this.list.push(e);BX.onCustomEvent(window,"BX.Main.User.SelectorController::init",[{id:e.id,inputId:e.searchInputNode.id,containerId:e.containerId,openDialogWhenInit:e.openDialogWhenInit}])},open:function(e){if(e.isOpen){return}if(BX.UI.SelectorManager){var t=BX.UI.SelectorManager.instances[e.id];if(t){if(!e.isInputMultiple){t.itemsSelected={}}e.getUsers().forEach((function(e){var i=null;for(var n in t.entities){if(t.entities.hasOwnProperty(n)&&BX.type.isNotEmptyObject(t.entities[n].items)){if(BX.util.in_array(e,Object.keys(t.entities[n].items))){i=n}}}if(i){t.itemsSelected[e]=i.toLowerCase()}}));t.nodes.input=e.selector.input;t.nodes.tag=e.selector.buttonSelect}}e.isOpen=true;BX.onCustomEvent(window,"BX.Main.User.SelectorController::open",[{id:e.id,inputId:e.searchInputNode.id,containerId:e.containerId,bindNode:e.container}])},formatName:function(e){var t="";var i=BX.type.isNotEmptyString(e.nameTemplate)?BX.util.htmlspecialcharsback(BX.util.htmlspecialcharsback(e.nameTemplate)):"#NAME#";if(BX.type.isNotEmptyObject(e.item)){var n=e.item;t=i}else{return t}for(var r in n){if(n.hasOwnProperty(r)){t=t.replace("#"+r.toUpperCase()+"#",BX.util.htmlspecialcharsback(n[r]))}}return t},select:function(e){var t=BX.type.isNotEmptyObject(BX.Main.selectorManagerV2)?BX.Main.selectorManagerV2.getById(e.selectorId):null;var i=BX.Main.User.SelectorController;var n=i.getUserSelector(e.selectorId);if(!n||!BX.type.isNotEmptyObject(e.item)){return}var r=n.useSymbolicId?e.item.id:e.item.entityId;if(BX.type.isNotEmptyObject(e.item.params)&&BX.type.isNotEmptyString(e.item.params.email)&&(!t||t.getOption("returnJsonValue")!="Y")){r=(BX.type.isNotEmptyString(e.prefix)?e.prefix:"UE")+r}var s=false;if(t&&t.getOption("returnJsonValue")=="Y"){n.setValue(JSON.stringify(e.item))}else{n.setValue(r)}var o={readonly:!!e.undeletable};if(BX.type.isNotEmptyString(e.entityType)){o.entityType=e.entityType}if(BX.type.isNotEmptyString(e.item.url)){o.url=e.item.url}if(BX.type.isNotEmptyString(e.item.urlUseSlider)){o.urlUseSlider=e.item.urlUseSlider}if(BX.type.isNotEmptyString(e.item.isExtranet)&&e.item.isExtranet=="Y"){o.extranet=true}if(BX.type.isNotEmptyString(e.item.isCrmEmail)&&e.item.isCrmEmail=="Y"){o.crmEmail=true}if(BX.type.isNotEmptyString(e.state)){o.state=e.state}n.selector.addTile(i.formatName({item:e.item,nameTemplate:t?t.getOption("nameTemplate"):"#NAME# #LAST_NAME#"}),o,r);n.selector.input.value="";if(!n.isInputMultiple||!BX.type.isNotEmptyString(e.tab)||e.tab!="search"){n.selector.input.style.display="none";n.selector.buttonSelect.style.display=""}BX.onCustomEvent("BX.Main.User.SelectorController:select",[{selectorId:e.selectorId,item:e.item,contextNode:n.selector.context,containerId:n.containerId,inputName:n.inputName}])},unSelect:function(e){var t=BX.Main.User.SelectorController;var i=t.getUserSelector(e.selectorId);if(!i||!BX.type.isNotEmptyObject(e.item)){return}var n=i.useSymbolicId?e.item.id:e.item.entityId;i.unsetValue(n);var r=i.selector.getTile(n);if(r){i.selector.removeTile(r)}if(BX.UI.SelectorManager){var s=BX.UI.SelectorManager.instances[e.selectorId];if(s){if(typeof s.deleteSelectedItem=="function"){s.deleteSelectedItem({itemId:e.item.id})}else{delete s.itemsSelected[e.item.id]}}}if(!i.isInputMultiple||!BX.type.isNotEmptyString(e.tab)||e.tab!="search"){i.selector.input.style.display="none";i.selector.buttonSelect.style.display=""}BX.onCustomEvent("BX.Main.User.SelectorController:unSelect",[{selectorId:e.selectorId,item:e.item,contextNode:i.selector.context,containerId:i.containerId,inputName:i.inputName}])},openDialog:function(e){var t=BX.Main.User.SelectorController;var i=t.getUserSelector(e.selectorId);if(!i){return}i.isOpen=true;if(i.selector){i.selector.input.style.display="";i.selector.buttonSelect.style.display="none";i.selector.input.focus()}},closeDialog:function(e){var t=BX.Main.User.SelectorController;var i=t.getUserSelector(e.selectorId);if(!i){return}i.isOpen=false;if(i.selector){i.selector.input.style.display="none";i.selector.buttonSelect.style.display=""}},openSearch:function(e){var t=BX.Main.User.SelectorController;var i=t.getUserSelector(e.selectorId);if(!i){return}i.isOpen=false;if(i.selector){i.selector.input.style.display="";i.selector.buttonSelect.style.display="none"}},closeSearch:function(e){var t=BX.Main.User.SelectorController;var i=t.getUserSelector(e.selectorId);if(!i){return}if(i.selector){var n=BX.UI.SelectorManager.instances[e.selectorId];if(!n||!n.closeByEmptySearchResult){i.selector.input.style.display="none";i.selector.buttonSelect.style.display=""}}},getUserSelector:function(e){var t=this.list.filter((function(t){return t.id===e&&(!t.container||document.body.contains(t.container))}));return t[0]}};if(!BX.Main.User.SelectorController){BX.Main.User.SelectorController=t}BX.Main.User.Selector=e})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:88:"/bitrix/components/bitrix/lists.live.feed/templates/.default/right.min.js?17264563693556";s:6:"source";s:69:"/bitrix/components/bitrix/lists.live.feed/templates/.default/right.js";s:3:"min";s:73:"/bitrix/components/bitrix/lists.live.feed/templates/.default/right.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/lists.live.feed/templates/.default/right.map.js";}"*/
(function(){window.BXfpListsSelectCallback=function(e){BXfpListsMedalSelectCallback(e,"lists")};window.BXfpListsMedalLinkName=function(e,t){if(t!="lists")t="medal";if(BX.SocNetLogDestination.getSelectedCount(e)<=0)BX("bx-"+t+"-tag").innerHTML=BX.message("LISTS_ADD_STAFF");else BX("bx-"+t+"-tag").innerHTML=BX.message("LISTS_ADD_STAFF_MORE")};window.BXfpListsMedalSelectCallback=function(e,t){if(t!="lists")t="medal";var s="U";BX("feed-add-post-"+t+"-item").appendChild(BX.create("span",{attrs:{"data-id":e.id},props:{className:"feed-add-post-"+t+" feed-add-post-destination-users"},children:[BX.create("input",{attrs:{type:"hidden",name:"LISTS"+"["+s+"][]",value:e.id}}),BX.create("span",{props:{className:"feed-add-post-"+t+"-text"},html:e.name}),BX.create("span",{props:{className:"bizproc-type-control-user-delete"},events:{click:function(t){BX.SocNetLogDestination.deleteItem(e.id,"users",window["BXSocNetLogListsFormName"]);BXfpListsUnSelectCallback(e);BX.PreventDefault(t)},mouseover:function(){BX.addClass(this.parentNode,"feed-add-post-"+t+"-hover")},mouseout:function(){BX.removeClass(this.parentNode,"feed-add-post-"+t+"-hover")}}})]}));BX("feed-add-post-"+t+"-input").value="";BXfpListsMedalLinkName(window["BXSocNetLogListsFormName"],t)};window.BXfpListsUnSelectCallback=function(e){BXfpListsMedalUnSelectCallback(e,"lists")};window.BXfpListsMedalUnSelectCallback=function(e,t){var s=BX.findChildren(BX("feed-add-post-"+t+"-item"),{attribute:{"data-id":""+e.id+""}},true);if(s!=null){for(var i=0;i<s.length;i++)BX.remove(s[i])}BX("feed-add-post-"+t+"-input").value="";BXfpListsMedalLinkName(window["BXSocNetLogListsFormName"],t)};window.BXfpListsOpenDialogCallback=function(){BX.style(BX("feed-add-post-lists-input-box"),"display","inline-block");BX.style(BX("bx-lists-tag"),"display","none");BX.focus(BX("feed-add-post-lists-input"))};window.BXfpListsCloseDialogCallback=function(){if(!BX.SocNetLogDestination.isOpenSearch()&&BX("feed-add-post-lists-input").value.length<=0){BX.style(BX("feed-add-post-lists-input-box"),"display","none");BX.style(BX("bx-lists-tag"),"display","inline-block");BX.SocNetLogDestination.BXfpDisableBackspace()}};window.BXfpListsCloseSearchCallback=function(){if(!BX.SocNetLogDestination.isOpenSearch()&&BX("feed-add-post-lists-input").value.length>0){BX.style(BX("feed-add-post-lists-input-box"),"display","none");BX.style(BX("bx-lists-tag"),"display","inline-block");BX("feed-add-post-lists-input").value="";BX.SocNetLogDestination.BXfpDisableBackspace()}};window.BXfpListsSearch=function(e){if(e.keyCode==16||e.keyCode==17||e.keyCode==18)return false;if(e.keyCode==13){BX.SocNetLogDestination.selectFirstSearchItem(window["BXSocNetLogListsFormName"]);return true}if(e.keyCode==27){BX("feed-add-post-lists-input").value="";BX.style(BX("bx-lists-tag"),"display","inline")}else{BX.SocNetLogDestination.search(BX("feed-add-post-lists-input").value,true,window["BXSocNetLogListsFormName"])}if(!BX.SocNetLogDestination.isOpenDialog()&&BX("feed-add-post-lists-input").value.length<=0){BX.SocNetLogDestination.openDialog(window["BXSocNetLogListsFormName"])}else{if(BX.SocNetLogDestination.sendEvent&&BX.SocNetLogDestination.isOpenDialog())BX.SocNetLogDestination.closeDialog()}if(e.keyCode==8){BX.SocNetLogDestination.sendEvent=true}return true};window.BXfpListsSearchBefore=function(e){if(e.keyCode==8&&BX("feed-add-post-lists-input").value.length<=0){BX.SocNetLogDestination.sendEvent=false;BX.SocNetLogDestination.deleteLastItem(window["BXSocNetLogListsFormName"])}return true}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/socialnetwork.log.filter/templates/.default/script.min.js?172645642511024";s:6:"source";s:79:"/bitrix/components/bitrix/socialnetwork.log.filter/templates/.default/script.js";s:3:"min";s:83:"/bitrix/components/bitrix/socialnetwork.log.filter/templates/.default/script.min.js";s:3:"map";s:83:"/bitrix/components/bitrix/socialnetwork.log.filter/templates/.default/script.map.js";}"*/
__logOnDateChange=function(e){var t=false,n=false,i=false,a=false;if(e.value=="interval")t=n=i=true;else if(e.value=="before")n=true;else if(e.value=="after"||e.value=="exact")t=true;else if(e.value=="days")a=true;BX("flt_date_from_span").style.display=t?"":"none";BX("flt_date_to_span").style.display=n?"":"none";BX("flt_date_hellip_span").style.display=i?"":"none";BX("flt_date_day_span").style.display=a?"inline-block":"none";BX("flt_date_day_text_span").style.display=a?"inline-block":"none"};function __logOnReload(e){if(BX("menu-popup-lenta-sort-popup")){var t=BX.findChildren(BX("menu-popup-lenta-sort-popup"),{className:"lenta-sort-item"},true);if(!BX.hasClass(t[0],"lenta-sort-item-selected")){for(var n=0;n<t.length;n++){if(n==0)BX.addClass(t[n],"lenta-sort-item-selected");else if(n!=t.length-1)BX.removeClass(t[n],"lenta-sort-item-selected")}}}if(BX("lenta-sort-button")){var i=BX.findChild(BX("lenta-sort-button"),{className:"lenta-sort-button-text-internal"},true,false);if(i)i.innerHTML=BX.message("sonetLFAllMessages")}var a=BX("sonet_log_counter_preset",true);if(a){if(parseInt(e)>0){a.style.display="inline-block";a.innerHTML=e}else{a.innerHTML="";a.style.display="none"}}}BitrixLFFilter=function(){this.id=null;this.filterPopup=false;this.currentName=null;this.obInputName={};this.obSearchInput={};this.obInputContainerName={};this.obContainerInput={};this.popupMenu=null;this.menuItems=[];this.actualSearchString="";this.minSearchStringLength=2};BitrixLFFilter.prototype.initLentaMenu=function(e){if(typeof e.menuItems!="undefined"){this.menuItems=e.menuItems}};BitrixLFFilter.prototype.showLentaMenu=function(e){var t=typeof e.short!="undefined"&&e.short,n=typeof e.bindElement!="undefined"?BX(e.bindElement):null;if(!n){return false}if(typeof e.siteTemplateId=="undefined"||e.siteTemplateId!="bitrix24"){BX.addClass(n,"lenta-sort-button-active")}const i=BX.util.array_merge(!t?BX.util.array_merge(this.menuItems.preset,this.menuItems.filter):[],this.menuItems.actions);if(!BX.Type.isArrayFilled(i)){return false}this.popupMenu=BX.PopupMenu.create("lenta-sort-popup",n,i,{offsetTop:e.siteTemplateId=="bitrix24"?-5:2,offsetLeft:e.siteTemplateId=="bitrix24"?17:43,angle:true,events:{onPopupClose:function(){if(typeof e.siteTemplateId!="undefined"||e.siteTemplateId!="bitrix24"){BX.removeClass(n,"lenta-sort-button-active")}}}});this.popupMenu.show();return false};BitrixLFFilter.prototype.initFilter=function(e){var t=typeof e!="undefined"&&typeof e.version!="undefined"?parseInt(e.version):0;var n=typeof e!="undefined"&&typeof e.filterId!="undefined"?e.filterId:"LIVEFEED";this.id=n;if(t>=2){if(typeof e!="undefined"&&typeof e.minSearchStringLength!="undefined"&&parseInt(e.minSearchStringLength)>0){this.minSearchStringLength=parseInt(e.minSearchStringLength)}var i=BX.Main.filterManager.getById(n);if(i&&(i.getSearch().getSquares().length>0||i.getSearch().getSearchString().length>0)){var a=BX.findParent(BX(n+"_filter_container"),{className:"pagetitle-wrap"});if(a){BX.addClass(a,"pagetitle-wrap-filter-opened")}}BX.addCustomEvent("BX.Livefeed:refresh",BX.delegate((function(){var e=BX.Main.filterManager.getById(n);if(e){e.getPreset().resetPreset(true);e.getSearch().clearForm()}}),this));BX.addCustomEvent("BX.Main.Filter:beforeApply",BX.delegate((function(e,t,i,a){if(e!=n||this.actualSearchString.length>0&&this.actualSearchString.length<this.minSearchStringLength){return}BX.onCustomEvent(window,"BX.Livefeed.Filter:beforeApply",[t,a])}),this));BX.addCustomEvent("BX.Main.Filter:apply",BX.delegate((function(e,t,i,a,o){if(e!=n||this.actualSearchString.length>0&&this.actualSearchString.length<this.minSearchStringLength){return}BX.onCustomEvent(window,"BX.Livefeed.Filter:apply",[t,a,o])}),this));BX.addCustomEvent("BX.Filter.Search:input",BX.delegate((function(e,t){if(e==n){this.actualSearchString=typeof t!="undefined"?BX.util.trim(t):"";if(this.actualSearchString.length>0&&this.actualSearchString.length>=this.minSearchStringLength){BX.onCustomEvent(window,"BX.Livefeed.Filter:searchInput",[t])}}}),this));BX.addCustomEvent("BX.Main.Filter:blur",BX.delegate((function(e){if(e.getParam("FILTER_ID")==n&&e.getSearch().getSquares().length<=0&&e.getSearch().getSearchString().length<=0){var t=BX.findParent(BX(n+"_filter_container"),{className:"pagetitle-wrap"});if(t){BX.removeClass(t,"pagetitle-wrap-filter-opened")}}})));if(BX(this.id+"_filter_container")){var o=BX.delegate((function(e){var t=BX.findParent(e.target,{className:"pagetitle-wrap"});if(t&&!BX.hasClass(t,"pagetitle-wrap-filter-opened")){BX.addClass(t,"pagetitle-wrap-filter-opened")}}),this);BX.bind(BX(this.id+"_search_container"),"click",o)}}else{__logOnDateChange(document.forms["log_filter"].flt_date_datesel);BX("flt_date_from_span").onclick=function(){BX.calendar({node:this,field:BX("flt_date_from"),bTime:false})};BX("flt_date_to_span").onclick=function(){BX.calendar({node:this,field:BX("flt_date_to"),bTime:false})}}};BitrixLFFilter.prototype.initDestination=function(e){this.obInputName[e.name]=e.inputName;this.obSearchInput[e.name]=BX(e.inputName);this.obInputContainerName[e.name]=e.inputContainerName;this.obContainerInput[e.name]=BX(e.inputContainerName);if(typeof e.items!="undefined"&&typeof e.items.department!="undefined"){if(typeof e.items.extranetRoot!="undefined"){for(var t in e.items.extranetRoot){if(e.items.extranetRoot.hasOwnProperty(t)){e.items.department[t]=e.items.extranetRoot[t]}}}if(!e.items.departmentRelation){e.items.departmentRelation=BX.SocNetLogDestination.buildDepartmentRelation(e.items.department)}}BX.SocNetLogDestination.init({name:e.name,pathToAjax:typeof e.pathToAjax!="undefined"?e.pathToAjax:false,searchInput:this.obSearchInput[e.name],extranetUser:!!e.extranetUser,departmentSelectDisable:!!e.departmentSelectDisable,bindMainPopup:{node:e.bindNode,offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:e.bindNode,offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.proxy(this.onSelectDestination,{name:e.name,containerInput:BX(e.inputContainerName),inputContainerName:e.inputContainerName,inputName:e.inputName,searchInput:BX(e.inputName),resultFieldName:e.resultFieldName}),unSelect:BX.proxy(this.onUnSelectDestination,{name:e.name,inputContainerName:e.inputContainerName,inputName:e.inputName,searchInput:BX(e.inputName)})},items:e.items,itemsLast:e.itemsLast,itemsSelected:e.itemsSelected,itemsSelectedUndeleted:typeof e.itemsSelectedUndeleted!="undefined"?e.itemsSelectedUndeleted:{},isCrmFeed:false,useClientDatabase:true,destSort:e.destSort,allowAddUser:false,allowSearchEmailUsers:!e.extranetUser,userNameTemplate:e.userNameTemplate});BX.bind(this.obSearchInput[e.name],"click",(function(t){oLFFilter.currentName=e.name;BX.SocNetLogDestination.openDialog(e.name);return BX.PreventDefault(t)}));BX.bind(this.obSearchInput[e.name],"keyup",BX.delegate(BX.SocNetLogDestination.BXfpSearch,{formName:e.name,inputName:oLFFilter.obInputName[e.name]}));BX.bind(this.obSearchInput[e.name],"keydown",BX.delegate(BX.SocNetLogDestination.BXfpSearchBefore,{formName:e.name,inputName:oLFFilter.obInputName[e.name]}))};BitrixLFFilter.prototype.clearInput=function(){if(this.obContainerInput[this.currentName]){var e=BX.findChildren(this.obContainerInput[this.currentName],{className:"feed-add-post-destination"},false);for(var t=0;t<e.length;t++){BX.SocNetLogDestination.deleteItem(e[t].attributes["data-id"].value,e[t].attributes["data-type"].value,this.currentName)}}};BitrixLFFilter.prototype.onSelectDestination=function(e,t,n,i){oLFFilter.clearInput();BX.SocNetLogDestination.BXfpSelectCallback({formName:this.name,item:e,type:t,search:n,bUndeleted:i,containerInput:this.containerInput,valueInput:this.searchInput,varName:this.resultFieldName});this.searchInput.style.display="none";if(this.name=="feed-filter-created-by"&&BX("flt_comments_cont")){BX("flt_comments_cont").style.display="block"}BX.SocNetLogDestination.closeDialog();BX.SocNetLogDestination.closeSearch()};BitrixLFFilter.prototype.onUnSelectDestination=function(e){var t=BX.findChildren(BX(this.inputContainerName),{attribute:{"data-id":""+e.id+""}},true);if(t!==null){for(var n=0;n<t.length;n++){BX.remove(t[n])}}BX(this.inputName).value="";this.searchInput.style.display="inline-block";if(this.name=="feed-filter-created-by"&&BX("flt_comments_cont")){BX("flt_comments_cont").style.display="none"}};BitrixLFFilter.prototype.ShowFilterPopup=function(e){if(!oLFFilter.filterPopup){BX.ajax.get(BX.message("sonetLFAjaxPath"),(function(t){BX.closeWait(e);oLFFilter.filterPopup=new BX.PopupWindow("bx_log_filter_popup",e,{closeIcon:false,offsetTop:5,autoHide:true,zIndex:-100,className:"sonet-log-filter-popup-window",events:{onPopupClose:function(){if(!BX.hasClass(this.bindElement,"pagetitle-menu-filter-set"))BX.removeClass(this.bindElement,"pagetitle-menu-filter-selected")},onPopupShow:function(){BX.addClass(this.bindElement,"pagetitle-menu-filter-selected")}}});var n=BX.create("DIV",{html:BX.util.trim(t)});oLFFilter.filterPopup.setContent(n.firstChild);oLFFilter.filterPopup.show()}))}else{oLFFilter.filterPopup.show()}};BitrixLFFilter.prototype.__SLFShowInfoPopup=function(e){var t=[BX.create("BUTTON",{props:{className:"ui-btn ui-btn-md ui-btn-success"},text:BX.message("sonetLFDialogRead"),events:{click:function(){BX.ajax({method:"POST",dataType:"json",url:BX.message("ajaxControllerURL"),data:{sessid:BX.bitrix_sessid(),popupType:e.type,closePopup:"Y"},onsuccess:function(t){if(typeof t!="undefined"&&typeof t.SUCCESS!="undefined"&&t.SUCCESS=="Y"){a.close();if(e.reload){top.location=top.location.href}}}})}}})];if(BX.type.isArray(e.buttonsAdd)){var n=0;for(var i=0;i<e.buttonsAdd.length;i++){n=e.buttonsAdd[i];t.push(BX.create("BUTTON",{props:{className:"ui-btn ui-btn-md ui-btn-"+n.type},text:n.title,events:{click:n.click}}))}}var a=new BX.PopupWindow(e.name,e.bindObj,{closeByEsc:false,closeIcon:false,autoHide:false,overlay:true,events:{},buttons:[],zIndex:0,content:BX.create("DIV",{children:[BX.create("DIV",{props:{className:"bx-slf-popup-title"},text:e.title}),BX.create("DIV",{props:{className:"bx-slf-popup-content"},children:[BX.create("DIV",{props:{className:"bx-slf-popup-cont-title"},html:e.description1}),BX.create("DIV",{props:{className:"bx-slf-popup-descript"},children:[BX.type.isNotEmptyString(e.description2)?BX.create("DIV",{html:e.description2}):null,BX.type.isPlainObject(e.descriptionImage)&&BX.type.isNotEmptyString(e.descriptionImage.src)?BX.create("IMG",{props:{className:"bx-slf-popup-descript-img"},attrs:{src:e.descriptionImage.src,width:e.descriptionImage.width,height:e.descriptionImage.height}}):null]})]}),BX.create("DIV",{props:{className:"popup-window-buttons"},children:t})]})});a.show();return a};BitrixLFFilter.prototype.onClickMenuItem=function(e){if(typeof e.menuItem!="undefined"){BX.toggleClass(e.menuItem,"lenta-sort-item-selected")}this.popupMenu.close();if(typeof e.href!="undefined"){top.location.href=e.href}};BitrixLFFilter.prototype.closeHint=function(e){};oLFFilter=new BitrixLFFilter;window.oLFFilter=oLFFilter;
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.min.js?172645624413346";s:6:"source";s:71:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.ui.selector/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Main");BX.Main.selectorManagerV2={getById:function(t){if(typeof this.controls[t]!="undefined"){return this.controls[t]}return null},controls:{},loadedEntities:{}};BX.Main.SelectorV2=function(){this.initialized=false;this.blockInit=false;this.id="";this.apiVersion=2;this.fieldName=null;this.inputId=null;this.input=null;this.tagId=null;this.tag=null;this.options=null;this.callback=null;this.callbackBefore=null;this.items=null;this.entities=null;this.mainPopupWindow=null;this.entitiesSet=["users","emails","crmemails","groups","sonetgroups","department","departmentRelation","contacts","companies","leads","deals"];this.entityTypes={};this.auxObject=null;this.selectorInstance=null;this.eventOpenBinded=false};BX.Main.SelectorV2.controls={};BX.Main.SelectorV2.create=function(t){if(typeof t.id=="undefined"||!t.id){t.id=BX.util.hashCode(Math.random().toString())}else if(typeof BX.Main.selectorManagerV2.controls[t.id]!="undefined"){var e=BX.Main.selectorManagerV2.controls[t.id];if(e.bindNode&&!document.body.contains(e.bindNode)){delete BX.Main.selectorManagerV2.controls[t.id]}else{return BX.Main.selectorManagerV2.controls[t.id]}}var i=new BX.Main.SelectorV2;BX.Main.selectorManagerV2.controls[t.id]=i;i.init(t);return i};BX.Main.SelectorV2.proxyCallback=function(t,e){t(e)};BX.Main.SelectorV2.prototype={init:function(t){this.id=t.id;this.apiVersion=t.apiVersion&&parseInt(t.apiVersion)>=2?parseInt(t.apiVersion):2;this.fieldName=t.fieldName?t.fieldName:null;this.inputId=t.inputId?t.inputId:null;this.input=t.inputId&&BX(t.inputId)?BX(t.inputId):null;this.inputBox=t.inputBoxId&&BX(t.inputBoxId)?BX(t.inputBoxId):null;this.inputItemsContainer=t.inputContainerId&&BX(t.inputContainerId)?BX(t.inputContainerId):null;this.containerNode=t.containerId&&BX(t.containerId)?BX(t.containerId):null;this.bindNode=t.bindId&&BX(t.bindId)?BX(t.bindId):this.containerNode;this.tagId=t.tagId?t.tagId:null;this.tag=t.tagId&&BX(t.tagId)?BX(t.tagId):null;this.openDialogWhenInit=typeof t.openDialogWhenInit=="undefined"||!!t.openDialogWhenInit;this.options=t.options||{};this.callback=t.callback||null;this.callbackBefore=t.callbackBefore||null;this.items=t.items||null;this.entities=t.entities||null;this.entityTypes={};BX.onCustomEvent("BX.Main.SelectorV2:onGetEntityTypes",[{selector:this}]);this.selectorInstance=BX.UI.Selector.create({id:this.id,fieldName:this.fieldName,type:"xxx",pathToAjax:BX.type.isNotEmptyString(t.pathToAjax)?t.pathToAjax:null,input:this.input||null,tag:this.tag||null,inputBox:this.inputBox||null,inputItemsContainer:this.inputItemsContainer||null,entities:BX.clone(this.entityTypes),itemsSelected:BX.clone(this.items.selected)||{},itemsUndeletable:BX.clone(this.items.undeletable)||[],options:{multiple:this.getOption("multiple"),useSearch:this.getOption("useSearch"),useContainer:this.getOption("useContainer")=="Y"?"Y":"N",userNameTemplate:this.getOption("userNameTemplate"),siteDepartmentId:this.getOption("siteDepartmentId"),showCloseIcon:"Y",popupAutoHide:this.getOption("popupAutoHide")=="N"?"N":"Y",last:{disable:this.getOption("disableLast")=="Y"?"Y":"N"},search:{useAjax:this.getOption("sendAjaxSearch")!="N"?"Y":"N",useClientDatabase:this.getOption("useClientDatabase")=="Y"?"Y":"N"},focusInputOnSelectItem:this.getOption("focusInputOnSelectItem")!="N"?"Y":"N",focusInputOnSwitchTab:this.getOption("focusInputOnSwitchTab")!="N"?"Y":"N",isCrmFeed:this.getOption("isCrmFeed")=="Y"?"Y":"N",tagLink1:this.getOption("tagLink1"),tagLink2:this.getOption("tagLink2")},bindOptions:{node:this.bindNode,offsetTop:5,offsetLeft:15,zIndex:parseInt(this.getOption("popupZIndex"))>0?parseInt(this.getOption("popupZIndex")):1200},callback:this.callback,callbackBefore:this.callbackBefore});BX.addCustomEvent("BX.UI.SelectorManager:getTreeItemRelation",function(t){if(this.id==t.selectorId){this.getTreeItemRelation(t)}}.bind(this));BX.addCustomEvent("BX.UI.SelectorManager:loadAll",function(t){this.loadAll(t)}.bind(this));BX.addCustomEvent("BX.Main.SelectorV2:initDialog",function(t){if(this.id==t.selectorId){if(!!t.openDialogWhenInit){this.openDialogWhenInit=true}this.initDialog()}}.bind(this));BX.addCustomEvent("BX.Main.SelectorV2:reInitDialog",function(t){if(this.id==t.selectorId){this.initialized=false;this.items.selected=BX.type.isNotEmptyObject(t.selectedItems)?t.selectedItems:{};this.items.undeletable=BX.type.isNotEmptyObject(t.undeletableItems)?t.undeletableItems:{};var e=BX.UI.SelectorManager.instances[t.selectorId],i=null,n=null,s=0;if(e){for(var o in e.itemsSelected){if(e.itemsSelected.hasOwnProperty(o)){i=e.itemsSelected[o].toUpperCase();n=BX.UI.SelectorManager.getEntityTypeFullList(i);for(s=0;s<n.length;s++){if(BX.type.isNotEmptyObject(e.entities[n[s]])){e.unselectItem({itemNode:BX.type.isNotEmptyObject(e.entities[n[s]].items)&&BX.type.isNotEmptyObject(e.entities[n[s]].items[o])?e.entities[n[s]].items[o]:false,itemId:o,entityType:n[s],mode:"reinit"})}}}}e.itemsSelected=this.items.selected;e.itemsUndeletable=this.items.undeletable}this.initDialog()}}.bind(this));BX.addCustomEvent("BX.UI.SelectorManager:searchRequest",function(t){if(this.id==t.selectorInstance.id){t.selectorInstance.timeouts.search=setTimeout(function(){this.searchRequest(t)}.bind(this),1e3)}}.bind(this));BX.addCustomEvent("BX.UI.Selector:onSelectItem",function(t){if(this.apiVersion>=3&&BX.type.isNotEmptyObject(t)&&this.id==t.selectorId&&BX.type.isNotEmptyString(t.itemId)){this.saveDestination({itemId:t.itemId})}}.bind(this));if(!BX.type.isNotEmptyString(this.getOption("lheName"))){var e=BX("div"+this.getOption("lheName"));if(e){BX.addCustomEvent(e,"OnShowLHE",function(t){if(!t){this.selectorInstance.closeAllPopups()}}.bind(this))}}if(this.getOption("useContainer")!="Y"&&this.input){if(this.getOption("lazyLoad")!="Y"||BX.type.isNotEmptyObject(this.items.selected)){if(BX.type.isNotEmptyObject(this.items.selected)){this.openDialogWhenInit=false}this.initDialog()}if(this.tag){BX.bind(this.tag,"focus",BX.delegate(function(t){this.initDialog({realParams:true,bByFocusEvent:true});return t.preventDefault()},this));this.selectorInstance.setTagTitle()}BX.bind(this.input,"keydown",function(t){this.selectorInstance.getSearchInstance().beforeSearchHandler({event:t})}.bind(this));BX.bind(this.input,"bxchange",function(e){setTimeout(function(){this.selectorInstance.getSearchInstance().searchHandler({event:e,tagInputName:t.tagId})}.bind(this),0)}.bind(this));this.input.setAttribute("data-bxchangehandler","Y")}else if(this.getOption("useContainer")=="Y"&&(this.getOption("lazyLoad")!="Y"||this.getOption("useContainer")=="Y")){this.initDialog()}if(this.items.hidden){for(var i in this.items.hidden){if(this.items.hidden.hasOwnProperty(i)){this.callback.select.apply({id:(typeof this.items.hidden[i]["PREFIX"]!="undefined"?this.items.hidden[i]["PREFIX"]:"SG")+this.items.hidden[i]["ID"],name:this.items.hidden[i]["NAME"]},typeof this.items.hidden[i]["TYPE"]!="undefined"?this.items.hidden[i]["TYPE"]:"sonetgroups","",true,"","init")}}}},show:function(){this.initDialog()},initDialog:function(t){if(typeof t=="undefined"||typeof t.realParams=="undefined"){t=null}if(this.blockInit){return}var e={id:this.id};if(!this.initialized){BX.onCustomEvent(window,"BX.Main.SelectorV2:beforeInitDialog",[e])}setTimeout(BX.delegate(function(){if(typeof e.blockInit=="undefined"||e.blockInit!==true){if(this.initialized){if(!this.mainPopupWindow||!this.mainPopupWindow.isShown()){if(this.input){this.input.style.display="inline-block"}if(this.inputBox){this.inputBox.style.display="inline-block"}this.openDialog(t)}}else{this.getData(BX.delegate(function(e){if(!!this.openDialogWhenInit){if(this.input){this.input.style.display="inline-block"}if(this.inputBox){this.inputBox.style.display="inline-block"}this.openDialog(t)}BX.onCustomEvent(window,"BX.Main.SelectorV2:afterInitDialog",[{id:this.id}]);if(typeof this.options.eventOpen!="undefined"&&!this.eventOpenBinded){this.eventOpenBinded=true;BX.addCustomEvent(window,this.options.eventOpen,function(t){if(typeof t.id=="undefined"||t.id!=this.id){return}if(this.options.multiple!="Y"&&this.inputItemsContainer&&this.inputItemsContainer.children.length>0){return}if(this.mainPopupWindow&&this.mainPopupWindow.isShown()){return}if(this.input){this.input.style.display="inline-block"}if(this.inputBox){this.inputBox.style.display="inline-block"}var e=BX.type.isNotEmptyObject(t)&&t.bindNode?t.bindNode:this.bindNode;var i=BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyObject(t.bindPosition)?t.bindPosition:false;if(e){var n=BX.findChild(e,{tagName:"input",attr:{type:"text"}},true);if(n){this.selectorInstance.nodes.input=n;var s=this.tag||BX(t.tagId);if(s){this.selectorInstance.nodes.tag=s}if(n.getAttribute("data-bxchangehandler")!=="Y"){BX.bind(n,"keydown",function(t){this.selectorInstance.getSearchInstance().beforeSearchHandler({event:t})}.bind(this));BX.bind(n,"bxchange",function(t){this.selectorInstance.getSearchInstance().searchHandler({event:t})}.bind(this));n.setAttribute("data-bxchangehandler","Y")}}}if(i||e){if(!this.initialized){this.selectorInstance.itemsSelected={}}if(typeof t.value!="undefined"){this.selectorInstance.itemsSelected=t.value}this.openDialog({bindNode:e,bindPosition:i})}}.bind(this))}},this))}}},this),1)},openDialog:function(t){if(BX.type.isNotEmptyObject(t)){if(typeof t.bindNode!="undefined"){this.selectorInstance.bindOptions.node=t.bindNode}if(typeof t.bindPosition!="undefined"){this.selectorInstance.bindOptions.position=t.bindPosition}}this.selectorInstance.openDialog();this.mainPopupWindow=this.getOption("useContainer")=="Y"?this.selectorInstance.popups.container:this.selectorInstance.popups.main},closeDialog:function(){this.selectorInstance.closeDialog()},getData:function(t){this.blockInit=true;BX.onCustomEvent("BX.Main.SelectorV2:onGetDataStart",[this.id]);BX.ajax.runComponentAction("bitrix:main.ui.selector","getData",{mode:"ajax",data:{options:this.options,entityTypes:this.entityTypes,selectedItems:this.items.selected||{}}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)){this.blockInit=false;BX.onCustomEvent("BX.Main.SelectorV2:onGetDataFinish",[this.id]);this.addData(e.data,t);this.initialized=true}}.bind(this),function(t){this.blockInit=false;BX.onCustomEvent("BX.Main.SelectorV2:onGetDataFinish",[this.id])}.bind(this))},loadAll:function(t){var e=BX.type.isNotEmptyString(t.entity)?t.entity.toUpperCase():"USERS";if(BX.type.isNotEmptyObject(t)&&BX.type.isFunction(t.callback)&&!BX.Main.selectorManagerV2.loadedEntities[e]){BX.Main.selectorManagerV2.loadedEntities[e]=true;BX.ajax.runComponentAction("bitrix:main.ui.selector","loadAll",{mode:"ajax",data:{entityType:e}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)){for(var i in e.data){if(e.data.hasOwnProperty(i)){BX.onCustomEvent("onFinderAjaxLoadAll",[e.data[i],BX.UI.SelectorManager,i.toLowerCase()])}}t.callback()}}.bind(this),function(t){}.bind(this))}},searchRequest:function(t){this.blockInit=true;if(this.selectorInstance.timeouts.search){clearTimeout(this.selectorInstance.timeouts.search)}var e=new Date;this.selectorInstance.searchRequestId=e.getTime();BX.ajax.runComponentAction("bitrix:main.ui.selector","doSearch",{mode:"ajax",data:{searchString:t.searchString,searchStringConverted:BX.message("LANGUAGE_ID")=="ru"&&BX.correctText?BX.correctText(t.searchString):"",currentTimestamp:this.selectorInstance.searchRequestId,options:this.options,entityTypes:this.entityTypes,additionalData:BX.type.isNotEmptyObject(t.additionalData)?t.additionalData:{}},onrequeststart:function(t){this.selectorInstance.searchXhr=t}.bind(this)}).then(function(e){this.blockInit=false;if(BX.type.isNotEmptyObject(e.data)&&e.data.currentTimestamp&&e.data.currentTimestamp==this.selectorInstance.searchRequestId&&BX.type.isNotEmptyObject(t.callback)&&BX.type.isFunction(t.callback.success)){t.callback.success(e.data,{searchString:t.searchString,searchStringOriginal:BX.type.isNotEmptyObject(t.searchStringOriginal)?t.searchStringOriginal:t.searchString})}}.bind(this),function(e){this.blockInit=false;if(BX.type.isNotEmptyObject(t.callback)&&BX.type.isFunction(t.callback.failure)){t.callback.failure(BX.type.isNotEmptyObject(e.data)?e.data:{})}}.bind(this))},getTreeItemRelation:function(t){BX.ajax.runComponentAction("bitrix:main.ui.selector","getTreeItemRelation",{mode:"ajax",data:{entityType:t.entityType,categoryId:t.categoryId,allowSearchSelf:t.allowSearchSelf}}).then(function(e){if(BX.type.isNotEmptyObject(e.data)&&typeof t.callback!="undefined"){t.callback({selectorInstanceId:this.selectorInstance.id,entityType:t.entityType,categoryId:t.categoryId,data:e.data})}}.bind(this),function(t){})},addData:function(t,e){BX.onCustomEvent("BX.Main.SelectorV2:onAddData",[this.id,t]);if(typeof t.ENTITIES.CRM!="undefined"&&typeof t.ENTITIES.CRM.ITEMS_LAST!="undefined"&&BX.type.isNotEmptyObject(t.ENTITIES.CRM.ITEMS_LAST)){}e.apply(this,t)},getId:function(){return this.id},getOption:function(t){return typeof this.options[t]!="undefined"?this.options[t]:null},saveDestination:function(t){if(BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyString(t.itemId)){var e=this.getOption("context");if(BX.type.isNotEmptyString(e)){BX.ajax.runComponentAction("bitrix:main.ui.selector","saveDestination",{mode:"ajax",data:{context:e,itemId:t.itemId}}).then(function(t){},function(t){})}}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:90:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js?1726456244176333";s:6:"source";s:69:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.ui.filter/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};(function(e,t,i,s,n){"use strict";(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["date-group"]=function(e){var t,i,s,n,a;t={block:"main-ui-control-field-group",name:e.name+"_datesel",mix:"mix"in e?e.mix:null,attrs:{"data-type":"type"in e?e.type:"","data-name":"name"in e?e.name:"","data-time":e.enableTime},content:[]};if("label"in e&&BX.type.isNotEmptyString(e.label)){var r=e.label;if("icon"in e&&BX.Type.isPlainObject(e.icon)){r=[{block:"main-ui-control-field-label-icon",tag:"img",attrs:{title:e.icon.title?e.icon.title:"",src:e.icon.url}},{block:"main-ui-control-field-label-text",tag:"span",content:r}]}n={block:"main-ui-control-field-label",tag:"span",attrs:{title:e.label},content:r};t.content.push(n)}i={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:"",items:"items"in e?e.items:"",name:"name"in e?e.name+"_datesel":"",params:"params"in e?e.params:"",valueDelete:false}};t.content.push(i);if("content"in e&&BX.type.isArray(e.content)){e.content.forEach((function(e){t.content.push(e)}))}if("content"in e&&(BX.type.isPlainObject(e.content)||BX.type.isNotEmptyString(e.content))){t.content.push(e.content)}s={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in e&&e.deleteTitle?e.deleteTitle:""}}};t.content.push(s);if(!("dragButton"in e)||e.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}};t.content.push(a)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field"]=function(e){var t,i,s,n,a;t={block:"main-ui-control-field",mix:"mix"in e?e.mix:null,attrs:{"data-type":"type"in e?e.type:"","data-name":"name"in e?e.name:""},content:[]};if("label"in e&&BX.type.isNotEmptyString(e.label)){var r=e.label;if("icon"in e&&BX.Type.isPlainObject(e.icon)){r=[{block:"main-ui-control-field-label-icon",tag:"img",attrs:{title:e.icon.title?e.icon.title:"",src:e.icon.url}},{block:"main-ui-control-field-label-text",tag:"span",content:r}]}n={block:"main-ui-control-field-label",tag:"span",attrs:{title:e.label},content:r};t.content.push(n)}if(BX.type.isArray(e.content)){e.content.forEach((function(e){t.content.push(e)}))}else if(BX.type.isPlainObject(e.content)||BX.type.isNotEmptyString(e.content)){t.content.push(e.content)}if("valueDelete"in e&&e.valueDelete===true){s={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};t.content.push(s)}if("deleteButton"in e&&e.deleteButton===true){i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in e&&e.deleteTitle?e.deleteTitle:""}}};t.content.push(i)}if(!("dragButton"in e)||e.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}};t.content.push(a)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-field-group"]=function(e){var t,i,s,n;t={block:"main-ui-control-field-group",mix:"mix"in e?e.mix:null,attrs:{"data-type":"type"in e?e.type:"","data-name":"name"in e?e.name:""},content:[]};if("label"in e&&BX.type.isNotEmptyString(e.label)){var a=e.label;if("icon"in e&&BX.Type.isPlainObject(e.icon)){a=[{block:"main-ui-control-field-label-icon",tag:"img",attrs:{title:e.icon.title?e.icon.title:"",src:e.icon.url}},{block:"main-ui-control-field-label-text",tag:"span",content:a}]}s={block:"main-ui-control-field-label",tag:"span",attrs:{title:e.label},content:a};t.content.push(s)}if(BX.type.isArray(e.content)){e.content.forEach((function(e){t.content.push(e)}))}else if(BX.type.isPlainObject(e.content)||BX.type.isNotEmptyString(e.content)){t.content.push(e.content)}if("deleteButton"in e&&e.deleteButton===true){i={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in e&&e.deleteTitle?e.deleteTitle:""}}};t.content.push(i)}if(!("dragButton"in e)||e.dragButton!==false){n={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}};t.content.push(n)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-string"]=function(e){return{block:"main-ui-control-string",mix:["main-ui-control"],tag:"input",attrs:{type:"type"in e?e.type:"text",name:"name"in e?e.name:"",placeholder:"placeholder"in e?e.placeholder:"",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:""}}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-control-textarea"]=function(e){return{block:"main-ui-control-string",mix:["main-ui-control main-ui-control-textarea"],tag:"textarea",attrs:{name:"name"in e?e.name:"",placeholder:"placeholder"in e?e.placeholder:"",tabindex:"tabindex"in e?e.tabindex:""},content:"value"in e?e.value:""}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-field-list-item"]=function(e){var t={block:"main-ui-select-inner-label",content:"label"in e?e.label:""};var i={block:"main-ui-filter-field-list-item",mix:"main-ui-select-inner-item",attrs:{"data-id":e.id,"data-name":e.name,"data-item":"item"in e?JSON.stringify(e.item):{}},events:{click:"onClick"in e?e.onClick:""},content:t};return i}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-filter-info"]=function(e){return{block:"main-ui-filter-info",tag:"span",content:e.content,attrs:{title:e.title}}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-number"]=function(e){var t,i,s;t={block:"main-ui-number",mix:["main-ui-control"],content:[]};if("mix"in e&&BX.type.isArray(e.mix)){e.mix.forEach((function(e){t.mix.push(e)}))}i={block:"main-ui-number-input",mix:["main-ui-control-input"],tag:"input",attrs:{type:"number",name:"name"in e?e.name:"",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:"",placeholder:"placeholder"in e?e.placeholder:"",autocomplete:"off"}};t.content.push(i);if("valueDelete"in e&&e.valueDelete===true){s={block:"main-ui-control-value-delete",content:{block:"main-ui-control-value-delete-item",tag:"span"}};t.content.push(s)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["main-ui-search-square"]=function(e){var t=["main-ui-filter-search-square"];if("isPreset"in e&&e.isPreset){t.push("main-ui-filter-search-square-preset")}var i="title"in e?e.title:"";var s="name"in e?BX.util.htmlspecialcharsback(e.name):"";if("icon"in e&&BX.Type.isPlainObject(e.icon)){var n=e.icon.title;i=i.length?n+": "+i:"";s=s.length?n+": "+s:""}return{block:"main-ui-square",mix:t,attrs:{"data-item":"item"in e?JSON.stringify(e.item):"",title:i},content:[{block:"main-ui-square-item",content:s},{block:"main-ui-square-delete",mix:["main-ui-item-icon"]}]}}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["number-group"]=function(e){var t,i,s,n,a;t={block:"main-ui-control-field-group",name:"name"in e?e.name+"_numsel":"",mix:"mix"in e?e.mix:null,attrs:{"data-type":"type"in e?e.type:"","data-name":"name"in e?e.name:""},content:[]};if("label"in e&&BX.type.isNotEmptyString(e.label)){var r=e.label;if("icon"in e&&BX.Type.isPlainObject(e.icon)){r=[{block:"main-ui-control-field-label-icon",tag:"img",attrs:{title:e.icon.title?e.icon.title:"",src:e.icon.url}},{block:"main-ui-control-field-label-text",tag:"span",content:r}]}n={block:"main-ui-control-field-label",tag:"span",attrs:{title:e.label},content:r};t.content.push(n)}i={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in e?e.tabindex:"",value:"value"in e?e.value:"",items:"items"in e?e.items:"",name:"name"in e?e.name+"_numsel":"",params:"params"in e?e.params:"",valueDelete:false}};t.content.push(i);if("content"in e&&BX.type.isArray(e.content)){e.content.forEach((function(e){t.content.push(e)}))}if("content"in e&&(BX.type.isPlainObject(e.content)||BX.type.isNotEmptyString(e.content))){t.content.push(e.content)}s={block:"main-ui-item-icon-container",content:{block:"main-ui-item-icon",mix:["main-ui-delete","main-ui-filter-field-delete"],tag:"span",attrs:{title:"deleteTitle"in e&&e.deleteTitle?e.deleteTitle:""}}};t.content.push(s);if(!("dragButton"in e)||e.dragButton!==false){a={block:"main-ui-filter-icon-grab",mix:["main-ui-item-icon"],tag:"span",attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}};t.content.push(a)}return t}})();(function(){BX.namespace("BX.Main.ui.block");BX.Main.ui.block["sidebar-item"]=function(e){return{block:"main-ui-filter-sidebar-item"+("pinned"in e&&e.pinned?" main-ui-item-pin":""),attrs:{"data-id":"id"in e?e.id:""},content:[{block:"main-ui-filter-icon-grab",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"dragTitle"in e&&e.dragTitle?e.dragTitle:""}},{block:"main-ui-filter-sidebar-item-text-container",tag:"span",content:[{block:"main-ui-filter-sidebar-item-input",tag:"input",attrs:{type:"text",placeholder:"placeholder"in e?e.placeholder:"",value:"text"in e?BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(e.text)):""}},{block:"main-ui-filter-sidebar-item-text",tag:"span",content:"text"in e?e.text:"",attrs:{title:"text"in e?e.text:""}},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"noEditPinTitle"in e&&e.noEditPinTitle?e.noEditPinTitle:""}}]},{block:"main-ui-filter-icon-edit",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editNameTitle"in e&&e.editNameTitle?e.editNameTitle:""}},{block:"main-ui-delete",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"removeTitle"in e&&e.removeTitle?e.removeTitle:""}},{block:"main-ui-filter-icon-pin",tag:"span",mix:["main-ui-item-icon"],attrs:{title:"editPinTitle"in e&&e.editPinTitle?e.editPinTitle:""}},{block:"main-ui-filter-edit-mask"}]}}})();(function(){BX.namespace("BX.Filter");BX.Filter.Utils={cache:{},styleForEach:function e(t,i){var s;i=BX.type.isPlainObject(i)?i:null;s=Object.keys(i);[].forEach.call(t||[],(function(e){s.forEach((function(t){BX.style(e,t,i[t])}))}))},closestParent:function e(t,i){if(t){if(!i){return t.parentNode||null}else{return BX.findParent(t,{className:i})}}},closestChilds:function e(t){return!!t?t.children:null},getNext:function e(t){return!!t?t.nextElementSibling:null},getPrev:function e(t){return!!t?t.previousElementSibling:null},collectionSort:function e(t,i){var s,n,a,r,l;if(t&&i&&t!==i&&t.parentNode===i.parentNode){s=this.closestParent(i);n=this.closestChilds(s);a=n.length;r=this.getIndex(n,t);l=this.getIndex(n,i);if(a===l){s.appendChild(i)}if(r>l){s.insertBefore(t,i)}if(r<l&&a!==l){s.insertBefore(t,this.getNext(i))}}},getIndex:function e(t,i){return[].indexOf.call(t||[],i)},getByClass:function e(t,i,s){var n=[];if(i){n=(t||document.body).getElementsByClassName(i);if(!s){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function e(t,i,s){var n=[];if(i){n=(t||document.body).getElementsByTagName(i);if(!s){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function e(t,i,s){var n=[];if(i){if(!s){n=(t||document.body).querySelector(i)}else{n=(t||document.body).querySelectorAll(i);n=[].slice.call(n)}}return n},requestAnimationFrame:function e(){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};t.apply(window,arguments)},sortObject:function e(t){var i={};Object.keys(t).sort().forEach((function(e){i[e]=t[e]}));return i},objectsIsEquals:function e(t,i){return JSON.stringify(t)===JSON.stringify(i)},isKey:function e(t,i){var s={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"escape",32:"space",37:"leftArrow",38:"upArrow",39:"rightArrow",40:"downArrow",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",65:"a"};var n=!!t?"keyCode"in t?t.keyCode:"which"in t?t.which:0:0;return n in s&&s[n]===i}}})();(function(){BX.namespace("BX.Filter");BX.Filter.DestinationSelectorManager={fields:[],controls:{},onSelect:function e(t,i,s){if(!BX.type.isNotEmptyObject(s)||!BX.type.isNotEmptyObject(s.item)||!BX.type.isNotEmptyString(s.selectorId)){return}var n=s.selectorId,a=s.item;var r=BX.Filter.DestinationSelectorManager.controls[n];if(r){var l=a.id;if(BX.type.isNotEmptyString(t)&&t=="Y"&&BX.type.isNotEmptyString(i)){var o=new RegExp("^"+i+"(\\d+)$");var u=l.match(o);if(BX.type.isArray(u)){l=u[1]}}else{var c={};BX.onCustomEvent(window,"BX.Filter.DestinationSelector:convert",[{selectorId:n,value:l},c]);if(BX.type.isNotEmptyString(c.value)){l=c.value}}r.setData(BX.util.htmlspecialcharsback(a.name),l);r.getLabelNode().value="";r.getLabelNode().blur()}},onDialogOpen:function e(t){if(typeof t=="undefined"||!BX.type.isNotEmptyString(t.selectorId)){return}var i=t.selectorId;var s=BX.Filter.DestinationSelector.items[i];if(s){s.onDialogOpen()}},onDialogClose:function e(t){if(typeof t=="undefined"||!BX.type.isNotEmptyString(t.selectorId)){return}var i=t.selectorId;var s=BX.Filter.DestinationSelector.items[i];if(s){s.onDialogClose()}}};BX.Filter.DestinationSelector=function(){this.id="";this.filterId="";this.settings={};this.fieldId="";this.control=null;this.inited=null};BX.Filter.DestinationSelector.items={};BX.Filter.DestinationSelector.create=function(e,t){if(typeof this.items[e]!="undefined"){return this.items[e]}var i=new BX.Filter.DestinationSelector(e,t);i.initialize(e,t);this.items[e]=i;BX.onCustomEvent(window,"BX.Filter.DestinationSelector:create",[e]);return i};BX.Filter.DestinationSelector.prototype.getSetting=function(e,t){return this.settings.hasOwnProperty(e)?this.settings[e]:t};BX.Filter.DestinationSelector.prototype.getSearchInput=function(){return this.control?this.control.getLabelNode():null};BX.Filter.DestinationSelector.prototype.initialize=function(e,t){this.id=e;this.settings=t?t:{};this.fieldId=this.getSetting("fieldId","");this.filterId=this.getSetting("filterId","");this.inited=false;this.opened=null;var i=this.getSetting("initialValue",false);if(!!i){var s={};s[this.fieldId]=i.itemId;s[this.fieldId+"_label"]=i.itemName;BX.Main.filterManager.getById(this.filterId).getApi().setFields(s)}BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this));BX.addCustomEvent(window,"BX.Main.Filter:onGetStopBlur",BX.delegate(this.onGetStopBlur,this));BX.addCustomEvent(window,"BX.Main.SelectorV2:beforeInitDialog",BX.delegate(this.onBeforeInitDialog,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityRemove",BX.delegate(this.onCustomEntityRemove,this))};BX.Filter.DestinationSelector.prototype.open=function(){var e=this.id;if(!this.inited){var t=this.getSearchInput();t.id=t.name;BX.addCustomEvent(window,"BX.Main.SelectorV2:afterInitDialog",BX.delegate((function(e){if(typeof e.id!="undefined"||e.id!=this.id){return}this.opened=true}),this));BX.addCustomEvent(window,"BX.UI.SelectorManager:onCreate",BX.delegate((function(e){if(!BX.type.isNotEmptyString(e)||e!=this.id){return}BX.onCustomEvent(window,"BX.Filter.DestinationSelector:setSelected",[{selectorId:e,current:this.control.getCurrentValues()}])}),this));BX.onCustomEvent(window,"BX.Filter.DestinationSelector:openInit",[{id:this.id,inputId:t.id,containerId:t.id}])}else{var i={};i[this.currentUser.entityId]="users";BX.onCustomEvent(window,"BX.Filter.DestinationSelector:open",[{id:this.id,bindNode:this.control.getField(),value:i}]);this.opened=true}};BX.Filter.DestinationSelector.prototype.close=function(){if(typeof BX.Main.selectorManagerV2.controls[this.id]!=="undefined"){BX.Main.selectorManagerV2.controls[this.id].closeDialog()}};BX.Filter.DestinationSelector.prototype.onCustomEntitySelectorOpen=function(e){var t=e.getId();if(this.fieldId!==t){this.control=null}else{this.control=e;if(this.control){var i=this.control.getCurrentValues();this.currentUser={entityId:i["value"]}}BX.Filter.DestinationSelectorManager.controls[this.id]=this.control;if(!this.opened){this.open()}else{this.close()}}};BX.Filter.DestinationSelector.prototype.onCustomEntitySelectorClose=function(e){if(this.fieldId===e.getId()&&this.inited===true&&this.opened===true){this.control=null;window.setTimeout(BX.delegate(this.close,this),0)}};BX.Filter.DestinationSelector.prototype.onGetStopBlur=function(e,t){if(BX.findParent(e.target,{className:"bx-lm-box"})){t.stopBlur=true}};BX.Filter.DestinationSelector.prototype.onCustomEntityRemove=function(e){if(this.fieldId===e.getId()){var t=BX.UI.SelectorManager.instances[e.getId()];if(t&&typeof e.hiddenInput!="undefined"&&typeof e.hiddenInput.value!="undefined"&&BX.type.isNotEmptyObject(t.itemsSelected)&&typeof t.itemsSelected[e.hiddenInput.value]!="undefined"){delete t.itemsSelected[e.hiddenInput.value]}}};BX.Filter.DestinationSelector.prototype.onBeforeInitDialog=function(e){if(typeof e.id=="undefined"||e.id!=this.id){return}this.inited=true;if(!this.control){e.blockInit=true}};BX.Filter.DestinationSelector.prototype.onDialogOpen=function(){this.opened=true};BX.Filter.DestinationSelector.prototype.onDialogClose=function(){this.opened=false}})();function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function r(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var l=function(){function e(t,s){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id",null);babelHelpers.defineProperty(this,"filter",null);babelHelpers.defineProperty(this,"dialog",null);babelHelpers.defineProperty(this,"dialogOptions",null);babelHelpers.defineProperty(this,"control",null);babelHelpers.defineProperty(this,"isMultiple",false);babelHelpers.defineProperty(this,"needAddEntityIdToFilter",false);babelHelpers.defineProperty(this,"isActive",false);babelHelpers.defineProperty(this,"needShowDialogOnEmptyInput",true);this.id=t;this.settings=s?s:{};this.filter=this.getSetting("filter",null);if(!this.filter){throw new Error("Filter option is required for EntitySelector field")}this.isMultiple=!!this.getSetting("isMultiple",false);this.needAddEntityIdToFilter=this.getSetting("addEntityIdToResult","N")==="Y";this.needShowDialogOnEmptyInput=!!this.getSetting("showDialogOnEmptyInput",true);this.dialogOptions=this.prepareDialogOptions();this.dialog=null;i.EventEmitter.subscribe("BX.Main.Filter:customEntityFocus",this.onCustomEntityFocus.bind(this));i.EventEmitter.subscribe("BX.Main.Filter:customEntityBlur",this.onCustomEntityBlur.bind(this));i.EventEmitter.subscribe("BX.Main.Filter:onGetStopBlur",this.onGetStopBlur.bind(this));i.EventEmitter.subscribe("BX.Main.Filter:move",this.onCustomEntityRemove.bind(this));i.EventEmitter.subscribe("BX.Main.Filter:onApplyPreset",this.onApplyPreset.bind(this));this.controlInputChangeHandler=this.onSearchInputChange.bind(this)}babelHelpers.createClass(e,[{key:"open",value:function e(){var t=this;this.isActive=true;if(!this.dialog){this.initDialog().then((function(){if(t.isActive){t.openDialog()}}))}else{this.openDialog()}}},{key:"close",value:function e(){this.isActive=false;if(this.dialog&&this.dialog.isOpen()){this.dialog.hide()}}},{key:"getFilterField",value:function e(){return this.filter.getField(this.id)}},{key:"getFilterFieldInputWrapper",value:function e(){var t=this.getFilterField();if(!t){return null}return BX.Filter.Utils.getBySelector(t.node,".main-ui-control-entity")}},{key:"getFilterFieldInput",value:function e(){var t=this.getFilterField();if(!t){return null}return BX.Filter.Utils.getBySelector(t.node,"."+this.filter.settings.classStringInput+'[type="text"]')}},{key:"setControl",value:function e(t){this.control=t}},{key:"unsetControl",value:function e(){this.control=null}},{key:"getSetting",value:function e(t,i){return this.settings.hasOwnProperty(t)?this.settings[t]:i}},{key:"prepareDialogOptions",value:function e(){var t={enableSearch:false,hideOnSelect:true,autoHide:false,hideByEsc:false};var i=this.getSetting("dialogOptions",{});i=Object.assign(t,i);return i}},{key:"openDialog",value:function e(){if(this.dialog.isOpen()){return}var t=this.getFilterFieldInputWrapper();var i=this.getFilterFieldInput();var s=n.Type.isDomNode(i)?i.value.trim():"";this.dialog.setTargetNode(t);this.dialog.setWidth(t.offsetWidth);if(this.needShowDialogOnEmptyInput||s.length){this.dialog.show()}this.updateSelectedItemsInDialog(this.dialog);if(s.length){this.dialog.search(s)}}},{key:"initDialog",value:function t(){var s=this;return e.initDialogExtension().then((function(e){var t=e.Dialog;s.dialog=new t(r(r({},s.dialogOptions),{},{id:s.getDialogId(),multiple:s.isMultiple}));i.EventEmitter.subscribe(s.dialog,"Item:onSelect",s.onDialogItemSelect.bind(s));i.EventEmitter.subscribe(s.dialog,"Item:onDeselect",s.onDialogItemDeSelect.bind(s));i.EventEmitter.subscribe(s.dialog,"onLoad",s.onDialogLoad.bind(s));var a=s.getFilterFieldInput();n.Event.bind(a,"input",s.controlInputChangeHandler)}))}},{key:"addItemToFilter",value:function e(t,i){if(!this.control){return}if(this.isMultiple){var s=this.control.getCurrentValues();if(!s.filter((function(e){return e.value===t})).length){s.push({value:t,label:i});this.control.setMultipleData(s)}}else{this.control.setSingleData(i,t)}}},{key:"removeItemFromFilter",value:function e(t){if(!this.control){return}if(this.isMultiple){var i=this.control.getCurrentValues();this.control.setMultipleData(i.filter((function(e){return e.value!==t})))}else{this.control.clearValue()}}},{key:"getDialogId",value:function e(){return this.id+"_"+this.filter.getParam("FILTER_ID")}},{key:"getItemId",value:function e(t){if(this.needAddEntityIdToFilter){return JSON.stringify([t.getEntityId()+"",t.getId()+""])}return t.getId()+""}},{key:"updateSelectedItemsInDialog",value:function e(t){var i=this;if(!this.control){return}var s=this.control.getCurrentValues();if(!this.isMultiple){s=[s]}var n=s.map((function(e){return e.value}));t.getItems().forEach((function(e){if(n.indexOf(i.getItemId(e))>-1){e.select(true)}else{e.deselect()}}))}},{key:"onCustomEntityFocus",value:function e(t){var i=t.getData(),s=babelHelpers.slicedToArray(i,1),n=s[0];if(this.id!==n.getId()){return}this.setControl(n);this.open()}},{key:"onCustomEntityBlur",value:function e(t){var i=t.getData(),s=babelHelpers.slicedToArray(i,1),n=s[0];if(this.id!==n.getId()){return}this.close();this.unsetControl()}},{key:"onGetStopBlur",value:function e(t){var i=t.getData(),s=babelHelpers.slicedToArray(i,2),a=s[0],r=s[1];if(!(this.dialog&&this.dialog.isOpen())){return}var l=this.getFilterField();if(!l){return}var o=a.target;if(o===l.node||l.node.contains(o)&&!n.Dom.hasClass(o,this.filter.settings.classFieldDelete)||o===document.body){r.stopBlur=true;return}var u=this.dialog.getPopup().getContentContainer();if(o===u||u.contains(o)){r.stopBlur=true}}},{key:"onCustomEntityRemove",value:function e(t){var i=t.getData(),s=babelHelpers.slicedToArray(i,1),n=s[0];if(this.id!==n.getId()){return}if(this.dialog){this.dialog.destroy();this.dialog=null}this.unsetControl()}},{key:"onApplyPreset",value:function e(t){if(this.dialog){this.dialog.destroy();this.dialog=null}this.unsetControl()}},{key:"onSearchInputChange",value:function e(t){if(this.dialog){if(!this.needShowDialogOnEmptyInput){if(t.target.value){this.open()}else{this.close()}}this.dialog.search(t.target.value)}}},{key:"onDialogItemSelect",value:function e(t){var i=t.getData(),s=i.item;this.addItemToFilter(this.getItemId(s),s.getTitle());this.getFilterFieldInput().value=""}},{key:"onDialogItemDeSelect",value:function e(t){var i=t.getData(),s=i.item;this.removeItemFromFilter(this.getItemId(s))}},{key:"onDialogLoad",value:function e(t){var i=t.getTarget();this.updateSelectedItemsInDialog(i)}}],[{key:"initDialogExtension",value:function t(){if(!e.initExtensionPromise){e.initExtensionPromise=n.Runtime.loadExtension("ui.entity-selector")}return e.initExtensionPromise}},{key:"create",value:function t(i,s){if(n.Type.isObject(this.items[i])){if(n.Type.isObject(s.filter)){this.items[i].filter=s.filter}return this.items[i]}var a=new e(i,s);this.items[i]=a;return a}}]);return e}();babelHelpers.defineProperty(l,"initExtensionPromise",null);babelHelpers.defineProperty(l,"items",{});var o=n.Reflection.namespace("BX.Filter");o.EntitySelector=l;(function(){BX.namespace("BX.Filter");BX.Filter.FieldController=function(e,t){this.field=null;this.parent=null;this.type=null;this.input=null;this.deleteButton=null;this.init(e,t)};BX.Filter.FieldController.prototype={init:function e(t,i){if(!BX.type.isDomNode(t)){throw"BX.Filter.FieldController.init: field isn't dom node"}if(!(i instanceof BX.Main.Filter)){throw"BX.Filter.FieldController.init: parent not instance of BX.Main.ui.Filter"}this.field=t;this.parent=i;this.bind();this.isShowDelete()?this.showDelete():this.hideDelete()},isShowDelete:function e(){var t=this.getSquares();return this.getInputValue()||BX.type.isArray(t)&&t.length},getField:function e(){return this.field},getInput:function e(){var t,i;if(!BX.type.isDomNode(this.input)){t=this.getType();i=this.parent.types;if(t===i.DATE){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classDateInput)}if(t===i.NUMBER||t==="number"){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classNumberInput)}if(t===i.STRING){this.input=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classStringInput)}if(t===i.CUSTOM_ENTITY){this.input=BX.Filter.Utils.getBySelector(this.getField(),'input[type="hidden"]')}}return this.input},getDeleteButton:function e(){if(!BX.type.isDomNode(this.deleteButton)){this.deleteButton=BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classValueDelete)}return this.deleteButton},getSquares:function e(){return BX.Filter.Utils.getByClass(this.getField(),this.parent.settings.classSquare)},bind:function e(){if(this.getType()!==this.parent.types.MULTI_SELECT&&this.getType()!==this.parent.types.SELECT){BX.bind(this.getDeleteButton(),"click",BX.delegate(this._onDeleteClick,this));BX.bind(this.getInput(),"input",BX.delegate(this._onInput,this))}},clearInput:function e(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=""}},hideDelete:function e(){var t=this.getDeleteButton();if(BX.type.isDomNode(t)){BX.addClass(t,this.parent.settings.classHide)}},showDelete:function e(){var t=this.getDeleteButton();if(BX.type.isDomNode(t)){BX.removeClass(t,this.parent.settings.classHide)}},removeSquares:function e(){var t=this.getSquares();if(BX.type.isArray(t)&&t.length){t.forEach((function(e){BX.remove(e)}))}},_onDeleteClick:function e(){this.removeSquares();this.clearInput();this.hideDelete()},_onInput:function e(){this.getInputValue()?this.showDelete():this.hideDelete()},getInputValue:function e(){var t="";var i=this.getInput();if(BX.type.isDomNode(i)){t=i.value}return t},getType:function e(){if(!BX.type.isNotEmptyString(this.type)){this.type=BX.data(this.getField(),"type")}return this.type}}})();(function(){BX.namespace("BX.Main.ui");BX.Main.ui.CustomEntity=function(){this.field=null;this.labelInput=null;this.hiddenInput=null;this.popupContainer=null;this.inputClass="main-ui-control-string";this.squareClass="main-ui-square";this.multiple=null};BX.Main.ui.CustomEntity.isMultiple=function(e){if(!!e&&!BX.hasClass(e,"main-ui-control-entity")){e=BX.Filter.Utils.getByClass(e,"main-ui-control-entity")}return!!e&&JSON.parse(BX.data(e,"multiple"))};BX.Main.ui.CustomEntity.prototype={setField:function e(t){if(this.field!==t){this.field=t;this.reset()}},isMultiple:function e(){return BX.Main.ui.CustomEntity.isMultiple(this.getField())},reset:function e(){this.labelInput=null;this.hiddenInput=null},getField:function e(){return this.field},getId:function e(){var t=this.getHiddenNode();var i=null;if(BX.type.isDomNode(t)){i=t.name}return i},getLabelNode:function e(){if(!BX.type.isDomNode(this.labelInput)){this.labelInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="text"]')}return this.labelInput},getHiddenNode:function e(){if(!BX.type.isDomNode(this.hiddenInput)){this.hiddenInput=BX.Filter.Utils.getBySelector(this.getField(),"."+this.inputClass+'[type="hidden"]')}return this.hiddenInput},getSquareByValue:function e(t){return BX.Filter.Utils.getBySelector(this.getField(),['[data-item*=":'+BX.util.jsencode(t)+'}"]','[data-item*=":\\"'+BX.util.jsencode(t)+'\\"}"]'].join(", "))},getSquares:function e(){return BX.Filter.Utils.getByClass(this.getField(),this.squareClass,true)},removeSquares:function e(){this.getSquares().forEach(BX.remove)},setSquare:function e(t,i){var s=this.getField();var n={block:"main-ui-square",name:t,item:{_label:t,_value:i}};var a=BX.decl(n);var r=this.getSquares();if(!r.length){BX.prepend(a,s)}else{BX.insertAfter(a,r[r.length-1])}},getCurrentValues:function e(){var t=this.getSquares();var i,s;if(this.isMultiple()){s=[];for(var n=0,a=t.length;n<a;n++){try{i=JSON.parse(BX.data(t[n],"item"));s.push({label:i._label,value:i._value})}catch(e){}}}else{if(t.length===0){s={label:"",value:""}}else{try{i=JSON.parse(BX.data(t[0],"item"));s={label:i._label,value:i._value}}catch(e){s={label:"",value:""}}}}return s},setData:function e(t,i){return this.isMultiple()?this.setMultipleData(t,i):this.setSingleData(t,i)},setSingleData:function e(t,i){var s=this.getHiddenNode();this.removeSquares();this.setSquare(t,i);if(BX.type.isDomNode(s)){s.value=i;BX.fireEvent(s,"input")}},setMultipleData:function e(t,i){var s=[];var n=this.getHiddenNode();if(BX.type.isArray(t)){this.removeSquares();if(BX.type.isArray(t)){t.forEach((function(e){s.push(e.value);this.setSquare(e.label,e.value)}),this);if(BX.type.isDomNode(n)){n.value=JSON.stringify(s);BX.fireEvent(n,"input")}}}if(!BX.type.isArray(t)&&i!==null){if(!this.getSquareByValue(i)){this.setSquare(t,i);this.getSquares().forEach((function(e){var t=JSON.parse(BX.data(e,"item"));if(BX.type.isPlainObject(t)){s.push(t._value)}}));n.value=JSON.stringify(s);BX.fireEvent(n,"input")}}},clearValue:function e(){this.removeSquares();var t=this.getHiddenNode();t.value=this.isMultiple()?"[]":""},setPopupContainer:function e(t){if(BX.type.isDomNode(t)){this.popupContainer=t}},getPopupContainer:function e(){return this.popupContainer}}})();(function(){BX.namespace("BX.Filter");BX.Filter.Search=function(e){this.parent=null;this.container=null;this.input=null;this.preset=null;this.buttonsContainer=null;this.delay=800;this.timeout=null;this.init(e)};BX.Filter.Search.prototype={init:function e(t){this.parent=t;BX.bind(this.getInput(),"input",BX.delegate(this._onInputWithoutDebounce,this));if(this.parent.getParam("ENABLE_LIVE_SEARCH")){BX.bind(this.getInput(),"input",BX.debounce(this._onInput,this.delay,this))}BX.bind(this.getInput(),"keydown",BX.delegate(this._onKeyDown,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onSearchClick,this));BX.bind(this.getContainer(),"click",BX.delegate(this._onSearchContainerClick,this));this.removeAutofocus();this.firstInit=true},removeAutofocus:function e(){var t=this.getInput();if(!!t){t.blur();t.autofocus=null}},getFindButton:function e(){if(!BX.type.isDomNode(this.findButton)){this.findButton=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButton)}return this.findButton},_onSearchClick:function e(){this.apply()},selectSquare:function e(t){!!t&&BX.addClass(t,this.parent.settings.classSquareSelected)},selectSquares:function e(){this.getSquares().forEach(this.selectSquare,this)},unselectSquare:function e(t){!!t&&BX.removeClass(t,this.parent.settings.classSquareSelected)},unselectSquares:function e(){this.getSquares().forEach(this.unselectSquare,this)},removeSquares:function e(){this.getSquares().forEach(this.removeSquare,this)},isSquaresSelected:function e(){var t=this.getSquares();return t.length&&t.every(this.isSquareSelected,this)},isSquareSelected:function e(t){return!!t&&BX.hasClass(t,this.parent.settings.classSquareSelected)},getLastSquare:function e(){var t=this.getSquares();return!!t?t[t.length-1]:null},isTextSelected:function e(){var t=this.getSearchString().length;var i=this.getInput();var s=i.selectionStart;var n=i.selectionEnd;return s===0&&n!==0&&n===t},isSelectionStart:function e(){var t=this.getInput();var i=t.selectionStart;var s=t.selectionEnd;return i===0&&s===0},isSquareRemoveButton:function e(t){return!!t&&BX.hasClass(t,this.parent.settings.classSquareDelete)},isClearButton:function e(t){return!!t&&BX.hasClass(t,this.parent.settings.classClearSearchValueButton)},getClearButton:function e(){return this.getContainer().querySelector("."+this.parent.settings.classClearSearchValueButton)},isSearchButton:function e(t){return!!t&&BX.hasClass(t,this.parent.settings.classSearchButton)},adjustFocus:function e(){if(!BX.browser.IsMobile()){var t=this.getInput();if(document.activeElement!==t&&window.scrollY<BX.pos(t).top){t.value=t.value;t.blur();t.focus()}}},findSquareByChild:function e(t){return BX.findParent(t,{className:this.parent.settings.classSquare},true,false)},getSquareData:function e(t){var i=BX.data(t,"item");return!!t&&!!i?JSON.parse(i):null},isSquareControl:function e(t){var i=this.getSquareData(t);return!!i&&(i.type==="control"||BX.type.isArray(i))},onPresetSquareRemove:function e(){var t=this.parent;var i=t.getPreset();var s=i.getCurrentPresetId();var n=t.getParam("RESET_TO_DEFAULT_MODE");var a=t.getParam("VALUE_REQUIRED");var r=i.isPinned(s);var l=this.getSquares();if(l.length===1){if(a&&r){this.parent.showPopup();this.adjustPlaceholder();this.parent.getPreset().deactivateAllPresets()}else{if(n&&r||!n){var o=true;this.lastPromise=t.resetFilter(o);t.closePopup()}}if(n&&!r){this.lastPromise=t.getPreset().applyPinnedPreset()}}if(l.length>1){var u=i.getPreset(i.getCurrentPresetId());var c=i.getPreset("tmp_filter");c.FIELDS=BX.clone(u.ADDITIONAL);u.ADDITIONAL=[];i.deactivateAllPresets();i.applyPreset("tmp_filter");t.applyFilter()}},onControlSquareRemove:function e(t){var i=this.parent;var s=i.getPreset();var n=i.getParam("RESET_TO_DEFAULT_MODE");var a=i.getParam("VALUE_REQUIRED");var r;if(n&&this.getSquares().length===1){if(a){r=this.getSquareData(t);i.clearControls(r);this.parent.showPopup();this.adjustPlaceholder();this.parent.getPreset().deactivateAllPresets()}else{this.lastPromise=i.getPreset().applyPinnedPreset()}}else{r=this.getSquareData(t);i.clearControls(r);i.closePopup();if(BX.type.isArray(r)){r.forEach((function(e){s.removeAdditionalField(e.name)}))}if(BX.type.isPlainObject(r)){s.removeAdditionalField(r.name)}this.apply()}},onValueRequiredSquareRemove:function e(){var t=this.parent;t.getPreset().deactivateAllPresets();t.showPopup();this.adjustPlaceholder()},complexSquareRemove:function e(t){var i=this.parent.getParam("VALUE_REQUIRED_MODE");var s=!this.isSquareControl(t);if(i){this.onValueRequiredSquareRemove()}else{if(s){this.onPresetSquareRemove()}else{this.onControlSquareRemove(t)}}this.removeSquare(t);this.adjustClearButton()},adjustClearButton:function e(){!!this.getLastSquare()?this.showClearButton():this.hideClearButton()},removeSquare:function e(t){!!t&&BX.remove(t)},_onSearchContainerClick:function e(t){var i=this.parent;if(this.isClearButton(t.target)){if(!i.getParam("VALUE_REQUIRED")){if(!i.getParam("VALUE_REQUIRED_MODE")){if(i.getParam("RESET_TO_DEFAULT_MODE")){this.clearInput();this.lastPromise=i.getPreset().applyPinnedPreset()}else{i.resetFilter()}i.closePopup();this.adjustFocus()}else{this.removeSquares();i.showPopup();this.adjustPlaceholder();this.hideClearButton();i.getPreset().deactivateAllPresets()}}else{var s=i.getPreset().isPinned(i.getPreset().getCurrentPresetId());if(s||i.getPreset().getCurrentPresetId()==="tmp_filter"){var n=i.getPreset().getPreset(i.getPreset().getCurrentPresetId());if(n.ADDITIONAL.length){n.ADDITIONAL=[];this.lastPromise=i.getPreset().applyPreset(i.getPreset().getCurrentPresetId());this.apply()}else{this.removeSquares();i.showPopup();this.adjustPlaceholder();this.hideClearButton();i.getPreset().deactivateAllPresets()}}else{if(i.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=i.getPreset().applyPinnedPreset()}else{i.resetFilter()}i.closePopup();this.adjustFocus()}this.clearInput()}}else if(this.isSearchButton(t.target)){this.apply();this.adjustFocus()}else if(this.isSquareRemoveButton(t.target)){var a=this.findSquareByChild(t.target);this.complexSquareRemove(a);this.adjustFocus()}else{if(!i.getPopup().isShown()){i.showPopup()}else{var r=this.getInput();var l=r.selectionStart;var o=r.selectionEnd;var u=this.getSearchString().length;if(!(u&&l===0&&o===u)){if(i.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.lastPromise=i.getPreset().applyPinnedPreset()}else{i.closePopup()}}else{i.closePopup();if(i.getParam("VALUE_REQUIRED_MODE")){i.restoreRemovedPreset()}}}}}},_onKeyDown:function e(t){var i=BX.Filter.Utils;var s=this.parent;if(i.isKey(t,"enter")){if(s.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.parent.getPreset().applyPinnedPreset()}else{this.apply();this.firstInit=false;this.lastSearchString=this.getSearchString()}}else{this.apply();this.firstInit=false;this.lastSearchString=this.getSearchString()}s.closePopup()}if(i.isKey(t,"tab")||i.isKey(t,"downArrow")){s.showPopup();s.adjustFocus();this.unselectSquares()}if(i.isKey(t,"upArrow")){s.closePopup();if(s.getParam("VALUE_REQUIRED_MODE")){this.parent.restoreRemovedPreset()}if(s.getParam("VALUE_REQUIRED")){if(!this.getSquares().length){this.parent.getPreset().applyPinnedPreset()}}}if(i.isKey(t,"a")&&t.metaKey||i.isKey(t,"a")&&t.ctrlKey){this.selectSquares()}if(i.isKey(t,"backspace")&&this.isTextSelected()&&this.isSquaresSelected()){clearTimeout(this.timeout);if(this.parent.getParam("VALUE_REQUIRED")){var n=this.parent.getPreset().isPinned(this.parent.getPreset().getCurrentPresetId());if(n){this.removeSquares();this.parent.showPopup();this.adjustPlaceholder();this.hideClearButton();this.parent.getPreset().deactivateAllPresets()}else{if(this.parent.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=this.parent.getPreset().applyPinnedPreset()}else{this.parent.resetFilter()}this.parent.closePopup();this.adjustFocus()}this.clearInput()}else{if(this.parent.getParam("RESET_TO_DEFAULT_MODE")){this.lastPromise=this.parent.getPreset().applyPinnedPreset()}else{this.lastPromise=this.parent.resetFilter()}this.parent.closePopup()}}if(i.isKey(t,"backspace")&&this.isSelectionStart()){clearTimeout(this.timeout);var a=this.getLastSquare();this.isSquareSelected(a)?this.complexSquareRemove(a):this.selectSquare(a)}if(!i.isKey(t,"backspace")&&!t.metaKey&&this.isSquaresSelected()){this.unselectSquares()}},getSearchString:function e(){var t=this.getInput();return!!t?t.value:""},getSquares:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true)},adjustPlaceholder:function e(){if(this.parent.getParam("LIMITS_ENABLED")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_LIMITS_EXCEEDED"))}else if(this.parent.getParam("DISABLE_SEARCH")||!this.parent.settings.get("SEARCH")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}},isResolvedRequest:function e(){return!this.lastPromise||!!this.lastPromise&&this.lastPromise.state},apply:function e(){if(this.isResolvedRequest()){this.lastPromise=this.parent._onFindButtonClick()}return this.lastPromise},reset:function e(){if(this.isResolvedRequest()){this.parent.getSearch().removePreset();this.parent.getPreset().deactivateAllPresets();this.parent.getPreset().resetPreset(true);this.timeout=setTimeout(BX.delegate((function(){this.lastPromise=this.parent.resetFilter()}),this),this.delay)}return this.lastPromise},_onInputWithoutDebounce:function e(){clearTimeout(this.timeout);var t=this.getSearchString();this.lastSearchString=!!this.lastSearchString?this.lastSearchString:t;if(t!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){if(this.parent.getParam("ENABLE_LIVE_SEARCH")){this.parent.showGridAnimation();BX.onCustomEvent(window,"BX.Filter.Search:input",[this.parent.params.FILTER_ID,t])}this.parent.getPopup().isShown()&&this.parent.closePopup()}if(t){this.showClearButton();this.parent.setIsSetOutsideState(false);this.parent.setDefaultPresetAppliedState(false)}else{if(!this.getSquares().length&&this.lastSearchString!==t){this.hideClearButton();this.adjustPlaceholder()}if(this.parent.isAppliedDefaultPreset()){this.parent.setDefaultPresetAppliedState(true)}}if(this.parent.isAppliedUserFilter()){BX.Dom.addClass(this.container,"main-ui-filter-search--active")}else{BX.Dom.removeClass(this.container,"main-ui-filter-search--active")}},_onInput:function e(){var t=this.getSearchString();if(t!==this.lastSearchString&&(!this.parent.isIe()||!this.firstInit)){this.apply()}this.firstInit=false;this.lastSearchString=t},getButtonsContainer:function e(){if(!BX.type.isDomNode(this.buttonsContainer)){this.buttonsContainer=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSearchButtonsContainer)}return this.buttonsContainer},showClearButton:function e(){BX.addClass(this.getButtonsContainer(),this.parent.settings.classShow)},hideClearButton:function e(){BX.removeClass(this.getButtonsContainer(),this.parent.settings.classShow)},getInput:function e(){var t;if(!BX.type.isDomNode(this.input)){t=[this.parent.getParam("FILTER_ID",""),"_search"].join("");this.input=BX(t)}return this.input},getContainer:function e(){var t;if(!BX.type.isDomNode(this.container)){t=[this.parent.getParam("FILTER_ID"),"_search_container"].join("");this.container=BX(t)}return this.container},setInputPlaceholder:function e(t){var i=this.getInput();i.placeholder=t},clearInput:function e(){var t=this.getInput();if(BX.type.isDomNode(t)){t.value=null}},clearForm:function e(){this.clearInput();this.removePreset()},makeSquares:function e(t,i,s){var n;var a=null;var r=this.getContainer();var l={squares:[],moreSquares:[]};t.forEach((function(e,t){if(t<i){n=BX.decl(e);a=a||n;if(!s){if(t===0){BX.prepend(n,r)}else{BX.insertAfter(n,a)}}else{var o=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare);if(o){BX.insertAfter(n,o)}else{BX.prepend(n,r)}}a=n;l.squares.push(n)}else{l.moreSquares.push({type:"control",name:e.value,title:e.title,icon:e.icon})}}),this);return l},squares:function e(t,i,s){var n,a,r,l,o;var e=BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classSquare,true);if(s){e.forEach((function(e){var t=BX.data(e,"item");if(t){BX.remove(e)}}))}else{e.forEach(BX.remove)}n=this.prepareSquaresData(t);a=this.makeSquares(n,i,s);l=0;o={squaresData:n,width:0};if(a.moreSquares.length){r={block:"main-ui-search-square",name:this.parent.getParam("MAIN_UI_FILTER__AND")+" "+this.parent.getParam("MAIN_UI_FILTER__MORE")+" "+a.moreSquares.length,item:a.moreSquares,title:a.moreSquares.map((function(e){var t=e.title;if("icon"in e&&BX.Type.isPlainObject(e.icon)){var i=e.icon.title;t=t.length?i+": "+t:""}return t})).join(", \n")};r=BX.decl(r);a.squares.push(r);BX.insertAfter(r,a.squares[a.squares.length-2]);l=a.squares.reduce((function(e,t){return e+BX.width(t)+(parseFloat(BX.style(t,"margin-right"))||0)}),0)}o.width=l;return o},setPreset:function e(t){var i=this.getContainer();var s,n;var a;if(BX.type.isPlainObject(t)){n=BX.Filter.Utils.getByClass(i,this.parent.settings.classSquare,true);n.forEach(BX.remove);t=BX.clone(t);t.ADDITIONAL=t.ADDITIONAL||[];BX.onCustomEvent(window,"BX.Filter.Search:beforeSquaresUpdate",[t,this]);if(t.ID!=="default_filter"&&t.ID!=="tmp_filter"){s=BX.decl({block:"main-ui-search-square",name:t.TITLE,value:t.ID,isPreset:true});BX.prepend(s,i);if("ADDITIONAL"in t&&BX.type.isArray(t.ADDITIONAL)&&t.ADDITIONAL.length){a=this.squares(t.ADDITIONAL,1,true);if(BX.width(i)-a.width<100){a=this.squares(t.ADDITIONAL,0,true)}}}else{if("ADDITIONAL"in t&&BX.type.isArray(t.ADDITIONAL)&&t.ADDITIONAL.length){t.ADDITIONAL.forEach((function(e,i){if(!("ID"in e)){e.ID="ADDITIONAL_ID_"+i}if(!("NAME"in e)){e.NAME="ADDITIONAL_NAME_"+i}if(!("TYPE"in e)){e.TYPE="STRING"}if("LABEL"in e&&"LABEL"in e){t.FIELDS.push(e)}}))}if(BX.type.isArray(t.FIELDS)&&t.FIELDS.length){a=this.squares(t.FIELDS,2);if(BX.width(i)-a.width<100){a=this.squares(t.FIELDS,1)}}}if(a&&BX.type.isArray(a.squaresData)&&a.squaresData.length||t.ID!=="default_filter"&&t.ID!=="tmp_filter"){if(this.parent.getParam("LIMITS_ENABLED")){this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_LIMITS_EXCEEDED"))}else{this.setInputPlaceholder(this.parent.getParam("MAIN_UI_FILTER__PLACEHOLDER_WITH_FILTER"))}this.showClearButton()}else{this.adjustPlaceholder()}if(BX.type.isNotEmptyString(this.parent.getSearch().getInput().value)){this.showClearButton()}}},prepareSquaresData:function e(t){var i,s,n;var a=[];t=t.filter((function(e){return!!e&&this.parent.params.FIELDS.some((function(t){return e.NAME===t.NAME}))}),this);t.map((function(e){i=null;if(!BX.Type.isStringFilled(e.ADDITIONAL_FILTER)){switch(e.TYPE){case this.parent.types.DATE:{i=e.LABEL+": "+e.SUB_TYPE.NAME;if(e.SUB_TYPE.VALUE===this.parent.dateTypes.QUARTER&&BX.type.isNotEmptyString(e.VALUES._quarter)){var t=e.QUARTERS.filter((function(t){return t.VALUE==e.VALUES._quarter})).map((function(e){return e.NAME}));t=t.length?t.join(""):"";i=e.LABEL+": "+t+" "+this.parent.getParam("MAIN_UI_FILTER__QUARTER").toLocaleLowerCase()+" "+e.VALUES._year}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.YEAR&&BX.type.isNotEmptyString(e.VALUES._year)){i=e.LABEL+": "+e.VALUES._year}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.MONTH&&BX.type.isNotEmptyString(e.VALUES._month)){var r=e.MONTHS.filter((function(t){return t.VALUE==e.VALUES._month})).map((function(e){return e.NAME}));r=r.length?r.join(""):"";i=e.LABEL+": "+r+" "+e.VALUES._year}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.EXACT&&BX.type.isNotEmptyString(e.VALUES._from)){i=e.LABEL+": "+e.VALUES._from}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.RANGE){if(BX.type.isNotEmptyString(e.VALUES._from)&&BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+e.VALUES._from+"-"+e.VALUES._to}else if(!BX.type.isNotEmptyString(e.VALUES._from)&&BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__BEFORE")+" "+e.VALUES._to}else if(BX.type.isNotEmptyString(e.VALUES._from)&&!BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__AFTER")+" "+e.VALUES._from}}if((e.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS||e.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS)&&!BX.type.isNumber(parseInt(e.VALUES._days))){i=null}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.NEXT_DAYS&&BX.type.isNumber(parseInt(e.VALUES._days))){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_NEXT_DAYS_LABEL").replace("#N#",e.VALUES._days)}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.PREV_DAYS&&BX.type.isNumber(parseInt(e.VALUES._days))){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__DATE_PREV_DAYS_LABEL").replace("#N#",e.VALUES._days)}if(e.SUB_TYPE.VALUE===this.parent.dateTypes.NONE){i=null}break}case this.parent.types.CUSTOM_DATE:{if(BX.type.isArray(e.VALUE.days)&&e.VALUE.days.length||BX.type.isArray(e.VALUE.months)&&e.VALUE.months.length||BX.type.isArray(e.VALUE.years)&&e.VALUE.years.length){i=e.LABEL}break}case this.parent.types.SELECT:{if(BX.type.isPlainObject(e.VALUE)&&e.VALUE.VALUE||e.STRICT){i=e.LABEL+": "+e.VALUE.NAME}break}case this.parent.types.MULTI_SELECT:{if(BX.type.isArray(e.VALUE)&&e.VALUE.length){s=[];i=e.LABEL+": ";e.VALUE.forEach((function(e,t){if(t<2){s.push(e.NAME)}}));i+=s.join(", ");if(e.VALUE.length>2){n=[];e.VALUE.forEach((function(e){n.push(e.NAME)}));i=n.join(", ")}}break}case this.parent.types.NUMBER:{if(e.SUB_TYPE.VALUE==="exact"){if(BX.type.isNotEmptyString(e.VALUES._from)){i=e.LABEL+": "+e.VALUES._from}else{i=null}}if(e.SUB_TYPE.VALUE==="range"){if(BX.type.isNotEmptyString(e.VALUES._from)&&BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+e.VALUES._from+"-"+e.VALUES._to}else if(!BX.type.isNotEmptyString(e.VALUES._from)&&BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_LESS")+" "+e.VALUES._to}else if(BX.type.isNotEmptyString(e.VALUES._from)&&!BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": "+this.parent.getParam("MAIN_UI_FILTER__NUMBER_MORE")+" "+e.VALUES._from}else{i=null}}if(e.SUB_TYPE.VALUE==="more"){if(BX.type.isNotEmptyString(e.VALUES._from)){i=e.LABEL+": > ";i+=e.VALUES._from}}if(e.SUB_TYPE.VALUE==="less"){if(BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": < ";i+=e.VALUES._to}}if(e.SUB_TYPE.VALUE==="before_n"){if(BX.type.isNotEmptyString(e.VALUES._to)){i=e.LABEL+": < ";i+=e.VALUES._to}}break}case this.parent.types.CUSTOM_ENTITY:case this.parent.types.DEST_SELECTOR:case this.parent.types.ENTITY_SELECTOR:{if(e.MULTIPLE){var l=!!e.VALUES._label?e.VALUES._label:[];if(BX.type.isPlainObject(l)){l=Object.keys(l).map((function(e){return l[e]}))}if(!BX.type.isArray(l)){l=[l]}if(l.length>0){i=e.LABEL+": ";i+=l.join(", ")}}else{if(BX.type.isNotEmptyString(e.VALUES._value)&&BX.type.isNotEmptyString(e.VALUES._label)){i=e.LABEL+": ";i+=e.VALUES._label}}break}case this.parent.types.CUSTOM:{i="_VALUE"in e&&BX.type.isNotEmptyString(e._VALUE)?e.LABEL:null;break}default:{if(BX.type.isNotEmptyString(e.VALUE)){i=e.LABEL+": "+e.VALUE}break}}}else{var o={block:"main-ui-search-square",name:e.LABEL+": "+BX.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_PLACEHOLDER_IS_EMPTY"),value:e.NAME,icon:"ICON"in e?e.ICON:null,item:{type:"control",name:e.NAME},title:e.LABEL+": "+BX.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_PLACEHOLDER_IS_EMPTY")};if(e.ADDITIONAL_FILTER===BX.Filter.AdditionalFilter.Type.HAS_ANY_VALUE){o.name=e.LABEL+": "+BX.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_PLACEHOLDER_HAS_ANY_VALUE");o.title=e.LABEL+": "+BX.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_PLACEHOLDER_HAS_ANY_VALUE")}a.push(o)}if(i!==null){a.push({block:"main-ui-search-square",name:i,value:e.NAME,icon:"ICON"in e?e.ICON:null,item:{type:"control",name:e.NAME},title:i})}}),this);return a},getPreset:function e(){var t=this.getContainer();var i=this.parent.settings.classSquare;var s=null;if(BX.type.isDomNode(t)){s=BX.Filter.Utils.getByClass(t,i)}return s},removePreset:function e(){var t=this.getPreset();if(BX.type.isDomNode(t)){BX.remove(t);this.adjustPlaceholder()}this.hideClearButton()},updatePreset:function e(t){this.removePreset();this.setPreset(t)}}})();(function(){BX.namespace("BX.Filter");BX.Filter.Settings=function(e,t){this.classField="main-ui-control-field";this.classFieldGroup="main-ui-control-field-group";this.classFieldLine="main-ui-filter-field-line";this.classFieldDelete="main-ui-filter-field-delete";this.classFieldLabel="main-ui-control-field-label";this.classFieldWithLabel="main-ui-filter-wield-with-label";this.classPresetName="main-ui-filter-sidebar-item-text";this.classControl="main-ui-control";this.classDateInput="main-ui-date-input";this.classHide="main-ui-hide";this.classNumberInput="main-ui-number-input";this.classSelect="main-ui-select";this.classMultiSelect="main-ui-multi-select";this.classValueDelete="main-ui-control-value-delete";this.classStringInput="main-ui-control-string";this.classAddField="main-ui-filter-field-add-item";this.classAddPresetField="main-ui-filter-new-filter";this.classAddPresetFieldInput="main-ui-filter-sidebar-edit-control";this.classAddPresetButton="main-ui-filter-add-item";this.classButtonsContainer="main-ui-filter-field-button-container";this.classSaveButton="main-ui-filter-save";this.classCancelButton="main-ui-filter-cancel";this.classMenuItem="main-ui-select-inner-item";this.classMenuItemText="main-ui-select-inner-item-element";this.classMenuMultiItemText="main-ui-select-inner-label";this.classMenuItemChecked="main-ui-checked";this.classSearchContainer="main-ui-filter-search";this.classDefaultPopup="popup-window";this.classPopupFieldList="main-ui-filter-popup-field-list";this.classPopupFieldList1Column="main-ui-filter-field-list-1-column";this.classPopupFieldList2Column="main-ui-filter-field-list-2-column";this.classPopupFieldList3Column="main-ui-filter-field-list-3-column";this.classPopupFieldList4Column="main-ui-filter-field-list-4-column";this.classPopupFieldList5Column="main-ui-filter-field-list-5-column";this.classPopupFieldList6Column="main-ui-filter-field-list-6-column";this.classFieldListItem="main-ui-filter-field-list-item";this.classEditButton="main-ui-filter-add-edit";this.classPresetEdit="main-ui-filter-edit";this.classPresetNameEdit="main-ui-filter-edit-text";this.classPresetDeleteButton="main-ui-delete";this.classPresetDragButton="main-ui-filter-icon-grab";this.classPresetEditButton="main-ui-filter-icon-edit";this.classPresetEditInput="main-ui-filter-sidebar-item-input";this.classPresetOndrag="main-ui-filter-sidebar-item-ondrag";this.classSquare="main-ui-square";this.classSquareDelete="main-ui-square-delete";this.classSquareSelected="main-ui-square-selected";this.classPresetsContainer="main-ui-filter-sidebar-item-container";this.classPreset="main-ui-filter-sidebar-item";this.classPresetCurrent="main-ui-filter-current-item";this.classFilterContainer="main-ui-filter-wrapper";this.classFileldControlList="main-ui-filter-field-container-list";this.classRestoreFieldsButton="main-ui-filter-field-restore-items";this.classClearSearchValueButton="main-ui-delete";this.classSearchButtonsContainer="main-ui-item-icon-block";this.classSearchButton="main-ui-search";this.classDisabled="main-ui-disable";this.classAnimationShow="main-ui-popup-show-animation";this.classAnimationClose="main-ui-popup-close-animation";this.classLimitsAnimation="main-ui-filter-field-limits-animate";this.classSidebarControlsContainer="main-ui-filter-add-container";this.searchContainerPostfix="_search_container";this.classPresetButtonsContainer="main-ui-filter-field-preset-button-container";this.classFindButton="main-ui-filter-find";this.classResetButton="main-ui-filter-reset";this.classDefaultFilter="main-ui-filter-default-preset";this.classRestoreButton="main-ui-filter-reset-link";this.classPinButton="main-ui-filter-icon-pin";this.classPopupOverlay="popup-window-overlay";this.classSidePanelContainer="side-panel-container";this.classPinnedPreset="main-ui-item-pin";this.classWaitButtonClass="ui-btn-clock";this.classForAllCheckbox="main-ui-filter-save-for-all";this.classShow="main-ui-show";this.classFocus="main-ui-focus";this.classPresetField="main-ui-filter-preset-field";this.classPopupSearchFieldListItemHidden="main-ui-filter-field-list-item-hidden";this.classPopupSearchFieldListItemVisible="main-ui-filter-field-list-item-visible";this.classPopupSearchSectionItem="main-ui-filter-popup-search-section-input";this.classPopupSearchSectionItemIcon="main-ui-filter-popup-search-section-item-icon";this.classPopupSearchSectionItemIconActive="main-ui-filter-popup-search-section-item-icon-active";this.numberPostfix="_numsel";this.datePostfix="_datesel";this.toPostfix="_to";this.fromPostfix="_from";this.daysPostfix="_days";this.monthPostfix="_month";this.quarterPostfix="_quarter";this.yearPostfix="_year";this.generalTemplateId="";this.maxPopupColumnCount=6;this.popupWidth=630;this.init(e,t)};BX.Filter.Settings.prototype={init:function e(t,i){this.generalTemplateId=i.getParam("FILTER_ID")+"_GENERAL_template";this.mergeSettings(t)},get:function e(t,i){return t&&t in this&&!BX.type.isFunction(this[t])?this[t]:i},mergeSettings:function e(t){if(BX.type.isPlainObject(t)){Object.keys(t).forEach((function(e){if(!BX.type.isFunction(this[e])){this[e]=t[e]}}),this)}}}})();var u,c,d,h,p,f,m,E;function g(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function y(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?g(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}(function(){BX.namespace("BX.Main");BX.Main.Filter=function(e,t,i,s,n,a,r){this.params=e;this.search=null;this.popup=null;this.presets=null;this.fields=null;this.types=i;this.dateTypes=s;this.additionalDateTypes=a;this.additionalNumberTypes=r;this.numberTypes=n;this.settings=new BX.Filter.Settings(t,this);this.filter=null;this.api=null;this.isAddPresetModeState=false;this.firstInit=true;this.analyticsLabel=null;this.emitter=new BX.Event.EventEmitter;this.emitter.setEventNamespace("BX.Filter.Field");this.emitter.subscribe=function(e,t){BX.Event.EventEmitter.subscribe(this.emitter,e.replace("BX.Filter.Field:",""),t)}.bind(this);this.enableFieldsSearch=null;this.enableHeadersSections=null;this.init()};function e(e){if(BX.type.isString(e)){e=e.toLowerCase();e=e.replace(/[\-_\s]+(.)?/g,(function(e,t){return t?t.toUpperCase():""}));return e.substr(0,1).toLowerCase()+e.substr(1)}return e}BX.Main.Filter.prototype={init:function e(){BX.bind(document,"mousedown",BX.delegate(this._onDocumentClick,this));BX.bind(document,"keydown",BX.delegate(this._onDocumentKeydown,this));BX.bind(window,"load",BX.delegate(this.onWindowLoad,this));BX.addCustomEvent("Grid::ready",BX.delegate(this._onGridReady,this));this.getSearch().updatePreset(this.getParam("CURRENT_PRESET"));this.enableFieldsSearch=this.getParam("ENABLE_FIELDS_SEARCH",false);this.enableHeadersSections=this.getParam("HEADERS_SECTIONS",false);if(this.isAppliedDefaultPreset()){this.setDefaultPresetAppliedState(true)}},getEmitter:function e(){return this.emitter},onWindowLoad:function e(){this.settings.get("AUTOFOCUS")&&this.adjustFocus()},clearGet:function e(){if("history"in window){var t=window.location.toString();var i=BX.util.remove_url_param(t,"apply_filter");window.history.replaceState(null,"",i)}},adjustFocus:function e(){this.getSearch().adjustFocus()},_onAddPresetKeydown:function e(t){if(BX.Filter.Utils.isKey(t,"enter")){this._onSaveButtonClick()}},_onDocumentKeydown:function e(t){if(BX.Filter.Utils.isKey(t,"escape")){if(this.getPopup().isShown()){BX.onCustomEvent(window,"BX.Main.Filter:blur",[this]);this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}if(this.getParam("VALUE_REQUIRED")){if(!this.getSearch().getSquares().length){this.getPreset().applyPinnedPreset()}}}}},getApi:function e(){if(!(this.api instanceof BX.Filter.Api)){this.api=new BX.Filter.Api(this)}return this.api},addSidebarItem:function e(t,i,s){var n=this.getPreset();var a=n.getContainer();var r=n.createSidebarItem(t,i,s);var l=n.getPresetNodeById(t);if(BX.type.isDomNode(l)){BX.remove(l);a.insertBefore(r,n.getAddPresetField())}else{a&&a.insertBefore(r,n.getAddPresetField())}BX.bind(r,"click",BX.delegate(n._onPresetClick,n))},saveUserSettings:function e(t){var i={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER_ARRAY"};var s=this.getPreset();var n=s.getCurrentPresetId();var a={};this.params["PRESETS"]=BX.clone(this.editablePresets);a.current_preset=n;s.getPresets().forEach((function(e,i){var n=s.getPresetId(e);if(n&&n!=="tmp_filter"){var r=s.getPreset(n);r.TITLE=BX.util.htmlspecialchars(BX.util.htmlspecialcharsback(r.TITLE));r.SORT=i;s.updatePresetName(e,r.TITLE);a[n]={sort:i,name:r.TITLE,fields:this.preparePresetSettingsFields(r.FIELDS),rows:r.FIELDS.map((function(e){return e.NAME})),for_all:t&&!BX.type.isBoolean(r.FOR_ALL)||t&&r.FOR_ALL===true}}}),this);this.saveOptions(a,i,null,t)},isForAll:function e(t){var i=this.getForAllCheckbox();return BX.type.isBoolean(t)&&t||!!i&&!!i.checked},getForAllCheckbox:function e(){if(!this.forAllCheckbox){this.forAllCheckbox=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.forAllCheckbox},preparePresetSettingsFields:function e(t){var i={};var s;(t||[]).forEach((function(e){switch(e.TYPE){case this.types.STRING:{i[e.NAME]=e.VALUE;break}case this.types.TEXTAREA:{i[e.NAME]=e.VALUE;break}case this.types.SELECT:{i[e.NAME]="VALUE"in e.VALUE?e.VALUE.VALUE:"";break}case this.types.MULTI_SELECT:{if(BX.type.isArray(e.VALUE)&&e.VALUE.length){e.VALUE.forEach((function(t,s){i[e.NAME]=BX.type.isPlainObject(i[e.NAME])?i[e.NAME]:{};i[e.NAME][s]=t.VALUE}),this)}break}case this.types.CHECKBOX:{if(BX.type.isArray(e.VALUE)&&e.VALUE.length){e.VALUE.forEach((function(t,s){i[e.NAME]=BX.type.isPlainObject(i[e.NAME])?i[e.NAME]:{};i[e.NAME][s]=t.VALUE}),this)}break}case this.types.DATE:{if(BX.type.isPlainObject(e.VALUES)){s=Object.keys(e.VALUES);i[e.NAME+"_datesel"]=e.SUB_TYPE.VALUE;s.forEach((function(t){i[e.NAME+t]=e.VALUES[t]}),this)}break}case this.types.NUMBER:{if(BX.type.isPlainObject(e.VALUES)){s=Object.keys(e.VALUES);i[e.NAME+"_numsel"]=e.SUB_TYPE.VALUE;s.forEach((function(t){i[e.NAME+t]=e.VALUES[t]}),this)}break}case this.types.DEST_SELECTOR:{if(BX.type.isPlainObject(e.VALUES)){i[e.NAME]=e.VALUES._value;i[e.NAME+"_label"]=e.VALUES._label}break}case this.types.DEST_SELECTOR:case this.types.ENTITY_SELECTOR:case this.types.CUSTOM_ENTITY:{if(BX.type.isPlainObject(e.VALUES)){i[e.NAME]=e.VALUES._value;i[e.NAME+"_label"]=e.VALUES._label}break}default:{break}}}),this);return i},savePreset:function e(){var t="filter_"+ +new Date;var i=BX.util.htmlspecialcharsback(this.getPreset().getAddPresetFieldInput().value);this.updatePreset(t,i,null,true,null,null,true);this.addSidebarItem(t,i);this.getPreset().applyPreset(t);this.getPreset().activatePreset(t);this.applyFilter()},updatePreset:function e(t,i,s,n,a,r,l){var o=this.getFilterFieldsValues();var u=this.getPreset().getFields().map((function(e){return BX.data(e,"name")}));var c=this.getPreset().getCurrentPresetData();var d={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var h,p,f,m,E;var g={};g.additional={};if(t!=="tmp_filter"&&t!=="default_filter"&&!l){var y=BX.type.isArray(c.ADDITIONAL)?c.ADDITIONAL:[];y.forEach((function(e){Object.keys(o).forEach((function(t){if(t.indexOf(e.NAME)!==-1){g.additional[t]=o[t];delete o[t]}}))}))}h=Object.keys(o);if(!s){g.apply_filter="Y"}else{g.clear_filter="Y"}g.save="Y";g.fields=o;g.rows=u.join(",");g.preset_id=t||c.ID;if(BX.type.isNotEmptyString(i)){g.name=BX.util.htmlspecialchars(i)}else{f=this.getPreset().getPresetNodeById(g.preset_id);m=this.getPreset().getPresetInput(f);if(BX.type.isDomNode(m)&&BX.type.isNotEmptyString(m.value)){g.name=m.value}else{g.name=c.TITLE}}if((!("sort"in g)||!BX.type.isNumber(g.sort))&&n){E=this.getParam("PRESETS");g.sort=E.length+2}if(!s){h.forEach((function(e){if(BX.type.isArray(g.fields[e])){p=g.fields[e].length?{}:"";g.fields[e].forEach((function(e,t){p[t]=e}),this);if(p||BX.type.isNumber(p)||BX.type.isBoolean(p)){g.fields[e]=p}}}),this)}if(g.preset_id==="tmp_filter"||this.isAddPresetEnabled()||s){this.updateParams(g)}if(BX.type.isFunction(a)){a()}var v=new BX.Promise(null,this);v.setAutoResolve("fulfill",0);v.then((function(){var e=new BX.Promise(null,this);this.saveOptions(g,d,BX.proxy(e.fulfill,e));return e})).then((function(){!!r&&r()}));return v},saveFieldsSort:function e(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var i=this.getPreset().getFields();var s={};s.preset_id="default_filter";if(BX.type.isArray(i)){s.rows=i.map((function(e){return BX.data(e,"name")}));s.rows=s.rows.join(",")}this.updateParams(s);this.saveOptions(s,t)},updateParams:function e(t){var i,s;if(BX.type.isPlainObject(t)&&"preset_id"in t){i=this.getPreset().getPreset(t.preset_id);if(BX.type.isPlainObject(i)){if("name"in t&&BX.type.isNotEmptyString(t.name)){i.TITLE=t.name}if("rows"in t&&!("fields"in t)){t.fields={};t.rows.split(",").forEach((function(e){t.fields[e]=""}))}if("fields"in t){i.FIELDS=this.preparePresetFields(t.fields,t.rows)}if("additional"in t&&i.ID!=="tmp_filter"){i.ADDITIONAL=this.preparePresetFields(t.additional,t.rows)}}else{s=this.getParam("PRESETS");i={ID:t.preset_id,TITLE:t.name,SORT:s.length+2,FIELDS:this.preparePresetFields(t.fields,t.rows)};s.push(i)}}},preparePresetFields:function e(t,i){var s,n;var a=[];if(BX.type.isPlainObject(t)){i=BX.type.isNotEmptyString(i)?i.split(","):[];s=i.length?i:Object.keys(t);s.forEach((function(e){e=e.replace("_datesel","").replace("_numsel","").replace("_"+BX.Filter.AdditionalFilter.Type.IS_EMPTY,"").replace("_"+BX.Filter.AdditionalFilter.Type.HAS_ANY_VALUE,"");n=BX.clone(this.getFieldByName(e));if(BX.type.isPlainObject(n)){n.ADDITIONAL_FILTER=BX.Filter.AdditionalFilter.fetchAdditionalFilter(e,t);if(!BX.Type.isStringFilled(n.ADDITIONAL_FILTER)){if(n.TYPE===this.types.STRING){n.VALUE=t[e]}if(n.TYPE===this.types.TEXTAREA){n.VALUE=t[e]}if(n.TYPE===this.types.MULTI_SELECT){n.VALUE=this.prepareMultiSelectValue(t[e],n.ITEMS)}if(n.TYPE===this.types.SELECT||n.TYPE===this.types.CHECKBOX){n.VALUE=this.prepareSelectValue(t[e],n.ITEMS)}if(n.TYPE===this.types.DATE){n.SUB_TYPE=this.prepareSelectValue(t[e+"_datesel"],n.SUB_TYPES);n.VALUES={_from:t[e+"_from"],_to:t[e+"_to"],_days:t[e+"_days"],_month:t[e+"_month"],_quarter:t[e+"_quarter"],_year:t[e+"_year"],_allow_year:t[e+"_allow_year"]}}if(n.TYPE===this.types.CUSTOM_DATE){n.VALUE={days:Object.keys(t[e+"_days"]||{}).map((function(i){return t[e+"_days"][i]})),months:Object.keys(t[e+"_months"]||{}).map((function(i){return t[e+"_months"][i]})),years:Object.keys(t[e+"_years"]||{}).map((function(i){return t[e+"_years"][i]}))}}if(n.TYPE===this.types.NUMBER){n.SUB_TYPE=this.prepareSelectValue(t[e+"_numsel"],n.SUB_TYPES);n.VALUES={_from:t[e+"_from"],_to:t[e+"_to"]}}if(n.TYPE===this.types.DEST_SELECTOR||n.TYPE===this.types.ENTITY_SELECTOR||n.TYPE===this.types.CUSTOM_ENTITY){if(typeof t[e+"_label"]!=="undefined"){n.VALUES._label=t[e+"_label"]}if(typeof t[e]!=="undefined"){n.VALUES._value=t[e]}}if(n.TYPE===this.types.CUSTOM){n._VALUE=t[e]}}a.push(n)}}),this)}return a},prepareSelectValue:function e(t,i){var s={};var n;if(BX.type.isNotEmptyString(t)&&BX.type.isArray(i)){n=this.prepareMultiSelectValue({0:t},i);s=n.length>0?n[0]:{}}else{s=i[0]}return s},prepareMultiSelectValue:function e(t,i){var s=[];if(BX.type.isPlainObject(t)&&BX.type.isArray(i)){var n=Object.keys(t);var a=n.map((function(e){return t[e]}));s=i.filter((function(e){return a.some((function(t){return t===e.VALUE}))}),this)}return s},getFieldByName:function e(t){var i=this.getParam("FIELDS");var s=i.find((function(e){return e.NAME===t}));if(s){return s}var n=this.getFieldListContainer().querySelector('[data-name="'+t+'"]');s=BX.Filter.Field.instances.get(n);if(s){return s.options}return null},confirmSaveForAll:function e(){return new Promise(function(e){var t={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("MAIN_UI_FILTER__CONFIRM_MESSAGE_FOR_ALL"),CONFIRM_APPLY_BUTTON:this.getParam("MAIN_UI_FILTER__CONFIRM_APPLY_FOR_ALL"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(t,e)}.bind(this))},saveOptions:function t(i,s,n,a){s.action=e(s.action);s.forAll=this.isForAll(a);s.commonPresetsId=this.getParam("COMMON_PRESETS_ID");s.apply_filter=i.apply_filter||"N";s.clear_filter=i.clear_filter||"N";s.with_preset=i.with_preset||"N";s.save=i.save||"N";s.isSetOutside=this.isSetOutside();var r={params:s,data:i};delete i.apply_filter;delete i.save;delete i.clear_filter;delete i.with_preset;if(s.forAll&&s.action==="setFilterArray"){return this.confirmSaveForAll().then(function(){return this.backend(s.action,r)}.bind(this)).then(function(){this.disableEdit();this.disableAddPreset()}.bind(this))}return this.backend(s.action,r).then(function(){BX.removeClass(this.getFindButton(),this.settings.classWaitButtonClass);BX.type.isFunction(n)&&n()}.bind(this))},backend:function e(t,i){var s=this.analyticsLabel||{};this.analyticsLabel={};return BX.ajax.runComponentAction("bitrix:main.ui.filter",t,{mode:"ajax",data:i,analyticsLabel:y({FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),PRESET_ID:i["data"]["preset_id"],FIND:i["data"].hasOwnProperty("fields")&&i["data"]["fields"].hasOwnProperty("FIND")&&!!i["data"]["fields"]["FIND"]?"Y":"N",ROWS:BX.Type.isObject(i["data"]["additional"])&&Object.keys(i["data"]["additional"]).length==0?"N":"Y"},s)})},limitAnalyticsSend:function e(){BX.ajax.runComponentAction("bitrix:main.ui.filter","limitAnalytics",{mode:"ajax",data:{},analyticsLabel:{FILTER_ID:this.getParam("FILTER_ID"),LIMIT:this.getParam("FILTER_ID")}})},prepareEvent:function e(t){var i,s;if(!("path"in t)||!t.path.length){t.path=[t.target];i=0;while((s=t.path[i++].parentNode)!==null){t.path.push(s)}}return t},restoreRemovedPreset:function e(){if(this.getParam("VALUE_REQUIRED_MODE")){var t=this.getParam("CURRENT_PRESET");if(BX.type.isPlainObject(t)){var i=t.ID;var s=this.getPreset().getPresetNodeById(i);this.getPreset().applyPreset(i);this.getPreset().activatePreset(s)}}},hasScrollClick:function e(t){var i="clientX"in t?t.clientX:"x"in t?t.x:0;return i>=document.documentElement.offsetWidth},isUseCommonPresets:function e(){return!!this.getParam("COMMON_PRESETS_ID")},isInsideFilterEvent:function e(t){t=this.prepareEvent(t);return(t.path||[]).some((function(e){return BX.type.isDomNode(e)&&(BX.hasClass(e,this.settings.classFilterContainer)||BX.hasClass(e,this.settings.classSearchContainer)||BX.hasClass(e,this.settings.classDefaultPopup)||BX.hasClass(e,this.settings.classPopupOverlay)||BX.hasClass(e,this.settings.classSidePanelContainer))}),this)},_onDocumentClick:function e(t){var i=this.getPopup();if(!this.isInsideFilterEvent(t)&&!this.hasScrollClick(t)){if(i&&i.isShown()){this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}if(this.getParam("VALUE_REQUIRED")){if(!this.getSearch().getSquares().length){this.getPreset().applyPinnedPreset()}}}BX.onCustomEvent(window,"BX.Main.Filter:blur",[this])}},_onAddFieldClick:function e(t){var i=this.getFieldsPopup();t.stopPropagation();t.preventDefault();if(i&&!i.isShown()){this.showFieldsPopup();this.syncFields()}else{this.closeFieldListPopup()}},syncFields:function e(t){if(BX.type.isPlainObject(t)){if(t.cache===false){this.fieldsPopupItems=null}}var i=this.getPreset().getFields();var s=this.getFieldsPopupItems();var n,a;if(BX.type.isArray(s)&&s.length){s.forEach((function(e){n=BX.data(e,"name").replace("_datesel","").replace("_numsel","");a=i.some((function(e){return BX.data(e,"name")===n}));if(a){BX.addClass(e,this.settings.classMenuItemChecked)}else{BX.removeClass(e,this.settings.classMenuItemChecked)}}),this)}},getFieldsPopupItems:function e(){if(!BX.type.isArray(this.fieldsPopupItems)){var t=this.getFieldsPopup();if("contentContainer"in t&&BX.type.isDomNode(t.contentContainer)){this.fieldsPopupItems=BX.Filter.Utils.getByClass(t.contentContainer,this.settings.classMenuItem,true)}this.prepareAnimation()}return this.fieldsPopupItems},getFieldListContainerClassName:function e(t){var i=parseInt(this.settings.get("popupColumnsCount",0),10);if(i>0&&i<=this.settings.maxPopupColumnCount){return this.settings.get("classPopupFieldList"+i+"Column")}var s=this.settings.classPopupFieldList1Column;if(t>6&&t<12){s=this.settings.classPopupFieldList2Column}if(t>12){s=this.settings.classPopupFieldList3Column}return s},prepareFieldsDecl:function e(t){return(t||[]).map((function(e){return{block:"main-ui-filter-field-list-item",label:"LABEL"in e?e.LABEL:"",id:"ID"in e?e.ID:"",name:"NAME"in e?e.NAME:"",item:e,sectionId:"SECTION_ID"in e?e.SECTION_ID:"",onClick:BX.delegate(this._clickOnFieldListItem,this)}}),this)},getLazyLoadFields:function e(){var t=new BX.Promise;BX.ajax({method:"GET",url:this.getParam("LAZY_LOAD")["GET_LIST"],dataType:"json",onsuccess:function e(i){t.fulfill(i)}});return t},getFieldsListPopupContent:function e(){var t=new BX.Promise;var i=this.getParam("FIELDS");var s=BX.type.isArray(i)?i.length:0;if(this.getParam("LAZY_LOAD")){var n=function(e){t.fulfill(this.getPopupContent(this.settings.classPopupFieldList,this.getFieldListContainerClassName(e.length),this.prepareFieldsDecl(e)))}.bind(this);if(BX.type.isNotEmptyObject(this.getParam("LAZY_LOAD")["CONTROLLER"])){var a=this.getParam("LAZY_LOAD")["CONTROLLER"]["componentName"];var r=this.getParam("LAZY_LOAD")["CONTROLLER"]["signedParameters"];BX.ajax.runAction(this.getParam("LAZY_LOAD")["CONTROLLER"]["getList"],{data:{filterId:this.getParam("FILTER_ID"),componentName:BX.type.isNotEmptyString(a)?a:"",signedParameters:BX.type.isNotEmptyString(r)?r:""}}).then(function(e){n(e.data)}.bind(this),(function(e){}))}else{this.getLazyLoadFields().then(n)}return t}t.fulfill(this.getPopupContent(this.settings.classPopupFieldList,this.getFieldListContainerClassName(s),this.prepareFieldsDecl(i)));return t},getPopupContent:function e(t,i,s){var n=BX.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(["<div></div>"])));if(!this.enableHeadersSections){var a=BX.decl({content:s,block:t,mix:i});this.setPopupElementWidthFromSettings(a);n.appendChild(a);if(this.enableFieldsSearch){this.preparePopupContentHeader(n)}return n}var r=this.getDefaultHeaderSection();var l={};s.forEach((function(e){var t=e.sectionId.length?e.sectionId:r.id;if(l[t]===undefined){l[t]=[]}l[t].push(e)}));this.preparePopupContentHeader(n);this.preparePopupContentFields(n,l,t,i);return n},preparePopupContentHeader:function e(t){var i=BX.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="main-ui-filter-popup-search-header-wrapper">\n\t\t\t\t\t<div class="ui-form-row-inline"></div>\n\t\t\t\t</div>\n\t\t\t'])));t.prepend(i);this.preparePopupContentHeaderSections(i);this.preparePopupContentHeaderSearch(i)},preparePopupContentHeaderSections:function e(t){if(!this.enableHeadersSections){return}var i=BX.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<div class="ui-form-content main-ui-filter-popup-search-section-wrapper"></div>\n\t\t\t\t</div>\n\t\t\t'])));t.firstElementChild.appendChild(i);var s=this.getHeadersSections();for(var n in s){var a=this.settings.classPopupSearchSectionItemIcon+(s[n].selected?" ".concat(this.settings.classPopupSearchSectionItemIconActive):"");var r=BX.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="main-ui-filter-popup-search-section-item" data-ui-popup-filter-section-button="','">\n\t\t\t\t\t\t<div class="','">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),n,a,BX.Text.encode(s[n].name));BX.bind(r,"click",this.onFilterSectionClick.bind(this,r));i.firstElementChild.appendChild(r)}},onFilterSectionClick:function e(t){var i=this.settings.classPopupSearchSectionItemIconActive;var s=t.dataset.uiPopupFilterSectionButton;var n=document.querySelectorAll("[data-ui-popup-filter-section='"+s+"']");if(BX.Dom.hasClass(t.firstElementChild,i)){BX.Dom.removeClass(t.firstElementChild,i);BX.Dom.hide(n[0])}else{BX.Dom.addClass(t.firstElementChild,i);BX.Dom.show(n[0])}},preparePopupContentHeaderSearch:function e(t){if(!this.enableFieldsSearch){return}var i=BX.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t<div class="ui-form-content main-ui-filter-popup-search-input-wrapper">\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-before-icon ui-ctl-after-icon">\n\t\t\t\t\t\t\t<div class="ui-ctl-before ui-ctl-icon-search"></div>\n\t\t\t\t\t\t\t<button class="ui-ctl-after ui-ctl-icon-clear"></button>\n\t\t\t\t\t\t\t<input type="text" class="ui-ctl-element ','">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t'])),this.settings.classPopupSearchSectionItem);t.firstElementChild.appendChild(i);var s=i.getElementsByClassName(this.settings.classPopupSearchSectionItem);if(s.length){var n=s[0];BX.bind(n,"input",this.onFilterSectionSearchInput.bind(this,n));BX.bind(n.previousElementSibling,"click",this.onFilterSectionSearchInputClear.bind(this,n))}},preparePopupContentFields:function e(t,i,s,n){if(!this.enableHeadersSections){return}var a=BX.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['<div class="main-ui-filter-popup-search-sections-wrapper"></div>'])));t.appendChild(a);for(var r in i){var l=BX.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="main-ui-filter-popup-section-wrapper" data-ui-popup-filter-section="','"></div>\n\t\t\t\t'])),r);this.setPopupElementWidthFromSettings(l);if(!this.getHeadersSectionParam(r,"selected")){l.setAttribute("hidden","")}var o=BX.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<h3 class="main-ui-filter-popup-title">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</h3>\n\t\t\t\t"])),BX.Text.encode(this.getHeadersSectionParam(r,"name")));var u=BX.decl({block:s,mix:n,content:i[r]});l.appendChild(o);l.appendChild(u);a.appendChild(l)}},prepareAnimation:function e(){var t=this;if(this.enableFieldsSearch){this.fieldsPopupItems.forEach((function(e){BX.bind(e,"animationend",t.onAnimationEnd.bind(t,e))}))}},onAnimationEnd:function e(t){t.style.display=BX.Dom.hasClass(t,this.settings.classPopupSearchFieldListItemHidden)?"none":"inline-block"},onFilterSectionSearchInput:function e(t){var i=t.value;if(i.length){i=i.toLowerCase()}this.getFieldsPopupItems().forEach(function(e){var t=e.innerText.toLowerCase();if(i.length&&t.indexOf(i)===-1){BX.Dom.removeClass(e,this.settings.classPopupSearchFieldListItemVisible);BX.Dom.addClass(e,this.settings.classPopupSearchFieldListItemHidden)}else{BX.Dom.removeClass(e,this.settings.classPopupSearchFieldListItemHidden);BX.Dom.addClass(e,this.settings.classPopupSearchFieldListItemVisible);e.style.display="inline-block"}}.bind(this))},onFilterSectionSearchInputClear:function e(t){if(t.value.length){t.value="";this.onFilterSectionSearchInput(t)}},getDefaultHeaderSection:function e(){var t=this.getHeadersSections();for(var i in t){if("selected"in t[i]&&t[i].selected){return t[i]}}return null},getHeadersSections:function e(){return this.getParam("HEADERS_SECTIONS")},getHeadersSectionParam:function e(t,i,s){if(this.getHeadersSections()[t]!==undefined&&this.getHeadersSections()[t][i]!==undefined){return this.getHeadersSections()[t][i]}return s},getFieldLoader:function e(){if(!this.fieldLoader){this.fieldLoader=new BX.Loader({mode:"custom",size:18,offset:{left:"5px",top:"5px"}})}return this.fieldLoader},_clickOnFieldListItem:function e(t){var i=t.target;var s;if(!BX.hasClass(i,this.settings.classFieldListItem)){i=BX.findParent(i,{className:this.settings.classFieldListItem},true,false)}if(BX.type.isDomNode(i)){try{s=JSON.parse(BX.data(i,"item"))}catch(e){}var n=BX.hasClass(i,this.settings.classMenuItemChecked);var a=new BX.Event.BaseEvent({data:s});this.emitter.emit(n?"onBeforeRemoveFilterItem":"onBeforeAddFilterItem",a);if(a.isDefaultPrevented()){return}var r=new BX.Promise;if(this.getParam("LAZY_LOAD")){this.getFieldLoader().show(i);var l=i.querySelector(".main-ui-select-inner-label");if(l){l.classList.add("main-ui-no-before")}var o=function(e){r.fulfill(e);this.getFieldLoader().hide();if(l){l.classList.remove("main-ui-no-before")}}.bind(this);if(BX.type.isNotEmptyObject(this.getParam("LAZY_LOAD")["CONTROLLER"])){var u=this.getParam("LAZY_LOAD")["CONTROLLER"]["componentName"];var c=this.getParam("LAZY_LOAD")["CONTROLLER"]["signedParameters"];BX.ajax.runAction(this.getParam("LAZY_LOAD")["CONTROLLER"]["getField"],{data:{filterId:this.getParam("FILTER_ID"),id:s.NAME,componentName:BX.type.isNotEmptyString(u)?u:"",signedParameters:BX.type.isNotEmptyString(c)?c:""}}).then(function(e){o(e.data)}.bind(this),(function(e){}))}else{this.getLazyLoadField(s.NAME).then(o)}}else{r.fulfill(s)}r.then(function(e){this.params.FIELDS.push(e);if(BX.hasClass(i,this.settings.classMenuItemChecked)){BX.removeClass(i,this.settings.classMenuItemChecked);this.getPreset().removeField(e)}else{if(BX.type.isPlainObject(e)){this.getPreset().addField(e);BX.addClass(i,this.settings.classMenuItemChecked);if(BX.type.isString(e.HTML)){var t=BX.create("div");this.getHiddenElement().appendChild(t);BX.html(t,e.HTML)}}}this.syncFields()}.bind(this))}},getHiddenElement:function e(){if(!this.hiddenElement){this.hiddenElement=BX.create("div");document.body.appendChild(this.hiddenElement)}return this.hiddenElement},getLazyLoadField:function e(t){var i=new BX.Promise;BX.ajax({method:"get",url:BX.util.add_url_param(this.getParam("LAZY_LOAD")["GET_FIELD"],{id:t}),dataType:"json",onsuccess:function e(t){i.fulfill(t)}});return i},showFieldsPopup:function e(){var t=this.getFieldsPopup();this.adjustFieldListPopupPosition();t.show()},closeFieldListPopup:function e(){var t=this.getFieldsPopup();t.close()},adjustFieldListPopupPosition:function e(){var t=this.getFieldsPopup();var i=BX.pos(this.getAddField());i.forceBindPosition=true;t.adjustPosition(i)},getFieldsPopup:function e(){var t=this.settings.get("showPopupInCenter",false)?null:this.getAddField();if(!this.fieldsPopup){this.fieldsPopup=new BX.PopupWindow(this.getParam("FILTER_ID")+"_fields_popup",t,{autoHide:true,offsetTop:4,offsetLeft:0,lightShadow:true,closeIcon:t===null,closeByEsc:t===null,noAllPaddings:true,zIndex:13});this.fieldsPopupLoader=new BX.Loader({target:this.fieldsPopup.contentContainer});this.fieldsPopupLoader.show();this.setPopupElementWidthFromSettings(this.fieldsPopup.contentContainer);this.fieldsPopup.contentContainer.style.height="330px";this.getFieldsListPopupContent().then(function(e){this.fieldsPopup.contentContainer.removeAttribute("style");this.fieldsPopupLoader.hide();this.fieldsPopup.setContent(e);this.syncFields({cache:false});this.adjustFieldListPopupPosition()}.bind(this))}return this.fieldsPopup},setPopupElementWidthFromSettings:function e(t){t.style.width=this.settings.popupWidth+"px"},_onAddPresetClick:function e(){this.enableAddPreset()},enableWaitSate:function e(t){!!t&&BX.addClass(t,this.settings.classWaitButtonClass)},disableWaitState:function e(t){!!t&&BX.removeClass(t,this.settings.classWaitButtonClass)},_onSaveButtonClick:function e(){var t=!!this.getSaveForAllCheckbox()&&this.getSaveForAllCheckbox().checked;var i=this.getPreset().getAddPresetFieldInput();var s=i.parentNode.querySelector(".main-ui-filter-edit-mask");var n;function a(e){if(e.animationName==="fieldError"){e.currentTarget.removeEventListener("animationend",a);e.currentTarget.removeEventListener("oAnimationEnd",a);e.currentTarget.removeEventListener("webkitAnimationEnd",a);e.currentTarget.classList.remove("main-ui-filter-error")}}function r(e){e.addEventListener("animationend",a);e.addEventListener("oAnimationEnd",a);e.addEventListener("webkitAnimationEnd",a);e.classList.add("main-ui-filter-error");var t=new BX.Promise;t.fulfill(true);return t}this.enableWaitSate(this.getFindButton());if(this.isAddPresetEnabled()&&!t){n=i.value;if(n.length){this.savePreset();this.disableAddPreset()}else{r(s).then((function(){i.focus()}))}}if(this.isEditEnabled()){var l=this.getPreset();var o=l.getPresetNodeById(l.getCurrentPresetId());var u=l.getPresetInput(o);if(u.value.length){l.updateEditablePreset(l.getCurrentPresetId());this.saveUserSettings(t);if(!t){this.disableEdit()}}else{var c=o.querySelector(".main-ui-filter-edit-mask");r(c).then((function(){u.focus()}))}}},_onCancelButtonClick:function e(){this.setIsSetOutsideState(false);this.disableAddPreset();this.getPreset().clearAddPresetFieldInput();this.disableEdit();!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)},_onGridReady:function e(t){if(!this.grid&&t.getContainerId()===this.getParam("GRID_ID")){this.grid=t}},_onFilterMousedown:function e(t){var i=t.target;if(this.getFields().isDragButton(i)){var s=BX.Filter.Utils.getByTag(i.parentNode,"input",true);(s||[]).forEach((function(e){BX.fireEvent(e,"blur")}));BX.fireEvent(this.getFilter(),"click")}},_onFilterClick:function e(t){var i=this.getFields();var s=this.getPreset();var n;if(i.isFieldDelete(t.target)){n=i.getField(t.target);s.removeField(n)}if(i.isFieldValueDelete(t.target)){n=i.getField(t.target);i.clearFieldValue(n)}},getButtonsContainer:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classButtonsContainer)},getSaveButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSaveButton)},getCancelButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classCancelButton)},getFindButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFindButton)},getResetButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classResetButton)},getAddPresetButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddPresetButton)},isAddPresetEnabled:function e(){return this.isAddPresetModeState},enableAddPreset:function e(){var t=this.getPreset();var i=t.getAddPresetField();var s=t.getAddPresetFieldInput();var n=this.getButtonsContainer();BX.show(i);BX.show(n);BX.hide(this.getPresetButtonsContainer());this.hideForAllCheckbox();if(BX.type.isDomNode(s)){s.focus()}BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=true},disableAddPreset:function e(){var t=this.getPreset();var i=t.getAddPresetField();var s=this.getButtonsContainer();BX.hide(i);BX.hide(s);BX.show(this.getPresetButtonsContainer());this.showForAllCheckbox();t.getAddPresetFieldInput().value="";BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=false},getControls:function e(){var t=this.getFieldListContainer();var i=null;if(BX.type.isDomNode(t)){i=BX.Filter.Utils.getByClass(t,this.settings.classControl,true)}return i},getFilterFields:function e(){var t=this.getFieldListContainer();var i=[];var s=[];if(BX.type.isDomNode(t)){i=BX.Filter.Utils.getByClass(t,this.settings.classField,true);s=BX.Filter.Utils.getByClass(t,this.settings.classFieldGroup,true);if(!BX.type.isArray(i)){i=[]}if(BX.type.isArray(s)){s.forEach((function(e){i.push(e)}))}}return i},getFilterFieldsValues:function e(){var t=this.getPreset().getFields();var i=this.getSearch();var s={};var n,a;s["FIND"]=i.getInput().value;if(BX.type.isArray(t)&&t.length){t.forEach((function(e){var t=BX.Filter.AdditionalFilter.getInstance().getFilter(e);if(t){Object.assign(s,t);return}n=BX.data(e,"type");a=BX.data(e,"name");switch(n){case this.types.STRING:{this.prepareControlStringValue(s,e);break}case this.types.TEXTAREA:{this.prepareControlTextareaValue(s,e);break}case this.types.NUMBER:{this.prepareControlNumberValue(s,a,e);break}case this.types.DATE:{this.prepareControlDateValue(s,a,e);break}case this.types.CUSTOM_DATE:{this.prepareControlCustomDateValue(s,a,e);break}case this.types.SELECT:{this.prepareControlSelectValue(s,a,e);break}case this.types.MULTI_SELECT:{this.prepareControlMultiselectValue(s,a,e);break}case this.types.DEST_SELECTOR:case this.types.CUSTOM_ENTITY:case this.types.ENTITY_SELECTOR:{this.prepareControlCustomEntityValue(s,a,e);break}case this.types.CUSTOM:{this.prepareControlCustomValue(s,a,e);break}default:{break}}}),this)}return s},prepareControlCustomEntityValue:function e(t,i,s){var n=this.fetchSquares(s);var a=this.fetchSquaresData(n);var r=BX.Main.ui.CustomEntity.isMultiple(s);t[i]="";t[i+"_label"]="";if(r){t[i]=[];t[i+"_label"]=[];!!a&&a.forEach((function(e){t[i].push(e._value.toString());t[i+"_label"].push(e._label.toString())}))}else{if(a.length){t[i]=a[0]._value.toString();t[i+"_label"]=a[0]._label.toString()}}},fetchSquares:function e(t){return!!t?BX.Filter.Utils.getByClass(t,this.settings.classSquare,true):[]},fetchSquaresData:function e(t){return t.map((function(e){return JSON.parse(BX.data(e,"item"))}),this)},prepareControlCustomValue:function e(t,i,s){var n=BX.Filter.Utils.getByTag(s,"input",true);t[i]="";if(BX.type.isArray(n)){n.forEach((function(e){if(BX.type.isNotEmptyString(e.name)){t[e.name]=e.value}}))}},prepareControlMultiselectValue:function e(t,i,s){var n=BX.Filter.Utils.getByClass(s,this.settings.classMultiSelect);var a=JSON.parse(BX.data(n,"value"));t[i]="";if(BX.type.isArray(a)&&a.length){t[i]={};a.forEach((function(e,s){t[i][s]=e.VALUE}))}},prepareControlSelectValue:function e(t,i,s){var n=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var a=JSON.parse(BX.data(n,"value"));t[i]=a.VALUE},prepareControlCustomDateValue:function e(t,i,s){var n=s.querySelector('[data-name="'+i+"_days"+'"]');if(n){var a=JSON.parse(n.dataset.value);t[i+"_days"]=a.map((function(e){return e.VALUE}))}var r=s.querySelector('[data-name="'+i+"_months"+'"]');if(r){var l=JSON.parse(r.dataset.value);t[i+"_months"]=l.map((function(e){return e.VALUE}))}var o=s.querySelector('[data-name="'+i+"_years"+'"]');if(o){var u=JSON.parse(o.dataset.value);t[i+"_years"]=u.map((function(e){return e.VALUE}))}},prepareControlDateValue:function e(t,i,s,n){var a=s.querySelector(".main-ui-filter-additional-fields-container");if(a&&!n){BX.remove(a)}var r=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var l=s.querySelector('.main-ui-select[data-name*="_allow_year"]');var o=i+this.settings.datePostfix;var u=i+this.settings.fromPostfix;var c=i+this.settings.toPostfix;var d=i+this.settings.daysPostfix;var h=i+this.settings.monthPostfix;var p=i+this.settings.quarterPostfix;var f=i+this.settings.yearPostfix;var m=i+"_allow_year";var E,g,y,v,B;t[o]="";t[u]="";t[c]="";t[d]="";t[h]="";t[p]="";t[f]="";var A=s.querySelector(".main-ui-date-input");if(A&&A.dataset.isValid==="false"){return}E=JSON.parse(BX.data(r,"value"));t[o]=E.VALUE;if(l){B=JSON.parse(BX.data(l,"value"));t[m]=B.VALUE}switch(E.VALUE){case this.dateTypes.EXACT:{g=BX.Filter.Utils.getByClass(s,this.settings.classDateInput);t[u]=g.value;t[c]=g.value;break}case this.dateTypes.QUARTER:{y=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(y)){y.forEach((function(e){v=BX.data(e,"name");if(v&&v.indexOf("_quarter")!==-1){t[p]=JSON.parse(BX.data(e,"value")).VALUE}if(v&&v.endsWith("_year")&&!v.endsWith("_allow_year")){t[f]=JSON.parse(BX.data(e,"value")).VALUE}}),this)}break}case this.dateTypes.YEAR:{y=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(y)){y.forEach((function(e){v=BX.data(e,"name");if(v&&v.endsWith("_year")&&!v.endsWith("_allow_year")){t[f]=JSON.parse(BX.data(e,"value")).VALUE}}),this)}break}case this.dateTypes.MONTH:{y=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(y)){y.forEach((function(e){v=BX.data(e,"name");if(v&&v.indexOf("_month")!==-1){t[h]=JSON.parse(BX.data(e,"value")).VALUE}if(v&&v.endsWith("_year")&&!v.endsWith("_allow_year")){t[f]=JSON.parse(BX.data(e,"value")).VALUE}}),this)}break}case this.additionalDateTypes.PREV_DAY:case this.additionalDateTypes.NEXT_DAY:case this.additionalDateTypes.MORE_THAN_DAYS_AGO:case this.additionalDateTypes.AFTER_DAYS:case this.dateTypes.NEXT_DAYS:case this.dateTypes.PREV_DAYS:{var P=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput);if(!!P&&P.name===d){t[d]=P.value}break}case this.dateTypes.RANGE:{g=BX.Filter.Utils.getByClass(s,this.settings.classDateInput,true);g.forEach((function(e){if(e.name===u){t[u]=e.value}else if(e.name===c){t[c]=e.value}}),this);break}case"CUSTOM_DATE":{var S={};this.prepareControlCustomDateValue(S,i,s);t[i+"_days"]=S[i+"_days"];t[h]=S[i+"_months"];t[f]=S[i+"_years"];break}default:{break}}if(a&&!n){BX.append(a,s)}var _=Array.from(s.querySelectorAll('.main-ui-filter-additional-fields-container > [data-type="DATE"]'));if(_){_.forEach((function(e){var i=e.dataset.name;this.prepareControlDateValue(t,i,e,true)}),this)}},prepareControlNumberValue:function e(t,i,s){var n=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput,true);var a=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var r=i+this.settings.numberPostfix;var l=i+this.settings.fromPostfix;var o=i+this.settings.toPostfix;var u;t[l]="";t[o]="";u=JSON.parse(BX.data(a,"value"));t[r]=u.VALUE;n.forEach((function(e){if(e.name.indexOf(this.settings.fromPostfix)!==-1){t[l]=e.value||"";if(t[r]==="exact"){t[o]=e.value||""}}else if(e.name.indexOf(this.settings.toPostfix)!==-1){t[o]=e.value||""}}),this)},prepareControlStringValue:function e(t,i){var s=BX.Filter.Utils.getByClass(i,this.settings.classStringInput);var n;if(BX.type.isDomNode(s)){n=s.name;t[n]=s.value}},prepareControlTextareaValue:function e(t,i){var s=BX.Filter.Utils.getByClass(i,this.settings.classStringInput);var n;if(BX.type.isDomNode(s)){n=s.name;t[n]=s.value}},showGridAnimation:function e(){this.grid&&this.grid.tableFade()},hideGridAnimation:function e(){this.grid&&this.grid.tableUnfade()},getPresetId:function e(t,i){var s=this.getPreset().getCurrentPresetId();if(!this.isEditEnabled()&&!this.isAddPresetEnabled()&&!i||s==="default_filter"&&!t){s="tmp_filter"}return s},isAppliedUserFilter:function e(){var t=this;var i=this.getPreset().getCurrentPresetData();if(BX.Type.isPlainObject(i)){var s=BX.Type.isArrayFilled(i.FIELDS)&&i.FIELDS.some((function(e){return!t.getPreset().isEmptyField(e)}));var n=BX.Type.isArrayFilled(i.ADDITIONAL)&&i.ADDITIONAL.some((function(e){return!t.getPreset().isEmptyField(e)}));return!i.IS_PINNED&&(s||n)||i.IS_PINNED&&BX.Type.isArrayFilled(i.ADDITIONAL)||BX.Type.isStringFilled(this.getSearch().getSearchString())}return false},isAppliedDefaultPreset:function e(){var t=this;var i=this.getPreset().getCurrentPresetData();if(!i.IS_PINNED){return false}if(BX.Type.isArrayFilled(i.ADDITIONAL)){var s=i.ADDITIONAL.some((function(e){return!t.getPreset().isEmptyField(e)}));if(s){return false}}if(BX.Type.isStringFilled(this.getSearch().getSearchString())){return false}return true},applyFilter:function e(t,i,s){this.setIsSetOutsideState(s);var n=this.getPresetId(t,i);var a=this.getParam("FILTER_ID");var r=new BX.Promise(null,this);var l=this.getPreset();var o=this.getSearch();var u={autoResolve:!this.grid};var c=this;this.setDefaultPresetAppliedState(this.isAppliedDefaultPreset());if(this.isAppliedUserFilter()){BX.Dom.addClass(this.getSearch().container,"main-ui-filter-search--active")}else{BX.Dom.removeClass(this.getSearch().container,"main-ui-filter-search--active")}this.clearGet();this.showGridAnimation();var d=t?"clear":"apply";BX.onCustomEvent(window,"BX.Main.Filter:beforeApply",[a,{action:d},this,r]);this.updatePreset(n,null,t,null).then((function(){o.updatePreset(l.getPreset(n));if(c.getParam("VALUE_REQUIRED")){if(!o.getSquares().length){c.lastPromise=l.applyPinnedPreset()}}})).then((function(){var e={apply_filter:"Y",clear_nav:"Y"};var t=BX.delegate(r.fulfill,r);var i=BX.delegate(r.reject,r);c.grid&&c.grid.reloadTable("POST",e,t,i);BX.onCustomEvent(window,"BX.Main.Filter:apply",[a,{action:d},c,r,u]);u.autoResolve&&r.fulfill()}));return r},getAddField:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddField)},getFieldListContainer:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFileldControlList)},getFields:function e(){if(!(this.fields instanceof BX.Filter.Fields)){this.fields=new BX.Filter.Fields(this)}return this.fields},getPreset:function e(){if(!(this.presets instanceof BX.Filter.Presets)){this.presets=new BX.Filter.Presets(this)}return this.presets},resetControlData:function e(t){if(BX.type.isPlainObject(t)){switch(t.TYPE){case this.types.MULTI_SELECT:{t.VALUE=[];break}case this.types.SELECT:{t.VALUE=t.ITEMS[0];break}case this.types.DATE:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:"",_days:"",_quarter:"",_year:""};break}case this.types.CUSTOM_DATE:{t.VALUES={days:[],months:[],years:[]};break}case this.types.NUMBER:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:""};break}case this.types.DEST_SELECTOR:case this.types.ENTITY_SELECTOR:case this.types.CUSTOM_ENTITY:{t.VALUES={_label:"",_value:""};break}case this.types.CUSTOM:{t._VALUE="";break}default:{t.VALUE=""}}}return t},clearControl:function e(t){var i=this.getPreset().getField({NAME:t});var s,n;if(BX.type.isDomNode(i)){s=this.getFieldByName(t);s=this.resetControlData(s);n=this.getPreset().createControl(s);BX.insertAfter(n,i);BX.remove(i)}},clearControls:function e(t){if(BX.type.isArray(t)){t.forEach((function(e){"name"in e&&this.clearControl(e.name)}),this)}else if(BX.type.isPlainObject(t)&&"name"in t){this.clearControl(t.name)}},getTemplate:function e(){return BX.html(BX(this.settings.generalTemplateId))},isIe:function e(){if(!BX.type.isBoolean(this.ie)){this.ie=BX.hasClass(document.documentElement,"bx-ie")}return this.ie},closePopup:function e(){var t=this.getPopup();var i=t.popupContainer;var s=this.settings.get("FILTER_CLOSE_DELAY");var n;BX.Dom.removeClass(this.getSearch().container,"main-ui-filter-search--showed");setTimeout(BX.delegate((function(){if(!this.isIe()){BX.removeClass(i,this.settings.classAnimationShow);BX.addClass(i,this.settings.classAnimationClose);n=parseFloat(BX.style(i,"animation-duration"));if(BX.type.isNumber(n)){n=n*1e3}setTimeout((function(){t.close()}),n)}else{t.close()}}),this),s);if(this.getParam("LIMITS_ENABLED")){BX.removeClass(this.getFilter(),this.settings.classLimitsAnimation)}this.closeFieldListPopup();this.adjustFocus()},showPopup:function e(){var t=this.getPopup();var i;if(!t.isShown()){BX.Dom.addClass(this.getSearch().container,"main-ui-filter-search--showed");this.isOpened=true;var s=this.settings.get("FILTER_SHOW_DELAY");if(this.getParam("LIMITS_ENABLED")===true){this.limitAnalyticsSend()}setTimeout(BX.delegate((function(){t.show();if(!this.isIe()){i=t.popupContainer;BX.removeClass(i,this.settings.classAnimationClose);BX.addClass(i,this.settings.classAnimationShow);BX.onCustomEvent(window,"BX.Main.Filter:show",[this])}var e=[].slice.call(this.getFieldListContainer().querySelectorAll("textarea"));e.forEach((function(e){BX.style(e,"height",e.scrollHeight+"px")}))}),this),s)}},getSaveForAllCheckbox:function e(){if(!this.saveForAllCheckbox&&!!this.getSaveForAllCheckboxContainer()){this.saveForAllCheckbox=BX.Filter.Utils.getBySelector(this.getSaveForAllCheckboxContainer(),'input[type="checkbox"]')}return this.saveForAllCheckbox},getSaveForAllCheckboxContainer:function e(){if(!this.saveForAllCheckboxContainer){this.saveForAllCheckboxContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.saveForAllCheckboxContainer},showForAllCheckbox:function e(){!!this.getSaveForAllCheckboxContainer()&&BX.removeClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},hideForAllCheckbox:function e(){!!this.getSaveForAllCheckboxContainer()&&BX.addClass(this.getSaveForAllCheckboxContainer(),this.settings.classHide)},getPopupBindElement:function e(){if(!this.popupBindElement){var t=this.settings.get("POPUP_BIND_ELEMENT_SELECTOR");var i=null;if(BX.type.isNotEmptyString(t)){i=BX.Filter.Utils.getBySelector(document,t)}this.popupBindElement=!!i?i:this.getSearch().getContainer()}return this.popupBindElement},getPopup:function e(){if(!(this.popup instanceof BX.PopupWindow)){this.popup=new BX.PopupWindow(this.getParam("FILTER_ID")+this.settings.searchContainerPostfix,this.getPopupBindElement(),{autoHide:false,offsetTop:parseInt(this.settings.get("POPUP_OFFSET_TOP")),offsetLeft:parseInt(this.settings.get("POPUP_OFFSET_LEFT")),lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:12});this.popup.setContent(this.getTemplate());BX.bind(this.getFieldListContainer(),"keydown",BX.delegate(this._onFieldsContainerKeydown,this));BX.bind(this.getFilter(),"click",BX.delegate(this._onFilterClick,this));BX.bind(this.getAddPresetButton(),"click",BX.delegate(this._onAddPresetClick,this));BX.bind(this.getPreset().getAddPresetFieldInput(),"keydown",BX.delegate(this._onAddPresetKeydown,this));BX.bind(this.getPreset().getContainer(),"keydown",BX.delegate(this._onPresetInputKeydown,this));BX.bind(this.getSaveButton(),"click",BX.delegate(this._onSaveButtonClick,this));BX.bind(this.getCancelButton(),"click",BX.delegate(this._onCancelButtonClick,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onFindButtonClick,this));BX.bind(this.getResetButton(),"click",BX.delegate(this._onResetButtonClick,this));BX.bind(this.getAddField(),"click",BX.delegate(this._onAddFieldClick,this));BX.bind(this.getEditButton(),"click",BX.delegate(this._onEditButtonClick,this));BX.bind(this.getRestoreButton(),"click",BX.delegate(this._onRestoreButtonClick,this));BX.bind(this.getRestoreFieldsButton(),"click",BX.delegate(this._onRestoreFieldsButtonClick,this));this.getFilter().addEventListener("mousedown",BX.delegate(this._onFilterMousedown,this),true);this.getPreset().showCurrentPresetFields();this.getPreset().bindOnPresetClick()}return this.popup},_onRestoreFieldsButtonClick:function e(){this.restoreDefaultFields()},restoreDefaultFields:function e(){var t=this.getPreset().getPreset("default_filter",true);var i=this.getParam("PRESETS");var s=this.getPreset().getCurrentPresetId();var n={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var a=t.FIELDS.map((function(e){return e.NAME}));var r=a.join(",");i.forEach((function(e,s){if(e.ID==="default_filter"){i[s]=BX.clone(t)}}),this);if(BX.type.isArray(this.editablePresets)){this.editablePresets.forEach((function(e,i){if(e.ID==="default_filter"){this.editablePresets[i]=BX.clone(t)}}),this)}this.getPreset().applyPreset(s);this.updatePreset(s);this.saveOptions({preset_id:"default_filter",rows:r,save:"Y",apply_filter:"N"},n)},getRestoreFieldsButton:function e(){if(!this.restoreFieldsButton){this.restoreFieldsButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreFieldsButton)}return this.restoreFieldsButton},restoreFilter:function e(){var t=this.getParam("DEFAULT_PRESETS");var i=this.getParam("PRESETS");var s=false;var n,a,r;if(BX.type.isArray(t)){t.sort((function(e,t){return e.SORT-t.SORT}));t.forEach((function(e){s=i.some((function(t,i){if(t.ID===e.ID){n=i;return true}}));if(s){i[n]=BX.clone(e)}else{i.push(BX.clone(e))}if(e.ID!=="default_filter"){this.addSidebarItem(e.ID,e.TITLE,e.IS_PINNED);if(e.IS_PINNED){a=e.ID}}}),this)}this.saveRestoreFilter();this.disableAddPreset();this.disableEdit();if(!a){a="default_filter"}r=this.getPreset().getPresetNodeById(a);if(r){BX.fireEvent(r,"click")}},saveRestoreFilter:function e(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"RESTORE_FILTER"};var i=this.getParam("PRESETS");var s={};var n;if(BX.type.isArray(i)){i.forEach((function(e){n=e.FIELDS.map((function(e){return e.NAME}));n=n.join(",");s[e.ID]={name:e.TITLE||null,sort:e.SORT,preset_id:e.ID,fields:this.prepareFields(e.FIELDS),rows:n,for_all:e.FOR_ALL}}),this);this.saveOptions(s,t)}},prepareFields:function e(t){var i={};var s;if(BX.type.isArray(t)){t.forEach((function(e){if(e.TYPE===this.types.SELECT){i[e.NAME]="VALUE"in e.VALUE?e.VALUE.VALUE:""}if(e.TYPE===this.types.MULTI_SELECT){e.VALUE.forEach((function(t,s){i[e.NAME]=i[e.NAME]||{};i[e.NAME][s]=t.VALUE}));i[e.NAME]=i[e.NAME]||""}if(e.TYPE===this.types.DATE||e.TYPE===this.types.NUMBER){s=Object.keys(e.VALUES);s.forEach((function(t){i[e.NAME+t]=e.VALUES[t]}));if(e.TYPE===this.types.DATE){i[e.NAME+"_datesel"]="VALUE"in e.SUB_TYPE?e.SUB_TYPE.VALUE:e.SUB_TYPES[0].VALUE}if(e.TYPE===this.types.NUMBER){i[e.NAME+"_numsel"]="VALUE"in e.SUB_TYPE?e.SUB_TYPE.VALUE:e.SUB_TYPES[0].VALUE}}if(e.TYPE===this.types.DEST_SELECTOR||e.TYPE===this.types.ENTITY_SELECTOR||e.TYPE===this.types.CUSTOM_ENTITY){i[e.NAME+"_label"]=e.VALUES._label;i[e.NAME+"_value"]=e.VALUES._value}}),this)}return i},getRestoreButton:function e(){if(!BX.type.isDomNode(this.restoreButton)){this.restoreButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreButton)}return this.restoreButton},_onPresetInputKeydown:function e(t){if(BX.Filter.Utils.isKey(t,"enter")&&t.target.tagName==="INPUT"){BX.fireEvent(this.getSaveButton(),"click")}},_onFieldsContainerKeydown:function e(t){if(BX.Filter.Utils.isKey(t,"enter")&&t.target.tagName==="INPUT"){BX.fireEvent(this.getFindButton(),"click")}},_onFindButtonClick:function e(){this.setIsSetOutsideState(false);var t=this.getPreset();var i=t.getCurrentPresetId();var s;if(i!=="tmp_filter"&&i!=="default_filter"&&!t.isPresetValuesModified(i)){var n=t.getPreset(i);var a=t.getAdditionalValues(i);var r=t.getFields().map((function(e){return BX.data(e,"name")}));n.ADDITIONAL=this.preparePresetFields(a,r);n.ADDITIONAL=n.ADDITIONAL.filter((function(e){return!this.getPreset().isEmptyField(e)}),this);s=this.applyFilter(false,i);this.closePopup()}else{t.deactivateAllPresets();s=this.applyFilter();this.closePopup()}return s},_onResetButtonClick:function e(){if(this.getParam("VALUE_REQUIRED")){var t=this.getPreset().getCurrentPresetData();if(t.ADDITIONAL.length){this.closePopup()}BX.fireEvent(this.getSearch().getClearButton(),"click")}else{if(this.getParam("RESET_TO_DEFAULT_MODE")){this.getSearch().clearInput();this.getPreset().applyPinnedPreset()}else{this.resetFilter()}this.closePopup()}},resetFilter:function e(t){var i=this.getSearch();var s=this.getPreset();if(!t){i.clearInput()}i.removePreset();s.deactivateAllPresets();s.resetPreset(true);i.hideClearButton();i.adjustPlaceholder();return this.applyFilter(true,true)},_onEditButtonClick:function e(){if(!this.isEditEnabled()){this.enableEdit()}else{this.disableEdit()}},enableFieldsDragAndDrop:function e(){var t=this.getPreset().getFields();this.fieldsList=[];if(BX.type.isArray(t)){this.fieldsList=t.map(this.registerDragItem,this)}},registerDragItem:function e(t){var i=this.getDragButton(t);if(i){i.onbxdragstart=BX.delegate(this._onFieldDragStart,this);i.onbxdragstop=BX.delegate(this._onFieldDragStop,this);i.onbxdrag=BX.delegate(this._onFieldDrag,this);jsDD.registerObject(i);jsDD.registerDest(i)}return t},unregisterDragItem:function e(t){var i=this.getDragButton(t);if(i){jsDD.unregisterObject(i);jsDD.unregisterDest(i)}},_onFieldDragStart:function e(){this.dragItem=this.getFields().getField(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.fieldsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onFieldDragStop:function e(){BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);this.fieldsList=this.getPreset().getFields();this.saveFieldsSort()},_onFieldDrag:function e(){var t=this;var i,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.fieldsList.forEach((function(e,n){if(e){i=e.getBoundingClientRect();s=i.top+BX.scrollTop(window)+i.height/2;if(n>t.dragIndex&&t.sortOffset>s&&e.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&e.style.transform!==""){t.targetItem=e;BX.style(e,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(e,"transition","300ms")}if(n<t.dragIndex&&t.sortOffset<s&&e.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&e.style.transform!==""){t.targetItem=e;BX.style(e,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(e,"transition","300ms")}if((n<t.dragIndex&&t.sortOffset>s||n>t.dragIndex&&t.sortOffset<s)&&e.style.transform!=="translate3d(0px, 0px, 0px)"){if(e.style.transform!==""){t.targetItem=e}BX.style(e,"transform","translate3d(0px, 0px, 0px)");BX.style(e,"transition","300ms")}}}))},disableFieldsDragAndDrop:function e(){if(BX.type.isArray(this.fieldsList)&&this.fieldsList.length){this.fieldsList.map(this.unregisterDragItem,this)}},enablePresetsDragAndDrop:function e(){var t,i,s,n;t=this.getPreset();i=t.getPresets();this.presetsList=[];if(BX.type.isArray(i)&&i.length){i.forEach((function(e){n=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&n!=="default_filter"&&!BX.hasClass(e,this.settings.classDefaultFilter)){s=this.getDragButton(e);s.onbxdragstart=BX.delegate(this._onDragStart,this);s.onbxdragstop=BX.delegate(this._onDragStop,this);s.onbxdrag=BX.delegate(this._onDrag,this);jsDD.registerObject(s);jsDD.registerDest(s);this.presetsList.push(e)}}),this)}},getDragButton:function e(t){return BX.Filter.Utils.getByClass(t,this.settings.classPresetDragButton)},disablePresetsDragAndDrop:function e(){if(BX.type.isArray(this.presetsList)&&this.presetsList.length){this.presetsList.forEach((function(e){if(!BX.hasClass(e,this.settings.classAddPresetField)){jsDD.unregisterObject(e);jsDD.unregisterDest(e)}}),this)}},_onDragStart:function e(){this.dragItem=this.getPreset().normalizePreset(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.presetsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.list,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onMouseMove:function e(t){this.realX=t.clientX;this.realY=t.clientY},getDragOffset:function e(){return jsDD.x-this.startDragOffset-this.dragRect.left},_onDragStop:function e(){var t,i;BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.presetsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);t=this.getPreset();i=t.getPresets();this.presetsList=[];if(BX.type.isArray(i)&&i.length){i.forEach((function(e){if(!BX.hasClass(e,this.settings.classAddPresetField)&&!BX.hasClass(e,this.settings.classDefaultFilter)){this.presetsList.push(e)}}),this)}},_onDrag:function e(){var t=this;var i,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.presetsList.forEach((function(e,n){if(e){i=e.getBoundingClientRect();s=i.top+BX.scrollTop(window)+i.height/2;if(n>t.dragIndex&&t.sortOffset>s&&e.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&e.style.transform!==""){t.targetItem=e;BX.style(e,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(e,"transition","300ms")}if(n<t.dragIndex&&t.sortOffset<s&&e.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&e.style.transform!==""){t.targetItem=e;BX.style(e,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(e,"transition","300ms")}if((n<t.dragIndex&&t.sortOffset>s||n>t.dragIndex&&t.sortOffset<s)&&e.style.transform!=="translate3d(0px, 0px, 0px)"){if(e.style.transform!==""){t.targetItem=e}BX.style(e,"transform","translate3d(0px, 0px, 0px)");BX.style(e,"transition","300ms")}}}))},getSidebarControlsContainer:function e(){if(!BX.type.isDomNode(this.sidebarControlsContainer)){this.sidebarControlsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSidebarControlsContainer)}return this.sidebarControlsContainer},enableEdit:function e(){var t=this.getPreset();var i=t.getPresets();var s;if(BX.type.isArray(i)&&i.length){i.forEach((function(e){s=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&s!=="default_filter"){BX.addClass(e,this.settings.classPresetEdit)}}),this)}this.enablePresetsDragAndDrop();BX.show(this.getButtonsContainer());BX.hide(this.getPresetButtonsContainer());BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=BX.clone(this.getParam("PRESETS"));this.isEditEnabledState=true},disableEdit:function e(){var t=this.getPreset();var i=t.getPresets();if(BX.type.isArray(i)&&i.length){i.forEach((function(e){if(!BX.hasClass(e,this.settings.classAddPresetField)){BX.removeClass(e,this.settings.classPresetEdit);this.getPreset().disableEditPresetName(e)}}),this)}this.disablePresetsDragAndDrop();if(!this.isAddPresetEnabled()){BX.style(this.getButtonsContainer(),"display","")}BX.show(this.getPresetButtonsContainer());BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=null;this.isEditEnabledState=false;this.applyFilter(null,true)},getPresetButtonsContainer:function e(){if(!BX.type.isDomNode(this.presetButtonsContainer)){this.presetButtonsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classPresetButtonsContainer)}return this.presetButtonsContainer},isEditEnabled:function e(){return this.isEditEnabledState},getEditButton:function e(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classEditButton)},getParam:function e(t,i){return t in this.params?this.params[t]:i},getFilter:function e(){return BX.Filter.Utils.getByClass(this.getPopup().contentContainer,this.settings.classFilterContainer)},getSearch:function e(){if(!(this.search instanceof BX.Filter.Search)){this.search=new BX.Filter.Search(this)}return this.search},_onRestoreButtonClick:function e(){var t={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("CONFIRM_MESSAGE"),CONFIRM_APPLY_BUTTON:this.getParam("CONFIRM_APPLY"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(t,BX.delegate(this.restoreFilter,this))},confirmDialog:function e(t,i,s){if("CONFIRM"in t&&t.CONFIRM){var n=this.getParam("FILTER_ID")+"-confirm-dialog";var a='<div class="main-ui-filter-confirm-content">'+t.CONFIRM_MESSAGE+"</div>";var r="CONFIRM_TITLE"in t?t.CONFIRM_TITLE:"";var l=new BX.PopupWindowButton({text:t.CONFIRM_APPLY_BUTTON,events:{click:function e(){BX.type.isFunction(i)?i():null;this.popupWindow.close();this.popupWindow.destroy()}}});var o=new BX.PopupWindowButtonLink({text:t.CONFIRM_CANCEL_BUTTON,events:{click:function e(){BX.type.isFunction(s)?s():null;this.popupWindow.close();this.popupWindow.destroy()}}});var u=new BX.PopupWindow(n,null,{content:a,titleBar:r,autoHide:false,zIndex:9999,overlay:.4,offsetTop:-100,closeIcon:true,closeByEsc:true,buttons:[l,o]});BX.addCustomEvent(u,"onPopupClose",BX.delegate((function(){!!this.getSaveForAllCheckbox()&&(this.getSaveForAllCheckbox().checked=null)}),this));if(!u.isShown()){u.show();var c=u.popupContainer;BX.removeClass(c,this.settings.classAnimationShow);BX.addClass(c,this.settings.classAnimationShow)}}else{BX.type.isFunction(i)?i():null}},getInitialValue:function e(t){if(BX.type.isString(t)){var i=this.params.INITIAL_FILTER;if(BX.type.isPlainObject(i)){var s=Object.entries(i).reduce((function(e,i){if(i[0].startsWith(t)){e.push(i)}return e}),[]);if(s.length===1){return s[0][1]}if(s.length>1){return s.reduce((function(e,i){e[i[0].replace(t,"")]=i[1];return e}),{})}}}return""},getField:function e(t){var i=this.getFieldListContainer().querySelector('[data-name="'+t+'"]');return BX.Filter.Field.instances.get(i)},isSetOutside:function e(){return BX.Text.toBoolean(this.isSetOutsideState)},setIsSetOutsideState:function e(t){this.isSetOutsideState=BX.Text.toBoolean(t);var i=this.getSearch().getContainer();if(this.isSetOutsideState){BX.Dom.addClass(i,"main-ui-filter-set-outside");BX.Dom.removeClass(i,"main-ui-filter-set-inside")}else{BX.Dom.addClass(i,"main-ui-filter-set-inside");BX.Dom.removeClass(i,"main-ui-filter-set-outside")}},setDefaultPresetAppliedState:function e(t){this.isDefaultPresetAppliedState=BX.Text.toBoolean(t);var i=this.getSearch().getContainer();if(this.isDefaultPresetAppliedState){BX.Dom.addClass(i,"main-ui-filter-default-applied")}else{BX.Dom.removeClass(i,"main-ui-filter-default-applied")}}}})();(function(){BX.Main.filterManager={data:{},push:function e(t,i){if(BX.type.isNotEmptyString(t)&&i){this.data[t]=i}},getById:function e(t){var i=null;if(t in this.data){i=this.data[t]}return i},getList:function e(){return Object.values(this.data)}}})();var v;function B(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function A(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?B(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):B(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var P=Symbol("onValueChange");var S=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));i.setEventNamespace("BX.Filter.Field");i.id=e.options.NAME;i.parent=e.parent;i.node=e.node;i.options=A({},e.options);i.cache=new n.Cache.MemoryCache;i[P]=i[P].bind(babelHelpers.assertThisInitialized(i));n.Event.bind(i.node,"input",i[P]);n.Event.bind(i.node,"change",i[P]);var s=babelHelpers.toConsumableArray(i.node.querySelectorAll(".main-ui-control-value-delete"));s.forEach((function(e){e.addEventListener("click",(function(){setTimeout((function(){i[P]()}))}))}));var a=new MutationObserver((function(){i[P]()}));var r=babelHelpers.toConsumableArray(i.node.querySelectorAll(".main-ui-select"));r.forEach((function(e){a.observe(e,{attributes:true,attributeFilter:["data-value"]})}));t.instances.set(i.node,babelHelpers.assertThisInitialized(i));return i}babelHelpers.createClass(t,[{key:"subscribe",value:function e(t,i){n.Event.EventEmitter.subscribe(this,t.replace("BX.Filter.Field:",""),i)}},{key:P,value:function e(){this.emit("change",{field:this,value:this.getValue()})}},{key:"getAdditionalFieldContainer",value:function e(){return this.cache.remember("additionalFieldsContainer",(function(){return n.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="main-ui-filter-additional-fields-container"></div>\n\t\t\t'])))}))}},{key:"hasAdditional",value:function e(){return n.Dom.hasClass(this.node,"main-ui-filter-field-with-additional-fields")}},{key:"addAdditionalField",value:function e(i){if(!this.hasAdditional()){n.Dom.addClass(this.node,"main-ui-filter-field-with-additional-fields");n.Dom.append(this.getAdditionalFieldContainer(),this.node)}var s=this.parent.getPreset();var a=this.prepareFieldOptions(i);var r=s.createControl(a);this.appendRenderedField(r);return t.instances.get(r)}},{key:"prepareListItems",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(n.Type.isPlainObject(t)){return Object.entries(t).map((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],s=t[1];return{NAME:s,VALUE:i}}))}return{}}},{key:"prepareFieldOptions",value:function e(t){var i=this;if(n.Type.isPlainObject(t)){var s=this.parent.params.FIELDS_STUBS;var a=t.type,r=a===void 0?"string":a;var l=s.find((function(e){return e.NAME===r}));if(n.Type.isPlainObject(l)){var o=A(A({},l),{},{NAME:t.id,LABEL:t.name,TYPE:r==="checkbox"?"SELECT":l.TYPE,VALUE_REQUIRED:t.valueRequired===true});if(r==="list"){return A(A({},o),{},{ITEMS:[].concat(babelHelpers.toConsumableArray(o.ITEMS),[this.prepareListItems(t.items)]),params:{isMulti:function(){if(n.Type.isPlainObject(t.params)){return t.params===true}return false}()}})}if(r==="date"){var u=function(){if(n.Type.isPlainObject(t.value)&&Reflect.has(t.value,"_datesel")){return t.value._datesel}return i.parent.dateTypes.NONE}();return A(A({},o),{},{SUB_TYPES:function(){if(n.Type.isArray(t.exclude)){return o.SUB_TYPES.filter((function(e){return!t.exclude.includes(e.VALUE)}))}return o.SUB_TYPES}(),SUB_TYPE:function(){return o.SUB_TYPES.find((function(e){return e.VALUE===u}))}(),VALUES:function(){if(n.Type.isPlainObject(t.value)){return A({},t.value)}return o.VALUES}()})}if(r==="string"||r==="custom_date"||r==="number"||r==="checkbox"||r==="custom_entity"){return o}}}return t}},{key:"appendRenderedField",value:function e(t){if(n.Type.isDomNode(t)){var i=this.getAdditionalFieldContainer();n.Dom.append(t,i)}}},{key:"getValue",value:function e(){var t=this.parent.getFilterFieldsValues();var i=this.options,s=i.TYPE,n=i.NAME;if(s==="DATE"||s==="NUMBER"){return Object.entries(t).reduce((function(e,t){var i=babelHelpers.slicedToArray(t,2),s=i[0],a=i[1];if(s.startsWith(n)){e[s.replace(n,"")]=a}return e}),{})}if(n in t){return t[n]}return""}},{key:"setValue",value:function e(t){var i=this;var s=this.options.TYPE;if(s==="DATE"||s==="NUMBER"){if(n.Type.isPlainObject(t)){var a=this.parent.getFieldListContainer();Object.entries(t).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),s=t[0],r=t[1];var l=a.querySelector('[data-name="'.concat(i.id,'"] [data-name="').concat(i.id).concat(s,'"], [data-name="').concat(i.id,'"] [name="').concat(i.id).concat(s,'"]'));if(l){if(n.Dom.hasClass(l,"main-ui-select")){var o=n.Dom.attr(l,"data-items");if(n.Type.isArray(o)){var u=o.find((function(e){return e.VALUE===r}));if(n.Type.isPlainObject(u)){n.Dom.attr(l,"data-value",u);var c=l.querySelector(".main-ui-select-name");if(c){c.innerText=u.NAME}var d=BX.Main.ui.Factory.get(l);if(!d){d={node:l,instance:new BX.Main.ui.select(l)};BX.Main.ui.Factory.data.push(d)}if(n.Type.isPlainObject(d)){BX.onCustomEvent(window,"UI::Select::Change",[d.instance,u])}}}}else if(l.tagName==="INPUT"){l.value=r}}}))}}}}]);return t}(n.Event.EventEmitter);babelHelpers.defineProperty(S,"instances",new WeakMap);var _=function(){function e(t){babelHelpers.classCallCheck(this,e);this.parent=t}babelHelpers.createClass(e,[{key:"setFields",value:function e(t){if(n.Type.isPlainObject(t)){this.parent.getPopup();var i=this.parent.getPreset();i.deactivateAllPresets();var s={preset_id:"tmp_filter",fields:t};this.parent.updateParams(s);i.applyPreset("tmp_filter")}}},{key:"setFilter",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;this.setAnalyticsLabel(i);if(n.Type.isObject(t)){this.parent.updateParams(t);this.parent.getPreset().deactivateAllPresets();this.parent.getPreset().activatePreset(t.preset_id);this.parent.getPreset().applyPreset(t.preset_id);if(!t.checkFields||!this.parent.getPreset().isPresetValuesModified(t.preset_id)){var s=true;this.parent.applyFilter(false,t.preset_id,s)}else{var a={};if(n.Type.isPlainObject(t.fields)){a=Object.assign({},t.fields)}if(n.Type.isPlainObject(t.additional)){a=Object.assign({},t.additional)}this.parent.getPreset().deactivateAllPresets();this.setFields(a);this.apply()}}}},{key:"extendFilter",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;this.setAnalyticsLabel(s);if(n.Type.isObject(t)){Object.keys(t).forEach((function(e){if(n.Type.isNumber(t[e])){t[e]=String(t[e])}}));var a=this.parent.getPreset().getCurrentPresetId();if(i||a==="tmp_filter"||a==="default_filter"){var r=Object.assign({},this.parent.getFilterFieldsValues(),t);this.setFields(r);this.apply();return}var l=this.parent.getPreset().getAdditionalValues(a);if(n.Type.isPlainObject(l)&&Object.keys(l).length){t=Object.assign({},l,t)}this.setFilter({preset_id:a,additional:t,checkFields:true})}}},{key:"apply",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.setAnalyticsLabel(t);if(!this.parent.isEditEnabled()){if(!this.parent.isEditEnabled()){var i=false;var s=false;var n=true;this.parent.applyFilter(i,s,n)}this.parent.closePopup();if(this.parent.isAddPresetEnabled()){this.parent.disableAddPreset()}}}},{key:"getEmitter",value:function e(){return this.parent.emitter}},{key:"setAnalyticsLabel",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(n.Type.isObject(t)){this.parent.analyticsLabel=t}}}]);return e}();function L(e){return{block:"main-ui-control-field",type:e.type,dragButton:false,content:{block:"main-ui-date",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:e.placeholder,name:e.name,tabindex:e.tabindex,value:e.value,enableTime:e.enableTime}}}function b(e){return{block:"main-ui-control-field",type:e.type,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],valueDelete:true,placeholder:e.placeholder,name:e.name,tabindex:e.tabindex,value:e.value}}}function I(){return{block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}}}function T(e){return{block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:e.tabindex,value:e.value,items:e.items,name:e.name,valueDelete:false}}}var F,D;function X(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function C(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?X(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):X(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var N=function(e){babelHelpers.inherits(t,e);babelHelpers.createClass(t,null,[{key:"getInstance",value:function e(){return t.cache.remember("instance",(function(){return new t}))}},{key:"fetchAdditionalFilter",value:function e(i,s){if(n.Type.isStringFilled(i)&&n.Type.isPlainObject(s)){if("".concat(i,"_").concat(t.Type.IS_EMPTY)in s){return t.Type.IS_EMPTY}if("".concat(i,"_").concat(t.Type.HAS_ANY_VALUE)in s){return t.Type.HAS_ANY_VALUE}}return null}}]);function t(){var e;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"cache",new n.Cache.MemoryCache);e.setEventNamespace("BX.Main.Filter.AdditionalFilter");e.options=C({},i);n.Event.bind(document,"click",e.onDocumentClick.bind(babelHelpers.assertThisInitialized(e)));return e}babelHelpers.createClass(t,[{key:"getAdditionalFilterMenu",value:function e(){var i=this;return this.cache.remember("menu",(function(){return new s.Menu({id:"additional_filter_menu",autoHide:false,items:[{id:"isEmpty",text:n.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_MENU_IS_EMPTY"),onclick:i.onAdditionalFilterMenuItemClick.bind(i,t.Type.IS_EMPTY)},{id:"hasAnyValue",text:n.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_MENU_HAS_ANY_VALUE"),onclick:i.onAdditionalFilterMenuItemClick.bind(i,t.Type.HAS_ANY_VALUE)},{id:"delimiter",delimiter:true},{id:"helper",html:n.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_PLACEHOLDER_HOW")+'<span class="ui-hint"><span class="ui-hint-icon"></span></span>',onclick:function e(){if(top.BX.Helper){top.BX.Helper.show("redirect=detail&code=14006190");event.preventDefault()}}}]})}))}},{key:"onAdditionalFilterMenuItemClick",value:function e(t){var i=this.getCurrentFieldNode();this.initAdditionalFilter(i,t)}},{key:"onDocumentClick",value:function e(){this.getAdditionalFilterMenu().close()}},{key:"setCurrentFieldId",value:function e(t){this.cache.set("currentFieldId",t)}},{key:"getCurrentFieldId",value:function e(){return this.cache.get("currentFieldId","")}},{key:"setCurrentFieldNode",value:function e(t){this.cache.set("currentFieldNode",t)}},{key:"getCurrentFieldNode",value:function e(){return this.cache.get("currentFieldNode")}},{key:"onAdditionalFilterButtonClick",value:function e(t,i){i.stopPropagation();var s=i.currentTarget;this.setCurrentFieldId(t);this.setCurrentFieldNode(s.parentElement);var a=this.getAdditionalFilterMenu();var r=String(n.Dom.attr(s,"data-allowed-types")).split(",");a.getMenuItems().forEach((function(e){var t=e.getId();if(r.includes(t)||t==="helper"||t==="delimiter"){n.Dom.removeClass(e.layout.item,"main-ui-disable")}else{n.Dom.addClass(e.layout.item,"main-ui-disable")}}));if(a.getPopupWindow().isShown()){if(a.getPopupWindow().bindElement!==s){a.getPopupWindow().setBindElement(s);a.getPopupWindow().adjustPosition()}else{a.close()}}else{a.getPopupWindow().setBindElement(s);a.show()}}},{key:"getAdditionalFilterButton",value:function e(i){var s=this;var a=i.fieldId,r=i.enabled;return this.cache.remember("field_".concat(a),(function(){var e=!n.Type.isArrayFilled(r)&&r!==true;var i=function(){if(n.Type.isArrayFilled(r)){return r.join(",")}if(!e){return[t.Type.IS_EMPTY,t.Type.HAS_ANY_VALUE].join(",")}return""}();return n.Tag.render(F||(F=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span \n\t\t\t\t\tclass="ui-icon ui-icon-service-light-other main-ui-filter-additional-filters-button','"\n\t\t\t\t\tonclick="','"\n\t\t\t\t\tdata-allowed-types="','"\n\t\t\t\t>\n\t\t\t\t\t<i></i>\n\t\t\t\t</span>\n\t\t\t'])),e?" main-ui-disable":"",s.onAdditionalFilterButtonClick.bind(s,a),i)}))}},{key:"initAdditionalFilter",value:function e(t,i){var s=this.getCurrentFieldId();if(s===""){s=t.attributes[1].value}var a=this.getAdditionalFilterPlaceholderField(s,i);n.Dom.addClass(t,"main-ui-filter-field-with-additional-filter");var r=t.querySelector(".main-ui-filter-additional-filter-placeholder");if(r){n.Dom.replace(r,a)}else{n.Dom.append(a,t)}}},{key:"restoreField",value:function e(t){if(n.Type.isDomNode(t)){var i=t.querySelector(".main-ui-filter-additional-filter-placeholder");if(i){n.Dom.remove(i)}n.Dom.removeClass(t,"main-ui-filter-field-with-additional-filter")}}},{key:"getAdditionalFilterPlaceholderField",value:function e(i,s){var a=this;return this.cache.remember("placeholder_".concat(i,"_").concat(s),(function(){var e=function(){if(s===t.Type.HAS_ANY_VALUE){return n.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_PLACEHOLDER_HAS_ANY_VALUE")}return n.Loc.getMessage("MAIN_UI_FILTER__ADDITIONAL_FILTER_PLACEHOLDER_IS_EMPTY")}();var i=function e(t){a.restoreField(t.currentTarget.closest(".main-ui-filter-field-with-additional-filter"))};return n.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="main-ui-control main-ui-filter-additional-filter-placeholder" data-type="','">\n\t\t\t\t\t<div class="main-ui-square">\n\t\t\t\t\t\t<div class="main-ui-square-item">','</div>\n\t\t\t\t\t\t<div class="main-ui-item-icon main-ui-square-delete" onclick="','"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t'])),s,e,i)}))}},{key:"getFilter",value:function e(t){if(n.Type.isDomNode(t)){var i=t.querySelector(".main-ui-filter-additional-filter-placeholder");if(n.Type.isDomNode(i)){var s=n.Dom.attr(i,"data-type");var a=n.Dom.attr(t,"data-name");return babelHelpers.defineProperty({},"".concat(a,"_").concat(s),"y")}}return null}}]);return t}(i.EventEmitter);babelHelpers.defineProperty(N,"Type",{IS_EMPTY:"isEmpty",HAS_ANY_VALUE:"hasAnyValue"});babelHelpers.defineProperty(N,"cache",new n.Cache.MemoryCache);var U;function O(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function R(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?O(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):O(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var k=new WeakMap;var M=new WeakMap;var V=new WeakMap;var w=function(){function e(t){babelHelpers.classCallCheck(this,e);this.parent=null;this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.parent=t;BX.addCustomEvent(window,"UI::Select::change",this._onDateTypeChange.bind(this))}},{key:"deleteField",value:function e(t){n.Dom.remove(t)}},{key:"isFieldDelete",value:function e(t){return n.Dom.hasClass(t,this.parent.settings.classFieldDelete)}},{key:"isFieldValueDelete",value:function e(t){return n.Dom.hasClass(t,this.parent.settings.classValueDelete)||n.Dom.hasClass(t.parentNode,this.parent.settings.classValueDelete)}},{key:"isDragButton",value:function e(t){return t&&n.Dom.hasClass(t,this.parent.settings.classPresetDragButton)}},{key:"clearFieldValue",value:function e(t){if(t){var i=babelHelpers.toConsumableArray(t.querySelectorAll(".main-ui-control"));var s=babelHelpers.toConsumableArray(t.querySelectorAll(".main-ui-square"));s.forEach((function(e){return n.Dom.remove(e)}));i.forEach((function(e){if(Reflect.has(e,"value")){e.value=""}}))}}},{key:"getField",value:function e(t){if(n.Type.isDomNode(t)){return t.closest(".main-ui-control-field, .main-ui-control-field-group")}return null}},{key:"render",value:function e(t,i){if(n.Type.isString(t)&&n.Type.isPlainObject(i)){var s=Object.entries(i).reduce((function(e,t){var i=babelHelpers.slicedToArray(t,2),s=i[0],n=i[1];return e.replace(new RegExp("{{".concat(s,"}}"),"g"),n)}),t);var a=n.Dom.create("div",{html:s});var r=a.querySelector(".main-ui-control-field-group");if(r){return r}var l=a.querySelector(".main-ui-control-field");if(l){return l}var o=a.querySelector(".main-ui-filter-field-line");if(o){return o}}return null}},{key:"createInputText",value:function e(t){var i={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",icon:this.parent.getParam("ENABLE_LABEL")&&t.ICON?t.ICON:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:[{block:"main-ui-control-string",name:t.NAME,placeholder:t.PLACEHOLDER||"",value:n.Type.isString(t.VALUE)||n.Type.isNumber(t.VALUE)?t.VALUE:"",tabindex:t.TABINDEX}]};var s=BX.decl(i);this.parent.getEmitter().emit("init",{field:new S({parent:this.parent,options:R({},t),node:s})});return s}},{key:"createTextarea",value:function e(t){var i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",icon:this.parent.getParam("ENABLE_LABEL")&&t.ICON?t.ICON:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:[{block:"main-ui-control-textarea",name:t.NAME,placeholder:t.PLACEHOLDER||"",value:n.Type.isString(t.VALUE)||n.Type.isNumber(t.VALUE)?t.VALUE:"",tabindex:t.TABINDEX}]});var s=i.querySelector("textarea");var a=function e(){n.Dom.style(s,"height","1px");n.Dom.style(s,"height","".concat(s.scrollHeight,"px"))};n.Event.bind(s,"input",a);n.Event.bind(s,"change",a);n.Event.bind(s,"keyup",a);n.Event.bind(s,"cut",a);n.Event.bind(s,"paste",a);this.parent.getEmitter().emit("init",{field:new S({parent:this.parent,options:R({},t),node:i})});return i}},{key:"createCustomEntityFieldLayout",value:function e(t){var i={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",icon:this.parent.getParam("ENABLE_LABEL")&&t.ICON?t.ICON:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-control-entity",mix:"main-ui-control",attrs:{"data-multiple":JSON.stringify(t.MULTIPLE)},content:[]}};if("_label"in t.VALUES&&!!t.VALUES._label){if(t.MULTIPLE){var s=t.VALUES._label?t.VALUES._label:[];if(n.Type.isPlainObject(s)){s=Object.keys(s).map((function(e){return s[e]}))}if(!n.Type.isArray(s)){s=[s]}var a=t.VALUES._value?t.VALUES._value:[];if(n.Type.isPlainObject(a)){a=Object.keys(a).map((function(e){return a[e]}))}if(!n.Type.isArray(a)){a=[a]}s.forEach((function(e,t){i.content.content.push({block:"main-ui-square",tag:"span",name:e,item:{_label:e,_value:a[t]}})}))}else{i.content.content.push({block:"main-ui-square",tag:"span",name:"_label"in t.VALUES?t.VALUES._label:"",item:t.VALUES})}}i.content.content.push({block:"main-ui-square-search",tag:"span",content:{block:"main-ui-control-string",name:"".concat(t.NAME,"_label"),tabindex:t.TABINDEX,type:"text",placeholder:t.PLACEHOLDER||""}},{block:"main-ui-control-string",name:t.NAME,type:"hidden",placeholder:t.PLACEHOLDER||"",value:"_value"in t.VALUES?t.VALUES._value:"",tabindex:t.TABINDEX});i=BX.decl(i);var r=BX.Filter.Utils.getBySelector(i,'.main-ui-control-string[type="text"]');BX.addClass(r,"main-ui-square-search-item");r.autocomplete="off";n.Event.bind(r,"focus",BX.proxy(this._onCustomEntityInputFocus,this));n.Event.bind(r,"click",BX.proxy(this._onCustomEntityInputClick,this));if(!this.bindDocument){n.Event.bind(document,"click",BX.proxy(this._onCustomEntityBlur,this));document.addEventListener("focus",BX.proxy(this._onDocumentFocus,this),true);this.bindDocument=true}n.Event.bind(r,"keydown",BX.proxy(this._onCustomEntityKeydown,this));n.Event.bind(i,"click",BX.proxy(this._onCustomEntityFieldClick,this));return i}},{key:"createDestSelector",value:function e(t){var i=this.createCustomEntityFieldLayout(t);BX.ready(BX.proxy((function(){BX.Filter.DestinationSelector.create(t.NAME,{filterId:this.parent.getParam("FILTER_ID"),fieldId:t.NAME})}),this));this.parent.getEmitter().emit("init",{field:new S({parent:this.parent,options:R({},t),node:i})});return i}},{key:"createEntitySelector",value:function e(t){var i=this.createCustomEntityFieldLayout(t);BX.Filter.EntitySelector.create(t.NAME,{filter:this.parent,isMultiple:t.MULTIPLE,addEntityIdToResult:t.ADD_ENTITY_ID_TO_RESULT,showDialogOnEmptyInput:t.SHOW_DIALOG_ON_EMPTY_INPUT,dialogOptions:t.DIALOG_OPTIONS});this.parent.getEmitter().emit("init",{field:new S({parent:this.parent,options:R({},t),node:i})});return i}},{key:"createCustomEntity",value:function e(t){var i=this.createCustomEntityFieldLayout(t);this.parent.getEmitter().emit("init",{field:new S({parent:this.parent,options:R({},t),node:i})});return i}},{key:"_onCustomEntityInputFocus",value:function e(t){BX.fireEvent(t.currentTarget,"click")}},{key:"_onCustomEntityInputClick",value:function e(t){t.preventDefault();t.stopPropagation();if(t.isTrusted){this.trustTimestamp=t.timeStamp;this.notTrustTimestamp=this.notTrustTimestamp||t.timeStamp}else{this.notTrustTimestamp=t.timeStamp}var i=new Date(this.trustTimestamp);var s=new Date(this.notTrustTimestamp);var n="".concat(i.getMinutes(),":").concat(i.getSeconds());var a="".concat(s.getMinutes(),":").concat(s.getSeconds());if(n!==a){this._onCustomEntityFocus(t)}}},{key:"_onDocumentFocus",value:function e(t){var i=this.getCustomEntityInstance();var s=i.getPopupContainer();var n=i.getLabelNode()===t.target;var a=!!s&&s.contains(t.target);if(!n&&!a){this._onCustomEntityBlur(t)}}},{key:"_onCustomEntityKeydown",value:function e(t){var i=t.target,s=t.currentTarget;var a=i.parentNode.parentNode;var r=a.querySelectorAll(".main-ui-square");var l=r[r.length-1];if(!n.Type.isDomNode(l)){return}if(BX.Filter.Utils.isKey(t,"backspace")&&s.selectionStart===0){if(n.Dom.hasClass(l,"main-ui-square-selected")){var o=a.querySelector('input[type="hidden"]');if(n.Type.isDomNode(o)){o.value="";BX.fireEvent(o,"input")}n.Dom.remove(l);return}n.Dom.addClass(l,"main-ui-square-selected");return}n.Dom.removeClass(l,"main-ui-square-selected")}},{key:"_onCustomEntityFieldClick",value:function e(t){var i=t.target;if(n.Dom.hasClass(i,"main-ui-square-delete")){var s=i.closest(".main-ui-square");if(n.Type.isDomNode(s)){var a=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityRemove",[a]);n.Dom.remove(s)}return}var r=i.querySelector('input[type="text"]');if(n.Type.isDomNode(r)){BX.fireEvent(r,"focus")}}},{key:"_onCustomEntityBlur",value:function e(t){var i={stopBlur:false};BX.onCustomEvent(window,"BX.Main.Filter:onGetStopBlur",[t,i]);if(typeof i.stopBlur==="undefined"||!i.stopBlur){var s=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityBlur",[s]);n.Event.unbind(s.getPopupContainer(),"click",this._stopPropagation);n.Dom.removeClass(s.getField(),"main-ui-focus")}}},{key:"_stopPropagation",value:function e(t){t.stopPropagation()}},{key:"getCustomEntityInstance",value:function e(){if(!(this.customEntityInstance instanceof BX.Main.ui.CustomEntity)){this.customEntityInstance=new BX.Main.ui.CustomEntity}return this.customEntityInstance}},{key:"_onCustomEntityFocus",value:function e(t){t.stopPropagation();var i=t.currentTarget;var s=i.closest(".main-ui-control-entity");var a=this.getCustomEntityInstance();a.setField(s);BX.onCustomEvent("BX.Main.Filter:customEntityFocus",[a]);var r=a.getPopupContainer();if(n.Type.isElementNode(r)){n.Event.bind(r,"click",this._stopPropagation)}n.Dom.addClass(s,"main-ui-focus")}},{key:"createCustom",value:function e(t){var i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",icon:this.parent.getParam("ENABLE_LABEL")&&t.ICON?t.ICON:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-custom",mix:["main-ui-control","main-ui-custom-style"],attrs:{"data-name":t.NAME},content:""}});if(n.Type.isString(t.VALUE)){var s=function(){if(Reflect.has(t,"_VALUE")){return t._VALUE}return""}();var a=n.Text.decode(t.VALUE).replace('name="'.concat(t.NAME,'"'),'name="'.concat(t.NAME,'" value="').concat(s,'"'));var r=i.querySelector(".main-ui-custom");n.Runtime.html(r,a)}this.parent.getEmitter().emit("init",{field:new S({parent:this.parent,options:R({},t),node:i})});return i}},{key:"createSelect",value:function e(t){var i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",icon:this.parent.getParam("ENABLE_LABEL")&&t.ICON?t.ICON:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:this.parent.settings.classSelect,name:t.NAME,items:t.ITEMS,value:"VALUE"in t?t.VALUE:t.ITEMS[0],params:t.PARAMS,tabindex:t.TABINDEX,valueDelete:false}});this.parent.getEmitter().emit("init",{field:new S({parent:this.parent,options:R({},t),node:i})});return i}},{key:"createMultiSelect",value:function e(t){var i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",icon:this.parent.getParam("ENABLE_LABEL")&&t.ICON?t.ICON:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-multi-select",name:t.NAME,tabindex:"TABINDEX"in t?t.TABINDEX:"",placeholder:!this.parent.getParam("ENABLE_LABEL")&&"PLACEHOLDER"in t?t.PLACEHOLDER:"",items:"ITEMS"in t?t.ITEMS:[],value:"VALUE"in t?t.VALUE:[],params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true}});this.parent.getEmitter().emit("init",{field:new S({parent:this.parent,options:R({},t),node:i})});return i}},{key:"createCustomDate",value:function e(t){var i={block:"main-ui-control-field-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-date-group"]:["main-ui-filter-date-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",icon:this.parent.getParam("ENABLE_LABEL")&&t.ICON?t.ICON:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",name:"NAME"in t?t.NAME:"",deleteButton:true,content:[]};if(n.Type.isPlainObject(t.VALUE.days)){t.VALUE.days=Object.keys(t.VALUE.days).map((function(e){return t.VALUE.days[e]}))}var s=t.DAYS.filter((function(e){return t.VALUE.days.some((function(t){return t===e.VALUE}))}));var a={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],placeholder:t.DAYS_PLACEHOLDER,dragButton:false,content:{block:"main-ui-multi-select",name:"".concat(t.NAME,"_days"),tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.DAYS,value:s,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.DAYS_PLACEHOLDER}}};if(n.Type.isPlainObject(t.VALUE.months)){t.VALUE.months=Object.keys(t.VALUE.months).map((function(e){return t.VALUE.months[e]}))}var r=t.MONTHS.filter((function(e){return t.VALUE.months.some((function(t){return t===e.VALUE}))}));var l={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],dragButton:false,content:{block:"main-ui-multi-select",name:"".concat(t.NAME,"_months"),tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.MONTHS,value:r,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.MONTHS_PLACEHOLDER}}};if(n.Type.isPlainObject(t.VALUE.years)){t.VALUE.years=Object.keys(t.VALUE.years).map((function(e){return t.VALUE.years[e]}))}var o=t.YEARS.filter((function(e){return t.VALUE.years.some((function(t){return t===e.VALUE}))}));var u={block:"main-ui-control-field",mix:["main-ui-control-custom-date"],dragButton:false,content:{block:"main-ui-multi-select",name:"".concat(t.NAME,"_years"),tabindex:"TABINDEX"in t?t.TABINDEX:"",items:t.YEARS,value:o,params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true,attrs:{"data-placeholder":t.YEARS_PLACEHOLDER}}};i.content.push(a);i.content.push(l);i.content.push(u);var c=BX.decl(i);this.parent.getEmitter().emit("init",{field:new S({parent:this.parent,options:R({},t),node:c})});return c}},{key:"_onDateTypeChange",value:function e(t,i){var s=this;if(this.parent.getPopup().contentContainer.contains(t.node)){var a={};var r=null;var l;var o;var u;if(n.Type.isPlainObject(i)&&Reflect.has(i,"VALUE")){var c=t.getNode();var d=t.getParams();var h=c.dataset.name;if(!n.Type.isPlainObject(d)&&(h.endsWith("_datesel")||h.endsWith("_numsel"))){var p=c.parentNode.parentNode;a.TABINDEX=t.getInput().getAttribute("tabindex");a.SUB_TYPES=t.getItems();a.SUB_TYPE=i;a.NAME=p.dataset.name;a.TYPE=p.dataset.type;a.VALUE_REQUIRED=p.dataset.valueRequired==="true";var f=this.parent.getPreset().getCurrentPresetData();if(n.Type.isArray(f.FIELDS)){var m=f.FIELDS.find((function(e){return e.NAME===a.NAME}));if(n.Type.isNil(m)){m=this.parent.params.FIELDS_STUBS.find((function(e){return e.TYPE===a.TYPE}))}if(!n.Type.isNil(m)){if(h.endsWith("_datesel")){a.MONTHS=m.MONTHS;a.MONTH=m.MONTH;a.YEARS=m.YEARS;a.YEAR=m.YEAR;a.QUARTERS=m.QUARTERS;a.QUARTER=m.QUARTER;a.ENABLE_TIME=m.ENABLE_TIME;a.YEARS_SWITCHER=m.YEARS_SWITCHER}a.VALUES=m.VALUES;a.REQUIRED=m.REQUIRED}}if(this.parent.getParam("ENABLE_LABEL")){l=p.querySelector(".main-ui-control-field-label");a.LABEL=l.innerText}if(h.endsWith("_datesel")){r=this.createDate(a)}else{r=this.createNumber(a)}if(n.Type.isArray(this.parent.fieldsList)){u=this.parent.fieldsList.indexOf(p);if(u!==-1){this.parent.fieldsList[u]=r;this.parent.registerDragItem(r)}}this.parent.unregisterDragItem(p);o=babelHelpers.toConsumableArray(r.querySelectorAll(".main-ui-control-field"));if(n.Type.isArray(o)&&o.length){o.forEach((function(e){e.FieldController=new BX.Filter.FieldController(e,s.parent)}))}if(this.parent.getParam("ENABLE_ADDITIONAL_FILTERS")){var E=N.getInstance().getAdditionalFilterButton({fieldId:a.NAME,enabled:a.ADDITIONAL_FILTER_ALLOWED});n.Dom.append(E,r)}n.Dom.insertAfter(r,p);n.Dom.remove(p)}}}}},{key:"createNumber",value:function e(t){var i=this.parent,s=i.numberTypes,n=i.additionalNumberTypes;var a=this.parent.params.ENABLE_LABEL;var r=t.SUB_TYPE,l=r===void 0?{}:r,o=t.SUB_TYPES,u=o===void 0?[]:o,c=t.TABINDEX,d=c===void 0?"":c,h=t.VALUES,p=h===void 0?{_from:"",_to:""}:h,f=t.LABEL,m=f===void 0?"":f,E=t.ICON,g=E===void 0?null:E,y=t.TYPE;var v=l.VALUE||s.SINGLE;var B=l.PLACEHOLDER||"";var A=t.NAME.replace("_numsel","");var P=function(){if(a){return["main-ui-filter-wield-with-label","main-ui-filter-number-group"]}return["main-ui-filter-number-group"]}();var _={block:"number-group",type:y,mix:P,label:a?m:"",icon:a?g:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:d,value:l,items:u,name:A,deleteButton:true,content:[]};if(v!==s.LESS&&v!==n.BEFORE_N){var L={block:"main-ui-control-field",type:y,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:B,name:"".concat(A,"_from"),tabindex:d,value:p._from||""}};_.content.push(L)}if(v===s.RANGE){var b={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};_.content.push(b)}if(v===s.RANGE||v===s.LESS||v===n.BEFORE_N){var I={block:"main-ui-control-field",type:y,dragButton:false,content:{block:"main-ui-number",calendarButton:true,valueDelete:true,name:"".concat(A,"_to"),tabindex:d,value:p._to||""}};_.content.push(I)}var T=BX.decl(_);this.parent.getEmitter().emit("init",{field:new S({parent:this.parent,options:R({},t),node:T})});return T}},{key:"createDate",value:function e(t){var i=this;var s=this.parent,a=s.dateTypes,r=s.additionalDateTypes;var l=t.SUB_TYPE,o=l===void 0?{}:l,u=t.SUB_TYPES,c=u===void 0?[]:u,d=t.PLACEHOLDER,h=d===void 0?"":d,p=t.VALUES,f=p===void 0?{_from:"",_to:"",_quarter:"",_days:"",_month:"",_year:"",_allow_year:""}:p,m=t.TABINDEX,E=m===void 0?"":m,g=t.ENABLE_TIME,y=g===void 0?false:g,v=t.LABEL,B=v===void 0?"":v,A=t.ICON,P=A===void 0?null:A,_=t.TYPE,F=t.VALUE_REQUIRED,D=F===void 0?false:F,X=t.REQUIRED,C=X===void 0?false:X;var N=this.parent.params.ENABLE_LABEL;var U=o.VALUE||a.NONE;var O=t.NAME.replace("_datesel","");var k=function(){if(N){return["main-ui-filter-wield-with-label","main-ui-filter-date-group"]}return["main-ui-filter-date-group"]}();var M={block:"date-group",type:_,mix:k,label:N?B:"",icon:N?P:null,dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:E,value:o,items:c,name:O,enableTime:y,deleteButton:true,content:[]};if(U===a.EXACT){var V=L({type:_,name:"".concat(O.NAME,"_from"),placeholder:h,tabindex:E,value:f._from||"",enableTime:y});M.content.push(V)}if(U===a.NEXT_DAYS||U===a.PREV_DAYS||U===r.PREV_DAY||U===r.NEXT_DAY||U===r.MORE_THAN_DAYS_AGO||U===r.AFTER_DAYS){var w=b({type:_,name:"".concat(O,"_days"),tabindex:E,value:f._days||"",placeholder:h});M.content.push(w)}if(U===a.RANGE){var x={block:"main-ui-filter-range-group",content:[L({type:_,name:"".concat(O,"_from"),placeholder:h,tabindex:E,value:f._from||"",enableTime:y}),I(),L({type:_,name:"".concat(O,"_to"),placeholder:h,tabindex:E,value:f._to||"",enableTime:y})]};M.content.push(x)}if(U===a.MONTH){var j=t.MONTHS,q=t.MONTH,Y=t.YEARS,H=t.YEAR;var W=j.find((function(e){return e.VALUE===f._month}))||q||j[0];var G=Y.find((function(e){return e.VALUE===f._year}))||H||Y[0];M.content.push(T({name:"".concat(O,"_month"),value:W,items:j,tabindex:E}),T({name:"".concat(O,"_year"),value:G,items:Y,tabindex:E}))}if(U===a.QUARTER){var Q=t.YEARS,K=t.YEAR,J=t.QUARTERS,z=t.QUARTER,Z=t.PARAMS;var $=Q.find((function(e){return e.VALUE===f._year}))||K||Q[0];var ee=J.find((function(e){return e.VALUE===f._quarter}))||z||J[0];M.content.push(T({name:"".concat(O,"_year"),value:$,items:Q,tabindex:E}),T({name:"".concat(O,"_quarter"),value:ee,items:J,tabindex:E,params:Z}))}if(U===a.YEAR){var te=t.YEARS,ie=t.YEAR;var se=te.find((function(e){return e.VALUE===f._year}))||ie||te[0];M.content.push(T({name:"".concat(O,"_year"),value:se,items:te,tabindex:E}))}if(U==="CUSTOM_DATE"){var ne=c.find((function(e){return e.VALUE==="CUSTOM_DATE"}));if(ne){var ae=n.Runtime.clone(ne.DECL);if(n.Type.isArray(f._days)){ae.VALUE.days=f._days}if(n.Type.isArray(f._month)){ae.VALUE.months=f._month}if(n.Type.isArray(f._year)){ae.VALUE.years=f._year}var re=this.createCustomDate(ae);n.Dom.removeClass(re,"main-ui-filter-wield-with-label");var le=babelHelpers.toConsumableArray(re.querySelectorAll(".main-ui-item-icon-container, .main-ui-filter-icon-grab"));le.forEach((function(e){return n.Dom.remove(e)}));M.content.push(re);M.mix.push("main-ui-filter-custom-date-group")}}if(U!==a.NONE&&U!==r.CUSTOM_DATE&&t.YEARS_SWITCHER){var oe=n.Runtime.clone(t.YEARS_SWITCHER);var ue=oe.ITEMS;oe.VALUE=ue.reduce((function(e,t){return t.VALUE===f._allow_year?t:e}));var ce=this.createSelect(oe);n.Dom.addClass(ce,["main-ui-filter-year-switcher","main-ui-filter-with-padding"]);n.Dom.removeClass(ce,"main-ui-filter-wield-with-label");var de=babelHelpers.toConsumableArray(ce.querySelectorAll(".main-ui-item-icon-container, .main-ui-filter-icon-grab"));de.forEach((function(e){return n.Dom.remove(e)}));var he=M.content.length-1;var pe=M.content[he];if(n.Type.isPlainObject(pe)){if(!n.Type.isArray(pe.mix)){pe.mix=[]}pe.mix.push("main-ui-filter-remove-margin-right")}if(n.Type.isDomNode(pe)){n.Dom.addClass(pe,"main-ui-filter-remove-margin-right")}requestAnimationFrame((function(){n.Dom.addClass(ce.previousElementSibling,"main-ui-filter-remove-margin-right")}));M.content.push(ce);M.mix.push("main-ui-filter-date-with-years-switcher")}var fe=BX.decl(M);var me=n.Runtime.debounce(this.onDateChange,500,this);var Ee=babelHelpers.toConsumableArray(fe.querySelectorAll(".main-ui-date-input"));Ee.forEach((function(e){e.addEventListener("change",me);e.addEventListener("input",me);var t=e.parentNode;var s=t.querySelector(".main-ui-control-value-delete");if(s){s.addEventListener("click",(function(){setTimeout((function(){i.onDateChange({target:e})}))}))}}));if(D){fe.dataset.valueRequired=true;var ge=[].concat(babelHelpers.toConsumableArray(Ee),babelHelpers.toConsumableArray(fe.querySelectorAll(".main-ui-number-input")));ge.forEach((function(e){e.addEventListener("change",i.checkRequiredDateValue.bind(i));e.addEventListener("input",i.checkRequiredDateValue.bind(i));var t=e.parentNode;var s=t.querySelector(".main-ui-control-value-delete");if(s){s.addEventListener("click",(function(){setTimeout((function(){i.checkRequiredDateValue({target:e})}))}))}n.Event.bindOnce(e,"mouseout",(function(){i.checkRequiredDateValue({target:e})}))}))}if(C){var ye=fe.querySelector(".main-ui-filter-field-delete");if(ye){BX.remove(ye)}}var ve={};this.parent.prepareControlDateValue(ve,O,fe);Object.entries(ve).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],s=t[1];ve[i.replace(O,"")]=s;delete ve[i]}));this.parent.getEmitter().emit("init",{field:new S({parent:this.parent,options:R(R({},t),{},{VALUES:ve}),node:fe})});return fe}},{key:"checkRequiredDateValue",value:function e(t){if(t.target.value===""){this.showError({id:"valueError",target:t.target,text:this.parent.params.MAIN_UI_FILTER__VALUE_REQUIRED});return}this.hideError({id:"valueError",target:t.target})}},{key:"onDateChange",value:function e(t){var i=this;if(V.get(t.target)===t.target.value){return}V.set(t.target,t.target.value);if(t.target.value===""){this.hideError({id:"formatError",target:t.target});return}BX.ajax.runComponentAction("bitrix:main.ui.filter","checkDateFormat",{mode:"ajax",data:{value:t.target.value,format:BX.message("FORMAT_DATETIME")}}).then((function(e){if(!e.data.result){i.showError({id:"formatError",target:t.target});return}i.hideError({id:"formatError",target:t.target})}))}},{key:"showError",value:function e(t){var i=t.id,s=t.target,a=t.text,r=a===void 0?null:a;n.Dom.style(s,"border-color","#FF5752");if(k.has(s)&&M.get(s)===i){n.Dom.remove(k.get(s))}var l=this.parent.params,o=l.MAIN_UI_FILTER__DATE_ERROR_TITLE,u=l.MAIN_UI_FILTER__DATE_ERROR_LABEL;var c=r||"".concat(u," ").concat(n.Loc.getMessage("FORMAT_DATE"));var d=n.Tag.render(U||(U=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div \n\t\t\t\tclass="main-ui-filter-error-message" \n\t\t\t\ttitle="','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),o,c);k.set(s,d);M.set(s,i);n.Dom.insertAfter(d,s);n.Dom.attr(s,"is-valid","false")}},{key:"hideError",value:function e(t){var i=t.id,s=t.target;n.Dom.style(s,"border-color",null);if(k.has(s)&&M.get(s)===i){n.Dom.remove(k.get(s))}n.Dom.attr(s,"is-valid","true")}}]);return e}();var x=function(){function e(t){babelHelpers.classCallCheck(this,e);this.parent=null;this.presets=null;this.container=null;this.init(t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.parent=t}},{key:"bindOnPresetClick",value:function e(){var t=this;(this.getPresets()||[]).forEach((function(e){n.Event.bind(e,"click",BX.delegate(t._onPresetClick,t))}))}},{key:"getAddPresetField",value:function e(){return this.getContainer().querySelector(".main-ui-filter-new-filter")}},{key:"getAddPresetFieldInput",value:function e(){return this.getAddPresetField().querySelector(".main-ui-filter-sidebar-edit-control")}},{key:"clearAddPresetFieldInput",value:function e(){var t=this.getAddPresetFieldInput();if(n.Type.isDomNode(t)){t.value=""}}},{key:"normalizePreset",value:function e(t){return t.closest(".main-ui-filter-sidebar-item")}},{key:"deactivateAllPresets",value:function e(){this.getPresets().forEach((function(e){n.Dom.removeClass(e,"main-ui-filter-current-item")}))}},{key:"createSidebarItem",value:function e(t,i,s){return BX.decl({block:"sidebar-item",text:n.Text.decode(i),id:t,pinned:s,noEditPinTitle:this.parent.getParam("MAIN_UI_FILTER__IS_SET_AS_DEFAULT_PRESET"),editNameTitle:this.parent.getParam("MAIN_UI_FILTER__EDIT_PRESET_TITLE"),removeTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_PRESET"),editPinTitle:this.parent.getParam("MAIN_UI_FILTER__SET_AS_DEFAULT_PRESET"),dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_TITLE")})}},{key:"activatePreset",value:function e(t){var i=this;this.deactivateAllPresets();var s=function(){if(n.Type.isString(t)){return i.getPresetNodeById(t)}return t}();if(n.Type.isDomNode(s)){n.Dom.addClass(s,"main-ui-filter-current-item")}}},{key:"getPresetNodeById",value:function e(t){return this.getPresets().find((function(e){return n.Dom.attr(e,"data-id")===t}))}},{key:"getPresetId",value:function e(t){return n.Dom.attr(t,"data-id")}},{key:"updatePresetName",value:function e(t,i){if(n.Type.isDomNode(t)&&n.Type.isString(i)&&i!==""){var s=this.getPresetNameNode(t);if(n.Type.isDomNode(s)){n.Runtime.html(s,i)}}}},{key:"removePreset",value:function e(t,i,s){var n=this.getCurrentPresetId();var a=[];var r={preset_id:i,is_default:s};var l={FILTER_ID:this.parent.getParam("FILTER_ID"),action:"REMOVE_FILTER"};this.parent.saveOptions(r,l);BX.remove(t);if(BX.type.isArray(this.parent.params.PRESETS)){a=this.parent.params.PRESETS.filter((function(e){return e.ID!==i}),this);this.parent.params.PRESETS=a}if(BX.type.isArray(this.parent.editablePresets)){a=this.parent.editablePresets.filter((function(e){return e.ID!==i}),this);this.parent.editablePresets=a}if(i===n){this.parent.getSearch().removePreset();this.resetPreset()}}},{key:"pinPreset",value:function e(t){if(!BX.type.isNotEmptyString(t)){t="default_filter"}var i=this.getPresetNodeById(t);if(this.parent.getParam("VALUE_REQUIRED_MODE")){if(t==="default_filter"){return}}var s={FILTER_ID:this.parent.getParam("FILTER_ID"),GRID_ID:this.parent.getParam("GRID_ID"),action:"PIN_PRESET"};var a={preset_id:t};this.getPresets().forEach((function(e){n.Dom.removeClass(e,this.parent.settings.classPinnedPreset)}),this);BX.addClass(i,this.parent.settings.classPinnedPreset);this.parent.saveOptions(a,s)}},{key:"_onPresetClick",value:function e(t){var i;var s;var a;var r;var l;var o;var u;t.preventDefault();u=this.parent;o=u.settings;l=t.target;i=t.currentTarget;s=this.getPresetId(i);a=this.getPreset(s);if(n.Dom.hasClass(l,o.classPinButton)){if(this.parent.isEditEnabled()){if(n.Dom.hasClass(i,o.classPinnedPreset)){this.pinPreset("default_filter")}else{this.pinPreset(s)}}}if(n.Dom.hasClass(l,o.classPresetEditButton)){this.enableEditPresetName(i)}if(n.Dom.hasClass(l,o.classPresetDeleteButton)){r="IS_DEFAULT"in a?a.IS_DEFAULT:false;this.removePreset(i,s,r);return false}if(!n.Dom.hasClass(l,o.classPresetDragButton)&&!n.Dom.hasClass(l,o.classAddPresetFieldInput)){if(this.parent.isEditEnabled()){this.updateEditablePreset(this.getCurrentPresetId())}var c=this.getPreset(this.getCurrentPresetId());var d=this.getPreset(s);c.ADDITIONAL=[];d.ADDITIONAL=[];this.activatePreset(i);this.applyPreset(s);if(!this.parent.isEditEnabled()){u.applyFilter(null,true);if(t.isTrusted){u.closePopup()}if(u.isAddPresetEnabled()){u.disableAddPreset()}}}}},{key:"applyPinnedPreset",value:function e(){var t=this.parent;var i=this.isPinned(this.getCurrentPresetId());var s;if(this.parent.getParam("VALUE_REQUIRED")&&this.getPinnedPresetId()==="default_filter"){this.applyPreset("default_filter");this.deactivateAllPresets();s=this.parent.applyFilter()}else if(!i){var n=this.getPinnedPresetId();var a=this.getPreset(n);a.ADDITIONAL=[];var r=this.getPinnedPresetNode();var l=false;var o=true;this.deactivateAllPresets();this.activatePreset(r);this.applyPreset(n);s=t.applyFilter(l,o);t.closePopup()}else{s=t.resetFilter()}return s}},{key:"updateEditablePreset",value:function e(t){var i=this.parent.getFilterFieldsValues();var s=this.getFields().map((function(e){return BX.data(e,"name")}));var n=this.parent.preparePresetFields(i,s);var a=this.getPreset(t);a.FIELDS=n;a.TITLE=this.getPresetInput(this.getPresetNodeById(t)).value;a.ROWS=s}},{key:"getPresetInput",value:function e(t){return BX.Filter.Utils.getByClass(t,this.parent.settings.classPresetEditInput)}},{key:"enableEditPresetName",value:function e(t){var i=this.getPresetInput(t);BX.addClass(t,this.parent.settings.classPresetNameEdit);i.select();i.value=BX.util.htmlspecialcharsback(i.value);n.Event.bind(i,"input",BX.delegate(this._onPresetNameInput,this))}},{key:"_onPresetNameInput",value:function e(t){var i=this.parent.getSearch();var s=t.currentTarget.value;var n=BX.findParent(t.currentTarget,{className:this.parent.settings.classPreset},true,false);var a=this.getPresetId(n);var r=this.getCurrentPresetId();var l={ID:a,TITLE:s};if(a===r){i.updatePreset(l)}}},{key:"getPresetNameNode",value:function e(t){return BX.Filter.Utils.getByClass(t,this.parent.settings.classPresetName)}},{key:"disableEditPresetName",value:function e(t){var i=this.getPresetInput(t);n.Dom.removeClass(t,this.parent.settings.classPresetNameEdit);if(BX.type.isDomNode(i)){i.blur();BX.unbind(i,"input",BX.delegate(this._onPresetNameInput,this))}}},{key:"getPreset",value:function e(t,i){var s=this.parent.getParam(i?"DEFAULT_PRESETS":"PRESETS",[]);if(this.parent.isEditEnabled()&&!i){s=this.parent.editablePresets}var n=s.filter((function(e){return e.ID===t}));if(t==="tmp_filter"&&!n.length){var a=BX.clone(this.getPreset("default_filter"));a.ID="tmp_filter";s.push(a);n.push(a)}return n.length!==0?n[0]:null}},{key:"getPresetField",value:function e(t,i){var s=this.getPreset(t);var n=null;if(BX.type.isPlainObject(s)&&"FIELDS"in s&&BX.type.isArray(s.FIELDS)){n=s.FIELDS.filter((function(e){return e.NAME===i}));n=n.length?n[0]:null}return n}},{key:"applyPreset",value:function e(t,i){t=i?"default_filter":t||"default_filter";var s=this.getPreset(t);if(t!=="default_preset"){s=this.extendPreset(s)}this.parent.getSearch().updatePreset(s);this.updatePresetFields(s,i);BX.onCustomEvent("BX.Main.Filter:onApplyPreset",[t])}},{key:"extendPreset",value:function e(t){var i=BX.clone(this.getPreset("default_filter"));if(BX.type.isPlainObject(t)){t=BX.clone(t);t.FIELDS.forEach((function(e){var t;var s=i.FIELDS.some((function(i,s){var n=false;if(i.NAME===e.NAME){t=s;n=true}return n}),this);if(s&&t||s&&t===0){i.FIELDS[t]=e}else if(!this.isEmptyField(e)){i.FIELDS.push(e)}}),this);t.FIELDS=i.FIELDS}return t}},{key:"isEmptyField",value:function e(t){var i=true;if(n.Type.isStringFilled(t.ADDITIONAL_FILTER)){return false}if(t.TYPE===this.parent.types.STRING){if(t.VALUE&&t.VALUE.length){i=false}}if(t.TYPE===this.parent.types.SELECT){if(BX.type.isPlainObject(t.VALUE)&&"VALUE"in t.VALUE&&t.VALUE.VALUE){i=false}}if(t.TYPE===this.parent.types.MULTI_SELECT){if(BX.type.isArray(t.VALUE)&&t.VALUE.length){i=false}}if(t.TYPE===this.parent.types.CUSTOM_DATE){if(BX.type.isArray(t.VALUE.days)&&t.VALUE.days.length||BX.type.isArray(t.VALUE.months)&&t.VALUE.months.length||BX.type.isArray(t.VALUE.years)&&t.VALUE.years.length){i=false}}if(t.TYPE===this.parent.types.CUSTOM_ENTITY||t.TYPE===this.parent.types.DEST_SELECTOR||t.TYPE===this.parent.types.ENTITY_SELECTOR){if(BX.type.isPlainObject(t.VALUES)){if(BX.type.isNotEmptyString(t.VALUES._label)&&BX.type.isNotEmptyString(t.VALUES._value)){i=false}if(BX.type.isPlainObject(t.VALUES._label)&&BX.type.isPlainObject(t.VALUES._value)&&Object.keys(t.VALUES._label).length&&Object.keys(t.VALUES._value).length){i=false}if(BX.type.isArray(t.VALUES._label)&&BX.type.isArray(t.VALUES._value)&&t.VALUES._label.length&&t.VALUES._value.length){i=false}if((BX.type.isArray(t.VALUES._label)&&t.VALUES._label.length||BX.type.isPlainObject(t.VALUES._label)&&Object.keys(t.VALUES._label).length)&&(BX.type.isArray(t.VALUES._value)&&t.VALUES._value.length||BX.type.isPlainObject(t.VALUES._value)&&Object.keys(t.VALUES._value).length)){i=false}}}if(t.TYPE===this.parent.types.DATE){var s="_datesel"in t.VALUES?t.VALUES._datesel:t.SUB_TYPE.VALUE;if(BX.type.isPlainObject(t.VALUES)&&(t.VALUES._from||t.VALUES._to||t.VALUES._quarter||t.VALUES._month&&!BX.type.isArray(t.VALUES._month)||t.VALUES._year&&!BX.type.isArray(t.VALUES._year)||t.VALUES._days&&!BX.type.isArray(t.VALUES._days))||BX.type.isArray(t.VALUES._days)&&t.VALUES._days.length||BX.type.isArray(t.VALUES._month)&&t.VALUES._month.length||BX.type.isArray(t.VALUES._year)&&t.VALUES._year.length||s===this.parent.dateTypes.CURRENT_DAY||s===this.parent.dateTypes.CURRENT_WEEK||s===this.parent.dateTypes.CURRENT_MONTH||s===this.parent.dateTypes.CURRENT_QUARTER||s===this.parent.dateTypes.LAST_7_DAYS||s===this.parent.dateTypes.LAST_30_DAYS||s===this.parent.dateTypes.LAST_60_DAYS||s===this.parent.dateTypes.LAST_90_DAYS||s===this.parent.dateTypes.LAST_WEEK||s===this.parent.dateTypes.LAST_MONTH||s===this.parent.dateTypes.TOMORROW||s===this.parent.dateTypes.YESTERDAY||s===this.parent.dateTypes.NEXT_WEEK||s===this.parent.dateTypes.NEXT_MONTH){i=false}}if(t.TYPE===this.parent.types.NUMBER){if(BX.type.isPlainObject(t.VALUES)&&(t.VALUES._from||t.VALUES._to)){i=false}}if(t.TYPE===this.parent.types.CHECKBOX){if(BX.type.isPlainObject(t.VALUE)&&t.VALUE.VALUE){i=false}}return i}},{key:"resetPreset",value:function e(t){this.applyPreset("",t)}},{key:"getFields",value:function e(){var t=this.parent.getFieldListContainer();var i=null;if(BX.type.isDomNode(t)){i=BX.Filter.Utils.getBySelector(t.parentNode,".".concat(this.parent.settings.classFileldControlList," > div"),true)}return i}},{key:"getField",value:function e(t){var i=this.getFields();var s=null;var n;var a;if(BX.type.isArray(i)&&i.length){a=i.filter((function(e){if(BX.type.isDomNode(e)){n=BX.data(e,"name")}return n===t.NAME}),this);s=a.length>0?a[0]:null}return s}},{key:"removeField",value:function e(t,i){var s;var n;i=i||false;if(BX.type.isPlainObject(t)){n=t.NAME;t=this.getField(t);if(BX.type.isArray(this.parent.fieldsList)){s=this.parent.fieldsList.indexOf(t);if(s!==-1){delete this.parent.fieldsList[s]}}this.parent.unregisterDragItem(t)}if(BX.type.isDomNode(t)){n=BX.data(t,"name");this.parent.getFields().deleteField(t)}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var a=this.getCurrentPresetId();var r=this.getPresetField(a,n);if(r&&!this.isEmptyField(r)){this.deactivateAllPresets();this.parent.applyFilter()}}if(!i){this.parent.saveFieldsSort()}}},{key:"removeFields",value:function e(t){t.forEach((function(e){this.removeField(e,true)}),this);this.parent.saveFieldsSort()}},{key:"addField",value:function e(t){var i;var s;var n;if(BX.type.isPlainObject(t)){i=this.parent.getFieldListContainer();n=this.parent.getControls();s=BX.type.isArray(n)?n[n.length-1]:null;if(BX.type.isDomNode(s)){if(s.nodeName!=="INPUT"){s=BX.Filter.Utils.getByTag(s,"input")}if(BX.type.isDomNode(s)){t.TABINDEX=parseInt(s.getAttribute("tabindex"))+1}}else{t.TABINDEX=2}if(BX.type.isDomNode(i)){s=this.createControl(t);if(BX.type.isDomNode(s)){BX.append(s,i);if(BX.type.isArray(this.parent.fieldsList)){this.parent.fieldsList.push(s)}this.parent.registerDragItem(s)}}}if(!this.parent.isEditEnabled()&&!this.parent.isAddPresetEnabled()){var a=this.getCurrentPresetId();var r=this.getPresetField(a,t.NAME);if(r&&!this.isEmptyField(r)){this.parent.updatePreset("tmp_filter");this.deactivateAllPresets();this.parent.getSearch().updatePreset(this.getPreset("tmp_filter"))}}this.parent.saveFieldsSort()}},{key:"createControl",value:function e(t){var i;switch(t.TYPE){case this.parent.types.STRING:{i=this.parent.getFields().createInputText(t);break}case this.parent.types.TEXTAREA:{i=this.parent.getFields().createTextarea(t);break}case this.parent.types.SELECT:{i=this.parent.getFields().createSelect(t);break}case this.parent.types.MULTI_SELECT:{i=this.parent.getFields().createMultiSelect(t);break}case this.parent.types.NUMBER:{i=this.parent.getFields().createNumber(t);break}case this.parent.types.DATE:{i=this.parent.getFields().createDate(t);break}case this.parent.types.CUSTOM_DATE:{i=this.parent.getFields().createCustomDate(t);break}case this.parent.types.DEST_SELECTOR:{i=this.parent.getFields().createDestSelector(t);break}case this.parent.types.ENTITY_SELECTOR:{i=this.parent.getFields().createEntitySelector(t);break}case this.parent.types.CUSTOM:{i=this.parent.getFields().createCustom(t);break}case this.parent.types.CUSTOM_ENTITY:{i=this.parent.getFields().createCustomEntity(t);break}default:{break}}if(this.parent.getParam("ENABLE_ADDITIONAL_FILTERS")){var s=N.getInstance();var a=s.getAdditionalFilterButton({fieldId:t.NAME,enabled:t.ADDITIONAL_FILTER_ALLOWED});n.Dom.append(a,i);if(!t.ADDITIONAL_FILTER_ALLOWED){BX.Dom.addClass(i,"main-ui-filter-additional-filters-hide")}if(n.Type.isStringFilled(t.ADDITIONAL_FILTER)){s.initAdditionalFilter(i,t.ADDITIONAL_FILTER)}}if(BX.type.isDomNode(i)){i.dataset.name=t.NAME;i.FieldController=new BX.Filter.FieldController(i,this.parent);if(t.REQUIRED){var r=i.querySelector(".main-ui-filter-field-delete");if(r){BX.remove(r)}}}return i}},{key:"removeNotCompareVariables",value:function e(t,i){if(BX.type.isPlainObject(t)){var s=this.parent.dateTypes;var n=this.parent.additionalDateTypes;if("FIND"in t){delete t.FIND}if(!i){Object.keys(t).forEach((function(e){if(e.indexOf("_numsel")!==-1){delete t[e]}if(e.indexOf("_datesel")!==-1){var i=t[e];if(i===s.EXACT||i===s.RANGE||i===n.PREV_DAY||i===n.NEXT_DAY||i===n.MORE_THAN_DAYS_AGO||i===n.AFTER_DAYS||i===s.PREV_DAYS||i===s.NEXT_DAYS||i===s.YEAR||i===s.MONTH||i===s.QUARTER||i===s.NONE||i===s.CUSTOM_DATE){delete t[e]}}var a=this.parent.getFieldByName(e);if(t[e]===""&&(!a||!a.STRICT)){delete t[e]}}),this)}}}},{key:"isPresetValuesModified",value:function e(t){var i=this.getPreset(t);var s=this.parent.preparePresetSettingsFields(i.FIELDS);var n=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(s);this.removeNotCompareVariables(n);var a=BX.Filter.Utils.sortObject(s);var r=BX.Filter.Utils.sortObject(n);return!Object.keys(a).every((function(e){return a[e]===r[e]||(BX.type.isPlainObject(a[e])||BX.type.isArray(a[e]))&&BX.Filter.Utils.objectsIsEquals(a[e],r[e])}))}},{key:"getAdditionalValues",value:function e(t){var i=this.getPreset(t);var s=i.FIELDS.filter((function(e){return!this.isEmptyField(e)}),this);var n=this.parent.preparePresetSettingsFields(s);var a=this.parent.getFilterFieldsValues();this.removeNotCompareVariables(n,true);this.removeNotCompareVariables(a,true);this.removeSameProperties(a,n);return a}},{key:"removeSameProperties",value:function e(t,i){if(BX.type.isPlainObject(t)&&BX.type.isPlainObject(i)){Object.keys(i).forEach((function(e){if(e in t){delete t[e]}}))}}},{key:"removeAdditionalField",value:function e(t){var i=this.getPreset(this.getCurrentPresetId());if(BX.type.isArray(i.ADDITIONAL)){i.ADDITIONAL=i.ADDITIONAL.filter((function(e){return e.NAME!==t}))}}},{key:"updatePresetFields",value:function e(t,i){var s=this;var n;var a;var r=[];if(BX.type.isPlainObject(t)&&"FIELDS"in t){n=t.FIELDS;if(BX.type.isArray(t.ADDITIONAL)){t.ADDITIONAL.filter((function(e){return s.parent.params.FIELDS.some((function(t){return e.NAME===t.NAME}))})).forEach((function(e){var t=false;e.IS_PRESET_FIELD=true;n.forEach((function(i,s){if(e.NAME===i.NAME){n[s]=e;t=true}}));if(!t){n.push(e)}}))}(n||[]).filter((function(e){return s.parent.params.FIELDS.some((function(t){return e.NAME===t.NAME}))})).forEach((function(e,t){e.TABINDEX=t+1;if(i){switch(e.TYPE){case this.parent.types.SELECT:{e.VALUE=e.ITEMS[0];break}case this.parent.types.MULTI_SELECT:{e.VALUE=[];break}case this.parent.types.DATE:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:"",_days:""};break}case this.parent.types.CUSTOM_DATE:{e.VALUE={days:[],months:[],years:[]};break}case this.parent.types.NUMBER:{e.SUB_TYPE=e.SUB_TYPES[0];e.VALUES={_from:"",_to:""};break}case this.parent.types.CUSTOM_ENTITY:{e.VALUES={_label:"",_value:""};break}case this.parent.types.CUSTOM:{e._VALUE="";break}default:{if("VALUE"in e){if(BX.type.isArray(e.VALUE)){e.VALUE=[]}else{e.VALUE=""}}break}}}r.push(this.createControl(e))}),this);this.parent.disableFieldsDragAndDrop();a=this.parent.getFieldListContainer();BX.cleanNode(a);if(r.length){r.forEach((function(e,i){if(BX.type.isDomNode(e)){if(t.ID!=="tmp_filter"&&t.ID!=="default_filter"&&!("IS_PRESET_FIELD"in n[i])&&!this.isEmptyField(n[i])){BX.addClass(e,this.parent.settings.classPresetField)}BX.append(e,a);if(BX.type.isString(n[i].HTML)){var s=BX.create("div");this.parent.getHiddenElement().appendChild(s);BX.html(s,n[i].HTML)}}}),this);this.parent.enableFieldsDragAndDrop()}}}},{key:"showCurrentPresetFields",value:function e(){var t=this.getCurrentPresetData();this.updatePresetFields(t)}},{key:"getCurrentPreset",value:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPresetCurrent)}},{key:"getCurrentPresetId",value:function e(){var t=this.getCurrentPreset();var i=null;if(BX.type.isDomNode(t)){i=this.getPresetId(t)}else{i="tmp_filter"}return i}},{key:"getCurrentPresetData",value:function e(){var t=this.getCurrentPresetId();var i=null;if(BX.type.isNotEmptyString(t)){i=this.getPreset(t);i=this.extendPreset(i)}return i}},{key:"getContainer",value:function e(){return BX.Filter.Utils.getByClass(this.parent.getFilter(),this.parent.settings.classPresetsContainer)}},{key:"getPresets",value:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPreset,true)}},{key:"getDefaultPresets",value:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classDefaultFilter,true)}},{key:"getPinnedPresetNode",value:function e(){return BX.Filter.Utils.getByClass(this.getContainer(),this.parent.settings.classPinnedPreset)}},{key:"isPinned",value:function e(t){return this.getPinnedPresetId()===t}},{key:"getPinnedPresetId",value:function e(){var t=this.getPinnedPresetNode();var i="default_filter";if(t){var s=BX.data(t,"id");i=s||i}return i}}]);return e}();e.Field=S;e.Api=_;e.Fields=w;e.Presets=x;e.AdditionalFilter=N})(this.BX.Filter=this.BX.Filter||{},BX.UI.EntitySelector,BX.Event,BX.Main,BX);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/socialnetwork.blog.post/templates/.default/script.min.js?172645642526365";s:6:"source";s:78:"/bitrix/components/bitrix/socialnetwork.blog.post/templates/.default/script.js";s:3:"min";s:82:"/bitrix/components/bitrix/socialnetwork.blog.post/templates/.default/script.min.js";s:3:"map";s:82:"/bitrix/components/bitrix/socialnetwork.blog.post/templates/.default/script.map.js";}"*/
function showHiddenDestination(t,e){BX.hide(e);BX("blog-destination-hidden-"+t).style.display="inline"}function showMenuLinkInput(t,e){var i="post-menu-"+t+"-link",o=BX(i+"-text"),s=BX(i+"-icon-done");if(BX.clipboard.isCopySupported()){if(o&&o.getAttribute("data-block-click")=="Y"){return}BX.clipboard.copy(e);if(o&&s){s.style.display="inline-block";BX.removeClass(BX(i+"-icon-animate"),"post-menu-link-icon-animate");BX.adjust(o,{attrs:{"data-block-click":"Y"}});setTimeout((function(){BX.addClass(BX(i+"-icon-animate"),"post-menu-link-icon-animate")}),1);setTimeout((function(){BX.adjust(o,{attrs:{"data-block-click":"N"}})}),500)}return}var n=BX.proxy_context,a=parseInt(!!n.getAttribute("bx-height")?n.getAttribute("bx-height"):n.offsetHeight);if(n.getAttribute("bx-status")!="shown"){n.setAttribute("bx-status","shown");if(!BX(i)&&!!BX(i+"-text")){var r=BX(i+"-text"),p=BX.pos(r),l=BX.pos(r.parentNode);pos3=BX.pos(BX.findParent(r,{className:"menu-popup-item"},true));p["height"]=l["height"]-1;BX.adjust(n,{attrs:{"bx-height":n.offsetHeight},style:{overflow:"hidden",display:"block"},children:[BX.create("BR"),BX.create("DIV",{attrs:{id:i},children:[BX.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[BX.create("INPUT",{attrs:{id:i+"-input",type:"text",value:e},style:{height:p["height"]+"px",width:pos3["width"]-21+"px"},events:{click:function(t){this.select();BX.PreventDefault(t)}}})]})]}),BX.create("SPAN",{className:"menu-popup-item-right"})]})}new BX.fx({time:.2,step:.05,type:"linear",start:a,finish:a*2,callback:BX.delegate((function(t){this.style.height=t+"px"}),n)}).start();BX.fx.show(BX(i),.2);BX(i+"-input").select()}else{n.setAttribute("bx-status","hidden");new BX.fx({time:.2,step:.05,type:"linear",start:n.offsetHeight,finish:a,callback:BX.delegate((function(t){this.style.height=t+"px"}),n)}).start();BX.fx.hide(BX(i),.2)}}function deleteBlogPost(t){var e=BX("blg-post-"+t);if(BX.findChild(e,{attr:{id:"form_c_del"}},true,false)){BX.hide(BX("form_c_del"));BX(e.parentNode.parentNode).appendChild(BX("form_c_del"))}BX.ajax.runAction("socialnetwork.api.livefeed.blogpost.delete",{data:{id:t}}).then(function(){BX.Livefeed.FeedInstance.deleteSuccess(document.getElementById("blg-post-"+t))}.bind(this),function(t){BX.findChild(e,{className:"feed-post-cont-wrap"},true,false).insertBefore(BX.create("span",{children:[BX.create("div",{props:{className:"feed-add-error"},children:[BX.create("span",{props:{className:"feed-add-info-icon"}}),BX.create("span",{props:{className:"feed-add-info-text"},html:t.errors[0].message})]})]}),BX.findChild(e,{className:"feed-user-avatar"},true,false))}.bind(this));return false}var waitPopupBlogImage=null;function blogShowImagePopup(t){if(!waitPopupBlogImage){waitPopupBlogImage=new BX.PopupWindow("blogwaitPopupBlogImage",window,{autoHide:true,lightShadow:false,zIndex:2,content:BX.create("IMG",{props:{src:t,id:"blgimgppp"}}),closeByEsc:true,closeIcon:true})}else{BX("blgimgppp").src="/bitrix/images/1.gif";BX("blgimgppp").src=t}waitPopupBlogImage.setOffset({offsetTop:0,offsetLeft:0});setTimeout((function(){waitPopupBlogImage.adjustPosition()}),100);waitPopupBlogImage.show()}function __blogPostSetFollow(t){return BX.Livefeed.FeedInstance.changeFollow({logId:t})}(function(){if(!!BX.SBPostMenu)return false;BX.SBPostMenu=function(t){};BX.SBPostMenu.showMenu=function(params){if(typeof params=="undefined"||typeof params.event==="undefined"){return false}var bindNode=params.event.currentTarget;if(!BX.type.isDomNode(bindNode)){return false}var menuNode=params.menuNode;if(!BX.type.isDomNode(menuNode)){return false}var postId=parseInt(menuNode.getAttribute("data-bx-post-id"));if(postId<=0){return false}BX.PopupMenu.destroy("blog-post-"+postId);var isPublicPage=menuNode.getAttribute("data-bx-public-page");isPublicPage=isPublicPage==="Y";var isTasksAvailable=menuNode.getAttribute("data-bx-tasks-available");isTasksAvailable=isTasksAvailable==="Y";var isGroupReadOnly=menuNode.getAttribute("data-bx-group-read-only");isGroupReadOnly=isGroupReadOnly==="Y";var items=menuNode.getAttribute("data-bx-items");try{items=JSON.parse(items);if(!BX.type.isPlainObject(items)){items={}}}catch(t){items={}}var pathToPost=menuNode.getAttribute("data-bx-path-to-post");var urlToEdit=menuNode.getAttribute("data-bx-path-to-edit");var urlToHide=menuNode.getAttribute("data-bx-path-to-hide");var urlToDelete=menuNode.getAttribute("data-bx-path-to-delete");var urlToPub=menuNode.getAttribute("data-bx-path-to-pub");var voteId=parseInt(menuNode.getAttribute("data-bx-vote-id"));var postType=menuNode.getAttribute("data-bx-post-type");var serverName=menuNode.getAttribute("data-bx-server-name");if(BX.type.isNotEmptyString(urlToHide)){urlToHide=BX.util.remove_url_param(urlToHide,["b24statAction"]);urlToHide=BX.util.add_url_param(urlToHide,{b24statAction:"hidePost"})}if(isPublicPage){return false}var menuWaiterPopup=new BX.PopupWindow("blog-post-"+postId+"-waiter",bindNode,{offsetLeft:-14,offsetTop:4,lightShadow:false,angle:{position:"top",offset:50},content:BX.create("SPAN",{props:{className:"bx-ilike-wait"}})});setTimeout((function(){if(menuWaiterPopup){menuWaiterPopup.show()}}),300);BX.ajax.runAction("socialnetwork.api.livefeed.blogpost.getData",{data:{params:{postId:postId,public:isPublicPage?"Y":"N",mobile:"N",groupReadOnly:isGroupReadOnly?"Y":"N",pathToPost:pathToPost,voteId:voteId,checkModeration:"Y"}}}).then((function(response){var postData=response.data;if(postData.perms<="D"&&items.length<=0){menuWaiterPopup.destroy();return false}var menuItems=[];if(!BX.util.in_array(postType,["DRAFT","MODERATION"])){if(parseInt(BX.message("USER_ID"))>0&&parseInt(postData.logId)>0){var isPinned=parseInt(postData.logPinnedUserId)>0;menuItems.push({text:BX.message(isPinned?"SONET_EXT_LIVEFEED_MENU_TITLE_PINNED_Y":"SONET_EXT_LIVEFEED_MENU_TITLE_PINNED_N"),onclick:function(t){BX.Livefeed.PinnedPanelInstance.changePinned({logId:parseInt(postData.logId),newState:isPinned?"N":"Y",event:t,node:bindNode});this.popupWindow.close();return t.preventDefault()}})}if(postData.isGroupReadOnly!="Y"&&parseInt(BX.message("USER_ID"))>0&&parseInt(postData.logId)>0){var isFavorites=parseInt(postData.logFavoritesUserId)>0;menuItems.push({text:BX.message(isFavorites?"SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_Y":"SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_N"),onclick:function(t){__logChangeFavorites(parseInt(postData.logId),"log_entry_favorites_"+parseInt(postData.logId),isFavorites?"N":"Y",true,t);return false}})}menuItems.push({text:BX.message("BLOG_HREF"),href:postData.urlToPost,class:"feed-entry-popup-menu-link",target:"_top"});menuItems.push({html:'<span id="post-menu-'+postData.logId+'-link-text">'+BX.message("BLOG_LINK")+"</span>"+'<span id="post-menu-'+postData.logId+'-link-icon-animate" class="post-menu-link-icon-wrap">'+'<span class="post-menu-link-icon" id="post-menu-'+postData.logId+'-link-icon-done" style="display: none;">'+"</span>"+"</span>",onclick:function(t){showMenuLinkInput(parseInt(postData.logId),serverName+postData.urlToPost);return false},class:"feed-entry-popup-menu-link"});if(parseInt(BX.message("USER_ID"))>0&&postData.isGroupReadOnly!="Y"&&postData.isShareForbidden!="Y"){menuItems.push({text:BX.message("BLOG_SHARE"),onclick:function(){showSharing(postId,parseInt(postData.authorId));this.popupWindow.close()}})}}if(postData.perms>="W"||postData.perms>="P"&&postData.authorId==BX.message("USER_ID")){var editParams={text:BX.message("BLOG_BLOG_BLOG_EDIT")};if(BX.type.isNotEmptyString(postData.backgroundCode)){editParams.onclick=function(){BX.Livefeed.Post.showBackgroundWarning({urlToEdit:urlToEdit,menuPopupWindow:this.popupWindow})}}else{editParams.href=urlToEdit;editParams.target="_top"}menuItems.push(editParams)}if(!BX.util.in_array(postType,["DRAFT","MODERATION"])){if(postData.perms>="T"){menuItems.push({text:BX.message("BLOG_MES_HIDE"),onclick:function(){if(confirm(BX.message("BLOG_MES_HIDE_POST_CONFIRM"))){window.location=urlToHide;this.popupWindow.close()}}})}if(isTasksAvailable&&postData.perms>"D"){menuItems.push({text:BX.message("BLOG_POST_CREATE_TASK"),onclick:function(t){BX.Livefeed.TaskCreator.create({entityType:"BLOG_POST",entityId:postId});this.popupWindow.close();return t.preventDefault()}})}if(typeof BX.Landing!=="undefined"){if(typeof BX.Landing.UI.Note.Menu.getMenuItem!=="undefined"){menuItems.push(BX.Landing.UI.Note.Menu.getMenuItem("blog",postId))}}if(postData.urlToVoteExport.length>0){menuItems.push({text:BX.message("BLOG_POST_VOTE_EXPORT"),href:postData.urlToVoteExport,target:"_top"})}}if(postType=="DRAFT"&&postData.allowModerate=="Y"&&BX.type.isNotEmptyString(urlToPub)){menuItems.push({text:BX.message("BLOG_POST_MOD_PUB"),href:urlToPub,target:"_top"})}if(postData.perms>="W"){menuItems.push({text:BX.message("BLOG_BLOG_BLOG_DELETE"),onclick:function(){if(confirm(BX.message("BLOG_MES_DELETE_POST_CONFIRM"))){if(urlToDelete.length>0){window.location=urlToDelete.replace("#del_post_id#",postId)}else{window.deleteBlogPost(postId)}this.popupWindow.close()}}})}var onclickHandler=null,menuItem=null,item=null;for(var key in items){if(items.hasOwnProperty(key)){item=items[key];menuItem={};if(typeof item.text_php!="undefined"){menuItem.text=item.text_php}if(typeof item.onclick!="undefined"){eval("onclickHandler = "+item.onclick);menuItem.onclick=onclickHandler}else if(typeof item.href!="undefined"){menuItem.href=item.href}menuItems.push(menuItem)}}menuWaiterPopup.destroy();BX.PopupMenu.show("blog-post-"+postId,bindNode,menuItems,{offsetLeft:-14,offsetTop:4,lightShadow:false,angle:{position:"top",offset:50},events:{}});return false}),(function(t){menuWaiterPopup.destroy();return false}))}})();(function(){if(!!window.SBPImpPost)return false;window.SBPImpPost=function(t){if(t.getAttribute("sbpimppost")=="Y")return false;this.CID="sbpimppost"+(new Date).getTime();this.busy=false;this.node=t;this.btn=t.parentNode;this.block=t.parentNode.parentNode;this.postId=t.getAttribute("bx-blog-post-id");t.setAttribute("sbpimppost","Y");BX.onCustomEvent(this.node,"onInit",[this]);if(this.postId>0)this.onclick();return false};window.SBPImpPost.prototype.onclick=function(){this.sendData()};window.SBPImpPost.prototype.showClick=function(){var t=this.btn.offsetWidth,e=BX.message("BLOG_ALREADY_READ"),i=BX.create("span",{props:{className:"have-read-text-block"},html:"<i></i>"+e+'<span class="feed-imp-post-footer-comma">,</span>'});this.block.style.minWidth=this.btn.offsetWidth-27+"px";var o=new BX.easing({duration:250,start:{width:t},finish:{width:1},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:BX.delegate((function(t){this.btn.style.width=t.width+"px"}),this),complete:BX.delegate((function(){this.btn.innerHTML="";this.btn.appendChild(i);var t=i.scrollWidth+31;var e=new BX.easing({duration:300,start:{width_2:0},finish:{width_2:t},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:BX.delegate((function(t){this.btn.style.width=t.width_2+"px"}),this)});e.animate()}),this)});o.animate()};window.SBPImpPost.prototype.wait=function(t){t=t=="show"?"show":"hide";if(t=="show"){this.node.disabled=true;BX.addClass(this.node,"ui-btn-clock")}else{BX.removeClass(this.node,"ui-btn-clock")}};window.SBPImpPost.prototype.sendData=function(){if(this.busy)return false;this.busy=true;window["node"]=this.node;window["obj"]=this;this.wait("show");var t={options:[{post_id:this.postId,name:"BLOG_POST_IMPRTNT",value:"Y"}],sessid:BX.bitrix_sessid()};BX.onCustomEvent(this.node,"onSend",[t]);BX.ajax.runAction("socialnetwork.api.livefeed.blogpost.important.vote",{data:{params:{POST_ID:this.postId}}}).then(function(e){if(!BX.type.isNotEmptyString(e.data.success)||e.data.success!="Y"){return false}this.busy=false;this.wait("hide");this.showClick();BX.onCustomEvent("onImportantPostRead",[this.postId,this.CID]);BX.ajax.runAction("socialnetwork.api.livefeed.blogpost.important.getUsers",{data:{params:{POST_ID:this.postId,NAME:"BLOG_POST_IMPRTNT",VALUE:"Y",PAGE_NUMBER:t.iNumPage,PATH_TO_USER:t.PATH_TO_USER,NAME_TEMPLATE:t.NAME_TEMPLATE}}}).then(function(t){var e=t.data;BX.onCustomEvent(this.node,"onUserVote",[e])}.bind(this),function(t){}.bind(this))}.bind(this),function(t){this.busy=false;this.wait("hide")}.bind(this))};top.SBPImpPostCounter=function(t,e,i){this.parentNode=t;this.node=BX.findChild(t,{tagName:"A"});if(!this.node)return false;BX.addCustomEvent(this.node,"onUserVote",BX.delegate((function(t){this.change(t)}),this));this.parentNode.SBPImpPostCounter=this;this.node.setAttribute("status","ready");this.node.setAttribute("inumpage",0);this.postId=e;this.popup=null;this.data=[];BX.bind(t,"click",BX.proxy((function(){this.get()}),this));BX.bind(t,"mouseover",BX.proxy((function(t){this.init(t)}),this));BX.bind(t,"mouseout",BX.proxy((function(t){this.init(t)}),this));this.pathToUser=i["pathToUser"];this.nameTemplate=i["nameTemplate"];this.onPullEvent=BX.delegate((function(t,e){if(t=="read"&&!!e&&e["POST_ID"]==this.postId){if(!!e["data"]){this.change(e["data"]);if(this.popup!=null){this.popup.isNew=true}}}}),this);BX.addCustomEvent("onPullEvent-socialnetwork",this.onPullEvent)};top.SBPImpPostCounter.prototype.click=function(t){t.uController=this;BX.addCustomEvent(t.node,"onUserVote",BX.proxy(this.change,this));BX.addCustomEvent(t.node,"onSend",BX.proxy((function(t){t["PATH_TO_USER"]=this.pathToUser;t["NAME_TEMPLATE"]=this.nameTemplate;t["iNumPage"]=0;t["ID"]=this.postId;t["post_id"]=this.postId;t["name"]="BLOG_POST_IMPRTNT";t["value"]="Y";t["return"]="users"}),this));this.btnObj=t};top.SBPImpPostCounter.prototype.change=function(t){if(!!t&&!!t.items){var e=false;this.data=[];for(var i in t.items){if(t.items.hasOwnProperty(i)){this.data.push(t.items[i])}}if(t["StatusPage"]=="done"){this.node.setAttribute("inumpage","done")}else this.node.setAttribute("inumpage",1);BX.adjust(this.parentNode,{style:{display:"flex"}})}else{this.node.setAttribute("inumpage","done");BX.hide(this.parentNode)}this.node.firstChild.innerHTML=t["RecordCount"]};top.SBPImpPostCounter.prototype.init=function(t){if(!!this.node.timeoutOver){clearTimeout(this.node.timeoutOver);this.node.timeoutOver=false}if(t.type=="mouseover"){if(!this.node.mouseoverFunc){this.node.mouseoverFunc=BX.delegate((function(){this.get();if(this.popup){BX.bind(this.popup.popupContainer,"mouseout",BX.proxy((function(){this.popup.timeoutOut=setTimeout(BX.proxy((function(){if(!!this.popup){this.popup.close()}}),this),400)}),this));BX.bind(this.popup.popupContainer,"mouseover",BX.proxy((function(){if(this.popup.timeoutOut)clearTimeout(this.popup.timeoutOut)}),this))}}),this)}this.node.timeoutOver=setTimeout(this.node.mouseoverFunc,400)}};top.SBPImpPostCounter.prototype.get=function(){if(this.node.getAttribute("inumpage")!="done")this.node.setAttribute("inumpage",parseInt(this.node.getAttribute("inumpage"))+1);this.show();if(this.data.length>0){this.make(this.node.getAttribute("inumpage")!="done")}if(this.node.getAttribute("inumpage")!="done"){this.node.setAttribute("status","busy");BX.ajax.runAction("socialnetwork.api.livefeed.blogpost.important.getUsers",{data:{params:{POST_ID:this.postId,NAME:"BLOG_POST_IMPRTNT",VALUE:"Y",PAGE_NUMBER:this.node.getAttribute("inumpage"),PATH_TO_USER:this.pathToUser,NAME_TEMPLATE:this.nameTemplate}}}).then(function(t){var e=t.data;if(BX.type.isNotEmptyObject(e.items)){for(var i in e.items){if(e.items.hasOwnProperty(i)){this.data.push(e.items[i])}}if(e.StatusPage=="done"){this.node.setAttribute("inumpage","done")}this.make(this.node.getAttribute("inumpage")!="done")}else{this.node.setAttribute("inumpage","done")}this.node.firstChild.innerHTML=e["RecordCount"];this.node.setAttribute("status","ready")}.bind(this),function(t){if(!!this.popup){this.popup.close()}this.node.setAttribute("status","ready")}.bind(this))}};top.SBPImpPostCounter.prototype.show=function(){if(this.popup==null){this.popup=new BX.PopupWindow("bx-vote-popup-cont-"+this.postId,this.node,{lightShadow:true,offsetTop:-2,offsetLeft:3,autoHide:true,closeByEsc:true,bindOptions:{position:"top"},events:{onPopupClose:function(){this.destroy()},onPopupDestroy:BX.proxy((function(){this.popup=null}),this)},content:BX.create("SPAN",{props:{className:"bx-ilike-wait"}})});this.popup.isNew=true;this.popup.show()}this.popup.setAngle({position:"bottom"});this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false};top.SBPImpPostCounter.prototype.make=function(t){if(!this.popup)return true;t=t!==false;var e=this.popup&&this.popup.contentContainer?this.popup.contentContainer:BX("popup-window-content-bx-vote-popup-cont-"+this.postId),i=false,o=false,s=this.data;if(this.popup.isNew){i=BX.create("SPAN",{props:{className:"bx-ilike-popup"},children:[BX.create("SPAN",{props:{className:"bx-ilike-bottom_scroll"}})]});o=BX.create("SPAN",{props:{className:"bx-ilike-wrap-block"},children:[i]})}else{i=BX.findChild(this.popup.contentContainer,{className:"bx-ilike-popup"},true)}if(!!i){var n=null;for(var a in s){if(s.hasOwnProperty(a)){if(!BX.findChild(i,{tag:"A",attr:{id:"u"+s[a]["ID"]}},true)){if(s[a]["PHOTO_SRC"].length>0){n=BX.create("IMG",{attrs:{src:encodeURI(s[a]["PHOTO_SRC"])},props:{className:"bx-ilike-popup-avatar-img"}})}else{n=BX.create("IMG",{attrs:{src:"/bitrix/images/main/blank.gif"},props:{className:"bx-ilike-popup-avatar-img bx-ilike-popup-avatar-img-default"}})}i.appendChild(BX.create("A",{attrs:{id:"u"+s[a]["ID"]},props:{href:s[a]["URL"].length>0?s[a]["URL"]:"#",target:"_blank",className:"bx-ilike-popup-img"+(!!s[a]["TYPE"]?" bx-ilike-popup-img-"+s[a]["TYPE"]:"")},text:"",children:[BX.create("SPAN",{props:{className:"bx-ilike-popup-avatar-new"},children:[n,BX.create("SPAN",{props:{className:"bx-ilike-popup-avatar-status-icon"}})]}),BX.create("SPAN",{props:{className:"bx-ilike-popup-name-new"},html:s[a]["FULL_NAME"]})],events:{click:s[a]["URL"].length>0?function(t){return true}:function(t){BX.PreventDefault(t)}}}))}}}if(t){BX.bind(i,"scroll",BX.proxy(this.popupScrollCheck,this))}}if(this.popup.isNew){this.popup.isNew=false;if(!!e){try{e.removeChild(e.firstChild)}catch(t){}e.appendChild(o)}}if(this.popup!=null){this.popup.bindOptions.forceBindPosition=true;this.popup.adjustPosition();this.popup.bindOptions.forceBindPosition=false}};top.SBPImpPostCounter.prototype.popupScrollCheck=function(){var t=BX.proxy_context;if(t.scrollTop>(t.scrollHeight-t.offsetHeight)/1.5){this.get();BX.unbindAll(t)}};window.entitySelectorRepo={}})(window);window.showSharing=function(t,e){BX("sharePostId").value=t;BX("shareUserId").value=e;var i=BX("blogShare").getAttribute("bx-selector-id");if(!BX.type.isNotEmptyString(i)){return}if(!window["postDest"+t]){return}var o="entity-selector-"+i;var s="entity-selector-data-"+i;BX.clean(o);window.entitySelectorRepo[t]=new SBPEntitySelector({id:i+t,context:"BLOG_POST",tagNodeId:o,inputNodeId:s,preselectedItems:window["postDest"+t],allowSearchEmailUsers:window.oSBPostManager&&!!window.oSBPostManager.allowSearchEmailUsers,allowToAll:window.oSBPostManager&&!!window.oSBPostManager.allowToAll});if(document.getElementById(s)){document.getElementById(s).value=JSON.stringify(window["postDest"+t])}var n=BX("destination-sharing");if(BX("blg-post-destcont-"+t)){BX("blg-post-destcont-"+t).appendChild(n)}n.style.height=0;n.style.opacity=0;n.style.overflow="hidden";n.style.display="inline-block";new BX.easing({duration:500,start:{opacity:0,height:0},finish:{opacity:100,height:n.scrollHeight-40},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){n.style.height=t.height+"px";n.style.opacity=t.opacity/100},complete:function(){n.style.cssText=""}}).animate()};window.closeSharing=function(){var t=BX("destination-sharing");if(BX("sharePostSubmitButton")){BX.removeClass(BX("sharePostSubmitButton"),"ui-btn-clock")}new BX.easing({duration:500,start:{opacity:100,height:t.scrollHeight-40},finish:{opacity:0,height:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){t.style.height=e.height+"px";t.style.opacity=e.opacity/100},complete:function(){BX.hide(t)}}).animate()};window.sharingPost=function(){var t=BX("sharePostId").value;var e=BX("blogShare");if(BX("sharePostSubmitButton")){BX.addClass(BX("sharePostSubmitButton"),"ui-btn-clock")}var i=0,o="",s=null,n=null,a=null,r={postId:t,pathToUser:oSBPostManager.pathToUser,pathToPost:oSBPostManager.pathToPost,readOnly:oSBPostManager.readOnly};for(i=0;i<e.elements.length;i++){var p=e.elements[i];if(p.disabled){continue}o=p.name;n=false;s=/^(.*)\[(.*)\]$/.exec(o);if(s){o=s[1];n=true;a=BX.type.isNotEmptyString(s[2])?s[2]:false}switch(p.type.toLowerCase()){case"text":case"hidden":if(n){if(typeof r[o]==="undefined"){r[o]=a?{}:[]}if(BX.type.isArray(r[o])){r[o].push(p.value)}else if(a){r[o][a]=p.value}}else{r[o]=p.value}break;default:break}}var l=renderSharingPost(t,r.DEST_DATA);BX.ajax.runAction("socialnetwork.api.livefeed.blogpost.share",{data:{params:r,MODE:"RECORD",ENTITY_XML_ID:"BLOG_"+t,AJAX_POST:"Y"},analyticsLabel:{b24statAction:"sharePost"}}).then((function(e){if(!BX.type.isNotEmptyObject(e)||!BX.type.isNotEmptyString(e.status)||e.status!="success"){hideRenderedSharingNodes(l);if(!BX.type.isNotEmptyString(e.status)&&e.status=="error"&&!!BX.type.isNotEmptyString(e.errorMessage)){sharingPostError({postId:t,errorMessage:e.errorMessage})}}else{var i=e;BX.onCustomEvent(window,"OnUCAfterRecordAdd",["BLOG_"+t,e,i])}}),(function(e){sharingPostError({postId:t,errorMessage:e.errors[0].message});hideRenderedSharingNodes(l)}));closeSharing()};window.sharingPostError=function(t){var e=new BX.PopupWindow("error_popup",BX("blg-post-inform-"+t.postId),{lightShadow:true,offsetTop:-10,offsetLeft:100,autoHide:true,closeByEsc:true,closeIcon:{right:"5px",top:"5px"},draggable:{restrict:true},contentColor:"white",contentNoPaddings:true,bindOptions:{position:"bottom"},content:BX.create("DIV",{props:{className:"feed-create-task-popup-content"},children:[BX.create("DIV",{props:{className:"feed-create-task-popup-description"},text:t.errorMessage})]})});e.show()};window.renderSharingPost=function(t,e){if(!BX.type.isNotEmptyString(e)){return}var i=[];try{e=JSON.parse(e);if(!BX.type.isArray(e)){e=[]}}catch(t){e=[]}if(e.length<=0||!window.entitySelectorRepo[t]||!window.entitySelectorRepo[t].selector){return}var o=window.entitySelectorRepo[t].selector;var s=null;var n=document.getElementById("blog-destination-hidden-"+t);if(!n){var a=document.getElementById("blg-post-img-"+t).querySelectorAll(".feed-add-post-destination-new");if(a){s=a[a.length-1]}}e.forEach((function(e){var a=false;window["postDest"+t].forEach((function(t){if(a){return}a=t[0]==e[0]&&t[1]==e[1]}));if(a){return}var r=o.getTag({id:e[1],entityId:e[0]});var p="feed-add-post-destination-new";if(r.getEntityType()==="email"){p+=" feed-add-post-destination-new-email"}else if(r.getEntityType()==="extranet"){p+=" feed-add-post-destination-new-extranet"}var l=r.getLink();var d="post_"+t+"_dest_"+r.getEntityId()+"_"+r.getId();i.push(d);var u=null;if(BX.type.isNotEmptyString(l)){u=BX.create("a",{props:{className:p},attrs:{href:l,"bx-tooltip-user-id":r.getEntityId()==="user"?r.getId():""},text:r.getTitle()})}else{u=BX.create("span",{props:{className:p},text:r.getTitle()})}u=BX.create("span",{attrs:{id:d},children:[BX.create("span",{html:", "}),u]});if(n){n.appendChild(u)}else if(s){s.parentNode.insertBefore(u,s.nextSibling)}}));window["postDest"+t]=BX.clone(e);return i};window.hideRenderedSharingNodes=function(t){var e=false;for(i=0;i<t.length;i++){e=t[i];if(BX(e)){BX.cleanNode(BX(e),true)}}};(function(){if(!!BX.SBPostManager)return false;BX.SBPostManager=function(){this.inited=false;this.tagLinkPattern="";this.readOnly="N";this.pathToUser="";this.pathToPost="";this.allowToAll=false};BX.SBPostManager.prototype.init=function(t){this.tagLinkPattern=BX.type.isNotEmptyString(t.tagLinkPattern)?t.tagLinkPattern:"";this.inited=true;this.readOnly=BX.type.isNotEmptyString(t.readOnly)&&t.readOnly=="Y"?"Y":"N";this.pathToUser=BX.type.isNotEmptyString(t.pathToUser)?t.pathToUser:"";this.pathToPost=BX.type.isNotEmptyString(t.pathToPost)?t.pathToPost:"";this.allowToAll=BX.type.isBoolean(t.allowToAll)?t.allowToAll:false};BX.SBPostManager.prototype.clickTag=function(t){var e=false;if(BX.type.isNotEmptyString(t)&&BX.type.isNotEmptyString(this.tagLinkPattern)){top.location.href=this.tagLinkPattern.replace("#tag#",BX.util.urlencode(t));e=true}return e}})();if(typeof oSBPostManager=="undefined"){oSBPostManager=new BX.SBPostManager;window.oSBPostManager=oSBPostManager}(function(){SBPEntitySelector=function(t){this.selector=null;this.inputNode=null;if(!BX.type.isNotEmptyString(t.id)){return null}this.init(t)};SBPEntitySelector.prototype.init=function(t){if(!BX.type.isPlainObject(t)){t={}}if(!BX.type.isNotEmptyString(t.id)||!BX.type.isNotEmptyString(t.tagNodeId)||!BX(t.tagNodeId)){return null}if(BX.type.isNotEmptyString(t.inputNodeId)&&BX(t.inputNodeId)){this.inputNode=BX(t.inputNodeId)}var e=BX.type.isArray(t.preselectedItems)?t.preselectedItems:[];this.selector=new BX.UI.EntitySelector.TagSelector({id:t.id,dialogOptions:{id:t.id,context:BX.type.isNotEmptyString(t.context)?t.context:null,preselectedItems:e,undeselectedItems:e,events:{"Item:onSelect":function(){this.recalcValue(this.selector.getDialog().getSelectedItems())}.bind(this),"Item:onDeselect":function(){this.recalcValue(this.selector.getDialog().getSelectedItems())}.bind(this)},entities:[{id:"meta-user",options:{"all-users":{allowView:BX.type.isBoolean(t.allowToAll)&&t.allowToAll}}},{id:"user",options:{emailUsers:BX.type.isBoolean(t.allowSearchEmailUsers)?t.allowSearchEmailUsers:false,myEmailUsers:true}},{id:"project",options:{features:{blog:["premoderate_post","moderate_post","write_post","full_post"]}}},{id:"department",options:{selectMode:"usersAndDepartments",allowFlatDepartments:false}}]},addButtonCaption:BX.message("BX_FPD_SHARE_LINK_1"),addButtonCaptionMore:BX.message("BX_FPD_SHARE_LINK_2")});this.selector.renderTo(document.getElementById(t.tagNodeId));return this.selector};SBPEntitySelector.prototype.recalcValue=function(t){if(!BX.type.isArray(t)||!this.inputNode){return}var e=[];t.forEach((function(t){e.push([t.entityId,t.id])}));this.inputNode.value=JSON.stringify(e)};window.SBPEntitySelector=SBPEntitySelector})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:105:"/bitrix/components/bitrix/socialnetwork.blog.post.comment/templates/.default/script.min.js?17264564252906";s:6:"source";s:86:"/bitrix/components/bitrix/socialnetwork.blog.post.comment/templates/.default/script.js";s:3:"min";s:90:"/bitrix/components/bitrix/socialnetwork.blog.post.comment/templates/.default/script.min.js";s:3:"map";s:90:"/bitrix/components/bitrix/socialnetwork.blog.post.comment/templates/.default/script.map.js";}"*/
(function(){if(!!window.__blogEditComment)return;window.checkForQuote=function(t,e,o,i){if(window.mplCheckForQuote)mplCheckForQuote(t,e,o,i)};window.__blogLinkEntity=function(t,e){if(!!window["UC"]&&!!window["UC"][e]){var o=window["UC"][e].eventNode;if(BX(o)&&!o.hasOwnProperty("__blogLinkEntity")){o["__blogLinkEntity"]=true;BX.addCustomEvent(o,"OnUCFormBeforeShow",(function(e){var o=e&&e.id&&e.id[0]?e.id[0]:null;if(o&&t[o]){BX.show(BX("blg-comment-"+t[i][1]))}}))}for(var i in t){if(t.hasOwnProperty(i)){var n=document.getElementById("blog-post-addc-add-"+t[i][1]);if(n){n.addEventListener("click",window["UC"][i].reply.bind(window["UC"][i]))}}}}};window.__blogEditComment=function(t,e){var o={messageBBCode:top["text"+t],messageFields:{arImages:top["arComFiles"+t],arDocs:top["arComDocs"+t],arFiles:top["arComFilesUf"+t],arDFiles:top["arComDFiles"+t],UrlPreview:top["UrlPreview"+t]}};BX.onCustomEvent(window,"OnUCAfterRecordEdit",["BLOG_"+e,t,o,"EDIT"])};window.__blogOnUCFormAfterShow=function(t,e,o){o=BX.type.isNotEmptyObject(o)&&BX.type.isNotEmptyObject(o.UF)?o.UF:{};BX.onCustomEvent(window,"OnBeforeSocialnetworkCommentShowedUp",["socialnetwork_blog"]);var i={ENTITY_XML_ID:t.currentEntity.ENTITY_XML_ID,ENTITY_TYPE:t.currentEntity.ENTITY_XML_ID.split("_")[0],ENTITY_ID:t.currentEntity.ENTITY_XML_ID.split("_")[1],parentId:t.id[1],comment_post_id:t.currentEntity.ENTITY_XML_ID.split("_")[1],edit_id:t.id[1],act:t.id[1]>0?"edit":"add"};for(var n in i){if(!t.form[n]){t.form.appendChild(BX.create("INPUT",{attrs:{name:n,type:"hidden"}}))}t.form[n].value=i[n]}var r=BX("captcha");if(!!r){BX.ajax.getCaptcha((function(t){BX("captcha_word").value="";BX("captcha_code").value=t["captcha_sid"];BX("captcha").src="/bitrix/tools/captcha.php?captcha_code="+t["captcha_sid"];BX("captcha").style.display=""}))}LHEPostForm.reinitData(SBPC.editorId,e,o)};window.__blogOnUCFormSubmit=function(t,e){e["decode"]="Y"};window.__blogOnUCAfterRecordAdd=function(t,e){if(e.errorMessage&&e.errorMessage.length>0){return}if(BX("blg-post-inform-"+t.substr(5))){var o=BX.findChild(BX("blg-post-inform-"+t.substr(5)),{tag:"span",className:"feed-inform-follow"},true);if(o){var i=o.getAttribute("data-follow")=="Y"?"Y":"N";if(i=="N"){BX.findChild(o,{tagName:"a"}).innerHTML=BX.message("sonetBPFollowY");o.setAttribute("data-follow","Y")}}}};BX.SocialnetworkBlogPostComment={};BX.SocialnetworkBlogPostComment.registerViewAreaList=function(t){if(typeof t=="undefined"||typeof t.containerId=="undefined"||typeof t.className=="undefined"){return}if(BX(t.containerId)){var e=BX.findChildren(BX(t.containerId),{tag:"div",className:t.className},true),o=null;for(var i=0,n=e.length;i<n;i++){if(e[i].id.length>0){o=null;if(BX.type.isNotEmptyString(t.fullContentClassName)){o=BX.findChild(e[i],{className:t.fullContentClassName})}BX.UserContentView.registerViewArea(e[i].id,o?o:null)}}}}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.list/templates/.default/script.min.js?172645624455869";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.list/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.list/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.list/templates/.default/script.map.js";}"*/
(function(){window["UC"]=window["UC"]||{};if(window["FCList"]){return}var quoteData=null,repo={listById:new Map,listByXmlId:new Map};window.FCList=function(t,e){this.exemplarId=t["EXEMPLAR_ID"];this.ENTITY_XML_ID=t["ENTITY_XML_ID"];this.template=t["template"];this.scope="web";this.node={main:t["mainNode"],navigation:t["navigationNode"],navigationLoader:t["navigationNodeLoader"],history:t["nodeForOldMessages"],newComments:t["nodeForNewMessages"],formHolder:t["nodeFormHolder"],writersBlock:BX.findChild(t["nodeFormHolder"],{attrs:{id:["record",this.getXmlId(),"writers-block"].join("-")}},true),writers:BX.findChild(t["nodeFormHolder"],{attrs:{id:["record",this.getXmlId(),"writers"].join("-")}},true)};this.ajax=t["ajax"]||null;this.eventNode=this.node.main;this.form=BX.type.isNotEmptyString(t["FORM_ID"])?UCForm.bindFormToEntity(t["FORM_ID"],this):null;this.order=t["order"];this.mid=parseInt(t["mid"]);this.operationIds=[];this.canCheckVisibleComments=true;this.status="ready";this.msg=this.node.navigation?this.node.navigation.innerHTML:"";this.params=e||{};this.rights=t["rights"];this.DATE_TIME_FORMAT=this.params["DATE_TIME_FORMAT"]||null;this.unreadComments=new Map;this.comments=new Map;this.blankComments=new Map;this.blankCommentsForAjax=new Map;this.bindEvents=[];this.registerNewComment=this.registerNewComment.bind(this);this.registerBlankComment=this.registerBlankComment.bind(this);this.privateEvents={onShowActions:function(t,e){fcShowActions(this.node.main,e,t)}.bind(this),OnUCCommentIsInDOM:this.registerNewComment,OnUCBlankCommentIsInDOM:this.registerBlankComment,onExpandComment:fcCommentExpand};this.windowEvents={OnUCCommentWasPulled:function(t,e,i){if(this.getXmlId()!==i["ENTITY_XML_ID"]||this.isOwnOperationId(i["OPERATION_ID"])){return}this.setOperationId(i["OPERATION_ID"]);this.add(t,e,null,null,{live:true});if(this.params["NOTIFY_TAG"]&&this.params["NOTIFY_TEXT"]){window["UC"]["Informer"].check(t,e,this.params["NOTIFY_TAG"],this.params["NOTIFY_TEXT"])}}.bind(this),OnUCommentWasDeleted:function(t,e,i){if(this.getXmlId()!==i["ENTITY_XML_ID"]||this.isOwnOperationId(i["OPERATION_ID"])||!this.getCommentNode(e[1])){return}this.setOperationId(i["OPERATION_ID"]);BX.hide(this.getCommentNode(e[1]));this.comments.delete(e[1])}.bind(this),OnUCommentWasHidden:function(t,e,i){if(this.getXmlId()!==i["ENTITY_XML_ID"]||this.isOwnOperationId(i["OPERATION_ID"])||!this.getCommentNode(e[1])){return}this.setOperationId(i["OPERATION_ID"]);if(this.rights["MODERATE"]==="Y"||this.rights["MODERATE"]==="ALL"||Number(i["USER_ID"])===Number(BX.message("USER_ID"))){var n=BX.findChild(this.getCommentNode(e[1]),{tagName:"DIV",className:"feed-com-block"});if(BX(n)){BX.addClass(n,"feed-com-block-hidden");BX.removeClass(n,"feed-com-block-approved")}}else{BX.hide(this.getCommentNode(e[1]))}}.bind(this),OnUCUserIsWriting:function(e,i){if(i.sent===true){return}if(this.form!==null&&this!==e){return}if(this.form===null&&e!==this.ENTITY_XML_ID){return}i.sent=true;BX.ajax({url:this.url.activity,method:"POST",data:{AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,COMMENT_EXEMPLAR_ID:this.exemplarId,MODE:"PUSH&PULL",sessid:BX.bitrix_sessid(),sign:t["sign"],PATH_TO_USER:this.params["PATH_TO_USER"],AVATAR_SIZE:this.params["AVATAR_SIZE"],NAME_TEMPLATE:this.params["NAME_TEMPLATE"],SHOW_LOGIN:this.params["SHOW_LOGIN"]}})}.bind(this),OnUCAfterRecordAdd:function(t,e){if(this.ENTITY_XML_ID===e["messageId"][0]){this.add(e["messageId"],e,true,"simple")}}.bind(this),OnUCFormSubmit:BX.delegate((function(t,e,i,n){if(!i||this.form===null&&t!==this.getXmlId()||this.form!==null&&i.currentEntity!==this){return}n["EXEMPLAR_ID"]=this.exemplarId;n["OPERATION_ID"]=this.getOperationId()}),this),OnUCFormResponse:function(t,e,i){},OnUCFormBeforeShow:function(t){var e=0;if(this.form===null&&t.id[0]===this.getXmlId()){e=t.id[1]}else if(this.form!==null&&t.currentEntity===this){e=t.currentEntity.messageId}else{return}if(e<=0){BX.addClass(this.node.formHolder,"feed-com-add-box-outer-form-shown")}if(BX(this.node.writersBlock)){var i=BX("lhe_buttons_"+t.form.id);if(!i||i.style.display==="none"){i=t.form}if(!this.node.writersBlockPointer){this.node.writersBlockPointer=BX.create("DIV",{style:{display:"none"}});this.node.writersBlock.parentNode.insertBefore(this.node.writersBlockPointer,this.node.writersBlock)}i.appendChild(this.node.writersBlock)}}.bind(this),OnUCFormAfterShow:function(t){if(t.id[0]!==this.getXmlId()){return}var e=BX.findParent(this.node.main,{className:"feed-comments-block"});if(e){BX.addClass(e,"feed-comments-block-editor-shown")}}.bind(this),OnUCFormBeforeHide:function(t){if(this.form===null&&(!t.id||t.id[0]!==this.getXmlId())||this.form!==null&&t.currentEntity!==this){return}var e=BX.findParent(this.node.main,{className:"feed-comments-block"});if(e){BX.removeClass(e,"feed-comments-block-editor-shown")}}.bind(this),OnUCFormAfterHide:function(t){if(this.form===null&&(!t.id||t.id[0]!==this.getXmlId())||this.form!==null&&t.currentEntity!==this){return}BX.removeClass(this.node.formHolder,"feed-com-add-box-outer-form-shown");BX.focus(this.node.formHolder.firstChild);if(this.node.writersBlock&&this.node.writersBlockPointer){this.node.writersBlockPointer.parentNode.insertBefore(this.node.writersBlock,this.node.writersBlockPointer)}}.bind(this),OnUCUsersAreWriting:function(t,e,i,n,s){if(this.getXmlId()===t){this.addWriter(e,i,n,s)}}.bind(this),OnUCCommentRecalculate:function(t){if(this.getXmlId()!==t){return}var e;var i=BX.findChild(this.node.main,{attrs:{"bx-mpl-xml-id":this.ENTITY_XML_ID}},false,true);for(e=0;e<i.length;e++){this.recalcMoreButtonComment(i[e].getAttribute("bx-mpl-entity-id"))}}.bind(this),"BX.BXUrlPreview.onImageLoaded":function(t){if(!BX.type.isPlainObject(t)||!BX.type.isDomNode(t.imageNode)){return}var e=BX.findParent(t.imageNode,{className:"feed-com-block-cover"});if(BX.type.isDomNode(e)){this.recalcMoreButtonComment(e.getAttribute("bx-mpl-entity-id"))}}.bind(this)};if(this.params["NOTIFY_TAG"]&&this.params["NOTIFY_TEXT"]&&window["UC"]["Informer"]){window["UC"]["InformerTags"][this.params["NOTIFY_TAG"]]=window["UC"]["InformerTags"][this.params["NOTIFY_TAG"]]||[]}else{this.params["NOTIFY_TAG"]=null;this.params["NOTIFY_TEXT"]=null}this.initialize();this.checkHash();this.registerComments();BX.onCustomEvent(this.eventNode,"OnUCInitialized",[this.exemplarId]);BX.addCustomEvent(this.eventNode,"OnUCInitialized",this.destroy.bind(this));this.windowEvents["OnUCInitialized"]=this.checkAndDestroy.bind(this);BX.Event.EventEmitter.incrementMaxListeners("OnUCInitialized");BX.addCustomEvent(window,"OnUCInitialized",this.windowEvents["OnUCInitialized"]);BX.ready(function(){setTimeout(function(){BX.onCustomEvent(window,"OnUCHasBeenInitialized",[this.ENTITY_XML_ID,this])}.bind(this),100)}.bind(this));repo.listById.set(this.exemplarId,this);repo.listByXmlId.set(this.getXmlId(),this);return this};window.FCList.prototype={getId:function(){return this.exemplarId},getXmlId:function(){return this.ENTITY_XML_ID},getOperationId:function(){var t=BX.util.getRandomString(20);this.operationIds.push(t);return t},setOperationId:function(t){if(BX.type.isNotEmptyString(t)){this.operationIds.push(t)}},isOwnOperationId:function(t){for(var e=0;e<this.operationIds.length;e++){if(this.operationIds[e]===t){return true}}return false},initialize:function(){this.checkVisibleComments=this.checkVisibleComments.bind(this);this.recalcMoreButtonComment=this.recalcMoreButtonComment.bind(this);this.sendCommentAsBlank=this.sendCommentAsBlank.bind(this);BX.Event.EventEmitter.incrementMaxListeners(scrSpy,"onRead");BX.addCustomEvent(scrSpy,"onRead",this.checkVisibleComments);scrSpy.watchNode(this.node.main);this.initNavigationEvents();this.initPostFormActivity();for(var t=0;t<this.bindEvents.length;t++){BX.bind(this.bindEvents[t][0],this.bindEvents[t][1],this.bindEvents[t][2])}for(t in this.privateEvents){if(this.privateEvents.hasOwnProperty(t)){BX.Event.EventEmitter.incrementMaxListeners(this.eventNode,t);BX.addCustomEvent(this.eventNode,t,this.privateEvents[t])}}if(!BX.type.isBoolean(this.params["USE_LIVE"])||this.params["USE_LIVE"]){for(t in this.windowEvents){if(this.windowEvents.hasOwnProperty(t)){BX.Event.EventEmitter.incrementMaxListeners(t);BX.addCustomEvent(window,t,this.windowEvents[t])}}}if(BX.DD&&!this.node.main.hasAttribute("dropzone")){new BX.DD.dropFiles(this.node.main)}},initNavigationEvents:function(){if(!BX(this.node.navigation)){return}this.bindEvents.unshift([this.node.navigation,"click",function(t){BX.eventCancelBubble(t);t.preventDefault();this.getPagenavigation();return false}.bind(this)])},initPostFormActivity:function(){this.privateEvents["onAct"]=this.act.bind(this);if(this.params["SHOW_POST_FORM"]!=="Y"){return}this.privateEvents["onReply"]=this.reply.bind(this);this.privateEvents["onQuote"]=this.quote.bind(this);this.hideWriter=this.hideWriter.bind(this);this.quoteShow=this.quoteShow.bind(this);this.bindEvents.unshift([this.eventNode,"mouseup",this.privateEvents["onQuote"]]);var t=0;var e=function(e){if(e&&e.currentTarget.contains(e.relatedTarget)){return}if(t>0){clearTimeout(t);t=0}}.bind(this);var i=function(){e();this.reply.apply(this,arguments)}.bind(this);var n=function(){if(t<=0){t=setTimeout(i,200)}}.bind(this);this.bindEvents.unshift([this.node.main,"dragover",n]);this.bindEvents.unshift([this.node.main,"dragenter",n]);this.bindEvents.unshift([this.node.main,"dragleave",e]);this.bindEvents.unshift([this.node.main,"dragexit",e]);this.bindEvents.unshift([this.node.main,"drop",e])},url:{activity:"/bitrix/components/bitrix/main.post.list/activity.php"},destroy:function(){BX.removeCustomEvent(scrSpy,"onRead",this.checkVisibleComments);var t,e;while((e=this.bindEvents.pop())&&e){BX.unbindAll(e[0]);delete e[0];delete e[2]}for(t in this.privateEvents){if(this.privateEvents.hasOwnProperty(t)){BX.removeCustomEvent(this.eventNode,t,this.privateEvents[t]);BX.Event.EventEmitter.decrementMaxListeners(this.eventNode,t);this.privateEvents[t]=null}}this.privateEvents=null;for(t in this.windowEvents){if(this.windowEvents.hasOwnProperty(t)){BX.removeCustomEvent(window,t,this.windowEvents[t]);this.windowEvents[t]=null;BX.Event.EventEmitter.decrementMaxListeners(t)}}this.windowEvents=null;for(t in this.node){if(this.node.hasOwnProperty(t)){this.node[t]=null}}this.unreadComments.clear();this.comments.clear();BX.onCustomEvent(window,"OnUCHasBeenDestroyed",[this.ENTITY_XML_ID,this]);repo.listById.delete(this.exemplarId);if(repo.listByXmlId.get(this.ENTITY_XML_ID)===this){repo.listByXmlId.delete(this.ENTITY_XML_ID)}},checkAndDestroy:function(t){if(this.exemplarId===t||!document.body.contains(this.eventNode)){this.destroy()}},quotePopup:null,quoteCheck:function(){var t="";var e;var i=null;if(window.getSelection){e=window.getSelection();t=e.toString()}else if(document.selection){e=document.selection;t=e.createRange().text}if(t!==""){var n=BX.findParent(e.focusNode,{tagName:"DIV",className:"feed-com-block-cover"},this.node.main);var s=BX.findParent(e.anchorNode,{tagName:"DIV",className:"feed-com-block-cover"},this.node.main);if(n!==s||BX(n)&&!n.hasAttribute("id")){t=""}else if(BX(n)){var o=BX(n.getAttribute("id").replace(/\-cover$/,"-actions-reply"));if(o){i={id:parseInt(o.getAttribute("bx-mpl-author-id")),name:o.getAttribute("bx-mpl-author-name"),gender:o.getAttribute("bx-mpl-author-gender")}}}}if(t===""){if(this.quotePopup){this.quotePopup.hide()}return false}return{text:t,author:i}},quoteShow:function(t,e){e=e||this.quoteCheck()||{};if(!BX.type.isNotEmptyString(e["text"])){return}quoteData=e;if(this.quotePopup==null){this.__quoteShowClick=function(){if(this.form){BX.onCustomEvent(this.form,"onQuote",[this,e["author"],e["text"]])}else{BX.onCustomEvent(window,"OnUCQuote",[this.ENTITY_XML_ID,e["author"],e["text"],true])}}.bind(this);this.__quoteShowHide=function(){quoteData=null;BX.removeCustomEvent(this.quotePopup,"onQuote",this.__quoteShowClick);BX.removeCustomEvent(this.quotePopup,"onHide",this.__quoteShowHide);this.quotePopup=null}.bind(this);this.quotePopup=new MPLQuote;BX.addCustomEvent(this.quotePopup,"onQuote",this.__quoteShowClick);BX.addCustomEvent(this.quotePopup,"onHide",this.__quoteShowHide)}this.quotePopup.show(t)},displayPagenavigation:function(t,e){var i;var n=0;var s;var o=this.node.history;t=t=="hide"?"hide":"show";if(t=="hide"){i=parseInt(this.node.history.offsetHeight);s=i/2e3;s=s<.3?.3:s>.5?.5:s;o.style.overflow="hidden";new BX["easing"]({duration:s*1e3,start:{height:i,opacity:100},finish:{height:n,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){o.style.maxHeight=t.height+"px";o.style.opacity=t.opacity/100},complete:BX.proxy((function(){o.style.cssText="";o.style.display="none";BX.onCustomEvent(this,"OnUCListWasHidden",[this,[],o])}),this)}).animate()}else{i=parseInt(e||20);o.style.display="block";o.style.overflow="hidden";o.style.maxHeight=i;n=parseInt(this.node.history.offsetHeight);s=(n-i)/(2e3-i);s=s<.3?.3:s>.8?.8:s;new BX["easing"]({duration:s*1e3,start:{height:i,opacity:i>0?100:0},finish:{height:n,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){o.style.maxHeight=t.height+"px";o.style.opacity=t.opacity/100},complete:BX.proxy((function(){o.style.cssText="";o.style.maxHeight="none";BX.onCustomEvent(this,"OnUCListWasShown",[this,[],o])}),this)}).animate()}},getPagenavigation:function(){if(this.status=="done"){if(this.node.navigation.getAttribute("bx-visibility-status")=="visible"){this.displayPagenavigation("hide");BX.adjust(this.node.navigation,{attrs:{"bx-visibility-status":"none"},html:this.msg})}else{this.displayPagenavigation("show");BX.adjust(this.node.navigation,{attrs:{"bx-visibility-status":"visible"},html:BX.message("BLOG_C_HIDE")})}}else if(this.status=="ready"){this.sendPagenavigation()}return false},sendPagenavigation:function(){this.status="busy";BX.addClass(this.node.navigation,"feed-com-all-hover");var t={AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,EXEMPLAR_ID:this.exemplarId,MODE:"LIST",FILTER:this.order=="ASC"?{">ID":this.mid}:{"<ID":this.mid},sessid:BX.bitrix_sessid()},e=BX.util.htmlspecialcharsback(this.node.navigation.getAttribute("href"));e=e.indexOf("#")!==-1?e.substr(0,e.indexOf("#")):e;var i={url:e,data:t};BX.onCustomEvent(this,"OnUCListHasToBeEnlarged",[this,i]);e=i.url;t=i.data;t.scope=this.scope;var n=this.buildPagenavigation.bind(this);var s=this.completePagenavigation.bind(this);if(this.ajax["navigateComment"]===true){e=e.indexOf("?")>=0?e.substr(e.indexOf("?")+1):"";e.split("&").forEach((function(e){var i=e.split("=");t[i[0]]=i[1]}));BX.ajax.runComponentAction(this.ajax.componentName,"navigateComment",{mode:"class",data:t,signedParameters:this.ajax.params}).then(n,s)}else{BX.adjust(this.node.navigationLoader,{style:{display:"flex"}});BX.ajax({url:e+(e.indexOf("?")!==-1?"&":"?")+BX.ajax.prepareData(t),method:"GET",dataType:"json",data:"",onsuccess:n,onfailure:s})}},buildPagenavigation:function(t){if(t["status"]!=="success"){return this.completePagenavigation()}this.status="ready";this.wait("hide");BX.adjust(this.node.navigationLoader,{style:{display:"none"}});BX.removeClass(this.node.navigation,"feed-com-all-hover");var e=BX.processHTML(t["messageList"],false);var i=this.node.history.offsetHeight;var n=BX.create("DIV",{html:e.HTML});if(this.order==="ASC"||!this.node.history.firstChild){this.node.history.appendChild(n)}else{this.node.history.insertBefore(n,this.node.history.firstChild)}BX.onCustomEvent(window,"OnUCFeedChanged",[[this.ENTITY_XML_ID,this.mid]]);this.displayPagenavigation("show",i);if(BX.type.isNotEmptyString(t["navigation"])){var s=BX.create("DIV",{html:t["navigation"]}).firstChild;BX.adjust(this.node.navigation,{attrs:{href:s.getAttribute("href"),"bx-mpl-comments-count":s.getAttribute("bx-mpl-comments-count")},html:s.innerHTML})}else{BX.adjust(this.node.navigation,{attrs:{href:"#","bx-visibility-status":"visible","bx-mpl-comments-count":0},html:BX.message("BLOG_C_HIDE"),events:{click:function(t){BX.eventCancelBubble(t);t.preventDefault();return false}}});this.status="done"}var o=0;var a=function(){o++;if(o>100){return}if(n.childNodes.length<=0){setTimeout(a,500);return}BX.ajax.processScripts(e.SCRIPT);BX.onCustomEvent(this,"OnUCListWasBuilt",[this,t,n])}.bind(this);setTimeout(a,500)},completePagenavigation:function(){this.status="done";BX.removeClass(this.node.navigation,"feed-com-all-hover");this.wait("hide");BX.adjust(this.node.navigationLoader,{style:{display:"none"}})},getCommentsCount:function(){var t=0;if(BX(this.node.navigation)){t=Number(this.node.navigation.getAttribute("bx-mpl-comments-count"))}return this.comments.size+t},wait:function(t){t=t==="show"?"show":"hide";return t},quote:function(t,e){if(t.hasOwnProperty("UCDone")){return}t["UCDone"]=true;setTimeout(this.quoteShow,50,t,e)},reply:function(t){var e={id:undefined,name:undefined};if(BX.type.isElementNode(t)){e.id=t.getAttribute("bx-mpl-author-id");e.name=t.getAttribute("bx-mpl-author-name")}else if(BX.type.isPlainObject(t)){e.id=t.id;e.name=t.name}if(this.form){BX.onCustomEvent(this.form,"onReply",[this,e])}else{var i={caught:false};BX.onCustomEvent(window,"OnUCReply",[this.ENTITY_XML_ID,e.id,e.name,true,i])}},getPlaceholder:function(t){if(!this.node["placeholderFor"+t]||!document.body.contains(this.node["placeholderFor"+t])){this.node["placeholderFor"+t]=BX.findChild(this.node.main,{attrs:{id:["record",this.getXmlId(),t,"placeholder"].join("-")}},true)}return this.node["placeholderFor"+t]},addWriter:function(t,e,i,n){if(!this.node.writersBlock||!this.node.writers){return}t=t>0?t:0;if(t<=0){return}var s=["writer",this.exemplarId,t].join("-");var o=BX(s);var a=setTimeout(this.hideWriter,n>0?n:40500,t);if(o){clearTimeout(o.getAttribute("bx-check-timeout"))}else{o=BX.create("DIV",{attrs:{id:s,className:"feed-com-avatar ui-icon ui-icon-common-user ",title:e},children:[i&&i.length>0?BX.create("I",{style:{background:"url('"+i+"')",backgroundSize:"cover"}}):null]});this.node.writers.appendChild(o)}o.setAttribute("bx-check-timeout",a+"");BX.show(this.node.writersBlock);if(this.objAnswering&&this.objAnswering.name!=="show"){this.objAnswering.stop()}if(!this.objAnswering||this.objAnswering.name!=="show"){this.node.writersBlock.style.display="inline-block";this.objAnswering=new BX["easing"]({duration:500,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){this.node.writersBlock.style.opacity=t.opacity/100}.bind(this)});this.objAnswering.name="show";this.objAnswering.animate()}},hideWriter:function(t){if(!this.node.writers||!this.node.writersBlock){return}var e=["writer",this.exemplarId,t].join("-");var i=BX(e);if(this.node.writers.childNodes.length>1){new BX["easing"]({duration:500,start:{opacity:100},finish:{opacity:0},transition:BX["easing"].makeEaseOut(BX["easing"].transitions.quart),step:function(t){if(i)i.style.opacity=t.opacity/100},complete:function(){if(i&&i.parentNode){i.parentNode.removeChild(i)}}.bind(this)}).animate()}else{if(this.objAnswering&&this.objAnswering.name!=="hide"){this.objAnswering.stop()}if(!this.objAnswering||this.objAnswering.name!=="hide"){this.objAnswering=new BX["easing"]({duration:500,start:{opacity:100},finish:{opacity:0},transition:BX["easing"].makeEaseOut(BX.easing.transitions.quart),step:function(t){this.node.writersBlock.style.opacity=t.opacity/100}.bind(this),complete:function(){this.node.writersBlock.style.display="none";if(i&&i.parentNode){i.parentNode.removeChild(i)}}.bind(this)});this.objAnswering.name="hide";this.objAnswering.animate()}}},getCommentNode:function(t){if(!this.node[t]||!document.body.contains(this.node[t])){this.node[t]=BX.findChild(this.node.main,{attrs:{id:["record",this.getXmlId(),t,"cover"].join("-")}},true)}return this.node[t]},add:function(t,e,i,n,s){if(!t||!t[1]||!BX.type.isPlainObject(e)){return false}var o=e["AUTHOR"]||(e["messageFields"]?e["messageFields"]["AUTHOR"]:null);if(o){this.hideWriter(o["ID"])}var a=this.getCommentNode(t[1]);if(!a&&t[1]<this.mid){return false}var r=t.join("-");var d=e["message"]||window.fcParseTemplate({messageFields:e["messageFields"]},{EXEMPLAR_ID:this.exemplarId,RIGHTS:this.rights,DATE_TIME_FORMAT:this.DATE_TIME_FORMAT,VIEW_URL:this.params.VIEW_URL,EDIT_URL:this.params.EDIT_URL,MODERATE_URL:this.params.MODERATE_URL,DELETE_URL:this.params.DELETE_URL,AUTHOR_URL:this.params.AUTHOR_URL,AUTHOR_URL_PARAMS:this.params.AUTHOR_URL_PARAMS,NAME_TEMPLATE:this.params.NAME_TEMPLATE,SHOW_LOGIN:this.params.SHOW_LOGIN,CLASSNAME:BX.type.isPlainObject(s)&&s.live?"feed-com-block-live":""},this.getTemplate());var l=BX.processHTML(d,false);var h;var m=this.node.newComments;var c=["MODERATE","EDIT","DELETE"];var u=false;var p=0;for(var E in c){if(c.hasOwnProperty(E)&&this.rights[c[E]]==="OWNLAST"){u=true;break}}if(u){h=m.lastChild&&BX.hasClass(m.lastChild,"feed-com-block-cover")?[m.lastChild]:[];var f;var T;if(this.addCheckPreviousNodes!==true){h=BX.findChildren(this.node.main,{tagName:"DIV",className:"feed-com-block-cover"},false)||[];h.concat(BX.findChildren(m,{tagName:"DIV",className:"feed-com-block-cover"},false)||[]);this.addCheckPreviousNodes=true}while((f=h.pop())&&f){T=BX.findChild(f,{attrs:{id:f.id.replace("-cover","-actions")}},true);if(T){if(this.rights["EDIT"]==="OWNLAST"){T.setAttribute("bx-mpl-edit-show","N")}if(this.rights["MODERATE"]==="OWNLAST"){T.setAttribute("bx-mpl-moderate-show","N")}if(this.rights["DELETE"]==="OWNLAST"){T.setAttribute("bx-mpl-delete-show","N")}}}}var X=false;if(!a){a=BX.create("DIV",{attrs:{id:"record-"+r+"-cover",className:"feed-com-block-cover","bx-mpl-xml-id":this.getXmlId(),"bx-mpl-entity-id":t[1],"bx-mpl-read-status":Number(o["ID"])!==Number(BX.message("USER_ID"))?"new":"old","bx-mpl-block":"main"},style:{opacity:0,height:0,overflow:"hidden",marginBottom:0},html:l.HTML});m.appendChild(a);X=true}else{var B=BX.create("DIV",{attrs:{id:"record-"+r+"-cover",className:"feed-com-block-cover"},style:{display:"none"},html:l.HTML});var I=a;var A=BX.findChild(I,{tag:"div",className:"feed-com-text-inner"},true);var g=A&&A.classList.contains("feed-com-text-inner-expanded");if(g){A=BX.findChild(B,{tag:"div",className:"feed-com-text-inner"},true);if(A){A.classList.add("feed-com-text-inner-expanded")}}a.parentNode.insertBefore(B,a);a.removeAttribute("id");p=a.scrollHeight;BX.hide(a);BX.show(B);a=B;this.node[t[1]]=a;setTimeout((function(){BX.remove(I)}),1e3)}if(n!=="simple"&&BX.Type.isUndefined(window.BXMobileApp)&&!(window.top===window&&BX.getClass("BX.SidePanel.Instance")&&BX.SidePanel.Instance.isOpen())&&!(BX.type.isNotEmptyObject(BXRL)&&BX.type.isNotEmptyObject(BXRL.render)&&BX.type.isDomNode(BXRL.render.reactionsPopup)&&!BXRL.render.reactionsPopup.classList.contains("feed-post-emoji-popup-invisible"))){var v=BX.pos(a);var _=BX.GetWindowScrollPos();var b=BX.GetWindowInnerSize();new BX["easing"]({duration:1e3,start:{opacity:X?0:100,height:p},finish:{opacity:100,height:a.scrollHeight+10},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){a.style.height=t.height+"px";a.style.opacity=t.opacity/100;if(_.scrollTop>0&&v.top<_.scrollTop+b.innerHeight){window.scrollTo(0,_.scrollTop+t.height)}},complete:function(){a.style.cssText="";BX.onCustomEvent(this,"OnUCRecordWasShown",[this.ENTITY_XML_ID,r,a])}.bind(this)}).animate()}else{new BX["easing"]({duration:500,start:{opacity:X?0:100,height:p},finish:{opacity:100,height:a.scrollHeight+10},transition:BX.easing.makeEaseOut(BX.easing.transitions.cubic),step:function(t){a.style.height=t.height+"px";a.style.opacity=t.opacity/100},complete:BX.proxy((function(){a.style.cssText="";BX.onCustomEvent(this,"OnUCRecordWasShown",[this.ENTITY_XML_ID,r,a])}),this)}).animate()}var C=0,w=function(){if(100<++C){return}if(this.getCommentNode(t[1]).childNodes.length>0){BX.ajax.processScripts(l.SCRIPT);if(this.params["BIND_VIEWER"]==="Y"&&BX["viewElementBind"]){BX.viewElementBind(this.getCommentNode(t[1]),{},(function(t){return BX.type.isElementNode(t)&&(t.getAttribute("data-bx-viewer")||t.getAttribute("data-bx-image"))}))}}else{setTimeout(w,500)}BX.onCustomEvent(window,"OnUCRecordHasDrawn",[this.ENTITY_XML_ID,t,e["messageFields"]||e]);BX.onCustomEvent(window,"OnUCCommentWasAdded",[this.ENTITY_XML_ID,t,e["messageFields"]||e]);BX.onCustomEvent(window,"OnUCFeedChanged",[t])}.bind(this);setTimeout(w,500);return true},act:function(url,id,act){if(this.ajax["processComment"]!==true&&BX.type.isNotEmptyString(url)&&url.substr(0,1)!=="/"){try{eval(url);return false}catch(t){}if(BX.type.isFunction(url)){url(this,id,act);return false}}this.showWait(id);id=parseInt(id);var data={sessid:BX.bitrix_sessid(),MODE:"RECORD",NOREDIRECT:"Y",AJAX_POST:"Y",FILTER:{ID:id},ACTION:act==="EDIT"?"GET":act,ID:id,ENTITY_XML_ID:this.ENTITY_XML_ID,OPERATION_ID:this.getOperationId(),EXEMPLAR_ID:this.exemplarId,scope:this.scope};url=url.indexOf("#")!==-1?url.substr(0,url.indexOf("#")):url;var onsuccess=function(t){this.closeWait(id);if(t["status"]==="error"){this.showError(id,t["message"]||"Unknown error.");return}var e=this.getCommentNode(id);if(e){if(act==="DELETE"){BX.hide(e);this.comments.delete(id.toString());BX.onCustomEvent(window,"OnUCommentWasDeleted",[this.ENTITY_XML_ID,[this.ENTITY_XML_ID,id],t])}else if(act!=="EDIT"&&!!t["message"]){var i=BX.processHTML(t["message"],false);e.innerHTML=i.HTML;var n=0,s=function(){n++;if(n<100){if(e.childNodes.length>0)BX.ajax.processScripts(i.SCRIPT);else BX.defer(s)()}};BX.defer(s)();t["okMessage"]=""}}if(this.form!==null){BX.onCustomEvent(this.form,"onEdit",[this,id,t,act])}else{BX.onCustomEvent(window,"OnUCAfterRecordEdit",[this.ENTITY_XML_ID,id,t,act])}BX.onCustomEvent(window,"OnUCFeedChanged",[id])}.bind(this);var onfailure=function(t){this.closeWait(id);var e=t;if(BX.type.isNotEmptyObject(t)){if(BX.type.isArray(t.errors)&&BX.type.isNotEmptyString(t.errors[0].message)){e=t.errors[0].message}else if(BX.type.isNotEmptyObject(t.data)&&BX.type.isNotEmptyString(t.data.message)){e=t.data.message}}this.showError(id,e)}.bind(this);if(this.ajax["processComment"]===true){BX.ajax.runComponentAction(this.ajax.componentName,"processComment",{mode:"class",data:data,signedParameters:this.ajax.params}).then(onsuccess,onfailure)}else{BX.ajax({method:"GET",url:url+(url.indexOf("?")!==-1?"&":"?")+BX.ajax.prepareData(data),data:"",dataType:"json",onsuccess:onsuccess,onfailure:onfailure})}},showError:function(t,e){if(this.errorWindow){this.errorWindow.close()}this.errorWindow=new BX.PopupWindow("bx-comments-error",null,{autoHide:false,zIndex:200,overlay:{opacity:50,backgroundColor:"#000000"},buttons:[new BX.PopupWindowButton({text:BX.message("MPL_CLOSE"),events:{click:BX.delegate((function(){if(this.errorWindow)this.errorWindow.close()}),this)}})],closeByEsc:true,titleBar:{content:BX.create("span",{props:{className:"popup-window-titlebar-text feed-error-title"},html:'<div class="feed-error-icon"></div>'+BX.message("MPL_ERROR_OCCURRED")})},closeIcon:true,contentColor:"white",content:'<div class="feed-error-block">'+e+"</div>"});this.errorWindow.show()},checkHash:function(){if(repo["hashHasBeenFound"]===true){return}var t=/%23com(\d+)/gi.exec(location.href);var e=parseInt(location.hash&&location.hash.indexOf("#com")>=0?location.hash.replace("#com",""):t?t[1]:0);if(e>0){var i=BX.findChild(this.node.main,{attrs:{id:"record-"+[this.ENTITY_XML_ID,e].join("-")+"-cover"}},true,false);if(i){var n=BX.findParent(i,{attrs:{"data-bx-role":"collapsed-block"}},this.node.main);if(n){var s=n.querySelector("input[type=checkbox]");if(!s.checked){s.click(true)}}repo["hashHasBeenFound"]=true;var o=BX.pos(i);window.scrollTo(0,o["top"]);var a=BX.findChild(i,{className:"feed-com-main-content"},true,false);BX.removeClass(a,"feed-com-block-pointer-to-new feed-com-block-new");BX.addClass(a,"feed-com-block-pointer")}}},registerComments:function(){var t;var e=BX.findChild(this.node.main,{tag:"DIV",attrs:{"bx-mpl-block":"main","bx-mpl-xml-id":this.ENTITY_XML_ID}},true,true);for(t=0;t<e.length;t++){if(e[t].getAttribute("bx-mpl-blank-status")==="blank"){this.blankComments.set(e[t].getAttribute("bx-mpl-entity-id"),e[t]);scrSpy.set([this.getXmlId(),e[t].getAttribute("bx-mpl-entity-id")].join("-"))}else{if(e[t].getAttribute("bx-mpl-read-status")==="new"){this.unreadComments.set(e[t].getAttribute("bx-mpl-entity-id"),e[t]);scrSpy.set([this.getXmlId(),e[t].getAttribute("bx-mpl-entity-id")].join("-"))}this.recalcMoreButtonComment(e[t].getAttribute("bx-mpl-entity-id"));this.comments.set(e[t].getAttribute("bx-mpl-entity-id"),[])}}},registerBlankComment:function(t,e){if(e!==true){setTimeout(this.registerBlankComment,1e3,t,true);return}var i=this.getCommentNode(t);if(!i||this.comments.has(t)||this.blankComments.has(t)){return}this.blankComments.set(t,i);scrSpy.set([this.getXmlId(),t].join("-"))},registerNewComment:function(t,e){if(e!==true){setTimeout(this.registerNewComment,1e3,t,true);return}var i=this.getCommentNode(t);if(!i||this.comments.has(t)){return}this.comments.set(t,[]);if(i.getAttribute("bx-mpl-read-status")==="new"){scrSpy.set([this.getXmlId(),t].join("-"),i);this.unreadComments.set(t,i)}this.recalcMoreButtonComment(t)},recalcMoreButtonComment:function(t){var e=this.getCommentNode(t);if(!BX(e)){return}var i=e.bodyBlock||BX.findChild(e,{attrs:{"bx-mpl-block":"body"}},true);if(!i){return}e.bodyBlock=i;var n=e.textBlock||BX.findChild(i,{attrs:{"bx-mpl-block":"text"}},true);if(!n){return}e.textBlock=n;var s=e.moreButtonBlock||BX.findChild(e,{attrs:{"bx-mpl-block":"more-button"}},true);e.moreButtonBlock=s;var o=BX.pos(i);var a=BX.pos(n);if(o.height>=a.height){s.style.display="none"}else if(s.style.display!=="block"){s.style.display="block"}var r=null;var d=BX.findChildren(i,{attr:{"data-bx-onload":"Y"}},true);var l=function(){this.recalcMoreButtonComment(t)}.bind(this);if(BX.type.isArray(d)){for(r=0;r<d.length;r++){d[r].addEventListener("load",l);d[r].setAttribute("data-bx-onload","N")}}var h=i.querySelectorAll("video");for(r=0;r<h.length;r++){h[r].addEventListener("loadedmetadata",l)}if(!e.hasOwnProperty("__boundOnForumSpoilerToggle")){e.__boundOnForumSpoilerToggle=true;BX.addCustomEvent(e,"onForumSpoilerToggle",l)}},checkVisibleComments:function(t){if(!this.canCheckVisibleComments){return}var e=this.getVisibleCommentIds(this.unreadComments,t);var i;while(i=e.shift()){this.markCommentAsRead(i)}window.fclistdebug=true;e=this.getVisibleCommentIds(this.blankComments,t);while(i=e.shift()){this.markCommentAsBlank(i)}},getVisibleCommentIds:function(t,e){var i=[];if(t.size<=0){return i}var n=BX.pos(this.node.main);if(n.top>e.bottom||n.bottom<e.top||n.top===0&&n.bottom===0){return i}var s=t.keys();var o=s.next();var a;while(o.done!==true){a=t.get(o.value);if(a.offsetWidth||a.offsetHeight||a.getClientRects().length){n=a.pos||BX.pos(a);a.pos=n;if(e.top<=n.top&&n.top<=e.bottom&&a.offsetParent!==null){i.push(o.value)}}o=s.next()}return i},markCommentAsRead:function(t){if(!this.unreadComments.has(t)){return}var e=this.unreadComments.get(t);e.setAttribute("bx-mpl-read-status","old");this.unreadComments.delete(t);scrSpy.unset([this.getXmlId(),t].join("-"));if(this.node.newComments.contains(e)){this.sendCommentAsRead(t)}BX.removeClass(e,"comment-new-answer");if(this.__checkNodeCorner!==true){this.__checkNodeCorner=true;var i=BX.findChild(this.node.main,{className:"feed-com-corner"});if(i){BX.addClass(i,"feed-post-block-corner-fade")}}var n=BX.findChild(e,{className:"feed-com-main-content"},true,false);if(n){BX.removeClass(n,"feed-com-block-pointer-to-new feed-com-block-new");BX.addClass(n,"feed-com-block-read")}var s=BX.findChild(e,{className:"feed-com-block"},true);BX.onCustomEvent(window,"OnUCCommentWasRead",[this.getXmlId(),[this.getXmlId(),t],{live:s&&s.classList.contains("feed-com-block-live"),new:!n||!n.classList.contains("feed-com-block-old")}])},sendCommentAsRead:function(t){if(this.ajax["readComment"]!==true){return}if(!this.sendCommentAsReadData){this.sendCommentAsReadData={mid:0,timeoutId:0,func:function(){BX.unbind(window,"beforeunload",this.sendCommentAsReadData.func);BX.removeCustomEvent(window,"onHidePageBefore",this.sendCommentAsReadData.func);this.sendCommentAsReadData.timeoutId=0;BX.ajax.runComponentAction(this.ajax.componentName,"readComment",{mode:"class",data:{ID:this.sendCommentAsReadData.mid},signedParameters:this.ajax.params})}.bind(this)}}if(this.sendCommentAsReadData.mid>t){return}this.sendCommentAsReadData.mid=t;if(this.sendCommentAsReadData.timeoutId<=0){BX.bind(window,"beforeunload",this.sendCommentAsReadData.func);BX.addCustomEvent(window,"onHidePageBefore",this.sendCommentAsReadData.func);this.sendCommentAsReadData.timeoutId=setTimeout(this.sendCommentAsReadData.func,6e3)}},markCommentAsBlank:function(t){if(!this.blankComments.has(t)){return}var e=this.blankComments.get(t);var i=e.parentNode;if(i&&!i.bxwaiter){fcShowWait(i)}this.blankComments.delete(t);scrSpy.unset([this.getXmlId(),t].join("-"));this.blankCommentsForAjax.set(t,e);setTimeout(this.sendCommentAsBlank,1e3)},sendCommentAsBlank:function(){if(this.ajax["getComment"]!==true||this.blankCommentsForAjax.size<=0){return}var t=Array.from(this.blankCommentsForAjax.keys());var e=new Map(this.blankCommentsForAjax);this.blankCommentsForAjax.clear();var i=function(t){e.forEach(function(e,i){fcCloseWait(e.parentNode);var n=t["messageList"][i];if(!n){e.parentNode.removeChild(e)}else{var s=BX.processHTML(n["message"],false);e.innerHTML=s.HTML;var o=function(t){if(e.childNodes.length>0){BX.ajax.processScripts(s.SCRIPT)}else if(t<100){setTimeout(o,500,t+1)}};o(0)}}.bind(this))}.bind(this);BX.ajax.runComponentAction(this.ajax.componentName,"getComment",{mode:"class",data:{sessid:BX.bitrix_sessid(),MODE:"RECORDS",NOREDIRECT:"Y",AJAX_POST:"Y",FILTER:{ID:t},ACTION:"GET",ID:t,ENTITY_XML_ID:this.ENTITY_XML_ID,OPERATION_ID:this.getOperationId(),EXEMPLAR_ID:this.exemplarId,scope:this.scope},signedParameters:this.ajax.params}).then(i,i)},getTemplate:function(){return this.template},showWait:function(t){fcShowWait(BX("record-"+this.ENTITY_XML_ID+"-"+t+"-actions"))},closeWait:function(t){fcCloseWait(BX("record-"+this.ENTITY_XML_ID+"-"+t+"-actions")||null)}};window.FCList.getQuoteData=function(){return quoteData};window.FCList.getInstance=function(t,e){if(!repo.listByXmlId.has(t["ENTITY_XML_ID"])&&e!==undefined){new window.FCList(t,e)}return repo.listByXmlId.get(t["ENTITY_XML_ID"])};var lastWaitElement=null;var fcShowWait=function(t){if(t&&!BX.type.isElementNode(t)){t=null}t=t||this;if(BX.type.isElementNode(t)){BX.defer((function(){t.disabled=true}))();var e=BX.findParent(t,BX.is_relative);t.bxwaiter=(e||document.body).appendChild(BX.create("DIV",{props:{className:"feed-com-loader"},style:{position:"absolute"}}));lastWaitElement=t;return t.bxwaiter}return true};var fcCloseWait=function(t){if(t&&!BX.type.isElementNode(t)){t=null}t=t||lastWaitElement||this;if(BX.type.isElementNode(t)){if(t.bxwaiter&&t.bxwaiter.parentNode){t.bxwaiter.parentNode.removeChild(t.bxwaiter);delete t.bxwaiter}t.disabled=false;if(lastWaitElement==t)lastWaitElement=null}};var fcShowActions=function(t,e,i){var n=[];var s=BX.util.getRandomString(20);if(i.getAttribute("bx-mpl-view-show")=="Y"){n.push({text:BX.message("MPL_MES_HREF"),href:i.getAttribute("bx-mpl-view-url").replace(/\\#(.+)$/gi,"")+"#com"+e,target:"_top"});n.push({html:'<span id="record-popup-'+s+'-link-text">'+BX.message("B_B_MS_LINK")+"</span>"+'<span id="record-popup-'+s+'-link-icon-animate" class="comment-menu-link-icon-wrap">'+'<span class="comment-menu-link-icon" id="record-popup-'+s+'-link-icon-done" style="display: none;">'+"</span>"+"</span>",onclick:function(){var t="record-popup-"+s+"-link",n=i.getAttribute("bx-mpl-view-url").replace(/#(.+)$/gi,"")+"#com"+e,o=BX(t+"-text"),a=BX(t+"-icon-done");n=(n.indexOf("http")<0?location.protocol+"//"+location.host:"")+n;if(BX.clipboard.isCopySupported()){if(o&&o.getAttribute("data-block-click")=="Y"){return}BX.clipboard.copy(n);if(o&&a){a.style.display="inline-block";BX.removeClass(BX(t+"-icon-animate"),"comment-menu-link-icon-animate");BX.adjust(BX(t+"-text"),{attrs:{"data-block-click":"Y"}});setTimeout((function(){BX.addClass(BX(t+"-icon-animate"),"comment-menu-link-icon-animate")}),1);setTimeout((function(){BX.adjust(BX(t+"-text"),{attrs:{"data-block-click":"N"}})}),500)}return}var r=BX.proxy_context;var d=parseInt(!!r.getAttribute("bx-height")?r.getAttribute("bx-height"):r.offsetHeight);if(r.getAttribute("bx-status")!="shown"){r.setAttribute("bx-status","shown");if(!BX(t)&&!!BX(t+"-text")){var l=BX(t+"-text"),h=BX.pos(l),m=BX.pos(l.parentNode),c=BX.findChildren(l.parentNode.parentNode.parentNode,{className:"menu-popup-item-text"},true);h["height"]=m["height"]-1;if(c){var u=0,p;for(var E=0;E<c.length;E++){p=BX.pos(c[E]);u=Math.max(u,p["width"])}m["width"]=u}BX.adjust(r,{attrs:{"bx-height":r.offsetHeight},style:{overflow:"hidden",display:"block"},children:[BX.create("BR"),BX.create("DIV",{attrs:{id:t},children:[BX.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[BX.create("INPUT",{attrs:{id:t+"-input",type:"text",value:n},style:{height:m["height"]+"px",width:m["width"]+"px"},events:{click:function(t){this.select();t.preventDefault()}}})]})]}),BX.create("SPAN",{className:"menu-popup-item-right"})]})}new BX["fx"]({time:.2,step:.05,type:"linear",start:d,finish:d*2,callback:BX.delegate((function(t){this.style.height=t+"px"}),r)}).start();BX.fx.show(BX(t),.2);BX(t+"-input").select()}else{r.setAttribute("bx-status","hidden");new BX["fx"]({time:.2,step:.05,type:"linear",start:r.offsetHeight,finish:d,callback:BX.delegate((function(t){this.style.height=t+"px"}),r)}).start();BX.fx.hide(BX(t),.2)}}})}if(i.getAttribute("bx-mpl-edit-show")=="Y"){n.push({text:BX.message("BPC_MES_EDIT"),onclick:function(){BX.onCustomEvent(t,"onAct",[i.getAttribute("bx-mpl-edit-url"),e,"EDIT"]);this.popupWindow.close();return false}})}if(i.getAttribute("bx-mpl-moderate-show")=="Y"){var o=i.getAttribute("bx-mpl-moderate-approved")=="hidden";n.push({text:o?BX.message("BPC_MES_SHOW"):BX.message("BPC_MES_HIDE"),onclick:function(){var n=i.getAttribute("bx-mpl-moderate-url").replace("#action#",o?"show":"hide").replace("#ACTION#",o?"SHOW":"HIDE");if(BX.type.isNotEmptyString(n)){n=BX.util.add_url_param(n,{b24statAction:o?"showComment":"hideComment"})}BX.onCustomEvent(t,"onAct",[n,e,o?"SHOW":"HIDE"]);this.popupWindow.close()}})}if(i.getAttribute("bx-mpl-delete-show")=="Y"){n.push({text:BX.message("BPC_MES_DELETE"),onclick:function(){if(window.confirm(BX.message("BPC_MES_DELETE_POST_CONFIRM"))){BX.onCustomEvent(t,"onAct",[i.getAttribute("bx-mpl-delete-url"),e,"DELETE"])}this.popupWindow.close();return false}})}var a=i.getAttribute("bx-mpl-post-entity-xml-id");if(i.getAttribute("bx-mpl-edit-show")=="Y"&&BX.Tasks&&BX.Tasks.ResultAction&&a.indexOf("TASK_")===0&&BX.Tasks.ResultAction.getInstance().canCreateResult(+/\d+/.exec(a))){var r=+/\d+/.exec(a);var d=BX.Tasks.ResultManager.getInstance().getResult(r);if(d&&d.context==="task"&&d.canUnsetAsResult&&d.canUnsetAsResult(parseInt(e,10))){n.push({text:BX.message("BPC_MES_DELETE_TASK_RESULT"),onclick:function(){BX.Tasks.ResultAction.getInstance().deleteFromComment(e);this.popupWindow.close();return false}})}else if(d&&d.context==="task"&&d.canSetAsResult&&d.canSetAsResult(parseInt(e,10))){n.push({text:BX.message("BPC_MES_CREATE_TASK_RESULT"),onclick:function(){BX.Tasks.ResultAction.getInstance().createFromComment(e);this.popupWindow.close();return false}})}}if(i.getAttribute("bx-mpl-createtask-show")==="Y"&&!BX.type.isUndefined(BX.Livefeed)){var l=i.getAttribute("bx-mpl-comment-entity-type");var h=i.getAttribute("bx-mpl-post-entity-type");n.push({text:BX.message("BPC_MES_CREATE_TASK"),onclick:function(){BX.Livefeed.TaskCreator.create({postEntityType:BX.type.isNotEmptyString(h)?h:"BLOG_POST",entityType:BX.type.isNotEmptyString(l)?l:"BLOG_COMMENT",entityId:e});this.popupWindow.close();return false}})}if(i.getAttribute("bx-mpl-createsubtask-show")==="Y"&&!BX.type.isUndefined(BX.Livefeed)){var m=i.getAttribute("bx-mpl-post-entity-xml-id");var c=m.match(/^TASK_(\d+)$/i);if(c){n.push({text:BX.message("BPC_MES_CREATE_SUBTASK"),onclick:function(){BX.Livefeed.TaskCreator.create({postEntityType:h,entityType:l,entityId:e,parentTaskId:parseInt(c[1])});this.popupWindow.close();return false}})}}if(n.length>0){for(var u in n){if(n.hasOwnProperty(u)){n[u]["className"]="blog-comment-popup-menu"}}var p={offsetLeft:-18,offsetTop:2,lightShadow:false,angle:{position:"top",offset:50},events:{onPopupClose:function(){this.destroy();BX.PopupMenu.Data["action-"+s]=null}}};BX.onCustomEvent("OnUCCommentActionsShown",[t,e,n,p]);BX.PopupMenu.show("action-"+s,i,n,p)}};var fcCommentExpand=function(t){BX.UI.Animations.expand({moreButtonNode:t,type:"comment",classBlock:"feed-com-block",classOuter:"feed-com-text-inner",classInner:"feed-com-text-inner-inner",heightLimit:200,callback:function(t){BX.onCustomEvent(window,"OnUCRecordWasExpanded",[t]);t.classList.add("feed-com-text-inner-expanded");var e=t.getAttribute("bx-content-view-xml-id");if(BX.type.isNotEmptyString(e)){BX.onCustomEvent(window,"OnUCFeedChanged",[e.split("-")])}}})};window["fcParseTemplate"]=function(t,e,i){e=e||{};e["RIGHTS"]=e["RIGHTS"]||{};for(var n=0,s=["MODERATE","EDIT","DELETE"];n<s.length;n++){e["RIGHTS"][s[n]]=BX.util.in_array(e["RIGHTS"][s[n]],["Y","ALL","OWN","OWNLAST"])?e["RIGHTS"][s[n]]:"N"}e["DATE_TIME_FORMAT"]=!!e["DATE_TIME_FORMAT"]?e["DATE_TIME_FORMAT"]:"d F Y G:i";e["TIME_FORMAT"]=!!e["DATE_TIME_FORMAT"]&&e["DATE_TIME_FORMAT"].indexOf("a")>=0?"g:i a":"G:i";e["VIEW_URL"]=e["VIEW_URL"]||"";e["EDIT_URL"]=e["EDIT_URL"]||"";e["MODERATE_URL"]=e["MODERATE_URL"]||"";e["DELETE_URL"]=e["DELETE_URL"]||"";e["AUTHOR_URL"]=e["AUTHOR_URL"]||"";e["NAME_TEMPLATE"]=e["NAME_TEMPLATE"]||"";e["SHOW_LOGIN"]=e["SHOW_LOGIN"]||"";var o=t&&t["messageFields"]?t["messageFields"]:t;var a={ID:"",FULL_ID:"",CONTENT_ID:"",ENTITY_XML_ID:"",EXEMPLAR_ID:"",NEW:"old",APPROVED:"Y",DATE:"",TEXT:"",CLASSNAME:"",VIEW_URL:"",VIEW_SHOW:"N",EDIT_URL:"",EDIT_SHOW:"N",MODERATE_URL:"",MODERATE_SHOW:"N",DELETE_URL:"",DELETE_SHOW:"N",CREATETASK_SHOW:"N",BEFORE_HEADER:"",BEFORE_ACTIONS:"",AFTER_ACTIONS:"",AFTER_HEADER:"",BEFORE:"",AFTER:"",BEFORE_RECORD:"",AFTER_RECORD:"",AUTHOR_ID:0,AUTHOR_AVATAR_IS:"N",AUTHOR_AVATAR:"",AUTHOR_URL:"",AUTHOR_NAME:"",AUTHOR_EXTRANET_STYLE:"",SHOW_POST_FORM:"Y",SHOW_MENU:"Y",VOTE_ID:"",AUTHOR_TOOLTIP_PARAMS:"","background:url('') no-repeat center;":"",LIKE_REACT:"",RATING_NONEMPTY_CLASS:""};if(!!o&&!!t["messageFields"]){o["AUTHOR"]=!!o["AUTHOR"]?o["AUTHOR"]:{};var r=parseInt(o["POST_TIMESTAMP"])+parseInt(BX.message("USER_TZ_OFFSET"))+parseInt(BX.message("SERVER_TZ_OFFSET"));var d=[["today",e["TIME_FORMAT"]],["yesterday",e["TIME_FORMAT"].indexOf("yesterday")<0?"yesterday, "+e["TIME_FORMAT"]:e["TIME_FORMAT"]],["",e["DATE_TIME_FORMAT"]]];var l="";if(!BX.Type.isUndefined(o["AUTHOR"]["TYPE"])){if(o["AUTHOR"]["TYPE"]==="EMAIL"){l=" feed-com-name-email"}else if(o["AUTHOR"]["TYPE"]==="EXTRANET"){l=" feed-com-name-extranet"}}else if(o["AUTHOR"]["IS_EXTRANET"]=="Y"){l=" feed-com-name-extranet"}var h=o["POST_MESSAGE_TEXT"].replace(/\001/gi,"").replace(/#/gi,"\x01");o.AUX_LIVE_PARAMS=BX.type.isPlainObject(o.AUX_LIVE_PARAMS)?o.AUX_LIVE_PARAMS:{};if(!!o.AUX&&(BX.util.in_array(o.AUX,["createentity","createtask","fileversion"])||o.AUX==="TASKINFO"&&BX.type.isNotEmptyObject(o.AUX_LIVE_PARAMS))){h=BX.CommentAux.getLiveText(o.AUX,o.AUX_LIVE_PARAMS)}a={ID:o["ID"],FULL_ID:o["FULL_ID"].join("-"),CONTENT_ID:o["RATING"]&&o["RATING"]["ENTITY_TYPE_ID"]&&o["RATING"]["ENTITY_ID"]?o["RATING"]["ENTITY_TYPE_ID"]+"-"+o["RATING"]["ENTITY_ID"]:"",ENTITY_XML_ID:o["ENTITY_XML_ID"],EXEMPLAR_ID:e["EXEMPLAR_ID"],NEW:o["NEW"]=="Y"?"new":"old",APPROVED:o["APPROVED"]!="Y"?"hidden":"approved",DATE:BX.date.format(d,r,parseInt(Date.now()/1e3)+parseInt(BX.message("USER_TZ_OFFSET"))+parseInt(BX.message("SERVER_TZ_OFFSET")),true),TEXT:h,CLASSNAME:(o["CLASSNAME"]?" "+o["CLASSNAME"]:"")+(BX.type.isNotEmptyString(e["CLASSNAME"])?" "+e["CLASSNAME"]:""),VIEW_URL:e["VIEW_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),VIEW_SHOW:e["VIEW_URL"]!==""?"Y":"N",EDIT_URL:e["EDIT_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),EDIT_SHOW:(!o.AUX||o.AUX.length<=0)&&(e["RIGHTS"]["EDIT"]=="Y"||e["RIGHTS"]["EDIT"]=="ALL"||e["RIGHTS"]["EDIT"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"])?"Y":"N",MODERATE_URL:e["MODERATE_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),MODERATE_SHOW:e["RIGHTS"]["MODERATE"]=="Y"||e["RIGHTS"]["MODERATE"]=="ALL"||e["RIGHTS"]["MODERATE"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"]?"Y":"N",DELETE_URL:e["DELETE_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),DELETE_SHOW:(!o["CAN_DELETE"]||o["CAN_DELETE"]==="Y")&&(e["RIGHTS"]["DELETE"]=="Y"||e["RIGHTS"]["DELETE"]=="ALL"||e["RIGHTS"]["DELETE"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"]?"Y":"N"),CREATETASK_SHOW:(!o.AUX||o.AUX.length<=0)&&e["RIGHTS"]["CREATETASK"]=="Y"?"Y":"N",CREATESUBTASK_SHOW:(!o.AUX||o.AUX.length<=0)&&BX.type.isNotEmptyString(e.RIGHTS.CREATESUBTASK)&&e.RIGHTS.CREATESUBTASK==="Y"?"Y":"N",BEFORE_HEADER:o["BEFORE_HEADER"],BEFORE_ACTIONS:o["BEFORE_ACTIONS"],AFTER_ACTIONS:o["AFTER_ACTIONS"],AFTER_HEADER:o["AFTER_HEADER"],BEFORE:o["BEFORE"],AFTER:o["AFTER"],BEFORE_RECORD:o["BEFORE_RECORD"],AFTER_RECORD:o["AFTER_RECORD"],AUTHOR_ID:o["AUTHOR"]["ID"],AUTHOR_AVATAR_IS:!!o["AUTHOR"]["AVATAR"]?"Y":"N",AUTHOR_AVATAR:!!o["AUTHOR"]["AVATAR"]?o["AUTHOR"]["AVATAR"]:"/bitrix/images/1.gif",AUTHOR_AVATAR_BG:!!o["AUTHOR"]["AVATAR"]?"background-image:url('"+o["AUTHOR"]["AVATAR"]+"')":"",AUTHOR_URL:e["AUTHOR_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]).replace("#USER_ID#",o["AUTHOR"]["ID"]).replace("#user_id#",o["AUTHOR"]["ID"])+(!BX.Type.isUndefined(o["AUTHOR"]["EXTERNAL_AUTH_ID"])&&o["AUTHOR"]["EXTERNAL_AUTH_ID"]==="email"&&!BX.Type.isUndefined(e["AUTHOR_URL_PARAMS"])?(e["AUTHOR_URL"].indexOf("?")>=0?"&":"?")+"entityType="+e["AUTHOR_URL_PARAMS"]["entityType"]+"&entityId="+e["AUTHOR_URL_PARAMS"]["entityId"]:""),AUTHOR_NAME:BX.formatName(o["AUTHOR"],e["NAME_TEMPLATE"],e["SHOW_LOGIN"]),AUTHOR_EXTRANET_STYLE:l,VOTE_ID:o["RATING"]&&o["RATING"]["VOTE_ID"]?o["RATING"]["VOTE_ID"]:"",AUTHOR_PERSONAL_GENDER:BX.type.isNotEmptyString(o["AUTHOR"]["PERSONAL_GENDER"])?o["AUTHOR"]["PERSONAL_GENDER"]:"",AUTHOR_TOOLTIP_PARAMS:!BX.Type.isUndefined(o["AUTHOR_TOOLTIP_PARAMS"])?o["AUTHOR_TOOLTIP_PARAMS"]:"{}","background:url('') no-repeat center;":"",LIKE_REACT:!!o["LIKE_REACT"]?o["LIKE_REACT"]:"",RATING_NONEMPTY_CLASS:o["RATING"]&&o["RATING"]["TOTAL_VOTES"]?"comment-block-rating-nonempty":"",POST_ENTITY_TYPE:!!e["POST_CONTENT_TYPE_ID"]?e["POST_CONTENT_TYPE_ID"]:"",COMMENT_ENTITY_TYPE:!!e["COMMENT_CONTENT_TYPE_ID"]?e["COMMENT_CONTENT_TYPE_ID"]:""}}else{for(n in a){if(a.hasOwnProperty(n)){a[n]=!!t[n]?t[n]:a[n]}}}for(n in a){if(a.hasOwnProperty(n)){a[n]=!!a[n]?a[n]:""}}a["SHOW_POST_FORM"]=BX("record-"+a["ENTITY_XML_ID"]+"-0-placeholder")?"Y":"N";for(var m in a){if(a.hasOwnProperty(m)){i=i.replace(new RegExp("#"+m+"#","g"),function(){return a[this]}.bind(m))}}return i.replace("background:url('') no-repeat center;","").replace(/\001/gi,"#")};window["fcPull"]=function(t,e){BX.ajax({url:"/bitrix/components/bitrix/main.post.list/templates/.default/component_epilog.php",method:"POST",data:{AJAX_POST:"Y",ENTITY_XML_ID:t,MODE:"PUSH&PULL",sessid:BX.bitrix_sessid(),DATA:e}})};var MPLQuote=function(){this.closeByEsc=true;this.autoHide=true;this.autoHideTimeout=5e3;this.node=document.createElement("A");BX.adjust(this.node,{style:{zIndex:BX.PopupWindow.getOption("popupZindex")+1,position:"absolute",display:"none",top:"0px",left:"0px"},attrs:{className:"mpl-quote-block",href:"#"},events:{click:this.fire.bind(this)}});this.checkEsc=this.checkEsc.bind(this);this.hide=this.hide.bind(this);document.body.appendChild(this.node)};MPLQuote.prototype={show:function(t){var e=this.getPosition(this.node,t);BX.adjust(this.node,{style:{top:e.y+"px",left:e.x+"px",display:"block"}});BX.addClass(this.node,"mpl-quote-block-show");if(this.closeByEsc&&this.closeByEscBound!==true){this.closeByEscBound=true;BX.bind(document,"keyup",this.checkEsc)}if(this.autoHide&&this.autoHideBound!==true){this.autoHideBound=true;setTimeout(function(){BX.bind(document,"click",this.hide)}.bind(this),10)}if(this.autoHideTimeoutPointer>0){clearTimeout(this.autoHideTimeoutPointer);this.autoHideTimeoutPointer=0}if(this.autoHideTimeout>0&&this.autoHideTimeoutBound!==true){this.autoHideTimeoutBound=true;this.autoHideTimeoutPointer=setTimeout(this.hide,this.autoHideTimeout)}},fire:function(t){t.preventDefault();if(!this.isShown()){return}if(t&&!(BX.getEventButton(t)&BX.MSLEFT)){return}this.cancelBubble(t);this.node.style.display="none";BX.onCustomEvent(this,"onQuote",[t,this]);setTimeout(this.hide,50);return false},hide:function(){BX.unbind(document,"keyup",this.checkEsc);this.closeByEscBound=false;BX.unbind(document,"click",this.hide);this.autoHideBound=false;if(this.autoHideTimeoutPointer>0){clearTimeout(this.autoHideTimeoutPointer)}this.autoHideTimeoutPointer=0;this.autoHideTimeoutBound=false;BX.onCustomEvent(this,"onHide",[this]);BX.remove(this.node)},getPosition:function(t,e){var i;if(e.pageX==null){var n=document.documentElement,s=document.body;var o=e.clientX+(n&&n.scrollLeft||s&&s.scrollLeft||0)-(n.clientLeft||0);var a=e.clientY+(n&&n.scrollTop||s&&s.scrollTop||0)-(n.clientTop||0);i={x:o,y:a}}else{i={x:e.pageX,y:e.pageY}}return{x:i.x+5,y:i.y-16}},isShown:function(){return this.node.style.display==="block"},cancelBubble:function(t){if(!t){t=window.event}if(t.stopPropagation){t.stopPropagation()}else{t.cancelBubble=true}},checkEsc:function(t){t=t||window.event;if(t.keyCode==27){this.hide(t)}}};var checkEntitiesActuality=function(t){var e=repo.listById.values();var i=e.next();while(i.done!==true){if(i.value.getXmlId()===t&&!document.body.contains(i.value.node.main)){BX.onCustomEvent(window,"OnUCInitialized",[i.value.getId()])}i=e.next()}};var getActiveEntitiesByXmlId=function(t){checkEntitiesActuality(t);var e=repo.listById.values();var i=e.next();var n=new Map;while(i.done!==true){if(i.value.getXmlId()===t){n.set(i.value.getId(),i.value)}i=e.next()}return n};window.mplCheckForQuote=function(t,e,i,n){t=document.all?window.event:t;var s="",o,a=null;if(window.getSelection){o=window.getSelection();s=o.toString()}else if(document.selection){o=document.selection;s=o.createRange().text}if(s.length<=0){return}var r=BX.findParent(o.focusNode,{tagName:e.tagName,className:e.className},e),d=BX.findParent(o.anchorNode,{tagName:e.tagName,className:e.className},e);if(r!==d||r!==e){return}var l=getActiveEntitiesByXmlId(i);if(l.size<=0){return}if(n&&BX(n,true)){var h=BX(n,true);if(h&&h.hasAttribute("bx-post-author-id")){a={id:parseInt(h.getAttribute("bx-post-author-id")),gender:h.getAttribute("bx-post-author-gender"),name:h.innerHTML}}}var m=null;if(e.__boundXmlCheckQuote===true){m=repo.listById.get(e.__boundXmlEntityId)||null}if(m===null){e.__boundXmlCheckQuote=true;var c=e;while(c){l.forEach((function(t,e){if(m===null&&c.contains(t.node.main)){m=t;return true}}));if(m!==null){break}c=c.parentNode}if(m===null){m=l.values().next().value}e.__boundXmlEntityId=m.getId();BX.addCustomEvent(window,"OnUCHasBeenDestroyed",(function(t,i){if(i.getId()===e.__boundXmlEntityId){delete e.__boundXmlEntityId;delete e.__boundXmlCheckQuote}}))}if(m!==null){BX.onCustomEvent(m.eventNode,"onQuote",[t,{text:s,author:a}])}};window.mplReplaceUserPath=function(t){if(!BX.Type.isStringFilled(t)){return""}if(BX("MPL_IS_EXTRANET_SITE")==="Y"){t=t.replace("/company/personal/user/","/extranet/contacts/personal/user/")}else{t=t.replace("/extranet/contacts/personal/user/","/company/personal/user/")}t=t.replace(new RegExp("[\\w/]*/mobile/users/\\?user_id=(\\d+)","igm"),BX("MPL_IS_EXTRANET_SITE")=="Y"?"/extranet/contacts/personal/user/$1/":"/company/personal/user/$1/");return t};BX.addCustomEvent(window,"BX.Livefeed:recalculateComments",(function(t){if(!BX.type.isPlainObject(t)||!BX.type.isDomNode(t.rootNode)){return}var e=t.rootNode.querySelectorAll(".feed-comments-block");var i=null;for(var n=0;n<e.length;n++){i=e[n].getAttribute("data-bx-comments-entity-xml-id");if(BX.type.isNotEmptyString(i)){BX.onCustomEvent(window,"OnUCCommentRecalculate",[i])}}}));BX.addCustomEvent(window,"BX.Forum.Spoiler:toggle",(function(t){if(!t.node){return}var e=BX.findParent(t.node,{attrs:{"bx-mpl-block":"main"}});if(e){BX.onCustomEvent(e,"onForumSpoilerToggle",[e.getAttribute("bx-mpl-entity-id")])}}));var ScreenSpy=function(){this.timeoutSec=2e3;this.check=this.check.bind(this);this.change=this.change.bind(this);this.scroll=this.scroll.bind(this);this.nodes=new Map;this.timeout=0;this.ready=true;this.window=BX.GetWindowInnerSize();this.screen={top:this.window.scrollTop,bottom:this.window.scrollTop+this.window.innerHeight};this.watchDimensionNodes=new WeakMap};ScreenSpy.prototype={watchNode:function(t){if(!this.watchDimensionNodes.has(t)){this.watchDimensionNodes.set(t,false);BX.bind(t,"click",this.check)}},set:function(t,e){this.nodes.set(t,e);this.start()},unset:function(t){this.nodes.delete(t);if(this.nodes.size<=0){this.stop()}},start:function(){if(this.ready!==true){return}this.ready=false;BX.bind(window,"resize",this.change);BX.bind(window,"scroll",this.scroll);this.scroll()},stop:function(){if(this.timeout>0){clearTimeout(this.timeout)}this.timeout=0;BX.unbind(window,"resize",this.change);BX.unbind(window,"scroll",this.scroll);this.ready=true},check:function(){this.timeout=0;var t=BX.GetWindowScrollPos();if(this.screen.bottom>t.scrollTop){var e={top:t.scrollTop,bottom:this.screen.bottom};BX.onCustomEvent(this,"onRead",[e])}if(this.screen.top!==t.scrollTop){this.scroll()}},change:function(){this.window=BX.GetWindowInnerSize()},scroll:function(){if(this.timeout<=0){var t=BX.GetWindowScrollPos();this.screen={top:t.scrollTop,bottom:t.scrollTop+this.window.innerHeight};this.timeout=setTimeout(this.check,this.timeoutSec)}}};var scrSpy=new ScreenSpy;BX.ready((function(){BX.addCustomEvent(window,"onPullEvent-unicomments",(function(t,e){if(e["AUX"]&&!BX.util.in_array(e["AUX"].toLowerCase(),BX.CommentAux.getLiveTypesList())||getActiveEntitiesByXmlId(e["ENTITY_XML_ID"]).size<=0){return}if(t==="comment"){if(e["NEED_REQUEST"]==="Y"){if(e["URL"]["LINK"].indexOf("#GROUPS_PATH#")>=0&&!!BX.message("MPL_WORKGROUPS_PATH")){e["URL"]["LINK"]=e["URL"]["LINK"].replace("#GROUPS_PATH#",BX.message("MPL_WORKGROUPS_PATH"))}var i=BX.ajax.prepareData({AJAX_POST:"Y",ENTITY_XML_ID:e["ENTITY_XML_ID"],MODE:"RECORD",FILTER:{ID:e["ID"]},sessid:BX.bitrix_sessid()});var n=e["URL"]["LINK"];n=n.indexOf("#")!==-1?n.substr(0,n.indexOf("#")):n;BX.ajax({url:n+(n.indexOf("?")!==-1?"&":"?")+i,method:"GET",dataType:"json",data:"",onsuccess:function(t){BX.onCustomEvent(window,"OnUCCommentWasPulled",[[e["ENTITY_XML_ID"],e["ID"]],t,e])}})}else if(e["ACTION"]==="DELETE"){BX.onCustomEvent(window,"OnUCommentWasDeleted",[e["ENTITY_XML_ID"],[e["ENTITY_XML_ID"],e["ID"]],e]);BX.onCustomEvent(window,"OnUCFeedChanged",[e["ID"]])}else if(e["ACTION"]==="HIDE"){BX.onCustomEvent(window,"OnUCommentWasHidden",[e["ENTITY_XML_ID"],[e["ENTITY_XML_ID"],e["ID"]],e]);BX.onCustomEvent(window,"OnUCFeedChanged",[e["ID"]])}else{if(e["ACTION"]==="REPLY"){e["NEW"]=!e["AUTHOR"]||e["AUTHOR"]["ID"]!=BX.message("USER_ID")?"Y":"N"}BX.onCustomEvent(window,"OnUCCommentWasPulled",[[e["ENTITY_XML_ID"],e["ID"]],{messageFields:e},e])}}else if(t==="answer"&&Number(e["USER_ID"])!==Number(BX.message("USER_ID"))){BX.onCustomEvent(window,"OnUCUsersAreWriting",[e["ENTITY_XML_ID"],e["USER_ID"],e["NAME"],e["AVATAR"]])}}));BX.addCustomEvent(window,"OnUCUserReply",(function(t,e,i){var n=getActiveEntitiesByXmlId(t);if(n.size<=0){return}n.values().next().value.reply({id:e,name:i})}))}));BX.onCustomEvent("main.post.list/default",[])})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:99:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.min.js?172645624412332";s:6:"source";s:79:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.js";s:3:"min";s:83:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.min.js";s:3:"map";s:83:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.map.js";}"*/
(function(){window["UC"]=window["UC"]||{};if(!!window["FCForm"])return;window.FCForm=function(e){this.url="";this.lhe="";this.entitiesId={};this.form=BX(e["formId"]);this.handler=window.LHEPostForm.getHandler(e["editorId"]);this.editorName=e["editorName"];this.editorId=e["editorId"];this.windowEvents={OnUCUnlinkForm:BX.delegate(function(e){if(!!e&&!!this.entitiesId[e]){var t={},i=true;for(var s in this.entitiesId){if(this.entitiesId.hasOwnProperty(s)&&s!=e){i=false;t[s]=this.entitiesId[s]}}this.entitiesId=t;if(i&&!!this.windowEvents){for(s in this.windowEvents){if(this.windowEvents.hasOwnProperty(s)&&s)BX.removeCustomEvent(window,s,this.windowEvents[s])}this.windowEventsSet=false}}},this),OnUCQuote:BX.delegate(function(e,t,i){if(!this.entitiesId[e]||!this._checkTextSafety([e,0])){return}this.show([e,0]);var s=0;var n=function(){s++;if(s>10){return}if(!this.handler.oEditor||!this.handler.oEditor.action){return setTimeout(n,10)}if(!this.handler.oEditor.toolbar.controls.Quote){return}if(!t&&!i){return this.handler.oEditor.action.Exec("quote")}var e="";if(t){e=t.gender?BX.message("MPL_HAVE_WRITTEN_"+t.gender):BX.message("MPL_HAVE_WRITTEN");if(this.handler.oEditor.GetViewMode()==="wysiwyg"){if(t.id>0){t='<span id="'+this.handler.oEditor.SetBxTag(false,{tag:"postuser",userId:t.id,userName:t.name})+'" class="bxhtmled-metion">'+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>"}else{t="<span>"+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>"}e=t+e+"<br/>"}else if(this.handler.oEditor.bbCode){if(t.id>0){t="[USER="+t.id+"]"+t.name+"[/USER]"}else{t=t.name}e=t!==""?t+e+"\n":""}}if(this.handler.oEditor.action.actions.quote.setExternalSelectionFromRange){this.handler.oEditor.action.actions.quote.setExternalSelectionFromRange();var o=this.handler.oEditor.action.actions.quote.getExternalSelection();if(o===""&&i!==""){o=i}o=e+o;if(BX.type.isNotEmptyString(o)){this.handler.oEditor.action.actions.quote.setExternalSelection(o)}}else{this.handler.oEditor.action.actions.quote.setExternalSelection(i)}this.handler.oEditor.action.Exec("quote")}.bind(this);this.handler.exec(n)},this),OnUCReply:function(e,t,i,s,n){if(!this.entitiesId[e]||!this._checkTextSafety([e,0])||n.caught===true){return false}n.caught=true;this.show([e,0]);if(t>0){this.handler.exec(window.BxInsertMention,[{item:{entityId:t,name:i},type:"user",formID:this.form.id,editorId:this.editorId,bNeedComa:true,insertHtml:true}])}}.bind(this),OnUCAfterRecordEdit:BX.delegate(function(e,t,i,s){if(!!this.entitiesId[e]){if(s==="EDIT"){this.show([e,t],i["messageBBCode"],i["messageFields"]);this.editing=true}else{this.hide(true);if(!!i["errorMessage"]){this.id=[e,t];this.showError(i["errorMessage"])}else if(!!i["okMessage"]){this.id=[e,t];this.showNote(i["okMessage"]);this.id=null}}}},this)};this.linkEntity(e["entitiesId"]);BX.remove(BX("micro"+e["editorName"]));BX.remove(BX("micro"+e["editorId"]));this.eventNode=this.handler.eventNode;if(this.eventNode){BX.addCustomEvent(this.eventNode,"OnBeforeHideLHE",BX.delegate(function(){BX.removeClass(document.documentElement,"bx-ios-fix-frame-focus");if(top&&top["document"])BX.removeClass(top["document"]["documentElement"],"bx-ios-fix-frame-focus");if(!!this.id&&!!BX("uc-writing-"+this.form.id+"-"+this.id[0]+"-area")){BX.hide(BX("uc-writing-"+this.form.id+"-"+this.id[0]+"-area"))}},this));BX.addCustomEvent(this.eventNode,"OnAfterHideLHE",BX.delegate(function(){var e=this._getPlacehoder();if(e){BX.hide(e)}e=this._getSwitcher();if(e){BX.show(e);BX.focus(e.firstChild)}this.__content_length=0;if(!!this.id){BX.onCustomEvent(this.eventNode,"OnUCFormAfterHide",[this])}clearTimeout(this._checkWriteTimeout);this._checkWriteTimeout=0;this.clear();BX.onCustomEvent(window,"OnUCFeedChanged",[this.id])},this));BX.addCustomEvent(this.eventNode,"OnBeforeShowLHE",BX.delegate(function(){if(BX.browser.IsIOS()&&BX.browser.IsMobile()){BX.addClass(window["document"]["documentElement"],"bx-ios-fix-frame-focus");if(top&&top["document"])BX.addClass(top["document"]["documentElement"],"bx-ios-fix-frame-focus")}var e=this._getPlacehoder();if(e){BX.removeClass(e,"feed-com-add-box-no-form");BX.removeClass(e,"feed-com-add-box-header");BX.show(e)}e=this._getSwitcher();if(e){BX.hide(e)}if(!!this.id&&!!BX("uc-writing-"+this.form.id+"-"+this.id[0]+"-area")){BX.hide(BX("uc-writing-"+this.form.id+"-"+this.id[0]+"-area"))}},this));BX.addCustomEvent(this.eventNode,"OnAfterShowLHE",function(e,t){this._checkWrite(e,t);BX.onCustomEvent(window,"OnUCFeedChanged",[this.id])}.bind(this));BX.addCustomEvent(this.eventNode,"OnClickSubmit",BX.delegate(this.submit,this));BX.addCustomEvent(this.eventNode,"OnClickCancel",BX.delegate(this.cancel,this));BX.onCustomEvent(this.eventNode,"OnUCFormInit",[this])}this.id=null;this.jsCommentId=null;BX.addCustomEvent(window,"OnImageDataUriHandle",BX.delegate(this.showWait,this));BX.addCustomEvent(window,"OnImageDataUriCaughtUploaded",BX.delegate(this.closeWait,this));BX.addCustomEvent(window,"OnImageDataUriCaughtFailed",BX.delegate(this.closeWait,this))};window.FCForm.prototype={linkEntity:function(e){if(!!e){for(var t in e){if(e.hasOwnProperty(t)){BX.onCustomEvent(window,"OnUCUnlinkForm",[t]);this.entitiesId[t]=e[t]}}}if(!this.windowEventsSet&&!!this.entitiesId){BX.addCustomEvent(window,"OnUCUnlinkForm",this.windowEvents.OnUCUnlinkForm);BX.addCustomEvent(window,"OnUCReply",BX.debounce(this.windowEvents.OnUCReply,10));BX.addCustomEvent(window,"OnUCQuote",BX.debounce(this.windowEvents.OnUCQuote,10));BX.addCustomEvent(window,"OnUCAfterRecordEdit",this.windowEvents.OnUCAfterRecordEdit);this.windowEventsSet=true}},_checkTextSafety:function(e){if(this.id&&this.id.join("-")!==e.join("-")&&this.handler.editorIsLoaded&&this.handler.oEditor.IsContentChanged()){return window.confirm(BX.message("MPL_SAFE_EDIT"))}return true},_checkWrite:function(){if(this.handler.editorIsLoaded&&this._checkWriteTimeout!==false){this.__content_length=this.__content_length>0?this.__content_length:0;var e=this.handler.oEditor.GetContent(),t=2e3;if(e.length>=4&&this.__content_length!=e.length&&!!this.id){BX.onCustomEvent(window,"OnUCUserIsWriting",[this.id[0],{sent:false}]);t=3e4}this._checkWriteTimeout=setTimeout(this._checkWrite.bind(this),t);this.__content_length=e.length}},_getPlacehoder:function(e){e=!!e?e:this.id;return!!e?BX("record-"+e.join("-")+"-placeholder"):null},_getSwitcher:function(e){e=!!e?e:this.id;return!!e?BX("record-"+e[0]+"-switcher"):null},hide:function(e){if(this.eventNode.style.display!="none"){BX.onCustomEvent(this.eventNode,"OnShowLHE",[e===true?false:"hide"])}if(e){document.body.appendChild(this.form)}},clear:function(){this.editing=false;var e=this._getPlacehoder();if(!!e)BX.hide(e);this.clearNotification(e,"feed-add-error");BX.onCustomEvent(this.eventNode,"OnUCFormClear",[this]);var t=BX.findChild(this.form,{className:"wduf-placeholder-tbody"},true,false);if(t!==null&&typeof t!="undefined")BX.cleanNode(t,false);t=BX.findChild(this.form,{className:"wduf-selectdialog"},true,false);if(t!==null&&typeof t!="undefined")BX.hide(t);t=BX.findChild(this.form,{className:"file-placeholder-tbody"},true,false);if(t!==null&&typeof t!="undefined")BX.cleanNode(t,false);this.id=null;this.jsCommentId=null},show:function(e,t,i){if(this.id&&!!e&&this.id.join("-")==e.join("-")){var s=this._getPlacehoder(e);this.handler.oEditor.Focus();setTimeout(function(){var e=BX.pos(s);var t=BX.GetWindowSize(document);if(t.scrollTop>e.top){s.scrollIntoView()}else if(t.scrollTop+t.innerHeight<e.top){s.scrollIntoView(false)}},100);return true}else{this.hide(true)}this.id=e;this.jsCommentId=BX.util.getRandomString(20);var n=this._getPlacehoder();BX.removeClass(n,"feed-com-add-box-no-form");BX.removeClass(n,"feed-com-add-box-header");n.appendChild(this.form);BX.onCustomEvent(this.eventNode,"OnUCFormBeforeShow",[this,t,i]);BX.onCustomEvent(this.eventNode,"OnShowLHE",["show",null,this.id]);BX.onCustomEvent(this.eventNode,"OnUCFormAfterShow",[this,t,i]);return true},submit:function(){if(this.busy===true)return"busy";var e=this.handler.editorIsLoaded?this.handler.oEditor.GetContent():"";if(!e){this.showError(BX.message("JERROR_NO_MESSAGE"));return false}this.showWait();this.busy=true;var t={};window.convertFormToArray(this.form,t);t["REVIEW_TEXT"]=e;t["NOREDIRECT"]="Y";t["MODE"]="RECORD";t["AJAX_POST"]="Y";t["id"]=this.id;if(this.jsCommentId!==null)t["COMMENT_EXEMPLAR_ID"]=this.jsCommentId;t["SITE_ID"]=BX.message("SITE_ID");t["LANGUAGE_ID"]=BX.message("LANGUAGE_ID");t["ACTION"]="ADD";if(this.editing===true){t["REVIEW_ACTION"]="EDIT";t["FILTER"]={ID:this.id[1]};t["ACTION"]="EDIT";t["ID"]=this.id[1]}BX.onCustomEvent(this.eventNode,"OnUCFormSubmit",[this,t]);BX.onCustomEvent(window,"OnUCFormSubmit",[this.id[0],this.id[1],this,t]);var i=this.form.action;i=BX.util.remove_url_param(i,["b24statAction"]);i=BX.util.add_url_param(i,{b24statAction:this.id[1]>0?"editComment":"addComment"});this.form.action=i;BX.ajax({method:"POST",url:this.form.action,data:t,dataType:"json",onsuccess:BX.proxy(function(e){this.closeWait();var t=e,i=this.id[0];BX.onCustomEvent(this.eventNode,"OnUCFormResponse",[this,e]);if(!!this.OnUCFormResponseData)e=this.OnUCFormResponseData;if(!!e){if(e["errorMessage"]){this.showError(e["errorMessage"])}else if(e["status"]=="error"){this.showError(BX.type.isNotEmptyString(e["message"])?e["message"]:"")}else{BX.onCustomEvent(window,"OnUCAfterRecordAdd",[this.id[0],e,t]);this.hide(true)}}this.busy=false;BX.onCustomEvent(window,"OnUCFormResponse",[i,e["messageId"],this,e])},this),onfailure:BX.delegate(function(){this.closeWait();this.busy=false;BX.onCustomEvent(window,"OnUCFormResponse",[this.id[0],this.id[1],this,[]])},this)})},cancel:function(){},clearNotification:function(e,t){var i=BX.findChildren(e,{tagName:"DIV",className:t},true);if(!!i){var s=i.pop();do{BX.remove(s);BX.remove(s)}while((s=i.pop())&&!!s)}},showError:function(e){if(!e)return;var t=this._getPlacehoder();this.clearNotification(t,"feed-add-error");BX.addClass(t,!t.firstChild?"feed-com-add-box-no-form":"feed-com-add-box-header");t.insertBefore(BX.create("div",{attrs:{class:"feed-add-error"},html:'<span class="feed-add-info-text"><span class="feed-add-info-icon"></span>'+"<b>"+BX.message("FC_ERROR")+"</b><br />"+e+"</span>"}),t.firstChild);BX.show(t)},showNote:function(e){if(!e)return;var t=this._getPlacehoder();this.clearNotification(t,"feed-add-error");this.clearNotification(t,"feed-add-successfully");BX.addClass(t,!t.firstChild?"feed-com-add-box-no-form":"feed-com-add-box-header");t.insertBefore(BX.create("div",{attrs:{class:"feed-add-successfully"},html:'<span class="feed-add-info-text"><span class="feed-add-info-icon"></span>'+e+"</span>"}),t.firstChild);BX.addClass(t,"comment-deleted");BX.show(t)},showWait:function(){var e=BX("lhe_button_submit_"+this.form.id);this.busy=true;if(!!e){BX.addClass(e,"ui-btn-clock");BX.defer(function(){e.disabled=true})()}},closeWait:function(){var e=BX("lhe_button_submit_"+this.form.id);this.busy=false;if(!!e){e.disabled=false;BX.removeClass(e,"ui-btn-clock")}}};window.convertFormToArray=function(e,t){t=!!t?t:[];if(!!e){var i,s=[],n=e.elements.length;for(i=0;i<n;i++){var o=e.elements[i];if(o.disabled)continue;switch(o.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":s.push({name:o.name,value:o.value});break;case"radio":case"checkbox":if(o.checked)s.push({name:o.name,value:o.value});break;case"select-multiple":for(var d=0;d<o.options.length;d++){if(o.options[d].selected)s.push({name:o.name,value:o.options[d].value})}break;default:break}}var r=t;i=0;while(i<s.length){var a=s[i].name.indexOf("[");if(a==-1){r[s[i].name]=s[i].value;r=t;i++}else{var h=s[i].name.substring(0,a);var l=s[i].name.substring(a+1);if(!r[h])r[h]=[];var c=l.indexOf("]");if(c==-1){r=t;i++}else if(c===0){r=r[h];s[i].name=""+r.length}else{r=r[h];s[i].name=l.substring(0,c)+l.substring(c+1)}}}}return t};window["fRefreshCaptcha"]=function(e){var t=null,i=BX.findChild(e,{attr:{name:"captcha_code"}},true),s=BX.findChild(e,{attr:{name:"captcha_word"}},true),n=BX.findChild(e,{className:"comments-reply-field-captcha-image"},true);if(n)t=BX.findChild(n,{tag:"img"});if(i&&s&&t){s.value="";BX.ajax.getCaptcha(function(e){i.value=e["captcha_sid"];t.src="/bitrix/tools/captcha.php?captcha_code="+e["captcha_sid"]})}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:100:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form2.min.js?172645624414615";s:6:"source";s:80:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form2.js";s:3:"min";s:84:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form2.min.js";s:3:"map";s:84:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form2.map.js";}"*/
(function(){if(!!window.UCForm)return;var t={};window.UCForm=function(t){this.formId=t;this.form=BX(this.formId);this.entities=new Map;this.xmls=new Map;if(t===""){}else{this.initialize()}this.startCheckWriting=this.startCheckWriting.bind(this);this.id=null;this.currentEntity=null;this.onSubmitSuccess=this.onSubmitSuccess.bind(this);this.onSubmitFailed=this.onSubmitFailed.bind(this)};window.UCForm.prototype={initialize:function(){this.bindWindowEvents();this.bindPrivateEvents();this.__bindLHEEvents=function(t,e){if(e===this.formId){this.handler=t;this.bindLHEEvents()}}.bind(this);BX.addCustomEvent(window,"onInitialized",this.__bindLHEEvents);if(this.getLHE())this.bindLHEEvents();BX.onCustomEvent(this.form,"OnUCFormInit",[this])},bindWindowEvents:function(){this.windowEvents={OnImageDataUriHandle:this.showWait.bind(this),OnImageDataUriCaughtUploaded:this.closeWait.bind(this),OnImageDataUriCaughtFailed:this.closeWait.bind(this)};for(var t in this.windowEvents){if(this.windowEvents.hasOwnProperty(t)){BX.addCustomEvent(window,t,this.windowEvents[t])}}},unbindWindowEvents:function(){for(var t in this.windowEvents){if(this.windowEvents.hasOwnProperty(t)){BX.removeCustomEvent(window,t,this.windowEvents[t])}}},bindPrivateEvents:function(){this.privateEvents={onQuote:this.onQuote.bind(this),onReply:this.onReply.bind(this),onEdit:this.onEdit.bind(this)};for(var t in this.privateEvents){if(this.privateEvents.hasOwnProperty(t)){BX.addCustomEvent(this,t,this.privateEvents[t])}}},bindLHEEvents:function(){if(!this.getLHE()){return}this.getLHE().exec(function(){BX.removeAllCustomEvents(this.getLHE().oEditor,"OnCtrlEnter");BX.addCustomEvent(this.getLHE().oEditor,"OnCtrlEnter",function(){this.getLHE().oEditor.SaveContent();BX.onCustomEvent(t,"OnButtonClick",["submit"])}.bind(this))}.bind(this));var t=this.getLHEEventNode();BX.addCustomEvent(t,"OnBeforeHideLHE",function(){BX.removeClass(document.documentElement,"bx-ios-fix-frame-focus");if(top&&top["document"]){BX.removeClass(top["document"]["documentElement"],"bx-ios-fix-frame-focus")}BX.onCustomEvent(this.form,"OnUCFormBeforeHide",[this,this.currentEntity])}.bind(this));BX.addCustomEvent(t,"OnAfterHideLHE",function(){if(this.currentEntity!==null){var t=this.currentEntity.getPlaceholder(this.currentEntity.messageId);if(t)BX.hide(t)}BX.onCustomEvent(this.form,"OnUCFormAfterHide",[this,this.currentEntity]);this.stopCheckWriting();this.clear();BX.onCustomEvent(window,"OnUCFeedChanged",[this.id])}.bind(this));BX.addCustomEvent(t,"OnBeforeShowLHE",function(){if(BX.browser.IsIOS()&&BX.browser.IsMobile()){BX.addClass(window["document"]["documentElement"],"bx-ios-fix-frame-focus");if(top&&top["document"])BX.addClass(top["document"]["documentElement"],"bx-ios-fix-frame-focus")}}.bind(this));BX.addCustomEvent(t,"OnAfterShowLHE",function(){this.startCheckWriting();BX.onCustomEvent(window,"OnUCFeedChanged",[this.id])}.bind(this));BX.addCustomEvent(t,"OnClickSubmit",this.submit.bind(this));BX.addCustomEvent(t,"OnClickCancel",this.cancel.bind(this));BX.removeCustomEvent(window,"onInitialized",this.__bindLHEEvents);delete this.__bindLHEEvents},getLHE:function(){if(!this.handler){this.handler=LHEPostForm.getHandlerByFormId(this.formId)}return this.handler},getLHEEventNode:function(){if(!this.handlerEventNode&&this.getLHE()){this.handlerEventNode=this.getLHE().eventNode}return this.handlerEventNode},bindEntity:function(t){if(this.entities.has(t.getId())){BX.onCustomEvent(this.form,"onUnbindEntity",[t]);this.entities.delete(t.getId())}this.entities.set(t.getId(),t);this.xmls.set(t.getXmlId(),t)},onInitEditorFrame:function(t){this.getLHE().exec(function(){BX.addCustomEvent(this.getLHE().oEditor,"OnAfterIframeInit",(()=>{t();BX.removeAllCustomEvents(this.getLHE().oEditor,"OnAfterIframeInit")}))}.bind(this))},onQuote:function(t,e,i,n,s){if(this.isFormOccupied(t)){return}const o=()=>{var t=BX.util.htmlspecialchars(i);if(!this.getLHE().oEditor.toolbar.controls.Quote){BX.DoNothing()}else if(!e&&!i){this.getLHE().oEditor.action.Exec("quote")}else{i=t;var n=e&&e.gender?BX.message("MPL_HAVE_WRITTEN_"+e.gender):BX.message("MPL_HAVE_WRITTEN");if(this.getLHE().oEditor.GetViewMode()=="wysiwyg"){i=i.replace(/\n/g,"<br/>");if(e){if(e.id>0){e='<span id="'+this.getLHE().oEditor.SetBxTag(false,{tag:"postuser",userId:e.id,userName:e.name})+'" class="bxhtmled-metion">'+e.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>"}else{e="<span>"+e.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>"}e=e!==""?e+n+"<br/>":"";i=e+i}}else if(this.getLHE().oEditor.bbCode){if(e){if(e.id>0){e="[USER="+e.id+"]"+e.name+"[/USER]"}else{e=e.name}e=e!==""?e+n+"\n":"";i=e+i}}if(this.getLHE().oEditor.action.actions.quote.setExternalSelectionFromRange){this.getLHE().oEditor.action.actions.quote.setExternalSelectionFromRange();var s=this.getLHE().oEditor.action.actions.quote.getExternalSelection();let i=BX.create("DIV",{html:s});let n=i.querySelector(".feed-post-emoji-container");if(n){i.removeChild(n);s=i.innerHTML}if(s===""&&t!==""){s=t}s=(BX.type.isNotEmptyString(e)?e:"")+s;if(BX.type.isNotEmptyString(s))this.getLHE().oEditor.action.actions.quote.setExternalSelection(s)}else{this.getLHE().oEditor.action.actions.quote.setExternalSelection(i)}this.getLHE().oEditor.action.Exec("quote")}};const r=this.currentEntity&&parseInt(this.currentEntity.messageId,10);if(this.currentEntity&&!r){this.show(t);o()}else{this.show(t);this.onInitEditorFrame(o)}},onReply:function(t,e){if(this.isFormOccupied(t)){return}if(this.currentEntity){this.show(t);this.insertMention(e)}else{this.show(t);this.onInitEditorFrame(this.insertMention.bind(this,e))}},onEdit:function(t,e,i,n){if(n==="EDIT"){this.show(t,e,i["messageBBCode"],i["messageFields"]);return}this.hide(true);this.setCurrentEntity(t,e);if(i["errorMessage"]){this.showError(i["errorMessage"])}else if(i["okMessage"]){this.showNote(i["okMessage"]);this.nullCurrentEntity()}},isFormOccupied:function(t){if(this.currentEntity!==null&&this.currentEntity!==t&&this.isFormChanged()){return!window.confirm(BX.message("MPL_SAFE_EDIT"))}return false},isFormChanged:function(){if(this.getLHE()&&this.getLHE().editorIsLoaded&&this.getLHE().oEditor.IsContentChanged()){return true}return false},insertMention:function(t){if(t.id>0){this.getLHE().exec(window.BxInsertMention,[{item:{entityId:t.id,name:t.name},type:"user",formID:this.formId,editorId:this.getLHE().oEditorId,bNeedComa:true,insertHtml:true}])}},startCheckWriting:function(){if(!this.getLHE().editorIsLoaded||this._checkWriteTimeout===false){return}this.__content_length=this.__content_length>0?this.__content_length:0;var t=this.getLHE().oEditor.GetContent(),e=2e3;if(t.length>=4&&this.__content_length!==t.length&&this.id){BX.onCustomEvent(this.form,"OnUCUserIsWriting",[this.currentEntity,{sent:false}]);e=3e4}this._checkWriteTimeout=setTimeout(this.startCheckWriting,e);this.__content_length=t.length},stopCheckWriting:function(){clearTimeout(this._checkWriteTimeout);this._checkWriteTimeout=false;this.__content_length=0},setCurrentEntity:function(t,e){this.currentEntity=t;this.currentEntity.messageId=e;this.currentEntity.operationId=BX.util.getRandomString(20);this.id=[this.currentEntity.getXmlId(),e]},nullCurrentEntity:function(){delete this.currentEntity.messageId;this.currentEntity=null;this.id=null},hide:function(t){if(this.getLHEEventNode()&&this.getLHEEventNode().style.display!=="none"){BX.onCustomEvent(this.getLHEEventNode(),"OnShowLHE",[t===true?false:"hide"])}if(t){document.body.appendChild(this.form)}},clear:function(){var t=this.currentEntity?this.currentEntity.getPlaceholder(this.currentEntity.messageId):null;if(t){BX.hide(t);this.clearNotification(t,"feed-add-error")}BX.onCustomEvent(this.form,"OnUCFormClear",[this]);var e=BX.findChild(this.form,{className:"wduf-placeholder-tbody"},true,false);if(e!==null&&typeof e!="undefined")BX.cleanNode(e,false);e=BX.findChild(this.form,{className:"wduf-selectdialog"},true,false);if(e!==null&&typeof e!="undefined")BX.hide(e);e=BX.findChild(this.form,{className:"file-placeholder-tbody"},true,false);if(e!==null&&typeof e!="undefined")BX.cleanNode(e,false);this.nullCurrentEntity()},show:function(t,e,i,n){e=parseInt(e>0?e:0);var s=t.getPlaceholder(e);if(this.currentEntity===t&&this.currentEntity.messageId===e){this.getLHE().oEditor.Focus();setTimeout(function(){if(!this.isElementCompletelyVisibleOnScreen(s)){s.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}}.bind(this),100);return true}if(this.getLHEEventNode()&&this.getLHEEventNode().style.display!=="none"&&BX.Dom.getPosition(s).y>BX.Dom.getPosition(this.getLHEEventNode()).y){window.scrollTo(window.scrollX,window.scrollY-this.getLHEEventNode().offsetHeight+10)}this.hide(true);this.setCurrentEntity(t,e);BX.removeClass(s,"feed-com-add-box-no-form");BX.removeClass(s,"feed-com-add-box-header");s.appendChild(this.form);BX.onCustomEvent(this.form,"OnUCFormBeforeShow",[this,i,n]);BX.show(s);BX.onCustomEvent(this.getLHEEventNode(),"OnShowLHE",["show",null,this.id]);BX.onCustomEvent(this.form,"OnUCFormAfterShow",[this,i,n]);return true},isElementCompletelyVisibleOnScreen:function(t){var e=BX.LazyLoad.getElementCoords(t);var i=window.pageYOffset||document.documentElement.scrollTop;var n=i+document.documentElement.clientHeight;e.bottom=e.top+t.offsetHeight;return e.top>i&&e.top<n&&e.bottom<n&&e.bottom>i},onSubmitSuccess:function(t){this.closeWait();var e=t,i=this.id[0];BX.onCustomEvent(this.form,"OnUCFormResponse",[this,t]);if(!!this.OnUCFormResponseData)t=this.OnUCFormResponseData;if(!!t){if(t["errorMessage"]){this.showError(t["errorMessage"])}else if(t["status"]=="error"){this.showError(BX.type.isNotEmptyString(t["message"])?t["message"]:"")}else{BX.onCustomEvent(this.form,"OnUCAfterRecordAdd",[this.id[0],t,e]);this.hide(true)}}this.busy=false;BX.onCustomEvent(window,"OnUCFormResponse",[i,t["messageId"],this,t])},onSubmitFailed:function(t){this.closeWait();if(BX.type.isPlainObject(t)){var e="Unknown error.";if(BX.type.isPlainObject(t["data"])&&BX.type.isPlainObject(t["data"]["ajaxRejectData"])&&BX.type.isNotEmptyString(t["data"]["ajaxRejectData"]["message"])){e=t["data"]["ajaxRejectData"]["message"]}else if(BX.type.isArray(t["errors"])){e=t["errors"].map((function(t){return t.message})).join("<br >")}this.showError(e)}this.busy=false;BX.onCustomEvent(window,"OnUCFormResponse",[this.id[0],this.id[1],this,[]])},submit:function(){if(this.busy===true){return"busy"}var t=this.getLHE().editorIsLoaded?this.getLHE().oEditor.GetContent():"";if(!t){this.showError(BX.message("JERROR_NO_MESSAGE"));return false}this.showWait();this.busy=true;var e={};convertFormToArray(this.form,e);e["REVIEW_TEXT"]=t;e["NOREDIRECT"]="Y";e["MODE"]="RECORD";e["AJAX_POST"]="Y";e["id"]=this.id;e["SITE_ID"]=BX.message("SITE_ID");e["LANGUAGE_ID"]=BX.message("LANGUAGE_ID");e["ACTION"]="ADD";if(this.currentEntity!==null&&this.currentEntity.messageId>0){e["REVIEW_ACTION"]="EDIT";e["FILTER"]={ID:this.id[1]};e["ACTION"]="EDIT";e["ID"]=this.id[1]}BX.onCustomEvent(this.form,"OnUCFormSubmit",[this,e]);BX.onCustomEvent(window,"OnUCFormSubmit",[this.id[0],this.id[1],this,e]);if(this.currentEntity!==null&&this.currentEntity.ajax["processComment"]===true){BX.ajax.runComponentAction(this.currentEntity.ajax.componentName,"processComment",{mode:"class",data:e,signedParameters:this.currentEntity.ajax.params}).then(this.onSubmitSuccess,this.onSubmitFailed)}else{var i=this.form.action;i=BX.util.remove_url_param(i,["b24statAction"]);i=BX.util.add_url_param(i,{b24statAction:this.id[1]>0?"editComment":"addComment"});this.form.action=i;BX.ajax({method:"POST",url:this.form.action,data:e,dataType:"json",onsuccess:this.onSubmitSuccess,onfailure:this.onSubmitFailed})}return false},cancel:function(){},clearNotification:function(t,e){var i=BX.findChildren(t,{tagName:"DIV",className:e},true);if(i){var n=i.pop();do{BX.remove(n)}while((n=i.pop())&&!!n)}},showError:function(t){if(!t||this.currentEntity===null)return;var e=this.currentEntity.getPlaceholder(this.currentEntity.messageId);this.clearNotification(e,"feed-add-error");BX.addClass(e,!e.firstChild?"feed-com-add-box-no-form":"feed-com-add-box-header");e.insertBefore(BX.create("div",{attrs:{class:"feed-add-error"},html:'<span class="feed-add-info-text"><span class="feed-add-info-icon"></span>'+"<b>"+BX.message("FC_ERROR")+"</b><br />"+t+"</span>"}),e.firstChild);BX.show(e)},showNote:function(t){if(!t||this.currentEntity===null)return;var e=this.currentEntity.getPlaceholder(this.currentEntity.messageId);this.clearNotification(e,"feed-add-error");this.clearNotification(e,"feed-add-successfully");BX.addClass(e,!e.firstChild?"feed-com-add-box-no-form":"feed-com-add-box-header");e.insertBefore(BX.create("div",{attrs:{class:"feed-add-successfully"},html:'<span class="feed-add-info-text"><span class="feed-add-info-icon"></span>'+t+"</span>"}),e.firstChild);BX.addClass(e,"comment-deleted");BX.show(e)},showWait:function(){var t=BX("lhe_button_submit_"+this.form.id);this.busy=true;if(!!t){BX.addClass(t,"ui-btn-clock");BX.defer((function(){t.disabled=true}))()}},closeWait:function(){var t=BX("lhe_button_submit_"+this.form.id);this.busy=false;if(!!t){t.disabled=false;BX.removeClass(t,"ui-btn-clock")}}};window.UCForm.bindFormToEntity=function(e,i){var n=t[e]||new UCForm(e);n.bindEntity(i);t[e]=n;return n};window.convertFormToArray=function(t,e){e=!!e?e:[];if(!!t){var i,n=[],s=t.elements.length;for(i=0;i<s;i++){var o=t.elements[i];if(o.disabled)continue;switch(o.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":n.push({name:o.name,value:o.value});break;case"radio":case"checkbox":if(o.checked)n.push({name:o.name,value:o.value});break;case"select-multiple":for(var r=0;r<o.options.length;r++){if(o.options[r].selected)n.push({name:o.name,value:o.options[r].value})}break;default:break}}var a=e;i=0;while(i<n.length){var d=n[i].name.indexOf("[");if(d==-1){a[n[i].name]=n[i].value;a=e;i++}else{var h=n[i].name.substring(0,d);var c=n[i].name.substring(d+1);if(!a[h])a[h]=[];var u=c.indexOf("]");if(u==-1){a=e;i++}else if(u===0){a=a[h];n[i].name=""+a.length}else{a=a[h];n[i].name=c.substring(0,u)+c.substring(u+1)}}}}return e};window["fRefreshCaptcha"]=function(t){var e=null,i=BX.findChild(t,{attr:{name:"captcha_code"}},true),n=BX.findChild(t,{attr:{name:"captcha_word"}},true),s=BX.findChild(t,{className:"comments-reply-field-captcha-image"},true);if(s)e=BX.findChild(s,{tag:"img"});if(i&&n&&e){n.value="";BX.ajax.getCaptcha((function(t){i.value=t["captcha_sid"];e.src="/bitrix/tools/captcha.php?captcha_code="+t["captcha_sid"]}))}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.min.js?17264562448220";s:6:"source";s:77:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.map.js";}"*/
(function(){window["UC"]=!!window["UC"]?window["UC"]:{};if(!!window["UC"]["Informer"])return;window.SPC=function(){this.stack=[];this.stackTimeout=null;this.stackPopup={};this.stackPopupTimeout={};this.stackPopupTimeout2={};this.stackPopupId=0;this.stackOverflow=false;this.notifyShow=0;this.notifyHideTime=5e3;this.notifyHeightCurrent=10;this.notifyHeightMax=0;this.notifyGarbageTimeout=null;this.notifyAutoHide=true;this.notifyAutoHideTimeout=null};var t=window.SPC;t.prototype.add=function(t){if(typeof t!="object"||!t.html)return false;if(BX.type.isDomNode(t.html))t.html=t.html.outerHTML;this.stack.push(t);if(!this.stackOverflow)this.setShowTimer(300);return true};t.prototype.remove=function(t){delete this.stack[t]};t.prototype.show=function(){this.notifyHeightMax=document.body.offsetHeight;var t=BX.GetWindowInnerSize();for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]=="undefined")continue;var i=new BX.PopupWindow("bx-sbpc-notify-flash-"+this.stackPopupId,{top:0,left:0},{lightShadow:true,zIndex:200,events:{onPopupClose:BX.delegate(function(){BX.proxy_context.popupContainer.style.opacity=0;this.notifyShow--;this.notifyHeightCurrent-=BX.proxy_context.popupContainer.offsetHeight+10;this.stackOverflow=false;setTimeout(BX.delegate(function(){this.destroy()},BX.proxy_context),1500)},this),onPopupDestroy:BX.delegate(function(){BX.unbindAll(BX.findChild(BX.proxy_context.popupContainer,{className:"bx-spbc-notifier-item-delete"},true));BX.unbindAll(BX.proxy_context.popupContainer);delete this.stackPopup[BX.proxy_context.uniquePopupId];delete this.stackPopupTimeout[BX.proxy_context.uniquePopupId];delete this.stackPopupTimeout2[BX.proxy_context.uniquePopupId]},this)},bindOnResize:false,content:BX.create("div",{props:{className:"bx-notifyManager-item-sbpc"},html:this.stack[e].html})});i.notifyParams=this.stack[e];i.notifyParams.id=e;i.show();BX.removeClass(i.popupContainer.firstChild,"popup-window");i.popupContainer.style.left=10+"px";i.popupContainer.style.opacity=0;if(this.notifyHeightMax<this.notifyHeightCurrent+i.popupContainer.offsetHeight+10){if(this.notifyShow>0){i.destroy();this.stackOverflow=true;break}}BX.addClass(i.popupContainer,"bx-notifyManager-animation-spbc");new BX.easing({duration:500,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){if(BX(i)&&BX(i.popupContainer))i.popupContainer.style.opacity=t.opacity/100}}).animate();i.popupContainer.style.top=t.innerHeight-this.notifyHeightCurrent-i.popupContainer.offsetHeight-10+"px";this.notifyHeightCurrent=this.notifyHeightCurrent+i.popupContainer.offsetHeight+10;this.stackPopupId++;this.notifyShow++;this.remove(e);this.stackPopupTimeout[i.uniquePopupId]=null;BX.bind(i.popupContainer,"mouseover",BX.delegate(function(){this.clearAutoHide()},this));BX.bind(i.popupContainer,"mouseout",BX.delegate(function(){this.setAutoHide(this.notifyHideTime/2)},this));BX.bind(i.popupContainer,"contextmenu",BX.delegate(function(t){if(this.stackPopup[BX.proxy_context.id].notifyParams.tag)this.closeByTag(this.stackPopup[BX.proxy_context.id].notifyParams.tag);else this.stackPopup[BX.proxy_context.id].close();return BX.PreventDefault(t)},this));var o=BX.findChildren(i.popupContainer,{tagName:"a"},true);for(var s=0;s<o.length;s++){if(o[s].href!="#")o[s].target="_blank"}BX.bind(BX.findChild(i.popupContainer,{className:"bx-spbc-notifier-item-delete"},true),"click",BX.delegate(function(t){var e=BX.proxy_context.parentNode.parentNode.parentNode.parentNode.id.replace("popup-window-content-","");if(this.stackPopup[e].notifyParams.close)this.stackPopup[e].notifyParams.close(this.stackPopup[e]);this.stackPopup[e].close();if(this.notifyAutoHide===false){this.clearAutoHide();this.setAutoHide(this.notifyHideTime/2)}return BX.PreventDefault(t)},this));if(i.notifyParams.click){i.popupContainer.style.cursor="pointer";BX.bind(i.popupContainer,"click",BX.delegate(function(t){this.notifyParams.click(this);return BX.PreventDefault(t)},i))}this.stackPopup[i.uniquePopupId]=i}if(this.stack.length>0){this.clearAutoHide(true);this.setAutoHide(this.notifyHideTime)}this.garbage()};t.prototype.closeByTag=function(t){for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]!="undefined"&&this.stack[e].tag==t){delete this.stack[e]}}for(e in this.stackPopup){if(this.stackPopup.hasOwnProperty(e))if(this.stackPopup[e].notifyParams.tag==t)this.stackPopup[e].close()}};t.prototype.setShowTimer=function(t){clearTimeout(this.stackTimeout);this.stackTimeout=setTimeout(BX.delegate(this.show,this),t)};t.prototype.setAutoHide=function(t){this.notifyAutoHide=true;clearTimeout(this.notifyAutoHideTimeout);this.notifyAutoHideTimeout=setTimeout(BX.delegate(function(){for(var e in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(e)){this.stackPopupTimeout[e]=setTimeout(BX.delegate(function(){this.close()},this.stackPopup[e]),t-1e3);this.stackPopupTimeout2[e]=setTimeout(BX.delegate(function(){this.setShowTimer(300)},this),t-700)}}},this),1e3)};t.prototype.clearAutoHide=function(t){clearTimeout(this.notifyGarbageTimeout);this.notifyAutoHide=false;t=t===true;var e;if(t){clearTimeout(this.stackTimeout);for(e in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(e)){clearTimeout(this.stackPopupTimeout[e]);clearTimeout(this.stackPopupTimeout2[e])}}}else{clearTimeout(this.notifyAutoHideTimeout);this.notifyAutoHideTimeout=setTimeout(BX.delegate(function(){clearTimeout(this.stackTimeout);for(var t in this.stackPopupTimeout){if(this.stackPopupTimeout.hasOwnProperty(t)){clearTimeout(this.stackPopupTimeout[t]);clearTimeout(this.stackPopupTimeout2[t])}}},this),300)}};t.prototype.garbage=function(){clearTimeout(this.notifyGarbageTimeout);this.notifyGarbageTimeout=setTimeout(BX.delegate(function(){var t=[];for(var e=0;e<this.stack.length;e++){if(typeof this.stack[e]!="undefined")t.push(this.stack[e])}this.stack=t},this),1e4)};t.prototype.check=function(t,e,i,o){if(t[1]<=0||!window["UC"]["Informer"]||!BX.type.isNotEmptyString(o))return;var s=/(\d+)/g.exec(t[0]),n=BX("record-"+t.join("-")+"-cover");s=!!s?parseInt(s):0;if(s<=0||!n)return false;else if(BX.util.in_array(s,window["UC"]["InformerTags"][i]))return true;window["UC"]["InformerTags"][i].push(s);var a=!!e&&!!e["messageFields"]?e["messageFields"]:false;if(!a)return;var r=BX.pos(n),p=BX.GetWindowScrollPos(),u=BX.GetWindowInnerSize();if(r.top<p.scrollTop||r.top>p.scrollTop+u.innerHeight-20){setTimeout(function(){if(parseInt(a["AUTHOR"]["ID"])!=parseInt(BX.message("USER_ID"))){var e=BX.create("div",{props:{className:"bx-spbc-notifier-item"},children:[BX.create("span",{props:{className:"bx-spbc-notifier-item-content"},children:[BX.create("span",{props:{className:"bx-spbc-notifier-item-avatar"},children:[!!a["AUTHOR"]["AVATAR"]?BX.create("img",{props:{className:"bx-spbc-notifier-item-avatar-img"},attrs:{src:a["AUTHOR"]["AVATAR"]}}):""]}),BX.create("a",{attrs:{href:"#"},props:{className:"bx-spbc-notifier-item-delete"}}),BX.create("span",{props:{className:"bx-spbc-notifier-item-name"},html:a["AUTHOR"]["NAME"]}),BX.create("span",{props:{className:"bx-spbc-notifier-item-time"},html:a["POST_TIME"]}),BX.create("span",{props:{className:"bx-spbc-notifier-item-text"}}),BX.create("span",{props:{className:"bx-spbc-notifier-item-text2"},html:'"'+o+'"'})]})]}),i=BX.GetWindowScrollPos();window["UC"]["Informer"].add({html:e,tag:"im-record-"+t.join("-"),click:BX.delegate(function(){var e=BX.pos(BX("record-"+t.join("-")));new BX.easing({duration:500,start:{scroll:i.scrollTop},finish:{scroll:e.top-100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){window.scrollTo(0,t.scroll)}}).animate()},this)})}},50)}};t.NativeNotify=function(){return window.webkitNotifications&&window.webkitNotifications.checkPermission()==0};window["UC"]["Informer"]=new t;window["UC"]["InformerTags"]={};t.notifyManagerShow=function(){BX.ready(function(){BX.addCustomEvent("onNotifyManagerShow",function(t){if(t.originalTag){var e=t.originalTag.lastIndexOf("|"),i=t.originalTag.substr(0,e);if(!!window["UC"]["InformerTags"][i]){var o=parseInt(t.originalTag.substr(e+1));window["UC"]["InformerTags"][i].push(o)}}})})}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:98:"/bitrix/components/bitrix/intranet.bitrix24.banner/templates/.default/script.min.js?17264563572008";s:6:"source";s:79:"/bitrix/components/bitrix/intranet.bitrix24.banner/templates/.default/script.js";s:3:"min";s:83:"/bitrix/components/bitrix/intranet.bitrix24.banner/templates/.default/script.min.js";s:3:"map";s:83:"/bitrix/components/bitrix/intranet.bitrix24.banner/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};(function(e,t,i){"use strict";function r(e,t,i){s(e,t);t.set(e,i)}function s(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function a(e,t,i,r){c(e,t);o(i,"set");n(e,i,r);return r}function n(e,t,i){if(t.set){t.set.call(e,i)}else{if(!t.writable){throw new TypeError("attempted to set read only private field")}t.value=i}}function l(e,t,i){c(e,t);o(i,"get");return u(e,i)}function o(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function c(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function u(e,t){if(t.get){return t.get.call(e)}return t.value}var f=new WeakMap;var h=new WeakMap;var b=function(){function e(){babelHelpers.classCallCheck(this,e);r(this,f,{writable:true,value:void 0});r(this,h,{writable:true,value:{DEB:{text:i.Loc.getMessage("B24_BANNER_DOWNLOAD_LINUX_DEB"),href:"https://dl.bitrix24.com/b24/bitrix24_desktop.deb"},RPM:{text:i.Loc.getMessage("B24_BANNER_DOWNLOAD_LINUX_RPM"),href:"https://dl.bitrix24.com/b24/bitrix24_desktop.rpm"}}})}babelHelpers.createClass(e,[{key:"showMenuForLinux",value:function e(i,r){i.preventDefault();babelHelpers.classPrivateFieldSet(this,f,babelHelpers.classPrivateFieldGet(this,f)||new t.Menu({className:"system-auth-form__popup",bindElement:r,items:[{text:babelHelpers.classPrivateFieldGet(this,h).DEB.text,href:babelHelpers.classPrivateFieldGet(this,h).DEB.href,onclick:function e(t){t.close()}},{text:babelHelpers.classPrivateFieldGet(this,h).RPM.text,href:babelHelpers.classPrivateFieldGet(this,h).RPM.href,onclick:function e(t){t.close()}}],angle:true,offsetLeft:40}));babelHelpers.classPrivateFieldGet(this,f).toggle()}}],[{key:"getInstance",value:function t(){if(!l(this,e,p)){a(this,e,p,new this)}return l(this,e,p)}}]);return e}();var p={writable:true,value:void 0};e.Bitrix24Banner=b})(this.BX.Intranet=this.BX.Intranet||{},BX.Main,BX);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/intranet.ustat.online/templates/.default/script.min.js?172645635718875";s:6:"source";s:76:"/bitrix/components/bitrix/intranet.ustat.online/templates/.default/script.js";s:3:"min";s:80:"/bitrix/components/bitrix/intranet.ustat.online/templates/.default/script.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/intranet.ustat.online/templates/.default/script.map.js";}"*/
this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(e,t,n,i,r,a,s){"use strict";var o,l;var u=function(){function e(t){var n=this;babelHelpers.classCallCheck(this,e);this.parent=t;this.signedParameters=this.parent.signedParameters;this.componentName=this.parent.componentName;this.userInnerBlockNode=this.parent.userInnerBlockNode||"";this.timemanNode=this.parent.timemanNode;this.circleNode=this.parent.circleNode||"";this.isPopupShown=false;this.popupCurrentPage={};this.renderedUsers=[];r.Event.bind(this.userInnerBlockNode,"click",(function(){n.showPopup("getAllOnlineUser",n.userInnerBlockNode)}));r.Event.bind(this.circleNode,"click",(function(){n.showPopup("getAllOnlineUser",n.circleNode,-5)}));if(this.parent.isTimemanAvailable&&r.Type.isDomNode(this.parent.timemanNode)){var i=this.timemanNode.querySelector(".js-ustat-online-timeman-opened-block");var a=this.timemanNode.querySelector(".js-ustat-online-timeman-closed-block");r.Event.bind(i,"click",(function(){n.showPopup("getOpenedTimemanUser",i)}));r.Event.bind(a,"click",(function(){n.showPopup("getClosedTimemanUser",a)}))}}babelHelpers.createClass(e,[{key:"getPopupTitle",value:function e(t){var n="";if(t==="getAllOnlineUser"){n=r.Loc.getMessage("INTRANET_USTAT_ONLINE_USERS")}else if(t==="getOpenedTimemanUser"){n=r.Loc.getMessage("INTRANET_USTAT_ONLINE_STARTED_DAY")}else if(t==="getClosedTimemanUser"){n=r.Loc.getMessage("INTRANET_USTAT_ONLINE_FINISHED_DAY")}return n}},{key:"showPopup",value:function e(t,a,s){var l=this;if(this.isPopupShown){return}if(r.Type.isUndefined(s)){s=7}this.popupCurrentPage[t]=1;this.popupInnerContainer="";this.renderedUsers=[];this.allOnlineUserPopup=new n.Popup("intranet-ustat-online-popup-".concat(r.Text.getRandom()),a,{lightShadow:true,offsetLeft:t==="getClosedTimemanUser"?-60:-22,offsetTop:s,autoHide:true,closeByEsc:true,bindOptions:{position:"bottom"},animationOptions:{show:{type:"opacity-transform"},close:{type:"opacity"}},events:{onPopupDestroy:function e(){l.isPopupShown=false},onPopupClose:function e(){l.allOnlineUserPopup.destroy()},onAfterPopupShow:function e(n){i.EventEmitter.emit(i.EventEmitter.GLOBAL_TARGET,"BX.Intranet.UstatOnline:showPopup",new i.BaseEvent({data:{popup:n}}));var a=r.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<span class="intranet-ustat-online-popup-name-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<div class="intranet-ustat-online-popup-container">\n\t\t\t\t\t\t\t\t<div class="intranet-ustat-online-popup-content">\n\t\t\t\t\t\t\t\t\t<div class="intranet-ustat-online-popup-content-box">\n\t\t\t\t\t\t\t\t\t\t<div class="intranet-ustat-online-popup-inner"></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'])),l.getPopupTitle(t));n.contentContainer.appendChild(a);l.popupInnerContainer=a.querySelector(".intranet-ustat-online-popup-inner");l.loader=l.showLoader({node:a.querySelector(".intranet-ustat-online-popup-content"),loader:null,size:40});l.showUsersInPopup(t);l.isPopupShown=true},onPopupFirstShow:function e(t){i.EventEmitter.subscribe(i.EventEmitter.GLOBAL_TARGET,"SidePanel.Slider:onOpenStart",(function(){t.close()}))}},className:"intranet-ustat-online-popup"});this.popupScroll(t);this.allOnlineUserPopup.show()}},{key:"popupScroll",value:function e(t){var n=this;if(!r.Type.isDomNode(this.popupInnerContainer)){return}r.Event.bind(this.popupInnerContainer,"scroll",(function(){if(n.popupInnerContainer.scrollTop>(n.popupInnerContainer.scrollHeight-n.popupInnerContainer.offsetHeight)/1.5){n.showUsersInPopup(t);r.Event.unbindAll(n.popupInnerContainer,"scroll")}}))}},{key:"showUsersInPopup",value:function e(t){var n=this;if(t!=="getAllOnlineUser"&&t!=="getOpenedTimemanUser"&&t!=="getClosedTimemanUser"){return}BX.ajax.runComponentAction(this.componentName,t,{signedParameters:this.signedParameters,mode:"class",data:{pageNum:this.popupCurrentPage[t]}}).then((function(e){if(e.data){n.renderPopupUsers(e.data);n.popupCurrentPage[t]++;n.popupScroll(t)}else{if(!n.popupInnerContainer.hasChildNodes()){n.popupInnerContainer.innerText=r.Loc.getMessage("INTRANET_USTAT_ONLINE_EMPTY")}}n.hideLoader({loader:n.loader})}),(function(e){n.hideLoader({loader:n.loader})}))}},{key:"renderPopupUsers",value:function e(t){if(!this.allOnlineUserPopup||!r.Type.isDomNode(this.popupInnerContainer)||!r.Type.isObjectLike(t)){return}for(var n in t){if(!t.hasOwnProperty(n)||this.renderedUsers.indexOf(t[n]["ID"])>=0){continue}this.renderedUsers.push(t[n]["ID"]);var i="<i></i>";if(r.Type.isString(t[n]["AVATAR"])&&t[n]["AVATAR"]){i="<i style=\"background-image: url('".concat(encodeURI(t[n]["AVATAR"]),"')\"></i>")}var a=r.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<a \n\t\t\t\t\tclass="intranet-ustat-online-popup-item"\n\t\t\t\t\thref="','" \n\t\t\t\t\ttarget="_blank"\n\t\t\t\t>\n\t\t\t\t\t<span class="intranet-ustat-online-popup-avatar-new">\n\t\t\t\t\t\t<div class="ui-icon ui-icon-common-user intranet-ustat-online-popup-avatar-img">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class="intranet-ustat-online-popup-avatar-status-icon"></span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="intranet-ustat-online-popup-name">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</a>\n\t\t\t"])),t[n]["PATH_TO_USER_PROFILE"],i,t[n]["NAME"]);this.popupInnerContainer.appendChild(a)}}},{key:"showLoader",value:function e(t){var n=null;if(t.node){if(t.loader===null){n=new BX.Loader({target:t.node,size:t.hasOwnProperty("size")?t.size:40})}else{n=t.loader}n.show()}return n}},{key:"hideLoader",value:function e(t){if(t.loader!==null){t.loader.hide()}if(t.node){r.Dom.clean(t.node)}if(t.loader!==null){t.loader=null}}}]);return e}();function c(e,t){var n=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=d(e))||t&&e&&typeof e.length==="number"){if(n)e=n;var i=0;var r=function e(){};return{s:r,n:function t(){if(i>=e.length)return{done:true};return{done:false,value:e[i++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,s=false,o;return{s:function t(){n=n.call(e)},n:function e(){var t=n.next();a=t.done;return t},e:function e(t){s=true;o=t},f:function e(){try{if(!a&&n["return"]!=null)n["return"]()}finally{if(s)throw o}}}}function d(e,t){if(!e)return;if(typeof e==="string")return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}function h(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var p=function(){function e(t){babelHelpers.classCallCheck(this,e);this.parent=t;this.signedParameters=this.parent.signedParameters;this.componentName=this.parent.componentName;this.isTimemanAvailable=this.parent.isTimemanAvailable;this.timemanNode=this.parent.timemanNode;this.containerNode=this.parent.ustatOnlineContainerNode;if(this.isTimemanAvailable&&r.Type.isDomNode(this.timemanNode)){this.timemanValueNodes=this.timemanNode.querySelectorAll(".intranet-ustat-online-value");this.timemanTextNodes=this.timemanNode.querySelectorAll(".js-ustat-online-timeman-text");this.resizeTimemanText();this.subscribePullEvent()}}babelHelpers.createClass(e,[{key:"resizeTimemanText",value:function e(){if(!r.Type.isDomNode(this.timemanNode)){return}var t=0;var n=0;if(r.Type.isArrayLike(this.timemanTextNodes)){var i=c(this.timemanTextNodes),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;var o=s.textContent.length;t+=o}}catch(e){i.e(e)}finally{i.f()}}if(r.Type.isArrayLike(this.timemanValueNodes)){var l=c(this.timemanValueNodes),u;try{for(l.s();!(u=l.n()).done;){var d=u.value;var h=d.textContent.length;n+=h}}catch(e){l.e(e)}finally{l.f()}}if(t>=17&&n>=6||t>=19&&n>=4){r.Dom.addClass(this.timemanNode,"intranet-ustat-online-info-text-resize")}else{r.Dom.removeClass(this.timemanNode,"intranet-ustat-online-info-text-resize")}}},{key:"redrawTimeman",value:function e(t){if(t.hasOwnProperty("OPENED")){var n=this.containerNode.querySelector(".js-ustat-online-timeman-opened");if(r.Type.isDomNode(n)){n.innerHTML=t["OPENED"]}}if(t.hasOwnProperty("CLOSED")){var i=this.containerNode.querySelector(".js-ustat-online-timeman-closed");if(r.Type.isDomNode(i)){i.innerHTML=t["CLOSED"]}}this.resizeTimemanText()}},{key:"checkTimeman",value:function e(){var t=this;BX.ajax.runComponentAction(this.componentName,"checkTimeman",{signedParameters:this.signedParameters,mode:"class"}).then((function(e){if(e.data){t.redrawTimeman(e.data)}}))}},{key:"subscribePullEvent",value:function e(){var t=this;a.PULL.subscribe({moduleId:"intranet",command:"timemanDayInfo",callback:function e(n){t.redrawTimeman(n)}})}}]);return e}();var f=r.Reflection.namespace("BX.Intranet");var m=function(){function e(t){var n=this;babelHelpers.classCallCheck(this,e);this.signedParameters=t.signedParameters;this.componentName=t.componentName;this.ustatOnlineContainerNode=t.ustatOnlineContainerNode||"";this.maxUserToShow=t.maxUserToShow;this.maxOnlineUserCountToday=t.maxOnlineUserCountToday;this.currentUserId=parseInt(t.currentUserId);this.isTimemanAvailable=t.isTimemanAvailable==="Y";this.isFullAnimationMode=t.isFullAnimationMode==="Y";this.limitOnlineSeconds=t.limitOnlineSeconds;this.renderingFinished=true;if(!r.Type.isDomNode(this.ustatOnlineContainerNode)){return}this.userBlockNode=this.ustatOnlineContainerNode.querySelector(".intranet-ustat-online-icon-box");this.userInnerBlockNode=this.ustatOnlineContainerNode.querySelector(".intranet-ustat-online-icon-inner");this.circleNode=this.ustatOnlineContainerNode.querySelector(".ui-graph-circle");this.timemanNode=this.ustatOnlineContainerNode.querySelector(".intranet-ustat-online-info");var i=t.users;var a=t.allOnlineUserIdToday;this.users=i.map((function(e){e.id=parseInt(e.id);e.offline_date=n.getOfflineDate(e.last_activity_date);return e}));this.allOnlineUserIdToday=a.map((function(e){return parseInt(e)}));this.online=[].concat(this.users);this.counter=0;this.ITEMS={obClientDb:null,obClientDbData:{},obClientDbDataSearchIndex:{},bMenuInitialized:false,initialized:{sonetgroups:false,menuitems:false},oDbSearchResult:{}};BX.Finder(false,"searchTitle",[],{},this);BX.onCustomEvent(this,"initFinderDb",[this.ITEMS,"searchTitle",null,["users"],this]);if(r.Type.isDomNode(this.ustatOnlineContainerNode)){BX.UI.Hint.init(this.ustatOnlineContainerNode)}new u(this);this.timemanObj=new p(this);var s=new Date;this.currentDate=new Date(s.getFullYear(),s.getMonth(),s.getDate()).valueOf();this.checkOnline();if(this.isFullAnimationMode){setTimeout((function(){n.subscribePullEvent()}),3e3);setInterval((function(){return n.checkOnline()}),6e4)}else{BX.addCustomEvent(window,"onImUpdateUstatOnline",BX.proxy(this.updateOnlineRestrictedMode,this))}}babelHelpers.createClass(e,[{key:"updateOnlineRestrictedMode",value:function e(t){this.counter=t.count;this.maxOnlineUserCountToday=t.count;this.online=t.users;this.redrawOnline()}},{key:"getOfflineDate",value:function e(t){return t?new Date(t).getTime()+parseInt(this.limitOnlineSeconds)*1e3:null}},{key:"checkOnline",value:function e(){var t=this;this.online=this.online.filter((function(e){return e&&(e.offline_date>+new Date||e.id===t.currentUserId)}));var n=this.counter;if(this.online.length>0){this.counter=this.online.map((function(e){return 1})).reduce((function(e){return e+1}))}else{this.counter=0}if(this.checkNewDay()||n!==this.counter){this.redrawOnline()}}},{key:"checkNewDay",value:function e(){var t=new Date;var n=new Date(t.getFullYear(),t.getMonth(),t.getDate()).valueOf();if(this.currentDate<n){this.maxOnlineUserCountToday=this.online.length;if(this.isTimemanAvailable){this.timemanObj.checkTimeman()}this.currentDate=n;return true}return false}},{key:"setUserOnline",value:function e(t){var n=this;var i=this.getNumberUserId(t.id);this.findUser(i).then((function(e){e.id=n.getNumberUserId(e.id);if(typeof t.last_activity_date!=="undefined"){e.last_activity_date=t.last_activity_date}if(e.isExtranet!=="Y"){n.setUserToLocal(e);n.checkOnline()}}))["catch"]((function(e){}))}},{key:"setUserToLocal",value:function e(t){t.offline_date=this.getOfflineDate(t.last_activity_date);this.users=this.users.filter((function(e){return e.id!==t.id}));this.users.push(t);var n=false;this.online.forEach((function(e){if(e.id===t.id){n=true}}));if(!n){this.online.unshift(t)}if(this.allOnlineUserIdToday.indexOf(t.id)===-1){this.allOnlineUserIdToday.push(t.id);this.maxOnlineUserCountToday++}}},{key:"setUserOnlineMultiply",value:function e(t){var n=this;var i=[];var r=0;var a=[];t.forEach((function(e){var t=parseInt(e.id);a.push(new Promise((function(e,a){n.findUser(t,true).then((function(t){r++;n.setUserToLocal(t);e()}))["catch"]((function(n){i.push(t);e()}))})))}));Promise.all(a).then((function(){if(i.length<=0){return false}var e=n.maxUserToShow-r;if(e<=0){return true}i=i.slice(0,e);BX.rest.callMethod("im.user.list.get",{ID:i}).then((function(e){var t=e.data();if(!t){return false}for(var i in t){if(!t.hasOwnProperty(i)){continue}var r=t[i];if(!r){continue}var a={};a.id=parseInt(r.id);a.name=r.name;a.avatar=BX.MessengerCommon.isBlankAvatar(r.avatar)?"":r.avatar;a.last_activity_date=r.last_activity_date;n.setUserToLocal(a)}}))["catch"]((function(e){}))}))}},{key:"findUser",value:function e(t){var n=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;t=parseInt(t);return new Promise((function(e,r){var a=null;a=n.users.find((function(e){return e.id===t}));if(a){e(a);return true}a=n.getUserFromMessenger(t);if(a){e(a);return true}n.getUserFromDb(t).then((function(t){e(t);return true}))["catch"]((function(a){if(i){r(null);return true}n.getUserFromServer(t).then((function(t){n.addUserToDb(t);e(t)}))["catch"]((function(e){r(null)}))}));return true}))}},{key:"getUserFromMessenger",value:function e(t){if(typeof window.BX.MessengerCommon==="undefined"){return null}var n=BX.MessengerCommon.getUser(t);if(!n){return null}var i={id:parseInt(n.id),name:n.name,avatar:BX.MessengerCommon.isBlankAvatar(n.avatar)?"":n.avatar,last_activity_date:null};if(n.last_activity_date instanceof Date){i.last_activity_date=n.last_activity_date.toISOString()}if(typeof n.last_activity_date==="string"){i.last_activity_date=n.last_activity_date}return i}},{key:"getUserFromDb",value:function e(t){var n=this;return new Promise((function(e,i){BX.indexedDB.getValue(n.ITEMS.obClientDb,"users","U"+t).then((function(t){if(t&&babelHelpers["typeof"](t)==="object"){if(t.hasOwnProperty("entityId")){t.id=n.getNumberUserId(t.entityId)}e(t)}else{e(null)}}))["catch"]((function(e){i(null)}))}))}},{key:"addUserToDb",value:function e(t){t.id="U"+t.id;BX.indexedDB.addValue(this.ITEMS.obClientDb,"users",t)}},{key:"getUserFromServer",value:function e(n){return new Promise((function(e,i){if(typeof window.BX.MessengerCommon==="undefined"){e(null);return false}t.rest.callMethod("im.user.get",{id:n}).then((function(t){if(t.data()&&t.data().external_auth_id!=="__controller"){var n={};n.id=parseInt(t.data().id);n.name=t.data().name;n.avatar=BX.MessengerCommon.isBlankAvatar(t.data().avatar)?"":t.data().avatar;n.last_activity_date=t.data().last_activity_date;n.isExtranet=t.data().extranet?"Y":"N";n.active="Y";n.entityId=parseInt(t.data().id);e(n)}else{e(null)}}))["catch"]((function(t){e(null)}))}))}},{key:"subscribePullEvent",value:function e(){var t=this;BX.PULL.subscribe({type:"online",callback:function e(n){if(n.command==="userStatus"){for(var i in n.params.users){if(!n.params.users.hasOwnProperty(i)){continue}t.setUserOnline(n.params.users[i])}}}})}},{key:"getNumberUserId",value:function e(t){if(!t){return}var n=String(t);n=n.replace("U","");return parseInt(n)}},{key:"isDocumentVisible",value:function e(){return document.visibilityState==="visible"}},{key:"redrawOnline",value:function e(){this.showCircleAnimation(this.circleNode,this.counter,this.maxOnlineUserCountToday);if(this.renderingFinished){this.renderingFinished=false;this.renderAllUser()}}},{key:"renderAllUser",value:function e(){var t=this;var n=[];var i=[];this.online.forEach((function(e){i.push(parseInt(e.id))}));var a=i.slice(0,this.maxUserToShow);var s=this.userBlockNode.querySelectorAll(".js-ustat-online-user");if(this.online.length>100&&s.length>=this.maxUserToShow){return}for(var o in s){if(!s.hasOwnProperty(o)){continue}var l=parseInt(s[o].getAttribute("data-user-id"));if(i.indexOf(l)===-1){if(r.Type.isDomNode(s[o])){r.Dom.remove(s[o])}}else{n.push(parseInt(l))}}s=this.userBlockNode.querySelectorAll(".js-ustat-online-user");var u=s.length;var c=u!==0;this.userIndex=this.online.length;var d=function e(i){if(i>=t.maxUserToShow||i>=t.online.length){t.renderingFinished=true;return}new Promise((function(e){var s=t.online[i];if(n.indexOf(s.id)>=0){e();return}if(u<t.maxUserToShow){if(c){t.userIndex++}t.renderUser(s,c);n.push(s.id);u++;if(!c){t.userIndex=t.userIndex-1}e()}else{var o=t.userBlockNode.querySelectorAll(".js-ustat-online-user");var l=o[0];var d="";for(var h=o.length-1;h>=0;h--){if(r.Type.isDomNode(o[h])){var p=parseInt(o[h].getAttribute("data-user-id"));if(a.indexOf(p)===-1){d=o[h];break}}}if(r.Type.isDomNode(d)){var f=parseInt(d.getAttribute("data-user-id"));r.Dom.removeClass(d,"intranet-ustat-online-icon-show");if(t.isDocumentVisible()){r.Dom.addClass(d,"intranet-ustat-online-icon-hide")}t.userIndex=parseInt(l.style.zIndex);t.userIndex++;t.renderUser(s,c);n=n.filter((function(e){return e!==f}));n.push(s.id);if(t.isDocumentVisible()){r.Event.bind(d,"animationend",(function(t){r.Dom.remove(d);e()}))}else{r.Dom.remove(d);e()}}else{e()}}})).then((function(){e(++i)}))};d(0)}},{key:"renderUser",value:function e(t,n){if(!t||babelHelpers["typeof"](t)!=="object"){return}var i="";if(t.avatar){i='background-image: url("'+encodeURI(t.avatar)+'");'}var a=this.getNumberUserId(t.id);var s="ui-icon ui-icon-common-user intranet-ustat-online-icon js-ustat-online-user\n\t\t\t".concat(n&&this.isDocumentVisible()?" intranet-ustat-online-icon-show":"");this.userItem=BX.create("span",{attrs:{className:s,"data-user-id":a},style:{zIndex:this.userIndex},children:[BX.create("i",{attrs:{style:i}})]});if(n){r.Dom.prepend(this.userItem,this.userInnerBlockNode)}else{this.userInnerBlockNode.appendChild(this.userItem)}}},{key:"showCircleAnimation",value:function e(t,n,i){i=parseInt(i);n=parseInt(n);if(n<=0){n=1}if(n>i){i=n}var r=n*100/i;if(!this.circle){this.circle=new s.Circle(t,68,r,n,true);this.circle.show()}else{this.circle.updateCounter(r,n)}}}]);return e}();f.UstatOnline=m;e.UstatOnline=m})(this.BX.Intranet.UstatOnline=this.BX.Intranet.UstatOnline||{},BX,BX.Main,BX.Event,BX,BX,BX.UI.Graph);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:92:"/bitrix/components/bitrix/calendar.events.list/templates/widget/script.min.js?17264562643822";s:6:"source";s:73:"/bitrix/components/bitrix/calendar.events.list/templates/widget/script.js";s:3:"min";s:77:"/bitrix/components/bitrix/calendar.events.list/templates/widget/script.min.js";s:3:"map";s:77:"/bitrix/components/bitrix/calendar.events.list/templates/widget/script.map.js";}"*/
(function(e,t,i,n){"use strict";var a;var s=function(){function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"DOM",{});this.maxEntryAmount=i.maxEntryAmount||5;if(i&&i.entries){this.renderList(i.entries)}else{this.displayEventList()}this.displayEventListDebounce=t.Runtime.debounce(this.displayEventList,3e3,this);t.Event.bind(document,"visibilitychange",this.checkDisplayEventList.bind(this));n.EventEmitter.subscribe("SidePanel.Slider:onCloseComplete",this.checkDisplayEventList.bind(this));n.EventEmitter.subscribe("onPullEvent-calendar",this.displayEventListDebounce)}babelHelpers.createClass(e,[{key:"checkDisplayEventList",value:function e(){if(this.needReload){this.displayEventListDebounce()}}},{key:"displayEventList",value:function e(){var t=this;if(this.isDisplayingNow()){this.showLoader();this.getEventList().then((function(e){t.hideLoader();t.renderList(e)}))}else{this.needReload=true}}},{key:"getEventList",value:function e(){var t=this;return new Promise((function(e){BX.ajax.runAction("calendar.api.calendarentryajax.getnearestevents",{data:{ownerId:t.ownerId,type:t.type,futureDaysAmount:60,maxEntryAmount:t.maxEntryAmount}}).then((function(t){var i;e(t===null||t===void 0?void 0:(i=t.data)===null||i===void 0?void 0:i.entries)}))}))}},{key:"showWidget",value:function e(){this.getOuterWrap().style.display=""}},{key:"hideWidget",value:function e(){this.getOuterWrap().style.display="none"}},{key:"showLoader",value:function e(){this.hideLoader();this.DOM.loader=this.getEventListWrap().appendChild(i.Util.getLoader(40,"next-events-loader"))}},{key:"hideLoader",value:function e(){if(t.Type.isDomNode(this.DOM.loader)){t.Dom.remove(this.DOM.loader)}}},{key:"renderList",value:function e(){var i=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(!t.Type.isArray(n)){n=[]}n=n.slice(0,this.maxEntryAmount);t.Dom.clean(this.getEventListWrap());var a=this.getEventListWrap();n.forEach((function(e,t){if(t===0){i.setReloadTimeout(e)}a.appendChild(i.renderEntry(e))}));if(n.length){this.showWidget()}else{this.hideWidget()}this.needReload=false}},{key:"renderEntry",value:function e(i){var n=BX.Calendar.Util.parseDate(i["DATE_FROM"]);return t.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a href="','" class="sidebar-widget-item">\n\t\t\t\t<span class="calendar-item-date">','</span>\n\t\t\t\t<span class="calendar-item-text">\n\t\t\t\t\t<span class="calendar-item-link">','</span>\n\t\t\t\t</span>\n\t\t\t\t<span class="calendar-item-icon">\n\t\t\t\t\t<span class="calendar-item-icon-day">','</span>\n\t\t\t\t\t<span class="calendar-item-icon-date">',"</span>\n\t\t\t\t</span>\n\t\t\t</a>\n\t\t"])),t.Text.encode(i["~URL"]),i["~FROM_TO_HTML"],t.Text.encode(i["NAME"]),t.Text.encode(i["~WEEK_DAY"]),n.getDate())}},{key:"getOuterWrap",value:function e(){if(!this.DOM.outerWrap){this.DOM.outerWrap=document.querySelector(".sidebar-widget.sidebar-widget-calendar")}return this.DOM.outerWrap}},{key:"getEventListWrap",value:function e(){if(!this.DOM.listWrap){this.DOM.listWrap=this.getOuterWrap().querySelector(".calendar-events-wrap")}return this.DOM.listWrap}},{key:"setReloadTimeout",value:function e(i){if(this.reloadTimeout){clearTimeout(this.reloadTimeout);this.reloadTimeout=null}var n=BX.Calendar.Util.parseDate(i["DATE_TO"]);if(t.Type.isDate(n)){var a=new Date;var s=Math.min(Math.max(n.getTime()-a.getTime()+6e4,6e4),864e5);this.reloadTimeout=setTimeout(this.displayEventList.bind(this),s)}}},{key:"isDisplayingNow",value:function e(){return!document.hidden&&!BX.SidePanel.Instance.getOpenSliders().length}}]);return e}();t.Reflection.namespace("BX.Calendar").NextEventList=s})(this.window=this.window||{},BX,BX.Calendar,BX.Event);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:108:"/bitrix/templates/bitrix24/components/bitrix/socialnetwork.blog.blog/important/script.min.js?172645657613923";s:6:"source";s:88:"/bitrix/templates/bitrix24/components/bitrix/socialnetwork.blog.blog/important/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(window){if(top.BSBBW)return true;function animation(t,e){if(!BX.browser.isPropertySupported("transform"))return false;function s(t){if(BX.browser.isPropertySupported(t))return BX.browser.isPropertySupported(t);else return false}function i(){var t=["moz","webkit","o","ms"],e=t.length,s="";while(e--)if("transform"in document.body.style){return s}else if(t[e]+"Transform"in document.body.style){s="-"+t[e].toLowerCase()+"-"}return s}var a=BX.create("div",{props:{className:"anim-corner-gradient"}});var n=BX.create("div",{props:{className:"anim-corner"},children:[a]}),o=BX.create("div",{props:{className:"anim-corner-wrap"},children:[n]}),r=BX.create("div",{props:{className:"block-distort-shadow-wrap"},children:[BX.create("div",{props:{className:"block-distort-shadow"}})]}),h=BX.create("div",{props:{className:"block-distort"},children:[t,o]}),d=BX.create("div",{props:{className:"main-mes-wrap"},children:[h,r]});e.appendChild(d);h.style[s("transformOrigin")]="180px 130px";h.style[s("transform")]="rotate(42deg)";t.style[s("transformOrigin")]="50% 100%";t.style[s("transformOrigin")]="50% 100%";t.style[s("transform")]="rotate(-42deg)";o.style[s("transform")]="rotate(-42deg)";var l=new BX.easing({duration:100,start:{height:475,bottom:-182,left:-124,shadow_height:0,shadow_bottom:-74,gradient_height:0,gradient_width:0},finish:{height:342,bottom:-50,left:-72,shadow_height:130,shadow_bottom:-52,gradient_height:172,gradient_width:197},transition:BX.easing.transitions.linear(),step:function(t){h.style.height=t.height+"px";o.style.left=t.left+"px";o.style.bottom=t.bottom+"px";r.style.height=t.shadow_height+"px";r.style.bottom=t.shadow_bottom+"px";a.style.height=t.gradient_height+"px";a.style.width=t.gradient_width+"px"},complete:function(){var e;o.style[s("transformOrigin")]="62px 0";o.style.left=-17+"px";o.style.bottom=-183+"px";r.style[s("transformOrigin")]="28px 0";r.style.left="-28px";r.style.bottom="46px";h.style[s("transformOrigin")]="47px 100%";h.style.top=-195+"px";h.style.left=-46+"px";t.style[s("transformOrigin")]="0 0";t.style.top=337+"px";t.style.left=41+"px";var l=new BX.easing({duration:200,start:{distort_rotate:42,shadow_rotate:42,shadow_skew:0,corner_rotate:-42,corner_height:180,corner_bottom:-183,message_rotate:-42,gradient_rotate:42},finish:{distort_rotate:34,shadow_rotate:34,shadow_skew:11,corner_rotate:-50,corner_height:251,corner_bottom:-248,message_rotate:-34,gradient_rotate:48},transition:BX.easing.transitions.linear(),step:function(e){h.style[s("transform")]="rotate("+e.distort_rotate+"deg)";o.style[s("transform")]="rotate("+e.corner_rotate+"deg)";o.style.bottom=e.corner_bottom+"px";n.style.height=e.corner_height+"px";r.style[s("transform")]="rotate("+e.shadow_rotate+"deg)";t.style[s("transform")]="rotate("+e.message_rotate+"deg)";a.style.height=e.corner_height+"px";a.style.backgroundImage=i()+"linear-gradient("+e.gradient_rotate+"deg, #ece297 42%, #e5d38e 57%, #f6e9a3 78%)"},complete:function(){n.style[s("transformOrigin")]="100% 0";n.style.boxShadow="none";if(i()=="-webkit-")e=24;else e=67;var l=new BX.easing({duration:200,start:{distort_rotate:34,corner_rotate:-50,corner_width:260,corner_height:251,corner_skew:0,message_rotate:-34,shadow_rotate:34,shadow_skew:0,shadow_width:340,opacity:10,gradient_rotate:48,gradient_percent:57},finish:{distort_rotate:16,corner_rotate:-60,corner_width:236,corner_height:256,corner_skew:8,message_rotate:-16,shadow_rotate:16,shadow_skew:15,shadow_width:301,opacity:0,gradient_rotate:e,gradient_percent:50},transition:BX.easing.transitions.linear(),step:function(e){h.style[s("transform")]="rotate("+e.distort_rotate+"deg)";h.style.opacity=e.opacity/10;o.style[s("transform")]="rotate("+e.corner_rotate+"deg)";n.style[s("transform")]="skew("+e.corner_skew+"deg, 0deg)";n.style.width=e.corner_width+"px";n.style.height=e.corner_height+"px";a.style.height=e.corner_height+"px";t.style[s("transform")]="rotate("+e.message_rotate+"deg)";r.style[s("transform")]="rotate("+e.shadow_rotate+"deg) skew("+e.shadow_skew+"deg, 0)";r.style.width=e.shadow_width+"px";r.style.opacity=e.opacity/10;a.style.backgroundImage=i()+"linear-gradient("+e.gradient_rotate+"deg, #ece297 42%, #e5d38e "+e.gradient_percent+"%, #f6e9a3 78%)"},complete:function(){d.style.display="none"}});l.animate()}});l.animate()}});l.animate()}top.BSBBW=function(t){this.CID=t["CID"];this.controller=t["controller"];this.nodes=t["nodes"];this.tMessage=this.nodes["template"].innerHTML;this.url=t["url"];this.options=t["options"];this.post_info=t["post_info"];this.post_info["AJAX_POST"]="Y";this.sended=false;this.active=false;this.inited=false;this.busy=false;this.userCounter=0;this.inited=this.init(t);this.show();BX.addCustomEvent(this.controller,"onDataAppeared",BX.delegate(this.onDataAppeared,this));BX.addCustomEvent(this.controller,"onDataRanOut",BX.delegate(this.onDataRanOut,this));BX.addCustomEvent(this.controller,"onReachedLimit",BX.delegate(this.onReachedLimit,this));BX.addCustomEvent(this.controller,"onRequestSend",BX.delegate(this.showWait,this));BX.addCustomEvent(this.controller,"onResponseCame",BX.delegate(this.hideWait,this));BX.addCustomEvent(this.controller,"onResponseFailed",BX.delegate(this.hideWait,this));BX.addCustomEvent(window,"onImUpdateCounter",BX.delegate(this.onImUpdateCounter,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(function(t,e){if(t=="user_counter"&&e[BX.message("SITE_ID")]&&e[BX.message("SITE_ID")]["BLOG_POST_IMPORTANT"]){this.onImUpdateCounter(e[BX.message("SITE_ID")])}},this));BX.addCustomEvent(window,"onSonetLogCounterClear",BX.delegate(function(){this.onImUpdateCounter({BLOG_POST_IMPORTANT:0})},this));BX.addCustomEvent(window,"onImportantPostRead",BX.delegate(this.onImportantPostRead,this))};top.BSBBW.prototype={init:function(t){this.page_settings=t["page_settings"];this.page_settings["NavRecordCount"]=parseInt(this.page_settings["NavRecordCount"]);this.limit=this.page_settings["NavPageCount"]>1?3:0;this.current=0;if(this.active)clearTimeout(this.active);this.active=false;this.data_id={};this.data=t["data"];for(var e in this.data)this.data_id["id"+this.data[e]["id"]]="normal";if(this.data.length<=0)BX.onCustomEvent(this.controller,"onDataRanOut");else BX.onCustomEvent(this.controller,"onDataAppeared");if(!this.inited){BX.bind(this.nodes["right"],"click",BX.delegate(function(){this.onShiftPage("right")},this));BX.bind(this.nodes["left"],"click",BX.delegate(function(){this.onShiftPage("left")},this));BX.adjust(this.nodes["btn"],{attrs:{url:this.url},events:{click:BX.delegate(this.onClickToRead,this)}})}return true},show:function(){var t=this.tMessage,e=this.data[this.current];if(!e)return;for(var s in e)t=t.replace("__"+s+"__",e[s]);this.nodes["leaf"].innerHTML=t;this.nodes["text"].innerHTML=t;this.nodes["counter"].innerHTML=this.current+1;this.nodes["total"].innerHTML=this.page_settings["NavRecordCount"];var i=BX.findChild(this.nodes["text"],{className:"sidebar-imp-mess-text"},true);var a=BX.findChild(this.nodes["text"],{attribute:{"data-bx-author-avatar":true}},true);if(!!i){BX.adjust(i,{attrs:{url:this.url},events:{click:BX.delegate(this.onClickToRead,this)}})}if(e["author_avatar_style"]!==""&&!!a){BX.adjust(a,{style:{backgroundImage:e["author_avatar_style"],backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover",backgroundColor:"transparent"}})}i=BX.findChild(this.nodes["leaf"],{className:"sidebar-imp-mess-text"},true);a=BX.findChild(this.nodes["leaf"],{attribute:{"data-bx-author-avatar":true}},true);if(e["author_avatar_style"]!==""&&!!a){BX.adjust(a,{style:{backgroundImage:e["author_avatar_style"],backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover",backgroundColor:"transparent"}})}},showWait:function(){},hideWait:function(){},onImUpdateCounter:function(t){var e=parseInt(t["BLOG_POST_IMPORTANT"]);if(this.userCounter!=e){this.userCounter=e;if(this.userCounter>0){this.startCheck()}}},startCheck:function(){if(this.busy!==true){var t=this.post_info;t["sessid"]=BX.bitrix_sessid();t["page_settings"]=this.page_settings;t["page_settings"]["iNumPage"]=null;BX.ajax({method:"POST",processData:false,url:this.url,data:t,onsuccess:BX.delegate(function(t){this.busy=false;this.parseResponse(t,true)},this),onfailure:BX.delegate(function(t){this.busy=false;this.onResponseFailed(t)},this)})}},parseResponse:function(response,fromCheck){var data=false,result=false;try{eval("result="+response+";")}catch(t){}if(!result||!result.data||result.data.length<=0)data=false;else if(fromCheck===true){var dataNew=[],data=result.data;for(var ii in data){if(typeof data[ii]=="object"&&!this.data_id["id"+data[ii]["id"]]){dataNew.push(data[ii])}}result.page_settings["NavRecordCount"]=parseInt(result.page_settings["NavRecordCount"]);this.page_settings["NavRecordCount"]=parseInt(this.page_settings["NavRecordCount"]);if(this.data.length>0&&dataNew.length==result.page_settings["NavRecordCount"]-this.page_settings["NavRecordCount"]){var d=dataNew.pop();while(!!d){this.data_id["id"+d["id"]]="normal";this.data.unshift(d);this.current++;d=dataNew.pop()}this.page_settings["NavPageCount"]=result.page_settings["NavPageCount"];this.page_settings["NavRecordCount"]=result.page_settings["NavRecordCount"];this.show()}else{var current=0,res=this.data[this.current];if(this.data.length>0&&!!res){for(var ii=0;ii<data.length;ii++){if(typeof data[ii]=="object"&&data[ii]["id"]==res["id"]){current=ii;break}}}this.init(result);this.current=current;this.show()}}else{this.page_settings["NavPageNomer"]=result.page_settings["NavPageNomer"];data=result.data;for(var ii in data){if(typeof data[ii]=="object"&&!this.data_id["id"+data[ii]["id"]]){this.data_id["id"+data[ii]["id"]]="normal";this.data.push(data[ii])}}if(this.data.length>0)BX.onCustomEvent(this.controller,"onDataAppeared")}return true},onClickToRead:function(t){var e=this.data[this.current],s=[],i;for(i in this.options)s.push({post_id:e["id"],name:this.options[i]["name"],value:this.options[i]["value"]});var a=this.post_info;a["options"]=s;a["page_settings"]=this.page_settings;a["sessid"]=BX.bitrix_sessid();t=t===false?false:true;a=BX.ajax.prepareData(a);if(t){BX.ajax({method:"GET",url:this.url+(this.url.indexOf("?")!==-1?"&":"?")+a,onsuccess:BX.delegate(this.onAfterClickToRead,this),onfailure:function(t){}})}this.onShiftPage("drop");animation(this.nodes["leaf"],this.nodes["block"])},onAfterClickToRead:function(){},onShiftPage:function(t){if(this.active)clearTimeout(this.active);this.active=setTimeout(BX.delegate(function(){this.active=false},this),12e4);if(t=="drop"){this.page_settings["NavRecordCount"]--;this.data_id["id"+this.data[this.current]["id"]]="readed";this.data=BX.util.deleteFromArray(this.data,this.current);if(!!this.data&&this.data.length>0){this.current=this.current-1;t="left"}else{BX.onCustomEvent(this.controller,"onDataRanOut");return}}if(t=="right"){if(this.current<=0){this.page_settings["NavRecordCount"]=parseInt(this.page_settings["NavRecordCount"]);if(this.data.length<this.page_settings["NavRecordCount"])this.current=1;else this.current=this.data.length}this.current=this.current-1}else{if(this.current>=this.data.length-1)this.current=0;else this.current=this.current+1}if(this.limit>0&&this.current>=this.data.length-1-this.limit)BX.onCustomEvent(this.controller,"onReachedLimit");this.show()},onDataRanOut:function(){if((!this.data||this.data.length<=0)&&this.controller.style.display!="none"){this.bodyAnimationheight=this.controller.offsetHeight;(this.bodyAnimation=new BX.easing({duration:200,start:{height:this.controller.offsetHeight,opacity:100},finish:{height:0,opacity:0},transition:BX.easing.makeEaseInOut(BX.easing.transitions.quart),step:BX.delegate(function(t){BX.adjust(this.controller,{style:{height:t.height+"px",opacity:t.opacity/100}})},this),complete:BX.delegate(function(){this.controller.style.display="none"},this)})).animate()}},onDataAppeared:function(){if(!!this.data&&this.data.length>0&&this.controller.style.display=="none"){var t=!!this.bodyAnimationheight?this.bodyAnimationheight:200;this.controller.style.display="block";(this.bodyAnimation=new BX.easing({duration:200,start:{height:0,opacity:0},finish:{height:t,opacity:100},transition:BX.easing.makeEaseInOut(BX.easing.transitions.quart),step:BX.delegate(function(t){BX.adjust(this.controller,{style:{height:t.height+"px",opacity:t.opacity/100}})},this),complete:BX.delegate(function(){BX.adjust(this.controller,{style:{display:"block",height:"auto",opacity:"auto"}})},this)})).animate()}},onReachedLimit:function(){if(this.sended===true)return;var t=this.post_info,e=false;this.page_settings["NavPageNomer"]=parseInt(this.page_settings["NavPageNomer"]);this.page_settings["NavPageCount"]=parseInt(this.page_settings["NavPageCount"]);if(this.page_settings["NavPageCount"]<=1)e=true;else if(this.page_settings["bDescPageNumbering"]==true){if(this.page_settings["NavPageNomer"]>1)this.page_settings["iNumPage"]=parseInt(this.page_settings["NavPageNomer"])-1;else e=true}else if(this.page_settings["NavPageNomer"]<this.page_settings["NavPageCount"])this.page_settings["iNumPage"]=parseInt(this.page_settings["NavPageNomer"])+1;else e=true;if(e===true){BX.removeCustomEvent(this.controller,"onReachedLimit",BX.delegate(this.onReachedLimit,this));return true}BX.onCustomEvent(this.controller,"onRequestSend");this.sended=true;t["page_settings"]=this.page_settings;t["sessid"]=BX.bitrix_sessid();BX.ajax({method:"POST",processData:false,url:this.url,data:t,onsuccess:BX.delegate(this.onResponseCame,this),onfailure:BX.delegate(this.onResponseFailed,this)})},onResponseCame:function(t){this.sended=false;BX.onCustomEvent(this.controller,"onResponseCame");this.parseResponse(t)},onResponseFailed:function(t){this.sended=false;BX.onCustomEvent(this.controller,"onResponseFailed")},onImportantPostRead:function(t,e){if(t>0){for(var s in this.data){if(this.data[s]["id"]==t){this.current=s;this.onClickToRead(e==this.CID);break}}}}}})(window);
/* End */
;; /* /bitrix/components/bitrix/socialnetwork.log.ex/templates/.default/script.min.js?17264564252044*/
; /* /bitrix/components/bitrix/socialnetwork.log.entry/templates/.default/scripts.min.js?17264564259164*/
; /* /bitrix/components/bitrix/socialnetwork.blog.post.edit/templates/.default/script.min.js?172645642550105*/
; /* /bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?172645624470830*/
; /* /bitrix/components/bitrix/system.field.edit/script.min.js?1726456244814*/
; /* /bitrix/components/bitrix/disk.uf.file/templates/.default/script.min.js?172645630266406*/
; /* /bitrix/components/bitrix/search.tags.input/templates/.default/script.js?172645641313020*/
; /* /bitrix/components/bitrix/voting.uf/templates/.default/script.min.js?172645645111231*/
; /* /bitrix/components/bitrix/voting.vote.edit/templates/.default/script.min.js?172645645112569*/
; /* /bitrix/components/bitrix/lists.live.feed/templates/.default/script.min.js?172645636918900*/
; /* /bitrix/components/bitrix/ui.tile.selector/templates/.default/script.min.js?172645644914347*/
; /* /bitrix/components/bitrix/intranet.user.selector.new/templates/.default/users.min.js?172645635714177*/
; /* /bitrix/components/bitrix/crm.field.element/templates/main.edit/script.min.js?17264562874990*/
; /* /bitrix/components/bitrix/main.user.selector/templates/.default/script.min.js?17264562448493*/
; /* /bitrix/components/bitrix/lists.live.feed/templates/.default/right.min.js?17264563693556*/
; /* /bitrix/components/bitrix/socialnetwork.log.filter/templates/.default/script.min.js?172645642511024*/
; /* /bitrix/components/bitrix/main.ui.selector/templates/.default/script.min.js?172645624413346*/
; /* /bitrix/components/bitrix/main.ui.filter/templates/.default/script.min.js?1726456244176333*/
; /* /bitrix/components/bitrix/socialnetwork.blog.post/templates/.default/script.min.js?172645642526365*/
; /* /bitrix/components/bitrix/socialnetwork.blog.post.comment/templates/.default/script.min.js?17264564252906*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/script.min.js?172645624455869*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form.min.js?172645624412332*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_form2.min.js?172645624414615*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/scripts_for_im.min.js?17264562448220*/
; /* /bitrix/components/bitrix/intranet.bitrix24.banner/templates/.default/script.min.js?17264563572008*/
; /* /bitrix/components/bitrix/intranet.ustat.online/templates/.default/script.min.js?172645635718875*/
; /* /bitrix/components/bitrix/calendar.events.list/templates/widget/script.min.js?17264562643822*/
; /* /bitrix/templates/bitrix24/components/bitrix/socialnetwork.blog.blog/important/script.min.js?172645657613923*/

//# sourceMappingURL=page_live_feed_v2.map.js